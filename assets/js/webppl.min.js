(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports=LRUCache;var Map=require("pseudomap");var util=require("util");var Yallist=require("yallist");var symbols={};var hasSymbol=typeof Symbol==="function";var makeSymbol;if(hasSymbol){makeSymbol=function(key){return Symbol.for(key)}}else{makeSymbol=function(key){return"_"+key}}function priv(obj,key,val){var sym;if(symbols[key]){sym=symbols[key]}else{sym=makeSymbol(key);symbols[key]=sym}if(arguments.length===2){return obj[sym]}else{obj[sym]=val;return val}}function naiveLength(){return 1}function LRUCache(options){if(!(this instanceof LRUCache)){return new LRUCache(options)}if(typeof options==="number"){options={max:options}}if(!options){options={}}var max=priv(this,"max",options.max);if(!max||!(typeof max==="number")||max<=0){priv(this,"max",Infinity)}var lc=options.length||naiveLength;if(typeof lc!=="function"){lc=naiveLength}priv(this,"lengthCalculator",lc);priv(this,"allowStale",options.stale||false);priv(this,"maxAge",options.maxAge||0);priv(this,"dispose",options.dispose);this.reset()}Object.defineProperty(LRUCache.prototype,"max",{set:function(mL){if(!mL||!(typeof mL==="number")||mL<=0){mL=Infinity}priv(this,"max",mL);trim(this)},get:function(){return priv(this,"max")},enumerable:true});Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(allowStale){priv(this,"allowStale",!!allowStale)},get:function(){return priv(this,"allowStale")},enumerable:true});Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(mA){if(!mA||!(typeof mA==="number")||mA<0){mA=0}priv(this,"maxAge",mA);trim(this)},get:function(){return priv(this,"maxAge")},enumerable:true});Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(lC){if(typeof lC!=="function"){lC=naiveLength}if(lC!==priv(this,"lengthCalculator")){priv(this,"lengthCalculator",lC);priv(this,"length",0);priv(this,"lruList").forEach(function(hit){hit.length=priv(this,"lengthCalculator").call(this,hit.value,hit.key);priv(this,"length",priv(this,"length")+hit.length)},this)}trim(this)},get:function(){return priv(this,"lengthCalculator")},enumerable:true});Object.defineProperty(LRUCache.prototype,"length",{get:function(){return priv(this,"length")},enumerable:true});Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return priv(this,"lruList").length},enumerable:true});LRUCache.prototype.rforEach=function(fn,thisp){thisp=thisp||this;for(var walker=priv(this,"lruList").tail;walker!==null;){var prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev}};function forEachStep(self,fn,node,thisp){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!priv(self,"allowStale")){hit=undefined}}if(hit){fn.call(thisp,hit.value,hit.key,self)}}LRUCache.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=priv(this,"lruList").head;walker!==null;){var next=walker.next;forEachStep(this,fn,walker,thisp);walker=next}};LRUCache.prototype.keys=function(){return priv(this,"lruList").toArray().map(function(k){return k.key},this)};LRUCache.prototype.values=function(){return priv(this,"lruList").toArray().map(function(k){return k.value},this)};LRUCache.prototype.reset=function(){if(priv(this,"dispose")&&priv(this,"lruList")&&priv(this,"lruList").length){priv(this,"lruList").forEach(function(hit){priv(this,"dispose").call(this,hit.key,hit.value)},this)}priv(this,"cache",new Map);priv(this,"lruList",new Yallist);priv(this,"length",0)};LRUCache.prototype.dump=function(){return priv(this,"lruList").map(function(hit){if(!isStale(this,hit)){return{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)}}},this).toArray().filter(function(h){return h})};LRUCache.prototype.dumpLru=function(){return priv(this,"lruList")};LRUCache.prototype.inspect=function(n,opts){var str="LRUCache {";var extras=false;var as=priv(this,"allowStale");if(as){str+="\n  allowStale: true";extras=true}var max=priv(this,"max");if(max&&max!==Infinity){if(extras){str+=","}str+="\n  max: "+util.inspect(max,opts);extras=true}var maxAge=priv(this,"maxAge");if(maxAge){if(extras){str+=","}str+="\n  maxAge: "+util.inspect(maxAge,opts);extras=true}var lc=priv(this,"lengthCalculator");if(lc&&lc!==naiveLength){if(extras){str+=","}str+="\n  length: "+util.inspect(priv(this,"length"),opts);extras=true}var didFirst=false;priv(this,"lruList").forEach(function(item){if(didFirst){str+=",\n  "}else{if(extras){str+=",\n"}didFirst=true;str+="\n  "}var key=util.inspect(item.key).split("\n").join("\n  ");var val={value:item.value};if(item.maxAge!==maxAge){val.maxAge=item.maxAge}if(lc!==naiveLength){val.length=item.length}if(isStale(this,item)){val.stale=true}val=util.inspect(val,opts).split("\n").join("\n  ");str+=key+" => "+val});if(didFirst||extras){str+="\n"}str+="}";return str};LRUCache.prototype.set=function(key,value,maxAge){maxAge=maxAge||priv(this,"maxAge");var now=maxAge?Date.now():0;var len=priv(this,"lengthCalculator").call(this,value,key);if(priv(this,"cache").has(key)){if(len>priv(this,"max")){del(this,priv(this,"cache").get(key));return false}var node=priv(this,"cache").get(key);var item=node.value;if(priv(this,"dispose")){priv(this,"dispose").call(this,key,item.value)}item.now=now;item.maxAge=maxAge;item.value=value;priv(this,"length",priv(this,"length")+(len-item.length));item.length=len;this.get(key);trim(this);return true}var hit=new Entry(key,value,len,now,maxAge);if(hit.length>priv(this,"max")){if(priv(this,"dispose")){priv(this,"dispose").call(this,key,value)}return false}priv(this,"length",priv(this,"length")+hit.length);priv(this,"lruList").unshift(hit);priv(this,"cache").set(key,priv(this,"lruList").head);trim(this);return true};LRUCache.prototype.has=function(key){if(!priv(this,"cache").has(key))return false;var hit=priv(this,"cache").get(key).value;if(isStale(this,hit)){return false}return true};LRUCache.prototype.get=function(key){return get(this,key,true)};LRUCache.prototype.peek=function(key){return get(this,key,false)};LRUCache.prototype.pop=function(){var node=priv(this,"lruList").tail;if(!node)return null;del(this,node);return node.value};LRUCache.prototype.del=function(key){del(this,priv(this,"cache").get(key))};LRUCache.prototype.load=function(arr){this.reset();var now=Date.now();for(var l=arr.length-1;l>=0;l--){var hit=arr[l];var expiresAt=hit.e||0;if(expiresAt===0){this.set(hit.k,hit.v)}else{var maxAge=expiresAt-now;if(maxAge>0){this.set(hit.k,hit.v,maxAge)}}}};LRUCache.prototype.prune=function(){var self=this;priv(this,"cache").forEach(function(value,key){get(self,key,false)})};function get(self,key,doUse){var node=priv(self,"cache").get(key);if(node){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!priv(self,"allowStale"))hit=undefined}else{if(doUse){priv(self,"lruList").unshiftNode(node)}}if(hit)hit=hit.value}return hit}function isStale(self,hit){if(!hit||!hit.maxAge&&!priv(self,"maxAge")){return false}var stale=false;var diff=Date.now()-hit.now;if(hit.maxAge){stale=diff>hit.maxAge}else{stale=priv(self,"maxAge")&&diff>priv(self,"maxAge")}return stale}function trim(self){if(priv(self,"length")>priv(self,"max")){for(var walker=priv(self,"lruList").tail;priv(self,"length")>priv(self,"max")&&walker!==null;){var prev=walker.prev;del(self,walker);walker=prev}}}function del(self,node){if(node){var hit=node.value;if(priv(self,"dispose")){priv(self,"dispose").call(this,hit.key,hit.value)}priv(self,"length",priv(self,"length")-hit.length);priv(self,"cache").delete(hit.key);priv(self,"lruList").removeNode(node)}}function Entry(key,value,length,now,maxAge){this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0}},{pseudomap:3,util:339,yallist:201}],2:[function(require,module,exports){var paper=new function(undefined){var Base=new function(){var hidden=/^(statics|enumerable|beans|preserve)$/,forEach=[].forEach||function(iter,bind){for(var i=0,l=this.length;i<l;i++)iter.call(bind,this[i],i,this)},forIn=function(iter,bind){for(var i in this)if(this.hasOwnProperty(i))iter.call(bind,this[i],i,this)},create=Object.create||function(proto){return{__proto__:proto}},describe=Object.getOwnPropertyDescriptor||function(obj,name){var get=obj.__lookupGetter__&&obj.__lookupGetter__(name);return get?{get:get,set:obj.__lookupSetter__(name),enumerable:true,configurable:true}:obj.hasOwnProperty(name)?{value:obj[name],enumerable:true,configurable:true,writable:true}:null},_define=Object.defineProperty||function(obj,name,desc){if((desc.get||desc.set)&&obj.__defineGetter__){if(desc.get)obj.__defineGetter__(name,desc.get);if(desc.set)obj.__defineSetter__(name,desc.set)}else{obj[name]=desc.value}return obj},define=function(obj,name,desc){delete obj[name];return _define(obj,name,desc)};function inject(dest,src,enumerable,beans,preserve){var beansNames={};function field(name,val){val=val||(val=describe(src,name))&&(val.get?val:val.value);if(typeof val==="string"&&val[0]==="#")val=dest[val.substring(1)]||val;var isFunc=typeof val==="function",res=val,prev=preserve||isFunc&&!val.base?val&&val.get?name in dest:dest[name]:null,bean;if(!preserve||!prev){if(isFunc&&prev)val.base=prev;if(isFunc&&beans!==false&&(bean=name.match(/^([gs]et|is)(([A-Z])(.*))$/)))beansNames[bean[3].toLowerCase()+bean[4]]=bean[2];if(!res||isFunc||!res.get||typeof res.get!=="function"||!Base.isPlainObject(res))res={value:res,writable:true};if((describe(dest,name)||{configurable:true}).configurable){res.configurable=true;res.enumerable=enumerable}define(dest,name,res)}}if(src){for(var name in src){if(src.hasOwnProperty(name)&&!hidden.test(name))field(name)}for(var name in beansNames){var part=beansNames[name],set=dest["set"+part],get=dest["get"+part]||set&&dest["is"+part];if(get&&(beans===true||get.length===0))field(name,{get:get,set:set})}}return dest}function each(obj,iter,bind){if(obj)("length"in obj&&!obj.getLength&&typeof obj.length==="number"?forEach:forIn).call(obj,iter,bind=bind||obj);return bind}function set(obj,props,exclude){for(var key in props)if(props.hasOwnProperty(key)&&!(exclude&&exclude[key]))obj[key]=props[key];return obj}return inject(function Base(){for(var i=0,l=arguments.length;i<l;i++)set(this,arguments[i])},{inject:function(src){if(src){var statics=src.statics===true?src:src.statics,beans=src.beans,preserve=src.preserve;if(statics!==src)inject(this.prototype,src,src.enumerable,beans,preserve);inject(this,statics,true,beans,preserve)}for(var i=1,l=arguments.length;i<l;i++)this.inject(arguments[i]);return this},extend:function(){var base=this,ctor,proto;for(var i=0,l=arguments.length;i<l;i++)if(ctor=arguments[i].initialize)break;ctor=ctor||function(){base.apply(this,arguments)};proto=ctor.prototype=create(this.prototype);define(proto,"constructor",{value:ctor,writable:true,configurable:true});inject(ctor,this,true);if(arguments.length)this.inject.apply(ctor,arguments);ctor.base=base;return ctor}},true).inject({inject:function(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i];if(src)inject(this,src,src.enumerable,src.beans,src.preserve)}return this},extend:function(){var res=create(this);return res.inject.apply(res,arguments)},each:function(iter,bind){return each(this,iter,bind)},set:function(props){return set(this,props)},clone:function(){return new this.constructor(this)},statics:{each:each,create:create,define:define,describe:describe,set:set,clone:function(obj){return set(new obj.constructor,obj)},isPlainObject:function(obj){var ctor=obj!=null&&obj.constructor;return ctor&&(ctor===Object||ctor===Base||ctor.name==="Object")},pick:function(a,b){return a!==undefined?a:b}}})};if(typeof module!=="undefined")module.exports=Base;Base.inject({toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+Base.each(this,function(value,key){if(!/^_/.test(key)){var type=typeof value;this.push(key+": "+(type==="number"?Formatter.instance.number(value):type==="string"?"'"+value+"'":value))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(options){return Base.exportJSON(this,options)},toJSON:function(){return Base.serialize(this)},_set:function(props,exclude,dontCheck){if(props&&(dontCheck||Base.isPlainObject(props))){var keys=Object.keys(props._filtering||props);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];if(!(exclude&&exclude[key])){var value=props[key];if(value!==undefined)this[key]=value}}return true}},statics:{exports:{enumerable:true},extend:function extend(){var res=extend.base.apply(this,arguments),name=res.prototype._class;if(name&&!Base.exports[name])Base.exports[name]=res;return res},equals:function(obj1,obj2){if(obj1===obj2)return true;if(obj1&&obj1.equals)return obj1.equals(obj2);if(obj2&&obj2.equals)return obj2.equals(obj1);if(obj1&&obj2&&typeof obj1==="object"&&typeof obj2==="object"){if(Array.isArray(obj1)&&Array.isArray(obj2)){var length=obj1.length;if(length!==obj2.length)return false;while(length--){if(!Base.equals(obj1[length],obj2[length]))return false}}else{var keys=Object.keys(obj1),length=keys.length;if(length!==Object.keys(obj2).length)return false;while(length--){var key=keys[length];if(!(obj2.hasOwnProperty(key)&&Base.equals(obj1[key],obj2[key])))return false}}return true}return false},read:function(list,start,options,length){if(this===Base){var value=this.peek(list,start);list.__index++;return value}var proto=this.prototype,readIndex=proto._readIndex,index=start||readIndex&&list.__index||0;if(!length)length=list.length-index;var obj=list[index];if(obj instanceof this||options&&options.readNull&&obj==null&&length<=1){if(readIndex)list.__index=index+1;return obj&&options&&options.clone?obj.clone():obj}obj=Base.create(this.prototype);if(readIndex)obj.__read=true;obj=obj.initialize.apply(obj,index>0||length<list.length?Array.prototype.slice.call(list,index,index+length):list)||obj;if(readIndex){list.__index=index+obj.__read;obj.__read=undefined}return obj},peek:function(list,start){return list[list.__index=start||list.__index||0]},remain:function(list){return list.length-(list.__index||0)},readAll:function(list,start,options){var res=[],entry;for(var i=start||0,l=list.length;i<l;i++){res.push(Array.isArray(entry=list[i])?this.read(entry,0,options):this.read(list,i,options,1))}return res},readNamed:function(list,name,start,options,length){var value=this.getNamed(list,name),hasObject=value!==undefined;if(hasObject){var filtered=list._filtered;if(!filtered){filtered=list._filtered=Base.create(list[0]);filtered._filtering=list[0]}filtered[name]=undefined}return this.read(hasObject?[value]:list,start,options,length)},getNamed:function(list,name){var arg=list[0];if(list._hasObject===undefined)list._hasObject=list.length===1&&Base.isPlainObject(arg);if(list._hasObject)return name?arg[name]:list._filtered||arg},hasNamed:function(list,name){return!!this.getNamed(list,name)},isPlainValue:function(obj,asString){return this.isPlainObject(obj)||Array.isArray(obj)||asString&&typeof obj==="string"},serialize:function(obj,options,compact,dictionary){options=options||{};var root=!dictionary,res;if(root){options.formatter=new Formatter(options.precision);dictionary={length:0,definitions:{},references:{},add:function(item,create){var id="#"+item._id,ref=this.references[id];if(!ref){this.length++;var res=create.call(item),name=item._class;if(name&&res[0]!==name)res.unshift(name);this.definitions[id]=res;ref=this.references[id]=[id]}return ref}}}if(obj&&obj._serialize){res=obj._serialize(options,dictionary);var name=obj._class;if(name&&!compact&&!res._compact&&res[0]!==name)res.unshift(name)}else if(Array.isArray(obj)){res=[];for(var i=0,l=obj.length;i<l;i++)res[i]=Base.serialize(obj[i],options,compact,dictionary);if(compact)res._compact=true}else if(Base.isPlainObject(obj)){res={};var keys=Object.keys(obj);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];res[key]=Base.serialize(obj[key],options,compact,dictionary)}}else if(typeof obj==="number"){res=options.formatter.number(obj,options.precision)}else{res=obj}return root&&dictionary.length>0?[["dictionary",dictionary.definitions],res]:res},deserialize:function(json,create,_data,_isDictionary){var res=json,isRoot=!_data;_data=_data||{};if(Array.isArray(json)){var type=json[0],isDictionary=type==="dictionary";if(json.length==1&&/^#/.test(type))return _data.dictionary[type];type=Base.exports[type];res=[];if(_isDictionary)_data.dictionary=res;for(var i=type?1:0,l=json.length;i<l;i++)res.push(Base.deserialize(json[i],create,_data,isDictionary));if(type){var args=res;if(create){res=create(type,args)}else{res=Base.create(type.prototype);type.apply(res,args)}}}else if(Base.isPlainObject(json)){res={};if(_isDictionary)_data.dictionary=res;for(var key in json)res[key]=Base.deserialize(json[key],create,_data)}return isRoot&&json&&json.length&&json[0][0]==="dictionary"?res[1]:res},exportJSON:function(obj,options){var json=Base.serialize(obj,options);return options&&options.asString===false?json:JSON.stringify(json)},importJSON:function(json,target){return Base.deserialize(typeof json==="string"?JSON.parse(json):json,function(type,args){var obj=target&&target.constructor===type?target:Base.create(type.prototype),isTarget=obj===target;if(args.length===1&&obj instanceof Item&&(isTarget||!(obj instanceof Layer))){var arg=args[0];if(Base.isPlainObject(arg))arg.insert=false}type.apply(obj,args);if(isTarget)target=null;return obj})},splice:function(list,items,index,remove){var amount=items&&items.length,append=index===undefined;index=append?list.length:index;if(index>list.length)index=list.length;for(var i=0;i<amount;i++)items[i]._index=index+i;if(append){list.push.apply(list,items);return[]}else{var args=[index,remove];if(items)args.push.apply(args,items);var removed=list.splice.apply(list,args);for(var i=0,l=removed.length;i<l;i++)removed[i]._index=undefined;for(var i=index+amount,l=list.length;i<l;i++)list[i]._index=i;return removed}},capitalize:function(str){return str.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},camelize:function(str){return str.replace(/-(.)/g,function(all,chr){return chr.toUpperCase()})},hyphenate:function(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(type,func){if(typeof type!=="string"){Base.each(type,function(value,key){this.on(key,value)},this)}else{var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks=this._callbacks||{};handlers=handlers[type]=handlers[type]||[];if(handlers.indexOf(func)===-1){handlers.push(func);if(entry&&entry.install&&handlers.length===1)entry.install.call(this,type)}}return this},off:function(type,func){if(typeof type!=="string"){Base.each(type,function(value,key){this.off(key,value)},this);return}var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks&&this._callbacks[type],index;if(handlers){if(!func||(index=handlers.indexOf(func))!==-1&&handlers.length===1){if(entry&&entry.uninstall)entry.uninstall.call(this,type);delete this._callbacks[type]}else if(index!==-1){handlers.splice(index,1)}}return this},once:function(type,func){return this.on(type,function(){func.apply(this,arguments);this.off(type,func)})},emit:function(type,event){var handlers=this._callbacks&&this._callbacks[type];if(!handlers)return false;var args=[].slice.call(arguments,1);handlers=handlers.slice();for(var i=0,l=handlers.length;i<l;i++){if(handlers[i].apply(this,args)===false){if(event&&event.stop)event.stop();break}}return true},responds:function(type){return!!(this._callbacks&&this._callbacks[type])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(install){var handlers=this._callbacks,key=install?"install":"uninstall";for(var type in handlers){if(handlers[type].length>0){var types=this._eventTypes,entry=types&&types[type],func=entry&&entry[key];if(func)func.call(this,type)}}},statics:{inject:function inject(src){var events=src._events;if(events){var types={};Base.each(events,function(entry,key){var isString=typeof entry==="string",name=isString?entry:key,part=Base.capitalize(name),type=name.substring(2).toLowerCase();types[type]=isString?{}:entry;name="_"+name;src["get"+part]=function(){return this[name]};src["set"+part]=function(func){var prev=this[name];if(prev)this.off(type,prev);if(func)this.on(type,func);this[name]=func}});src._eventTypes=types}return inject.base.apply(this,arguments)}}};var PaperScope=Base.extend({_class:"PaperScope",initialize:function PaperScope(){paper=this;this.settings=new Base({applyMatrix:true,handleSize:4,hitTolerance:0});this.project=null;this.projects=[];this.tools=[];this.palettes=[];this._id=PaperScope._id++;PaperScope._scopes[this._id]=this;var proto=PaperScope.prototype;if(!this.support){var ctx=CanvasProvider.getContext(1,1);proto.support={nativeDash:"setLineDash"in ctx||"mozDash"in ctx,nativeBlendModes:BlendMode.nativeModes};CanvasProvider.release(ctx)}if(!this.browser){var agent=navigator.userAgent.toLowerCase(),platform=(/(win)/.exec(agent)||/(mac)/.exec(agent)||/(linux)/.exec(agent)||[])[0],browser=proto.browser={platform:platform};if(platform)browser[platform]=true;agent.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(all,n,v1,v2,rv){if(!browser.chrome){var v=n==="opera"?v2:v1;if(n==="trident"){v=rv;n="msie"}browser.version=v;browser.versionNumber=parseFloat(v);browser.name=n;browser[n]=true}});if(browser.chrome)delete browser.webkit;if(browser.atom)delete browser.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(code,url,options){paper.PaperScript.execute(code,this,url,options);View.updateFocus()},install:function(scope){var that=this;Base.each(["project","view","tool"],function(key){Base.define(scope,key,{configurable:true,get:function(){return that[key]}})});for(var key in this)if(!/^_/.test(key)&&this[key])scope[key]=this[key]},setup:function(element){paper=this;this.project=new Project(element);return this},activate:function(){paper=this},clear:function(){for(var i=this.projects.length-1;i>=0;i--)this.projects[i].remove();for(var i=this.tools.length-1;i>=0;i--)this.tools[i].remove();for(var i=this.palettes.length-1;i>=0;i--)this.palettes[i].remove()},remove:function(){this.clear();delete PaperScope._scopes[this._id]},statics:new function(){function handleAttribute(name){name+="Attribute";return function(el,attr){return el[name](attr)||el[name]("data-paper-"+attr)}}return{_scopes:{},_id:0,get:function(id){return this._scopes[id]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}});var PaperScopeItem=Base.extend(Emitter,{initialize:function(activate){this._scope=paper;this._index=this._scope[this._list].push(this)-1;if(activate||!this._scope[this._reference])this.activate()},activate:function(){if(!this._scope)return false;var prev=this._scope[this._reference];if(prev&&prev!==this)prev.emit("deactivate");this._scope[this._reference]=this;this.emit("activate",prev);return true},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(this._index==null)return false;Base.splice(this._scope[this._list],null,this._index,1);if(this._scope[this._reference]==this)this._scope[this._reference]=null;this._scope=null;return true}});var Formatter=Base.extend({initialize:function(precision){this.precision=precision||5;this.multiplier=Math.pow(10,this.precision)},number:function(val){return Math.round(val*this.multiplier)/this.multiplier},pair:function(val1,val2,separator){return this.number(val1)+(separator||",")+this.number(val2)},point:function(val,separator){return this.number(val.x)+(separator||",")+this.number(val.y)},size:function(val,separator){return this.number(val.width)+(separator||",")+this.number(val.height)},rectangle:function(val,separator){return this.point(val,separator)+(separator||",")+this.size(val,separator)}});Formatter.instance=new Formatter;var Numerical=new function(){var abscissas=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]];var weights=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]];var abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,EPSILON=1e-12,MACHINE_EPSILON=1.12e-16;function clip(value,min,max){return value<min?min:value>max?max:value}return{TOLERANCE:1e-6,EPSILON:EPSILON,MACHINE_EPSILON:MACHINE_EPSILON,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(sqrt(2)-1)/3,isZero:function(val){return val>=-EPSILON&&val<=EPSILON},integrate:function(f,a,b,n){var x=abscissas[n-2],w=weights[n-2],A=(b-a)*.5,B=A+a,i=0,m=n+1>>1,sum=n&1?w[i++]*f(B):0;while(i<m){var Ax=A*x[i];sum+=w[i++]*(f(B+Ax)+f(B-Ax))}return A*sum},findRoot:function(f,df,x,a,b,n,tolerance){for(var i=0;i<n;i++){var fx=f(x),dx=fx/df(x),nx=x-dx;if(abs(dx)<tolerance)return nx;if(fx>0){b=x;x=nx<=a?(a+b)*.5:nx}else{a=x;x=nx>=b?(a+b)*.5:nx}}return x},solveQuadratic:function(a,b,c,roots,min,max){var count=0,eMin=min-EPSILON,eMax=max+EPSILON,x1,x2=Infinity,B=b,D;b/=-2;D=b*b-a*c;if(D!==0&&abs(D)<MACHINE_EPSILON){var gmC=pow(abs(a*b*c),1/3);if(gmC<1e-8){var mult=pow(10,abs(Math.floor(Math.log(gmC)*Math.LOG10E)));if(!isFinite(mult))mult=0;a*=mult;b*=mult;c*=mult;D=b*b-a*c}}if(abs(a)<EPSILON){if(abs(B)<EPSILON)return abs(c)<EPSILON?-1:0;x1=-c/B}else if(D>=-MACHINE_EPSILON){var Q=D<0?0:sqrt(D),R=b+(b<0?-Q:Q);if(R===0){x1=c/a;x2=-x1}else{x1=R/a;x2=c/R}}if(isFinite(x1)&&(min==null||x1>eMin&&x1<eMax))roots[count++]=min==null?x1:clip(x1,min,max);if(x2!==x1&&isFinite(x2)&&(min==null||x2>eMin&&x2<eMax))roots[count++]=min==null?x2:clip(x2,min,max);return count},solveCubic:function(a,b,c,d,roots,min,max){var count=0,x,b1,c2;if(abs(a)<EPSILON){a=b;b1=c;c2=d;x=Infinity}else if(abs(d)<EPSILON){b1=b;c2=c;x=0}else{var ec=1+MACHINE_EPSILON,x0,q,qd,t,r,s,tmp;x=-(b/a)/3;tmp=a*x,b1=tmp+b,c2=b1*x+c,qd=(tmp+b1)*x+c2,q=c2*x+d;t=q/a;r=pow(abs(t),1/3);s=t<0?-1:1;t=-qd/a;r=t>0?1.3247179572*Math.max(r,sqrt(t)):r;x0=x-s*r;if(x0!==x){do{x=x0;tmp=a*x,b1=tmp+b,c2=b1*x+c,qd=(tmp+b1)*x+c2,q=c2*x+d;x0=qd===0?x:x-q/qd/ec;if(x0===x){x=x0;break}}while(s*x0>s*x);if(abs(a)*x*x>abs(d/x)){c2=-d/x;b1=(c2-c)/x}}}var count=Numerical.solveQuadratic(a,b1,c2,roots,min,max);if(isFinite(x)&&(count===0||x!==roots[count-1])&&(min==null||x>min-EPSILON&&x<max+EPSILON))roots[count++]=min==null?x:clip(x,min,max);return count}}};var UID={_id:1,_pools:{},get:function(ctor){if(ctor){var name=ctor._class,pool=this._pools[name];if(!pool)pool=this._pools[name]={_id:1};return pool._id++}else{return this._id++}}};var Point=Base.extend({_class:"Point",_readIndex:true,initialize:function Point(arg0,arg1){var type=typeof arg0;if(type==="number"){var hasY=typeof arg1==="number";this.x=arg0;this.y=hasY?arg1:arg0;if(this.__read)this.__read=hasY?2:1}else if(type==="undefined"||arg0===null){this.x=this.y=0;if(this.__read)this.__read=arg0===null?1:0}else{if(Array.isArray(arg0)){this.x=arg0[0];this.y=arg0.length>1?arg0[1]:arg0[0]}else if(arg0.x!=null){this.x=arg0.x;this.y=arg0.y}else if(arg0.width!=null){this.x=arg0.width;this.y=arg0.height}else if(arg0.angle!=null){this.x=arg0.length;this.y=0;this.setAngle(arg0.angle)}else{this.x=this.y=0;if(this.__read)this.__read=0}if(this.__read)this.__read=1}},set:function(x,y){this.x=x;this.y=y;return this},equals:function(point){return this===point||point&&(this.x===point.x&&this.y===point.y||Array.isArray(point)&&this.x===point[0]&&this.y===point[1])||false},clone:function(){return new Point(this.x,this.y)},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(length){if(this.isZero()){var angle=this._angle||0;this.set(Math.cos(angle)*length,Math.sin(angle)*length)}else{var scale=length/this.getLength();if(Numerical.isZero(scale))this.getAngle();this.set(this.x*scale,this.y*scale)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(angle){this.setAngleInRadians.call(this,angle*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length){return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)}else{var point=Point.read(arguments),div=this.getLength()*point.getLength();if(Numerical.isZero(div)){return NaN}else{var a=this.dot(point)/div;return Math.acos(a<-1?-1:a>1?1:a)}}},setAngleInRadians:function(angle){this._angle=angle;if(!this.isZero()){var length=this.getLength();this.set(Math.cos(angle)*length,Math.sin(angle)*length)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:false,getDirectedAngle:function(){var point=Point.read(arguments);return Math.atan2(this.cross(point),this.dot(point))*180/Math.PI},getDistance:function(){var point=Point.read(arguments),x=point.x-this.x,y=point.y-this.y,d=x*x+y*y,squared=Base.read(arguments);return squared?d:Math.sqrt(d)},normalize:function(length){if(length===undefined)length=1;var current=this.getLength(),scale=current!==0?length/current:0,point=new Point(this.x*scale,this.y*scale);

if(scale>=0)point._angle=this._angle;return point},rotate:function(angle,center){if(angle===0)return this.clone();angle=angle*Math.PI/180;var point=center?this.subtract(center):this,sin=Math.sin(angle),cos=Math.cos(angle);point=new Point(point.x*cos-point.y*sin,point.x*sin+point.y*cos);return center?point.add(center):point},transform:function(matrix){return matrix?matrix._transformPoint(this):this},add:function(){var point=Point.read(arguments);return new Point(this.x+point.x,this.y+point.y)},subtract:function(){var point=Point.read(arguments);return new Point(this.x-point.x,this.y-point.y)},multiply:function(){var point=Point.read(arguments);return new Point(this.x*point.x,this.y*point.y)},divide:function(){var point=Point.read(arguments);return new Point(this.x/point.x,this.y/point.y)},modulo:function(){var point=Point.read(arguments);return new Point(this.x%point.x,this.y%point.y)},negate:function(){return new Point(-this.x,-this.y)},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var point=Point.read(arguments),tolerance=Base.read(arguments);return this.getDistance(point)<tolerance},isCollinear:function(){var point=Point.read(arguments);return Point.isCollinear(this.x,this.y,point.x,point.y)},isColinear:"#isCollinear",isOrthogonal:function(){var point=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,point.x,point.y)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var point=Point.read(arguments);return this.x*point.x+this.y*point.y},cross:function(){var point=Point.read(arguments);return this.x*point.y-this.y*point.x},project:function(){var point=Point.read(arguments),scale=point.isZero()?0:this.dot(point)/point.dot(point);return new Point(point.x*scale,point.y*scale)},statics:{min:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.min(point1.x,point2.x),Math.min(point1.y,point2.y))},max:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.max(point1.x,point2.x),Math.max(point1.y,point2.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(x1,y1,x2,y2){return Math.abs(x1*y2-y1*x2)<=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))*1e-7},isOrthogonal:function(x1,y1,x2,y2){return Math.abs(x1*x2+y1*y2)<=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))*1e-7}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Point(op(this.x),op(this.y))}},{}));var LinkedPoint=Point.extend({initialize:function Point(x,y,owner,setter){this._x=x;this._y=y;this._owner=owner;this._setter=setter},set:function(x,y,_dontNotify){this._x=x;this._y=y;if(!_dontNotify)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(x){this._x=x;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(y){this._y=y;this._owner[this._setter](this)}});var Size=Base.extend({_class:"Size",_readIndex:true,initialize:function Size(arg0,arg1){var type=typeof arg0;if(type==="number"){var hasHeight=typeof arg1==="number";this.width=arg0;this.height=hasHeight?arg1:arg0;if(this.__read)this.__read=hasHeight?2:1}else if(type==="undefined"||arg0===null){this.width=this.height=0;if(this.__read)this.__read=arg0===null?1:0}else{if(Array.isArray(arg0)){this.width=arg0[0];this.height=arg0.length>1?arg0[1]:arg0[0]}else if(arg0.width!=null){this.width=arg0.width;this.height=arg0.height}else if(arg0.x!=null){this.width=arg0.x;this.height=arg0.y}else{this.width=this.height=0;if(this.__read)this.__read=0}if(this.__read)this.__read=1}},set:function(width,height){this.width=width;this.height=height;return this},equals:function(size){return size===this||size&&(this.width===size.width&&this.height===size.height||Array.isArray(size)&&this.width===size[0]&&this.height===size[1])||false},clone:function(){return new Size(this.width,this.height)},toString:function(){var f=Formatter.instance;return"{ width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var size=Size.read(arguments);return new Size(this.width+size.width,this.height+size.height)},subtract:function(){var size=Size.read(arguments);return new Size(this.width-size.width,this.height-size.height)},multiply:function(){var size=Size.read(arguments);return new Size(this.width*size.width,this.height*size.height)},divide:function(){var size=Size.read(arguments);return new Size(this.width/size.width,this.height/size.height)},modulo:function(){var size=Size.read(arguments);return new Size(this.width%size.width,this.height%size.height)},negate:function(){return new Size(-this.width,-this.height)},isZero:function(){return Numerical.isZero(this.width)&&Numerical.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(size1,size2){return new Size(Math.min(size1.width,size2.width),Math.min(size1.height,size2.height))},max:function(size1,size2){return new Size(Math.max(size1.width,size2.width),Math.max(size1.height,size2.height))},random:function(){return new Size(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Size(op(this.width),op(this.height))}},{}));var LinkedSize=Size.extend({initialize:function Size(width,height,owner,setter){this._width=width;this._height=height;this._owner=owner;this._setter=setter},set:function(width,height,_dontNotify){this._width=width;this._height=height;if(!_dontNotify)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(width){this._width=width;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(height){this._height=height;this._owner[this._setter](this)}});var Rectangle=Base.extend({_class:"Rectangle",_readIndex:true,beans:true,initialize:function Rectangle(arg0,arg1,arg2,arg3){var type=typeof arg0,read=0;if(type==="number"){this.x=arg0;this.y=arg1;this.width=arg2;this.height=arg3;read=4}else if(type==="undefined"||arg0===null){this.x=this.y=this.width=this.height=0;read=arg0===null?1:0}else if(arguments.length===1){if(Array.isArray(arg0)){this.x=arg0[0];this.y=arg0[1];this.width=arg0[2];this.height=arg0[3];read=1}else if(arg0.x!==undefined||arg0.width!==undefined){this.x=arg0.x||0;this.y=arg0.y||0;this.width=arg0.width||0;this.height=arg0.height||0;read=1}else if(arg0.from===undefined&&arg0.to===undefined){this.x=this.y=this.width=this.height=0;this._set(arg0);read=1}}if(!read){var point=Point.readNamed(arguments,"from"),next=Base.peek(arguments);this.x=point.x;this.y=point.y;if(next&&next.x!==undefined||Base.hasNamed(arguments,"to")){var to=Point.readNamed(arguments,"to");this.width=to.x-point.x;this.height=to.y-point.y;if(this.width<0){this.x=to.x;this.width=-this.width}if(this.height<0){this.y=to.y;this.height=-this.height}}else{var size=Size.read(arguments);this.width=size.width;this.height=size.height}read=arguments.__index}if(this.__read)this.__read=read},set:function(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;return this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(rect){var rt=Base.isPlainValue(rect)?Rectangle.read(arguments):rect;return rt===this||rt&&this.x===rt.x&&this.y===rt.y&&this.width===rt.width&&this.height===rt.height||false},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+", width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.x,this.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.x=point.x;this.y=point.y},getSize:function(_dontLink){var ctor=_dontLink?Size:LinkedSize;return new ctor(this.width,this.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(this._fixX)this.x+=(this.width-size.width)*this._fixX;if(this._fixY)this.y+=(this.height-size.height)*this._fixY;this.width=size.width;this.height=size.height;this._fixW=1;this._fixH=1},getLeft:function(){return this.x},setLeft:function(left){if(!this._fixW)this.width-=left-this.x;this.x=left;this._fixX=0},getTop:function(){return this.y},setTop:function(top){if(!this._fixH)this.height-=top-this.y;this.y=top;this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(right){if(this._fixX!==undefined&&this._fixX!==1)this._fixW=0;if(this._fixW)this.x=right-this.width;else this.width=right-this.x;this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(bottom){if(this._fixY!==undefined&&this._fixY!==1)this._fixH=0;if(this._fixH)this.y=bottom-this.height;else this.height=bottom-this.y;this._fixY=1},getCenterX:function(){return this.x+this.width*.5},setCenterX:function(x){this.x=x-this.width*.5;this._fixX=.5},getCenterY:function(){return this.y+this.height*.5},setCenterY:function(y){this.y=y-this.height*.5;this._fixY=.5},getCenter:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var point=Point.read(arguments);this.setCenterX(point.x);this.setCenterY(point.y);return this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(arg){return arg&&arg.width!==undefined||(Array.isArray(arg)?arg:arguments).length==4?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(point){var x=point.x,y=point.y;return x>=this.x&&y>=this.y&&x<=this.x+this.width&&y<=this.y+this.height},_containsRectangle:function(rect){var x=rect.x,y=rect.y;return x>=this.x&&y>=this.y&&x+rect.width<=this.x+this.width&&y+rect.height<=this.y+this.height},intersects:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>this.x&&rect.y+rect.height>this.y&&rect.x<this.x+this.width&&rect.y<this.y+this.height},touches:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>=this.x&&rect.y+rect.height>=this.y&&rect.x<=this.x+this.width&&rect.y<=this.y+this.height},intersect:function(){var rect=Rectangle.read(arguments),x1=Math.max(this.x,rect.x),y1=Math.max(this.y,rect.y),x2=Math.min(this.x+this.width,rect.x+rect.width),y2=Math.min(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},unite:function(){var rect=Rectangle.read(arguments),x1=Math.min(this.x,rect.x),y1=Math.min(this.y,rect.y),x2=Math.max(this.x+this.width,rect.x+rect.width),y2=Math.max(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},include:function(){var point=Point.read(arguments);var x1=Math.min(this.x,point.x),y1=Math.min(this.y,point.y),x2=Math.max(this.x+this.width,point.x),y2=Math.max(this.y+this.height,point.y);return new Rectangle(x1,y1,x2-x1,y2-y1)},expand:function(){var amount=Size.read(arguments),hor=amount.width,ver=amount.height;return new Rectangle(this.x-hor/2,this.y-ver/2,this.width+hor,this.height+ver)},scale:function(hor,ver){return this.expand(this.width*hor-this.width,this.height*(ver===undefined?hor:ver)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(parts,index){var part=parts.join("");var xFirst=/^[RL]/.test(part);if(index>=4)parts[1]+=xFirst?"Y":"X";var x=parts[xFirst?0:1],y=parts[xFirst?1:0],getX="get"+x,getY="get"+y,setX="set"+x,setY="set"+y,get="get"+part,set="set"+part;this[get]=function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this[getX](),this[getY](),this,set)};this[set]=function(){var point=Point.read(arguments);this[setX](point.x);this[setY](point.y)}},{beans:true}));var LinkedRectangle=Rectangle.extend({initialize:function Rectangle(x,y,width,height,owner,setter){this.set(x,y,width,height,true);this._owner=owner;this._setter=setter},set:function(x,y,width,height,_dontNotify){this._x=x;this._y=y;this._width=width;this._height=height;if(!_dontNotify)this._owner[this._setter](this);return this}},new function(){var proto=Rectangle.prototype;return Base.each(["x","y","width","height"],function(key){var part=Base.capitalize(key);var internal="_"+key;this["get"+part]=function(){return this[internal]};this["set"+part]=function(value){this[internal]=value;if(!this._dontNotify)this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(key){var name="set"+key;this[name]=function(){this._dontNotify=true;proto[name].apply(this,arguments);this._dontNotify=false;this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(selected){var owner=this._owner;if(owner.setSelected){owner._boundsSelected=selected;owner.setSelected(selected||owner._selectedSegmentState>0)}}}))});var Matrix=Base.extend({_class:"Matrix",initialize:function Matrix(arg){var count=arguments.length,ok=true;if(count===6){this.set.apply(this,arguments)}else if(count===1){if(arg instanceof Matrix){this.set(arg._a,arg._c,arg._b,arg._d,arg._tx,arg._ty)}else if(Array.isArray(arg)){this.set.apply(this,arg)}else{ok=false}}else if(count===0){this.reset()}else{ok=false}if(!ok)throw new Error("Unsupported matrix parameters")},set:function(a,c,b,d,tx,ty,_dontNotify){this._a=a;this._c=c;this._b=b;this._d=d;this._tx=tx;this._ty=ty;if(!_dontNotify)this._changed();return this},_serialize:function(options){return Base.serialize(this.getValues(),options)},_changed:function(){var owner=this._owner;if(owner){if(owner._applyMatrix){owner.transform(null,true)}else{owner._changed(9)}}},clone:function(){return new Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(mx){return mx===this||mx&&this._a===mx._a&&this._b===mx._b&&this._c===mx._c&&this._d===mx._d&&this._tx===mx._tx&&this._ty===mx._ty||false},toString:function(){var f=Formatter.instance;return"[["+[f.number(this._a),f.number(this._b),f.number(this._tx)].join(", ")+"], ["+[f.number(this._c),f.number(this._d),f.number(this._ty)].join(", ")+"]]"},reset:function(_dontNotify){this._a=this._d=1;this._c=this._b=this._tx=this._ty=0;if(!_dontNotify)this._changed();return this},apply:function(recursively,_setApplyMatrix){var owner=this._owner;if(owner){owner.transform(null,true,Base.pick(recursively,true),_setApplyMatrix);return this.isIdentity()}return false},translate:function(){var point=Point.read(arguments),x=point.x,y=point.y;this._tx+=x*this._a+y*this._b;this._ty+=x*this._c+y*this._d;this._changed();return this},scale:function(){var scale=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});if(center)this.translate(center);this._a*=scale.x;this._c*=scale.x;this._b*=scale.y;this._d*=scale.y;if(center)this.translate(center.negate());this._changed();return this},rotate:function(angle){angle*=Math.PI/180;var center=Point.read(arguments,1),x=center.x,y=center.y,cos=Math.cos(angle),sin=Math.sin(angle),tx=x-x*cos+y*sin,ty=y-x*sin-y*cos,a=this._a,b=this._b,c=this._c,d=this._d;this._a=cos*a+sin*b;this._b=-sin*a+cos*b;this._c=cos*c+sin*d;this._d=-sin*c+cos*d;this._tx+=tx*a+ty*b;this._ty+=tx*c+ty*d;this._changed();return this},shear:function(){var shear=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});if(center)this.translate(center);var a=this._a,c=this._c;this._a+=shear.y*this._b;this._c+=shear.y*this._d;this._b+=shear.x*a;this._d+=shear.x*c;if(center)this.translate(center.negate());this._changed();return this},skew:function(){var skew=Point.read(arguments),center=Point.read(arguments,0,{readNull:true}),toRadians=Math.PI/180,shear=new Point(Math.tan(skew.x*toRadians),Math.tan(skew.y*toRadians));return this.shear(shear,center)},concatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+c2*b1;this._b=b2*a1+d2*b1;this._c=a2*c1+c2*d1;this._d=b2*c1+d2*d1;this._tx+=tx2*a1+ty2*b1;this._ty+=tx2*c1+ty2*d1;this._changed();return this},preConcatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+b2*c1;this._b=a2*b1+b2*d1;this._c=c2*a1+d2*c1;this._d=c2*b1+d2*d1;this._tx=a2*tx1+b2*ty1+tx2;this._ty=c2*tx1+d2*ty1+ty2;this._changed();return this},chain:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;return new Matrix(a2*a1+c2*b1,a2*c1+c2*d1,b2*a1+d2*b1,b2*c1+d2*d1,tx1+tx2*a1+ty2*b1,ty1+tx2*c1+ty2*d1)},isIdentity:function(){return this._a===1&&this._c===0&&this._b===0&&this._d===1&&this._tx===0&&this._ty===0},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(src,dst,count){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(src,dst,count)},_transformPoint:function(point,dest,_dontNotify){var x=point.x,y=point.y;if(!dest)dest=new Point;return dest.set(x*this._a+y*this._b+this._tx,x*this._c+y*this._d+this._ty,_dontNotify)},_transformCoordinates:function(src,dst,count){var i=0,j=0,max=2*count;while(i<max){var x=src[i++],y=src[i++];dst[j++]=x*this._a+y*this._b+this._tx;dst[j++]=x*this._c+y*this._d+this._ty}return dst},_transformCorners:function(rect){var x1=rect.x,y1=rect.y,x2=x1+rect.width,y2=y1+rect.height,coords=[x1,y1,x2,y1,x2,y2,x1,y2];return this._transformCoordinates(coords,coords,4)},_transformBounds:function(bounds,dest,_dontNotify){var coords=this._transformCorners(bounds),min=coords.slice(0,2),max=min.slice();for(var i=2;i<8;i++){var val=coords[i],j=i&1;if(val<min[j])min[j]=val;else if(val>max[j])max[j]=val}if(!dest)dest=new Rectangle;return dest.set(min[0],min[1],max[0]-min[0],max[1]-min[1],_dontNotify)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var det=this._a*this._d-this._b*this._c;return isFinite(det)&&!Numerical.isZero(det)&&isFinite(this._tx)&&isFinite(this._ty)?det:null},_inverseTransform:function(point,dest,_dontNotify){var det=this._getDeterminant();if(!det)return null;var x=point.x-this._tx,y=point.y-this._ty;if(!dest)dest=new Point;return dest.set((x*this._d-y*this._b)/det,(y*this._a-x*this._c)/det,_dontNotify)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(Numerical.isZero(a*d-b*c))return null;var scaleX=Math.sqrt(a*a+b*b);a/=scaleX;b/=scaleX;var shear=a*c+b*d;c-=a*shear;d-=b*shear;var scaleY=Math.sqrt(c*c+d*d);c/=scaleY;d/=scaleY;shear/=scaleY;if(a*d<b*c){a=-a;b=-b;shear=-shear;scaleX=-scaleX}return{scaling:new Point(scaleX,scaleY),rotation:-Math.atan2(b,a)*180/Math.PI,shearing:shear}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var det=this._getDeterminant();return det&&new Matrix(this._d/det,-this._c/det,-this._b/det,this._a/det,(this._b*this._ty-this._d*this._tx)/det,(this._c*this._tx-this._a*this._ty)/det)},shiftless:function(){return new Matrix(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(ctx){ctx.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},Base.each(["a","c","b","d","tx","ty"],function(name){var part=Base.capitalize(name),prop="_"+name;this["get"+part]=function(){return this[prop]};this["set"+part]=function(value){this[prop]=value;this._changed()}},{}));var Line=Base.extend({_class:"Line",initialize:function Line(arg0,arg1,arg2,arg3,arg4){var asVector=false;if(arguments.length>=4){this._px=arg0;this._py=arg1;this._vx=arg2;this._vy=arg3;asVector=arg4}else{this._px=arg0.x;this._py=arg0.y;this._vx=arg1.x;this._vy=arg1.y;asVector=arg2}if(!asVector){this._vx-=this._px;this._vy-=this._py}},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(line,isInfinite){return Line.intersect(this._px,this._py,this._vx,this._vy,line._px,line._py,line._vx,line._vy,true,isInfinite)},getSide:function(point,isInfinite){return Line.getSide(this._px,this._py,this._vx,this._vy,point.x,point.y,true,isInfinite)},getDistance:function(point){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,point.x,point.y,true))},isCollinear:function(line){return Point.isCollinear(this._vx,this._vy,line._vx,line._vy)},isOrthogonal:function(line){return Point.isOrthogonal(this._vx,this._vy,line._vx,line._vy)},statics:{intersect:function(p1x,p1y,v1x,v1y,p2x,p2y,v2x,v2y,asVector,isInfinite){if(!asVector){v1x-=p1x;v1y-=p1y;v2x-=p2x;v2y-=p2y}var cross=v1x*v2y-v1y*v2x;if(!Numerical.isZero(cross)){var dx=p1x-p2x,dy=p1y-p2y,u1=(v2x*dy-v2y*dx)/cross,u2=(v1x*dy-v1y*dx)/cross,epsilon=1e-12,uMin=-epsilon,uMax=1+epsilon;if(isInfinite||uMin<u1&&u1<uMax&&uMin<u2&&u2<uMax){if(!isInfinite){u1=u1<=0?0:u1>=1?1:u1}return new Point(p1x+u1*v1x,p1y+u1*v1y)}}},getSide:function(px,py,vx,vy,x,y,asVector,isInfinite){if(!asVector){vx-=px;vy-=py}var v2x=x-px,v2y=y-py,ccw=v2x*vy-v2y*vx;if(ccw===0&&!isInfinite){ccw=(v2x*vx+v2x*vx)/(vx*vx+vy*vy);if(ccw>=0&&ccw<=1)ccw=0}return ccw<0?-1:ccw>0?1:0},getSignedDistance:function(px,py,vx,vy,x,y,asVector){if(!asVector){vx-=px;vy-=py}return vx===0?vy>0?x-px:px-x:vy===0?vx<0?y-py:py-y:((x-px)*vy-(y-py)*vx)/Math.sqrt(vx*vx+vy*vy)}}});var Project=PaperScopeItem.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function Project(element){PaperScopeItem.call(this,true);this.layers=[];this._activeLayer=null;this.symbols=[];this._currentStyle=new Style(null,null,this);this._view=View.create(this,element||CanvasProvider.getCanvas(1,1));this._selectedItems={};this._selectedItemCount=0;this._updateVersion=0},_serialize:function(options,dictionary){return Base.serialize(this.layers,options,true,dictionary)},clear:function(){for(var i=this.layers.length-1;i>=0;i--)this.layers[i].remove();this.symbols=[]},isEmpty:function(){return this.layers.length===0},remove:function remove(){if(!remove.base.call(this))return false;if(this._view)this._view.remove();return true},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(style){this._currentStyle.initialize(style)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new Layer({project:this})},getSelectedItems:function(){var items=[];for(var id in this._selectedItems){var item=this._selectedItems[id];if(item.isInserted())items.push(item)}return items},insertChild:function(index,item,_preserve){if(item instanceof Layer){item._remove(false,true);Base.splice(this.layers,[item],index,0);item._setProject(this,true);if(this._changes)item._changed(5);if(!this._activeLayer)this._activeLayer=item}else if(item instanceof Item){(this._activeLayer||this.insertChild(index,new Layer(Item.NO_INSERT))).insertChild(index,item,_preserve)}else{item=null}return item},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},_updateSelection:function(item){var id=item._id,selectedItems=this._selectedItems;if(item._selected){if(selectedItems[id]!==item){this._selectedItemCount++;selectedItems[id]=item}}else if(selectedItems[id]===item){this._selectedItemCount--;delete selectedItems[id]}},selectAll:function(){var layers=this.layers;for(var i=0,l=layers.length;i<l;i++)layers[i].setFullySelected(true)},deselectAll:function(){var selectedItems=this._selectedItems;for(var i in selectedItems)selectedItems[i].setFullySelected(false)},hitTest:function(){var point=Point.read(arguments),options=HitResult.getOptions(Base.read(arguments));for(var i=this.layers.length-1;i>=0;i--){var res=this.layers[i]._hitTest(point,options);if(res)return res}return null},getItems:function(match){return Item._getItems(this.layers,match)},getItem:function(match){return Item._getItems(this.layers,match,null,null,true)[0]||null},importJSON:function(json){this.activate();var layer=this._activeLayer;return Base.importJSON(json,layer&&layer.isEmpty()&&layer)},draw:function(ctx,matrix,pixelRatio){this._updateVersion++;ctx.save();matrix.applyToContext(ctx);var param=new Base({offset:new Point(0,0),pixelRatio:pixelRatio,viewMatrix:matrix.isIdentity()?null:matrix,matrices:[new Matrix],updateMatrix:true});for(var i=0,layers=this.layers,l=layers.length;i<l;i++)layers[i].draw(ctx,param);ctx.restore();if(this._selectedItemCount>0){ctx.save();ctx.strokeWidth=1;var items=this._selectedItems,size=this._scope.settings.handleSize,version=this._updateVersion;for(var id in items)items[id]._drawSelection(ctx,matrix,size,items,version);ctx.restore()}}});var Symbol=Base.extend({_class:"Symbol",initialize:function Symbol(item,dontCenter){this._id=UID.get();this.project=paper.project;this.project.symbols.push(this);if(item)this.setDefinition(item,dontCenter)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._class,this._definition],options,false,dictionary)})},_changed:function(flags){if(flags&8){Item._clearBoundsCache(this)}if(flags&1){this.project._needsUpdate=true}},getDefinition:function(){return this._definition},setDefinition:function(item,_dontCenter){if(item._parentSymbol)item=item.clone();if(this._definition)this._definition._parentSymbol=null;this._definition=item;item.remove();item.setSelected(false);if(!_dontCenter)item.setPosition(new Point);item._parentSymbol=this;this._changed(9)},place:function(position){return new PlacedSymbol(this,position)},clone:function(){return new Symbol(this._definition.clone(false))},equals:function(symbol){return symbol===this||symbol&&this.definition.equals(symbol.definition)||false}});var Item=Base.extend(Emitter,{statics:{extend:function extend(src){if(src._serializeFields)src._serializeFields=new Base(this.prototype._serializeFields,src._serializeFields);return extend.base.apply(this,arguments)},NO_INSERT:{insert:false}},_class:"Item",_applyMatrix:true,_canApplyMatrix:true,_boundsSelected:false,_selectChildren:false,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,locked:false,visible:true,blendMode:"normal",opacity:1,guide:false,selected:false,clipMask:false,data:{}},initialize:function Item(){},_initialize:function(props,point){var hasProps=props&&Base.isPlainObject(props),internal=hasProps&&props.internal===true,matrix=this._matrix=new Matrix,project=hasProps&&props.project||paper.project;if(!internal)this._id=UID.get();this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix;if(point)matrix.translate(point);matrix._owner=this;this._style=new Style(project._currentStyle,this,project);if(!this._project){if(internal||hasProps&&props.insert===false){this._setProject(project)}else if(hasProps&&props.parent){this.setParent(props.parent)}else{(project._activeLayer||new Layer).addChild(this)}}if(hasProps&&props!==Item.NO_INSERT)this._set(props,{insert:true,project:true,parent:true},true);return hasProps},_events:Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(name){this[name]={install:function(type){this.getView()._installEvent(type)},uninstall:function(type){this.getView()._uninstallEvent(type)}}},{onFrame:{install:function(){this.getView()._animateItem(this,true)},uninstall:function(){this.getView()._animateItem(this,false)}},onLoad:{}}),_serialize:function(options,dictionary){var props={},that=this;function serialize(fields){for(var key in fields){var value=that[key];if(!Base.equals(value,key==="leading"?fields.fontSize*1.2:fields[key])){props[key]=Base.serialize(value,options,key!=="data",dictionary)}}}serialize(this._serializeFields);if(!(this instanceof Group))serialize(this._style._defaults);return[this._class,props]},_changed:function(flags){var symbol=this._parentSymbol,cacheParent=this._parent||symbol,project=this._project;if(flags&8){this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=undefined}if(cacheParent&&flags&40){Item._clearBoundsCache(cacheParent)}if(flags&2){Item._clearBoundsCache(this)}if(project){if(flags&1){project._needsUpdate=true}if(project._changes){var entry=project._changesById[this._id];if(entry){entry.flags|=flags}else{entry={item:this,flags:flags};project._changesById[this._id]=entry;project._changes.push(entry)}}}if(symbol)symbol._changed(flags)},set:function(props){if(props)this._set(props);return this},getId:function(){return this._id},getName:function(){return this._name},setName:function(name,unique){if(this._name)this._removeNamed();if(name===+name+"")throw new Error("Names consisting only of numbers are not supported.");var parent=this._parent;if(name&&parent){var children=parent._children,namedChildren=parent._namedChildren,orig=name,i=1;while(unique&&children[name])name=orig+" "+i++;(namedChildren[name]=namedChildren[name]||[]).push(this);children[name]=this}this._name=name||undefined;this._changed(128)},getStyle:function(){return this._style},setStyle:function(style){this.getStyle().set(style)}},Base.each(["locked","visible","blendMode","opacity","guide"],function(name){var part=Base.capitalize(name),name="_"+name;this["get"+part]=function(){return this[name]};this["set"+part]=function(value){if(value!=this[name]){this[name]=value;this._changed(name==="_locked"?128:129)}}},{}),{beans:true,_locked:false,_visible:true,_blendMode:"normal",_opacity:1,_guide:false,isSelected:function(){if(this._selectChildren){var children=this._children;for(var i=0,l=children.length;i<l;i++)if(children[i].isSelected())return true}return this._selected},setSelected:function(selected,noChildren){if(!noChildren&&this._selectChildren){var children=this._children;for(var i=0,l=children.length;i<l;i++)children[i].setSelected(selected)}if((selected=!!selected)^this._selected){this._selected=selected;this._project._updateSelection(this);this._changed(129)}},_selected:false,isFullySelected:function(){var children=this._children;if(children&&this._selected){for(var i=0,l=children.length;i<l;i++)if(!children[i].isFullySelected())return false;return true}return this._selected},setFullySelected:function(selected){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].setFullySelected(selected)}this.setSelected(selected,true)},isClipMask:function(){return this._clipMask},setClipMask:function(clipMask){if(this._clipMask!=(clipMask=!!clipMask)){this._clipMask=clipMask;if(clipMask){this.setFillColor(null);this.setStrokeColor(null)}this._changed(129);if(this._parent)this._parent._changed(1024)}},_clipMask:false,getData:function(){if(!this._data)this._data={};return this._data},setData:function(data){this._data=data},getPosition:function(_dontLink){var position=this._position,ctor=_dontLink?Point:LinkedPoint;if(!position){var pivot=this._pivot;position=this._position=pivot?this._matrix._transformPoint(pivot):this.getBounds().getCenter(true)}return new ctor(position.x,position.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(true)))},getPivot:function(_dontLink){var pivot=this._pivot;if(pivot){
var ctor=_dontLink?Point:LinkedPoint;pivot=new ctor(pivot.x,pivot.y,this,"setPivot")}return pivot},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:true,readNull:true});this._position=undefined},_pivot:null},Base.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(key){var getter="get"+Base.capitalize(key),match=key.match(/^internal(.*)$/),internalGetter=match?"get"+match[1]:null;this[getter]=function(_matrix){var boundsGetter=this._boundsGetter,name=!internalGetter&&(typeof boundsGetter==="string"?boundsGetter:boundsGetter&&boundsGetter[getter])||getter,bounds=this._getCachedBounds(name,_matrix,this,internalGetter);return key==="bounds"?new LinkedRectangle(bounds.x,bounds.y,bounds.width,bounds.height,this,"setBounds"):bounds}},{beans:true,_getBounds:function(getter,matrix,cacheItem){var children=this._children;if(!children||children.length==0)return new Rectangle;Item._updateBoundsCache(this,cacheItem);var x1=Infinity,x2=-x1,y1=x1,y2=x2;for(var i=0,l=children.length;i<l;i++){var child=children[i];if(child._visible&&!child.isEmpty()){var rect=child._getCachedBounds(getter,matrix&&matrix.chain(child._matrix),cacheItem);x1=Math.min(rect.x,x1);y1=Math.min(rect.y,y1);x2=Math.max(rect.x+rect.width,x2);y2=Math.max(rect.y+rect.height,y2)}}return isFinite(x1)?new Rectangle(x1,y1,x2-x1,y2-y1):new Rectangle},setBounds:function(){var rect=Rectangle.read(arguments),bounds=this.getBounds(),matrix=new Matrix,center=rect.getCenter();matrix.translate(center);if(rect.width!=bounds.width||rect.height!=bounds.height){matrix.scale(bounds.width!=0?rect.width/bounds.width:1,bounds.height!=0?rect.height/bounds.height:1)}center=bounds.getCenter();matrix.translate(-center.x,-center.y);this.transform(matrix)},_getCachedBounds:function(getter,matrix,cacheItem,internalGetter){matrix=matrix&&matrix.orNullIfIdentity();var _matrix=internalGetter?null:this._matrix.orNullIfIdentity(),cache=(!matrix||matrix.equals(_matrix))&&getter;Item._updateBoundsCache(this._parent||this._parentSymbol,cacheItem);if(cache&&this._bounds&&this._bounds[cache])return this._bounds[cache].clone();var bounds=this._getBounds(internalGetter||getter,matrix||_matrix,cacheItem);if(cache){if(!this._bounds)this._bounds={};var cached=this._bounds[cache]=bounds.clone();cached._internal=!!internalGetter}return bounds},statics:{_updateBoundsCache:function(parent,item){if(parent){var id=item._id,ref=parent._boundsCache=parent._boundsCache||{ids:{},list:[]};if(!ref.ids[id]){ref.list.push(item);ref.ids[id]=item}}},_clearBoundsCache:function(item){var cache=item._boundsCache;if(cache){item._bounds=item._position=item._boundsCache=undefined;for(var i=0,list=cache.list,l=list.length;i<l;i++){var other=list[i];if(other!==item){other._bounds=other._position=undefined;if(other._boundsCache)Item._clearBoundsCache(other)}}}}}}),{beans:true,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var decomposed=this._decomposed||this._decompose();return decomposed&&decomposed.rotation},setRotation:function(rotation){var current=this.getRotation();if(current!=null&&rotation!=null){var decomposed=this._decomposed;this.rotate(rotation-current);decomposed.rotation=rotation;this._decomposed=decomposed}},getScaling:function(_dontLink){var decomposed=this._decomposed||this._decompose(),scaling=decomposed&&decomposed.scaling,ctor=_dontLink?Point:LinkedPoint;return scaling&&new ctor(scaling.x,scaling.y,this,"setScaling")},setScaling:function(){var current=this.getScaling();if(current){var scaling=Point.read(arguments,0,{clone:true}),decomposed=this._decomposed;this.scale(scaling.x/current.x,scaling.y/current.y);decomposed.scaling=scaling;this._decomposed=decomposed}},getMatrix:function(){return this._matrix},setMatrix:function(){var matrix=this._matrix;matrix.initialize.apply(matrix,arguments);if(this._applyMatrix){this.transform(null,true)}else{this._changed(9)}},getGlobalMatrix:function(_dontClone){var matrix=this._globalMatrix,updateVersion=this._project._updateVersion;if(matrix&&matrix._updateVersion!==updateVersion)matrix=null;if(!matrix){matrix=this._globalMatrix=this._matrix.clone();var parent=this._parent;if(parent)matrix.preConcatenate(parent.getGlobalMatrix(true));matrix._updateVersion=updateVersion}return _dontClone?matrix:matrix.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(apply){if(this._applyMatrix=this._canApplyMatrix&&!!apply)this.transform(null,true)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(project,installEvents){if(this._project!==project){if(this._project)this._installEvents(false);this._project=project;var children=this._children;for(var i=0,l=children&&children.length;i<l;i++)children[i]._setProject(project);installEvents=true}if(installEvents)this._installEvents(true)},getView:function(){return this._project.getView()},_installEvents:function _installEvents(install){_installEvents.base.call(this,install);var children=this._children;for(var i=0,l=children&&children.length;i<l;i++)children[i]._installEvents(install)},getLayer:function(){var parent=this;while(parent=parent._parent){if(parent instanceof Layer)return parent}return null},getParent:function(){return this._parent},setParent:function(item){return item.addChild(this)},getChildren:function(){return this._children},setChildren:function(items){this.removeChildren();this.addChildren(items)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(item){return item===this||item&&this._class===item._class&&this._style.equals(item._style)&&this._matrix.equals(item._matrix)&&this._locked===item._locked&&this._visible===item._visible&&this._blendMode===item._blendMode&&this._opacity===item._opacity&&this._clipMask===item._clipMask&&this._guide===item._guide&&this._equals(item)||false},_equals:function(item){return Base.equals(this._children,item._children)},clone:function(insert){return this._clone(new this.constructor(Item.NO_INSERT),insert)},_clone:function(copy,insert,includeMatrix){var keys=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],children=this._children;copy.setStyle(this._style);for(var i=0,l=children&&children.length;i<l;i++){copy.addChild(children[i].clone(false),true)}for(var i=0,l=keys.length;i<l;i++){var key=keys[i];if(this.hasOwnProperty(key))copy[key]=this[key]}if(includeMatrix!==false)copy._matrix.initialize(this._matrix);copy.setApplyMatrix(this._applyMatrix);copy.setPivot(this._pivot);copy.setSelected(this._selected);copy._data=this._data?Base.clone(this._data):null;if(insert||insert===undefined)copy.insertAbove(this);if(this._name)copy.setName(this._name,true);return copy},copyTo:function(itemOrProject){return itemOrProject.addChild(this.clone(false))},rasterize:function(resolution){var bounds=this.getStrokeBounds(),scale=(resolution||this.getView().getResolution())/72,topLeft=bounds.getTopLeft().floor(),bottomRight=bounds.getBottomRight().ceil(),size=new Size(bottomRight.subtract(topLeft)),canvas=CanvasProvider.getCanvas(size.multiply(scale)),ctx=canvas.getContext("2d"),matrix=(new Matrix).scale(scale).translate(topLeft.negate());ctx.save();matrix.applyToContext(ctx);this.draw(ctx,new Base({matrices:[matrix]}));ctx.restore();var raster=new Raster(Item.NO_INSERT);raster.setCanvas(canvas);raster.transform((new Matrix).translate(topLeft.add(size.divide(2))).scale(1/scale));raster.insertAbove(this);return raster},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(point){if(this._children){for(var i=this._children.length-1;i>=0;i--){if(this._children[i].contains(point))return true}return false}return point.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:false})},intersects:function(item,_matrix){if(!(item instanceof Item))return false;return this._asPathItem().getIntersections(item._asPathItem(),null,_matrix||item._matrix,true).length>0},hitTest:function(){return this._hitTest(Point.read(arguments),HitResult.getOptions(Base.read(arguments)))},_hitTest:function(point,options){if(this._locked||!this._visible||this._guide&&!options.guides||this.isEmpty())return null;var matrix=this._matrix,parentTotalMatrix=options._totalMatrix,view=this.getView(),totalMatrix=options._totalMatrix=parentTotalMatrix?parentTotalMatrix.chain(matrix):this.getGlobalMatrix().preConcatenate(view._matrix),tolerancePadding=options._tolerancePadding=new Size(Path._getPenPadding(1,totalMatrix.inverted())).multiply(Math.max(options.tolerance,1e-6));point=matrix._inverseTransform(point);if(!this._children&&!this.getInternalRoughBounds().expand(tolerancePadding.multiply(2))._containsPoint(point))return null;var checkSelf=!(options.guides&&!this._guide||options.selected&&!this._selected||options.type&&options.type!==Base.hyphenate(this._class)||options.class&&!(this instanceof options.class)),that=this,res;function checkBounds(type,part){var pt=bounds["get"+part]();if(point.subtract(pt).divide(tolerancePadding).length<=1)return new HitResult(type,that,{name:Base.hyphenate(part),point:pt})}if(checkSelf&&(options.center||options.bounds)&&this._parent){var bounds=this.getInternalBounds();if(options.center)res=checkBounds("center","Center");if(!res&&options.bounds){var points=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"];for(var i=0;i<8&&!res;i++)res=checkBounds("bounds",points[i])}}var children=!res&&this._children;if(children){var opts=this._getChildHitTestOptions(options);for(var i=children.length-1;i>=0&&!res;i--)res=children[i]._hitTest(point,opts)}if(!res&&checkSelf)res=this._hitTestSelf(point,options);if(res&&res.point)res.point=matrix.transform(res.point);options._totalMatrix=parentTotalMatrix;return res},_getChildHitTestOptions:function(options){return options},_hitTestSelf:function(point,options){if(options.fill&&this.hasFill()&&this._contains(point))return new HitResult("fill",this)},matches:function(name,compare){function matchObject(obj1,obj2){for(var i in obj1){if(obj1.hasOwnProperty(i)){var val1=obj1[i],val2=obj2[i];if(Base.isPlainObject(val1)&&Base.isPlainObject(val2)){if(!matchObject(val1,val2))return false}else if(!Base.equals(val1,val2)){return false}}}return true}var type=typeof name;if(type==="object"){for(var key in name){if(name.hasOwnProperty(key)&&!this.matches(key,name[key]))return false}}else if(type==="function"){return name(this)}else{var value=/^(empty|editable)$/.test(name)?this["is"+Base.capitalize(name)]():name==="type"?Base.hyphenate(this._class):this[name];if(/^(constructor|class)$/.test(name)){if(!(this instanceof compare))return false}else if(compare instanceof RegExp){if(!compare.test(value))return false}else if(typeof compare==="function"){if(!compare(value))return false}else if(Base.isPlainObject(compare)){if(!matchObject(compare,value))return false}else if(!Base.equals(value,compare)){return false}}return true},getItems:function(match){return Item._getItems(this._children,match,this._matrix)},getItem:function(match){return Item._getItems(this._children,match,this._matrix,null,true)[0]||null},statics:{_getItems:function _getItems(children,match,matrix,param,firstOnly){if(!param&&typeof match==="object"){var overlapping=match.overlapping,inside=match.inside,bounds=overlapping||inside,rect=bounds&&Rectangle.read([bounds]);param={items:[],inside:!!inside,overlapping:!!overlapping,rect:rect,path:overlapping&&new Path.Rectangle({rectangle:rect,insert:false})};if(bounds)match=Base.set({},match,{inside:true,overlapping:true})}var items=param&&param.items,rect=param&&param.rect;matrix=rect&&(matrix||new Matrix);for(var i=0,l=children&&children.length;i<l;i++){var child=children[i],childMatrix=matrix&&matrix.chain(child._matrix),add=true;if(rect){var bounds=child.getBounds(childMatrix);if(!rect.intersects(bounds))continue;if(!(param.inside&&rect.contains(bounds))&&!(param.overlapping&&(bounds.contains(rect)||param.path.intersects(child,childMatrix))))add=false}if(add&&child.matches(match)){items.push(child);if(firstOnly)break}_getItems(child._children,match,childMatrix,param,firstOnly);if(firstOnly&&items.length>0)break}return items}}},{importJSON:function(json){var res=Base.importJSON(json,this);return res!==this?this.addChild(res):res},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},insertChild:function(index,item,_preserve){var res=item?this.insertChildren(index,[item],_preserve):null;return res&&res[0]},addChildren:function(items,_preserve){return this.insertChildren(this._children.length,items,_preserve)},insertChildren:function(index,items,_preserve,_proto){var children=this._children;if(children&&items&&items.length>0){items=Array.prototype.slice.apply(items);for(var i=items.length-1;i>=0;i--){var item=items[i];if(_proto&&!(item instanceof _proto)){items.splice(i,1)}else{var shift=item._parent===this&&item._index<index;if(item._remove(false,true)&&shift)index--}}Base.splice(children,items,index,0);var project=this._project,notifySelf=project&&project._changes;for(var i=0,l=items.length;i<l;i++){var item=items[i];item._parent=this;item._setProject(this._project,true);if(item._name)item.setName(item._name);if(notifySelf)this._changed(5)}this._changed(11)}else{items=null}return items},_insertSibling:function(index,item,_preserve){return this._parent?this._parent.insertChild(index,item,_preserve):null},insertAbove:function(item,_preserve){return item._insertSibling(item._index+1,this,_preserve)},insertBelow:function(item,_preserve){return item._insertSibling(item._index,this,_preserve)},sendToBack:function(){return(this._parent||this instanceof Layer&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof Layer&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(item){return this.insertChild(0,item)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&this._children.length===1){var child=this._children[0].reduce();child.insertAbove(this);child.setStyle(this._style);this.remove();return child}return this},_removeNamed:function(){var parent=this._parent;if(parent){var children=parent._children,namedChildren=parent._namedChildren,name=this._name,namedArray=namedChildren[name],index=namedArray?namedArray.indexOf(this):-1;if(index!==-1){if(children[name]==this)delete children[name];namedArray.splice(index,1);if(namedArray.length){children[name]=namedArray[namedArray.length-1]}else{delete namedChildren[name]}}}},_remove:function(notifySelf,notifyParent){var parent=this._parent;if(parent){if(this._name)this._removeNamed();if(this._index!=null)Base.splice(parent._children,null,this._index,1);this._installEvents(false);if(notifySelf){var project=this._project;if(project&&project._changes)this._changed(5)}if(notifyParent)parent._changed(11);this._parent=null;return true}return false},remove:function(){return this._remove(true,true)},replaceWith:function(item){var ok=item&&item.insertBelow(this);if(ok)this.remove();return ok},removeChildren:function(from,to){if(!this._children)return null;from=from||0;to=Base.pick(to,this._children.length);var removed=Base.splice(this._children,null,from,to-from);for(var i=removed.length-1;i>=0;i--){removed[i]._remove(true,false)}if(removed.length>0)this._changed(11);return removed},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,l=this._children.length;i<l;i++)this._children[i]._index=i;this._changed(11)}},isEmpty:function(){return!this._children||this._children.length===0},isEditable:function(){var item=this;while(item){if(!item._visible||item._locked)return false;item=item._parent}return true},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(item){function getList(item){var list=[];do{list.unshift(item)}while(item=item._parent);return list}var list1=getList(this),list2=getList(item);for(var i=0,l=Math.min(list1.length,list2.length);i<l;i++){if(list1[i]!=list2[i]){return list1[i]._index<list2[i]._index?1:-1}}return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():false},isAbove:function(item){return this._getOrder(item)===-1},isBelow:function(item){return this._getOrder(item)===1},isParent:function(item){return this._parent===item},isChild:function(item){return item&&item._parent===this},isDescendant:function(item){var parent=this;while(parent=parent._parent){if(parent==item)return true}return false},isAncestor:function(item){return item?item.isDescendant(this):false},isSibling:function(item){return this._parent===item._parent},isGroupedWith:function(item){var parent=this._parent;while(parent){if(parent._parent&&/^(Group|Layer|CompoundPath)$/.test(parent._class)&&item.isDescendant(parent))return true;parent=parent._parent}return false},translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},rotate:function(angle){return this.transform((new Matrix).rotate(angle,Point.read(arguments,1,{readNull:true})||this.getPosition(true)))}},Base.each(["scale","shear","skew"],function(name){this[name]=function(){var point=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});return this.transform((new Matrix)[name](point,center||this.getPosition(true)))}},{}),{transform:function(matrix,_applyMatrix,_applyRecursively,_setApplyMatrix){if(matrix&&matrix.isIdentity())matrix=null;var _matrix=this._matrix,applyMatrix=(_applyMatrix||this._applyMatrix)&&(!_matrix.isIdentity()||matrix||_applyMatrix&&_applyRecursively&&this._children);if(!matrix&&!applyMatrix)return this;if(matrix)_matrix.preConcatenate(matrix);if(applyMatrix=applyMatrix&&this._transformContent(_matrix,_applyRecursively,_setApplyMatrix)){var pivot=this._pivot,style=this._style,fillColor=style.getFillColor(true),strokeColor=style.getStrokeColor(true);if(pivot)_matrix._transformPoint(pivot,pivot,true);if(fillColor)fillColor.transform(_matrix);if(strokeColor)strokeColor.transform(_matrix);_matrix.reset(true);if(_setApplyMatrix&&this._canApplyMatrix)this._applyMatrix=true}var bounds=this._bounds,position=this._position;this._changed(9);var decomp=bounds&&matrix&&matrix.decompose();if(decomp&&!decomp.shearing&&decomp.rotation%90===0){for(var key in bounds){var rect=bounds[key];if(applyMatrix||!rect._internal)matrix._transformBounds(rect,rect)}var getter=this._boundsGetter,rect=bounds[getter&&getter.getBounds||getter||"getBounds"];if(rect)this._position=rect.getCenter(true);this._bounds=bounds}else if(matrix&&position){this._position=matrix._transformPoint(position,position)}return this},_transformContent:function(matrix,applyRecursively,setApplyMatrix){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].transform(matrix,true,applyRecursively,setApplyMatrix);return true}},globalToLocal:function(){return this.getGlobalMatrix(true)._inverseTransform(Point.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(true)._transformPoint(Point.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(Point.read(arguments))},localToParent:function(){return this._matrix._transformPoint(Point.read(arguments))},fitBounds:function(rectangle,fill){rectangle=Rectangle.read(arguments);var bounds=this.getBounds(),itemRatio=bounds.height/bounds.width,rectRatio=rectangle.height/rectangle.width,scale=(fill?itemRatio>rectRatio:itemRatio<rectRatio)?rectangle.width/bounds.width:rectangle.height/bounds.height,newBounds=new Rectangle(new Point,new Size(bounds.width*scale,bounds.height*scale));newBounds.setCenter(rectangle.getCenter());this.setBounds(newBounds)},_setStyles:function(ctx){var style=this._style,fillColor=style.getFillColor(),strokeColor=style.getStrokeColor(),shadowColor=style.getShadowColor();if(fillColor)ctx.fillStyle=fillColor.toCanvasStyle(ctx);if(strokeColor){var strokeWidth=style.getStrokeWidth();if(strokeWidth>0){ctx.strokeStyle=strokeColor.toCanvasStyle(ctx);ctx.lineWidth=strokeWidth;var strokeJoin=style.getStrokeJoin(),strokeCap=style.getStrokeCap(),miterLimit=style.getMiterLimit();if(strokeJoin)ctx.lineJoin=strokeJoin;if(strokeCap)ctx.lineCap=strokeCap;if(miterLimit)ctx.miterLimit=miterLimit;if(paper.support.nativeDash){var dashArray=style.getDashArray(),dashOffset=style.getDashOffset();if(dashArray&&dashArray.length){if("setLineDash"in ctx){ctx.setLineDash(dashArray);ctx.lineDashOffset=dashOffset}else{ctx.mozDash=dashArray;ctx.mozDashOffset=dashOffset}}}}}if(shadowColor){var shadowBlur=style.getShadowBlur();if(shadowBlur>0){ctx.shadowColor=shadowColor.toCanvasStyle(ctx);ctx.shadowBlur=shadowBlur;var offset=this.getShadowOffset();ctx.shadowOffsetX=offset.x;ctx.shadowOffsetY=offset.y}}},draw:function(ctx,param,parentStrokeMatrix){var updateVersion=this._updateVersion=this._project._updateVersion;if(!this._visible||this._opacity===0)return;var matrices=param.matrices,viewMatrix=param.viewMatrix,matrix=this._matrix,globalMatrix=matrices[matrices.length-1].chain(matrix);if(!globalMatrix.isInvertible())return;function getViewMatrix(matrix){return viewMatrix?viewMatrix.chain(matrix):matrix}matrices.push(globalMatrix);if(param.updateMatrix){globalMatrix._updateVersion=updateVersion;this._globalMatrix=globalMatrix}var blendMode=this._blendMode,opacity=this._opacity,normalBlend=blendMode==="normal",nativeBlend=BlendMode.nativeModes[blendMode],direct=normalBlend&&opacity===1||param.dontStart||param.clip||(nativeBlend||normalBlend&&opacity<1)&&this._canComposite(),pixelRatio=param.pixelRatio||1,mainCtx,itemOffset,prevOffset;if(!direct){var bounds=this.getStrokeBounds(getViewMatrix(globalMatrix));if(!bounds.width||!bounds.height)return;prevOffset=param.offset;itemOffset=param.offset=bounds.getTopLeft().floor();mainCtx=ctx;ctx=CanvasProvider.getContext(bounds.getSize().ceil().add(1).multiply(pixelRatio));if(pixelRatio!==1)ctx.scale(pixelRatio,pixelRatio)}ctx.save();var strokeMatrix=parentStrokeMatrix?parentStrokeMatrix.chain(matrix):!this.getStrokeScaling(true)&&getViewMatrix(globalMatrix),clip=!direct&&param.clipItem,transform=!strokeMatrix||clip;if(direct){ctx.globalAlpha=opacity;if(nativeBlend)ctx.globalCompositeOperation=blendMode}else if(transform){ctx.translate(-itemOffset.x,-itemOffset.y)}if(transform)(direct?matrix:getViewMatrix(globalMatrix)).applyToContext(ctx);if(clip)param.clipItem.draw(ctx,param.extend({clip:true}));if(strokeMatrix){ctx.setTransform(pixelRatio,0,0,pixelRatio,0,0);var offset=param.offset;if(offset)ctx.translate(-offset.x,-offset.y)}this._draw(ctx,param,strokeMatrix);ctx.restore();matrices.pop();if(param.clip&&!param.dontFinish)ctx.clip();if(!direct){BlendMode.process(blendMode,ctx,mainCtx,opacity,itemOffset.subtract(prevOffset).multiply(pixelRatio));CanvasProvider.release(ctx);param.offset=prevOffset}},_isUpdated:function(updateVersion){var parent=this._parent;if(parent instanceof CompoundPath)return parent._isUpdated(updateVersion);var updated=this._updateVersion===updateVersion;if(!updated&&parent&&parent._visible&&parent._isUpdated(updateVersion)){this._updateVersion=updateVersion;updated=true}return updated},_drawSelection:function(ctx,matrix,size,selectedItems,updateVersion){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(updateVersion)){var color=this.getSelectedColor(true)||this.getLayer().getSelectedColor(true),mx=matrix.chain(this.getGlobalMatrix(true));ctx.strokeStyle=ctx.fillStyle=color?color.toCanvasStyle(ctx):"#009dec";if(this._drawSelected)this._drawSelected(ctx,mx,selectedItems);if(this._boundsSelected){var half=size/2,coords=mx._transformCorners(this.getInternalBounds());ctx.beginPath();for(var i=0;i<8;i++)ctx[i===0?"moveTo":"lineTo"](coords[i],coords[++i]);ctx.closePath();ctx.stroke();for(var i=0;i<8;i++)ctx.fillRect(coords[i]-half,coords[++i]-half,size,size)}}},_canComposite:function(){return false}},Base.each(["down","drag","up","move"],function(name){this["removeOn"+Base.capitalize(name)]=function(){var hash={};hash[name]=true;return this.removeOn(hash)}},{removeOn:function(obj){for(var name in obj){if(obj[name]){var key="mouse"+name,project=this._project,sets=project._removeSets=project._removeSets||{};sets[key]=sets[key]||{};sets[key][this._id]=this}}return this}}));var Group=Item.extend({_class:"Group",_selectChildren:true,_serializeFields:{children:[]},initialize:function Group(arg){this._children=[];this._namedChildren={};if(!this._initialize(arg))this.addChildren(Array.isArray(arg)?arg:arguments)},_changed:function _changed(flags){_changed.base.call(this,flags);if(flags&1026){this._clipItem=undefined}},_getClipItem:function(){var clipItem=this._clipItem;if(clipItem===undefined){clipItem=null;for(var i=0,l=this._children.length;i<l;i++){var child=this._children[i];if(child._clipMask){clipItem=child;break}}this._clipItem=clipItem}return clipItem},isClipped:function(){return!!this._getClipItem()},setClipped:function(clipped){var child=this.getFirstChild();if(child)child.setClipMask(clipped)},_draw:function(ctx,param){var clip=param.clip,clipItem=!clip&&this._getClipItem(),draw=true;param=param.extend({clipItem:clipItem,clip:false});if(clip){if(this._currentPath){ctx.currentPath=this._currentPath;draw=false}else{ctx.beginPath();param.dontStart=param.dontFinish=true}}else if(clipItem){clipItem.draw(ctx,param.extend({clip:true}))}if(draw){for(var i=0,l=this._children.length;i<l;i++){var item=this._children[i];if(item!==clipItem)item.draw(ctx,param)}}if(clip){this._currentPath=ctx.currentPath}}});var Layer=Group.extend({_class:"Layer",initialize:function Layer(arg){var props=Base.isPlainObject(arg)?new Base(arg):{children:Array.isArray(arg)?arg:arguments},insert=props.insert;props.insert=false;Group.call(this,props);if(insert||insert===undefined){this._project.addChild(this);this.activate()}},_remove:function _remove(notifySelf,notifyParent){if(this._parent)return _remove.base.call(this,notifySelf,notifyParent);if(this._index!=null){var project=this._project;if(project._activeLayer===this)project._activeLayer=this.getNextSibling()||this.getPreviousSibling();Base.splice(project.layers,null,this._index,1);this._installEvents(false);if(notifySelf&&project._changes)this._changed(5);if(notifyParent){project._needsUpdate=true}return true}return false},getNextSibling:function getNextSibling(){return this._parent?getNextSibling.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function getPreviousSibling(){return this._parent?getPreviousSibling.base.call(this):this._project.layers[this._index-1]||null},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_insertSibling:function _insertSibling(index,item,_preserve){return!this._parent?this._project.insertChild(index,item,_preserve):_insertSibling.base.call(this,index,item,_preserve)}});var Shape=Item.extend({_class:"Shape",_applyMatrix:false,_canApplyMatrix:false,_boundsSelected:true,_serializeFields:{type:null,size:null,radius:null},initialize:function Shape(props){this._initialize(props)},_equals:function(item){return this._type===item._type&&this._size.equals(item._size)&&Base.equals(this._radius,item._radius)},clone:function(insert){var copy=new Shape(Item.NO_INSERT);copy.setType(this._type);copy.setSize(this._size);copy.setRadius(this._radius);return this._clone(copy,insert)},getType:function(){return this._type},setType:function(type){this._type=type},getShape:"#getType",setShape:"#setType",getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!this._size){this._size=size.clone()}else if(!this._size.equals(size)){var type=this._type,width=size.width,height=size.height;if(type==="rectangle"){var radius=Size.min(this._radius,size.divide(2));this._radius.set(radius.width,radius.height)}else if(type==="circle"){width=height=(width+height)/2;this._radius=width/2}else if(type==="ellipse"){this._radius.set(width/2,height/2)}this._size.set(width,height);this._changed(9)}},getRadius:function(){var rad=this._radius;return this._type==="circle"?rad:new LinkedSize(rad.width,rad.height,this,"setRadius")},setRadius:function(radius){var type=this._type;if(type==="circle"){if(radius===this._radius)return;var size=radius*2;this._radius=radius;this._size.set(size,size)}else{radius=Size.read(arguments);if(!this._radius){this._radius=radius.clone()}else{if(this._radius.equals(radius))return;this._radius.set(radius.width,radius.height);if(type==="rectangle"){var size=Size.max(this._size,radius.multiply(2));this._size.set(size.width,size.height)}else if(type==="ellipse"){this._size.set(radius.width*2,radius.height*2)}}}this._changed(9)},isEmpty:function(){return false},toPath:function(insert){var path=this._clone(new(Path[Base.capitalize(this._type)])({center:new Point,size:this._size,radius:this._radius,insert:false}),insert);if(paper.settings.applyMatrix)path.setApplyMatrix(true);return path},_draw:function(ctx,param,strokeMatrix){var style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),dontPaint=param.dontFinish||param.clip,untransformed=!strokeMatrix;if(hasFill||hasStroke||dontPaint){var type=this._type,radius=this._radius,isCircle=type==="circle";if(!param.dontStart)ctx.beginPath();if(untransformed&&isCircle){ctx.arc(0,0,radius,0,Math.PI*2,true)}else{var rx=isCircle?radius:radius.width,ry=isCircle?radius:radius.height,size=this._size,width=size.width,height=size.height;if(untransformed&&type==="rectangle"&&rx===0&&ry===0){ctx.rect(-width/2,-height/2,width,height)}else{var x=width/2,y=height/2,kappa=1-.5522847498307936,cx=rx*kappa,cy=ry*kappa,c=[-x,-y+ry,-x,-y+cy,-x+cx,-y,-x+rx,-y,x-rx,-y,x-cx,-y,x,-y+cy,x,-y+ry,x,y-ry,x,y-cy,x-cx,y,x-rx,y,-x+rx,y,-x+cx,y,-x,y-cy,-x,y-ry];if(strokeMatrix)strokeMatrix.transform(c,c,32);ctx.moveTo(c[0],c[1]);ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]);if(x!==rx)ctx.lineTo(c[8],c[9]);ctx.bezierCurveTo(c[10],c[11],c[12],c[13],c[14],c[15]);if(y!==ry)ctx.lineTo(c[16],c[17]);ctx.bezierCurveTo(c[18],c[19],c[20],c[21],c[22],c[23]);if(x!==rx)ctx.lineTo(c[24],c[25]);ctx.bezierCurveTo(c[26],c[27],c[28],c[29],c[30],c[31])}}ctx.closePath()}if(!dontPaint&&(hasFill||hasStroke)){this._setStyles(ctx);if(hasFill){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(hasStroke)ctx.stroke()}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);if(getter!=="getBounds"&&this.hasStroke())rect=rect.expand(this.getStrokeWidth());return matrix?matrix._transformBounds(rect):rect}},new function(){function getCornerCenter(that,point,expand){var radius=that._radius;if(!radius.isZero()){var halfSize=that._size.divide(2);for(var i=0;i<4;i++){var dir=new Point(i&1?1:-1,i>1?1:-1),corner=dir.multiply(halfSize),center=corner.subtract(dir.multiply(radius)),rect=new Rectangle(corner,center);if((expand?rect.expand(expand):rect).contains(point))return center}}}function getEllipseRadius(point,radius){var angle=point.getAngleInRadians(),width=radius.width*2,height=radius.height*2,x=width*Math.sin(angle),y=height*Math.cos(angle);return width*height/(2*Math.sqrt(x*x+y*y));

}return{_contains:function _contains(point){if(this._type==="rectangle"){var center=getCornerCenter(this,point);return center?point.subtract(center).divide(this._radius).getLength()<=1:_contains.base.call(this,point)}else{return point.divide(this.size).getLength()<=.5}},_hitTestSelf:function _hitTestSelf(point,options){var hit=false;if(this.hasStroke()){var type=this._type,radius=this._radius,strokeWidth=this.getStrokeWidth()+2*options.tolerance;if(type==="rectangle"){var center=getCornerCenter(this,point,strokeWidth);if(center){var pt=point.subtract(center);hit=2*Math.abs(pt.getLength()-getEllipseRadius(pt,radius))<=strokeWidth}else{var rect=new Rectangle(this._size).setCenter(0,0),outer=rect.expand(strokeWidth),inner=rect.expand(-strokeWidth);hit=outer._containsPoint(point)&&!inner._containsPoint(point)}}else{if(type==="ellipse")radius=getEllipseRadius(point,radius);hit=2*Math.abs(point.getLength()-radius)<=strokeWidth}}return hit?new HitResult("stroke",this):_hitTestSelf.base.apply(this,arguments)}}},{statics:new function(){function createShape(type,point,size,radius,args){var item=new Shape(Base.getNamed(args));item._type=type;item._size=size;item._radius=radius;return item.translate(point)}return{Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createShape("circle",center,new Size(radius*2),radius,arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.min(Size.readNamed(arguments,"radius"),rect.getSize(true).divide(2));return createShape("rectangle",rect.getCenter(true),rect.getSize(true),radius,arguments)},Ellipse:function(){var ellipse=Shape._readEllipse(arguments),radius=ellipse.radius;return createShape("ellipse",ellipse.center,radius.multiply(2),radius,arguments)},_readEllipse:function(args){var center,radius;if(Base.hasNamed(args,"radius")){center=Point.readNamed(args,"center");radius=Size.readNamed(args,"radius")}else{var rect=Rectangle.readNamed(args,"rectangle");center=rect.getCenter(true);radius=rect.getSize(true).divide(2)}return{center:center,radius:radius}}}}});var Raster=Item.extend({_class:"Raster",_applyMatrix:false,_canApplyMatrix:false,_boundsGetter:"getBounds",_boundsSelected:true,_serializeFields:{crossOrigin:null,source:null},initialize:function Raster(object,position){if(!this._initialize(object,position!==undefined&&Point.read(arguments,1))){if(typeof object==="string"){this.setSource(object)}else{this.setImage(object)}}if(!this._size){this._size=new Size;this._loaded=false}},_equals:function(item){return this.getSource()===item.getSource()},clone:function(insert){var copy=new Raster(Item.NO_INSERT),image=this._image,canvas=this._canvas;if(image){copy.setImage(image)}else if(canvas){var copyCanvas=CanvasProvider.getCanvas(this._size);copyCanvas.getContext("2d").drawImage(canvas,0,0);copy.setImage(copyCanvas)}copy._crossOrigin=this._crossOrigin;return this._clone(copy,insert)},getSize:function(){var size=this._size;return new LinkedSize(size?size.width:0,size?size.height:0,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!size.equals(this._size)){if(size.width>0&&size.height>0){var element=this.getElement();this.setImage(CanvasProvider.getCanvas(size));if(element)this.getContext(true).drawImage(element,0,0,size.width,size.height)}else{if(this._canvas)CanvasProvider.release(this._canvas);this._size=size.clone()}}},getWidth:function(){return this._size?this._size.width:0},setWidth:function(width){this.setSize(width,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(height){this.setSize(this.getWidth(),height)},isEmpty:function(){var size=this._size;return!size||size.width===0&&size.height===0},getResolution:function(){var matrix=this._matrix,orig=new Point(0,0).transform(matrix),u=new Point(1,0).transform(matrix).subtract(orig),v=new Point(0,1).transform(matrix).subtract(orig);return new Size(72/u.getLength(),72/v.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(image){if(this._canvas)CanvasProvider.release(this._canvas);if(image&&image.getContext){this._image=null;this._canvas=image;this._loaded=true}else{this._image=image;this._canvas=null;this._loaded=image&&image.complete}this._size=new Size(image?image.naturalWidth||image.width:0,image?image.naturalHeight||image.height:0);this._context=null;this._changed(521)},getCanvas:function(){if(!this._canvas){var ctx=CanvasProvider.getContext(this._size);try{if(this._image)ctx.drawImage(this._image,0,0);this._canvas=ctx.canvas}catch(e){CanvasProvider.release(ctx)}}return this._canvas},setCanvas:"#setImage",getContext:function(modify){if(!this._context)this._context=this.getCanvas().getContext("2d");if(modify){this._image=null;this._changed(513)}return this._context},setContext:function(context){this._context=context},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(src){var that=this,crossOrigin=this._crossOrigin,image;function loaded(){var view=that.getView();if(view){paper=view._scope;that.setImage(image);that.emit("load");view.update()}}image=document.getElementById(src)||new Image;if(crossOrigin)image.crossOrigin=crossOrigin;if(image.naturalWidth&&image.naturalHeight){setTimeout(loaded,0)}else{DomEvent.add(image,{load:loaded});if(!image.src)image.src=src}this.setImage(image)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(crossOrigin){this._crossOrigin=crossOrigin;if(this._image)this._image.crossOrigin=crossOrigin},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:false,getSubCanvas:function(){var rect=Rectangle.read(arguments),ctx=CanvasProvider.getContext(rect.getSize());ctx.drawImage(this.getCanvas(),rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height);return ctx.canvas},getSubRaster:function(){var rect=Rectangle.read(arguments),raster=new Raster(Item.NO_INSERT);raster.setImage(this.getSubCanvas(rect));raster.translate(rect.getCenter().subtract(this.getSize().divide(2)));raster._matrix.preConcatenate(this._matrix);raster.insertAbove(this);return raster},toDataURL:function(){var src=this._image&&this._image.src;if(/^data:/.test(src))return src;var canvas=this.getCanvas();return canvas?canvas.toDataURL.apply(canvas,arguments):null},drawImage:function(image){var point=Point.read(arguments,1);this.getContext(true).drawImage(image,point.x,point.y)},getAverageColor:function(object){var bounds,path;if(!object){bounds=this.getBounds()}else if(object instanceof PathItem){path=object;bounds=object.getBounds()}else if(object.width){bounds=new Rectangle(object)}else if(object.x){bounds=new Rectangle(object.x-.5,object.y-.5,1,1)}var sampleSize=32,width=Math.min(bounds.width,sampleSize),height=Math.min(bounds.height,sampleSize);var ctx=Raster._sampleContext;if(!ctx){ctx=Raster._sampleContext=CanvasProvider.getContext(new Size(sampleSize))}else{ctx.clearRect(0,0,sampleSize+1,sampleSize+1)}ctx.save();var matrix=(new Matrix).scale(width/bounds.width,height/bounds.height).translate(-bounds.x,-bounds.y);matrix.applyToContext(ctx);if(path)path.draw(ctx,new Base({clip:true,matrices:[matrix]}));this._matrix.applyToContext(ctx);var element=this.getElement(),size=this._size;if(element)ctx.drawImage(element,-size.width/2,-size.height/2);ctx.restore();var pixels=ctx.getImageData(.5,.5,Math.ceil(width),Math.ceil(height)).data,channels=[0,0,0],total=0;for(var i=0,l=pixels.length;i<l;i+=4){var alpha=pixels[i+3];total+=alpha;alpha/=255;channels[0]+=pixels[i]*alpha;channels[1]+=pixels[i+1]*alpha;channels[2]+=pixels[i+2]*alpha}for(var i=0;i<3;i++)channels[i]/=total;return total?Color.read(channels):null},getPixel:function(){var point=Point.read(arguments);var data=this.getContext().getImageData(point.x,point.y,1,1).data;return new Color("rgb",[data[0]/255,data[1]/255,data[2]/255],data[3]/255)},setPixel:function(){var point=Point.read(arguments),color=Color.read(arguments),components=color._convert("rgb"),alpha=color._alpha,ctx=this.getContext(true),imageData=ctx.createImageData(1,1),data=imageData.data;data[0]=components[0]*255;data[1]=components[1]*255;data[2]=components[2]*255;data[3]=alpha!=null?alpha*255:255;ctx.putImageData(imageData,point.x,point.y)},createImageData:function(){var size=Size.read(arguments);return this.getContext().createImageData(size.width,size.height)},getImageData:function(){var rect=Rectangle.read(arguments);if(rect.isEmpty())rect=new Rectangle(this._size);return this.getContext().getImageData(rect.x,rect.y,rect.width,rect.height)},setImageData:function(data){var point=Point.read(arguments,1);this.getContext(true).putImageData(data,point.x,point.y)},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return matrix?matrix._transformBounds(rect):rect},_hitTestSelf:function(point){if(this._contains(point)){var that=this;return new HitResult("pixel",that,{offset:point.add(that._size.divide(2)).round(),color:{get:function(){return that.getPixel(this.offset)}}})}},_draw:function(ctx){var element=this.getElement();if(element){ctx.globalAlpha=this._opacity;ctx.drawImage(element,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return true}});var PlacedSymbol=Item.extend({_class:"PlacedSymbol",_applyMatrix:false,_canApplyMatrix:false,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:true,_serializeFields:{symbol:null},initialize:function PlacedSymbol(arg0,arg1){if(!this._initialize(arg0,arg1!==undefined&&Point.read(arguments,1)))this.setSymbol(arg0 instanceof Symbol?arg0:new Symbol(arg0))},_equals:function(item){return this._symbol===item._symbol},getSymbol:function(){return this._symbol},setSymbol:function(symbol){this._symbol=symbol;this._changed(9)},clone:function(insert){var copy=new PlacedSymbol(Item.NO_INSERT);copy.setSymbol(this._symbol);return this._clone(copy,insert)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(getter,matrix,cacheItem){var definition=this.symbol._definition;return definition._getCachedBounds(getter,matrix&&matrix.chain(definition._matrix),cacheItem)},_hitTestSelf:function(point,options){var res=this._symbol._definition._hitTest(point,options);if(res)res.item=this;return res},_draw:function(ctx,param){this.symbol._definition.draw(ctx,param)}});var HitResult=Base.extend({_class:"HitResult",initialize:function HitResult(type,item,values){this.type=type;this.item=item;if(values){values.enumerable=true;this.inject(values)}},statics:{getOptions:function(options){return new Base({type:null,tolerance:paper.settings.hitTolerance,fill:!options,stroke:!options,segments:!options,handles:false,ends:false,center:false,bounds:false,guides:false,selected:false},options)}}});var Segment=Base.extend({_class:"Segment",beans:true,initialize:function Segment(arg0,arg1,arg2,arg3,arg4,arg5){var count=arguments.length,point,handleIn,handleOut;if(count===0){}else if(count===1){if("point"in arg0){point=arg0.point;handleIn=arg0.handleIn;handleOut=arg0.handleOut}else{point=arg0}}else if(count===2&&typeof arg0==="number"){point=arguments}else if(count<=3){point=arg0;handleIn=arg1;handleOut=arg2}else{point=arg0!==undefined?[arg0,arg1]:null;handleIn=arg2!==undefined?[arg2,arg3]:null;handleOut=arg4!==undefined?[arg4,arg5]:null}new SegmentPoint(point,this,"_point");new SegmentPoint(handleIn,this,"_handleIn");new SegmentPoint(handleOut,this,"_handleOut")},_serialize:function(options){return Base.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,options,true)},_changed:function(point){var path=this._path;if(!path)return;var curves=path._curves,index=this._index,curve;if(curves){if((!point||point===this._point||point===this._handleIn)&&(curve=index>0?curves[index-1]:path._closed?curves[curves.length-1]:null))curve._changed();if((!point||point===this._point||point===this._handleOut)&&(curve=curves[index]))curve._changed()}path._changed(25)},getPoint:function(){return this._point},setPoint:function(){var point=Point.read(arguments);this._point.set(point.x,point.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var point=Point.read(arguments);this._handleIn.set(point.x,point.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var point=Point.read(arguments);this._handleOut.set(point.x,point.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0);this._handleOut.set(0,0)},_selectionState:0,isSelected:function(_point){var state=this._selectionState;return!_point?!!(state&7):_point===this._point?!!(state&4):_point===this._handleIn?!!(state&1):_point===this._handleOut?!!(state&2):false},setSelected:function(selected,_point){var path=this._path,selected=!!selected,state=this._selectionState,oldState=state,flag=!_point?7:_point===this._point?4:_point===this._handleIn?1:_point===this._handleOut?2:0;if(selected){state|=flag}else{state&=~flag}this._selectionState=state;if(path&&state!==oldState){path._updateSelection(this,oldState,state);path._changed(129)}},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var path=this._path,index=this._index;if(path){if(index>0&&!path._closed&&index===path._segments.length-1)index--;return path.getCurves()[index]||null}return null},getLocation:function(){var curve=this.getCurve();return curve?new CurveLocation(curve,this===curve._segment1?0:1):null},getNext:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index+1]||this._path._closed&&segments[0])||null},getPrevious:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index-1]||this._path._closed&&segments[segments.length-1])||null},isFirst:function(){return this._index===0},isLast:function(){var path=this._path;return path&&this._index===path._segments.length-1||false},reverse:function(){var handleIn=this._handleIn,handleOut=this._handleOut,inX=handleIn._x,inY=handleIn._y;handleIn.set(handleOut._x,handleOut._y);handleOut.set(inX,inY)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):false},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(segment){return segment===this||segment&&this._class===segment._class&&this._point.equals(segment._point)&&this._handleIn.equals(segment._handleIn)&&this._handleOut.equals(segment._handleOut)||false},toString:function(){var parts=["point: "+this._point];if(!this._handleIn.isZero())parts.push("handleIn: "+this._handleIn);if(!this._handleOut.isZero())parts.push("handleOut: "+this._handleOut);return"{ "+parts.join(", ")+" }"},transform:function(matrix){this._transformCoordinates(matrix,new Array(6),true);this._changed()},_transformCoordinates:function(matrix,coords,change){var point=this._point,handleIn=!change||!this._handleIn.isZero()?this._handleIn:null,handleOut=!change||!this._handleOut.isZero()?this._handleOut:null,x=point._x,y=point._y,i=2;coords[0]=x;coords[1]=y;if(handleIn){coords[i++]=handleIn._x+x;coords[i++]=handleIn._y+y}if(handleOut){coords[i++]=handleOut._x+x;coords[i++]=handleOut._y+y}if(matrix){matrix._transformCoordinates(coords,coords,i/2);x=coords[0];y=coords[1];if(change){point._x=x;point._y=y;i=2;if(handleIn){handleIn._x=coords[i++]-x;handleIn._y=coords[i++]-y}if(handleOut){handleOut._x=coords[i++]-x;handleOut._y=coords[i++]-y}}else{if(!handleIn){coords[i++]=x;coords[i++]=y}if(!handleOut){coords[i++]=x;coords[i++]=y}}}return coords}});var SegmentPoint=Point.extend({initialize:function SegmentPoint(point,owner,key){var x,y,selected;if(!point){x=y=0}else if((x=point[0])!==undefined){y=point[1]}else{var pt=point;if((x=pt.x)===undefined){pt=Point.read(arguments);x=pt.x}y=pt.y;selected=pt.selected}this._x=x;this._y=y;this._owner=owner;owner[key]=this;if(selected)this.setSelected(true)},set:function(x,y){this._x=x;this._y=y;this._owner._changed(this);return this},_serialize:function(options){var f=options.formatter,x=f.number(this._x),y=f.number(this._y);return this.isSelected()?{x:x,y:y,selected:true}:[x,y]},getX:function(){return this._x},setX:function(x){this._x=x;this._owner._changed(this)},getY:function(){return this._y},setY:function(y){this._y=y;this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},setSelected:function(selected){this._owner.setSelected(selected,this)},isSelected:function(){return this._owner.isSelected(this)}});var Curve=Base.extend({_class:"Curve",initialize:function Curve(arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7){var count=arguments.length,seg1,seg2,point1,point2,handle1,handle2;if(count===3){this._path=arg0;seg1=arg1;seg2=arg2}else if(count===0){seg1=new Segment;seg2=new Segment}else if(count===1){if("segment1"in arg0){seg1=new Segment(arg0.segment1);seg2=new Segment(arg0.segment2)}else if("point1"in arg0){point1=arg0.point1;handle1=arg0.handle1;handle2=arg0.handle2;point2=arg0.point2}else if(Array.isArray(arg0)){point1=[arg0[0],arg0[1]];point2=[arg0[6],arg0[7]];handle1=[arg0[2]-arg0[0],arg0[3]-arg0[1]];handle2=[arg0[4]-arg0[6],arg0[5]-arg0[7]]}}else if(count===2){seg1=new Segment(arg0);seg2=new Segment(arg1)}else if(count===4){point1=arg0;handle1=arg1;handle2=arg2;point2=arg3}else if(count===8){point1=[arg0,arg1];point2=[arg6,arg7];handle1=[arg2-arg0,arg3-arg1];handle2=[arg4-arg6,arg5-arg7]}this._segment1=seg1||new Segment(point1,null,handle1);this._segment2=seg2||new Segment(point2,handle2,null)},_serialize:function(options){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],options,true)},_changed:function(){this._length=this._bounds=undefined},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var parts=["point1: "+this._segment1._point];if(!this._segment1._handleOut.isZero())parts.push("handle1: "+this._segment1._handleOut);if(!this._segment2._handleIn.isZero())parts.push("handle2: "+this._segment2._handleIn);parts.push("point2: "+this._segment2._point);return"{ "+parts.join(", ")+" }"},remove:function(){var removed=false;if(this._path){var segment2=this._segment2,handleOut=segment2._handleOut;removed=segment2.remove();if(removed)this._segment1._handleOut.set(handleOut.x,handleOut.y)}return removed},getPoint1:function(){return this._segment1._point},setPoint1:function(){var point=Point.read(arguments);this._segment1._point.set(point.x,point.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var point=Point.read(arguments);this._segment2._point.set(point.x,point.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var point=Point.read(arguments);this._segment1._handleOut.set(point.x,point.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var point=Point.read(arguments);this._segment2._handleIn.set(point.x,point.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index+1]||this._path._closed&&curves[0])||null},getPrevious:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index-1]||this._path._closed&&curves[curves.length-1])||null},isFirst:function(){return this._segment1._index===0},isLast:function(){var path=this._path;return path&&this._segment1._index===path._curves.length-1||false},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(selected){this.getPoint1().setSelected(selected);this.getHandle1().setSelected(selected);this.getHandle2().setSelected(selected);this.getPoint2().setSelected(selected)},getValues:function(matrix){return Curve.getValues(this._segment1,this._segment2,matrix)},getPoints:function(){var coords=this.getValues(),points=[];for(var i=0;i<8;i+=2)points.push(new Point(coords[i],coords[i+1]));return points},getLength:function(){if(this._length==null)this._length=Curve.getLength(this.getValues(),0,1);return this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(from,to){return new Curve(Curve.getPart(this.getValues(),from,to))},getPartLength:function(from,to){return Curve.getLength(this.getValues(),from,to)},getIntersections:function(curve){return Curve._getIntersections(this.getValues(),curve&&curve!==this?curve.getValues():null,this,curve,[],{})},_getParameter:function(offset,isParameter){return isParameter?offset:offset&&offset.curve===this?offset.parameter:offset===undefined&&isParameter===undefined?.5:this.getParameterAt(offset,0)},divide:function(offset,isParameter,_setHandles){var parameter=this._getParameter(offset,isParameter),tMin=4e-7,tMax=1-tMin,res=null;if(parameter>=tMin&&parameter<=tMax){var parts=Curve.subdivide(this.getValues(),parameter),left=parts[0],right=parts[1],setHandles=_setHandles||this.hasHandles(),segment1=this._segment1,segment2=this._segment2,path=this._path;if(setHandles){segment1._handleOut.set(left[2]-left[0],left[3]-left[1]);segment2._handleIn.set(right[4]-right[6],right[5]-right[7])}var x=left[6],y=left[7],segment=new Segment(new Point(x,y),setHandles&&new Point(left[4]-x,left[5]-y),setHandles&&new Point(right[2]-x,right[3]-y));if(path){path.insert(segment1._index+1,segment);res=this.getNext()}else{this._segment2=segment;res=new Curve(segment,segment2)}}return res},split:function(offset,isParameter){return this._path?this._path.split(this._segment1._index,this._getParameter(offset,isParameter)):null},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0);this._segment2._handleIn.set(0,0)},statics:{getValues:function(segment1,segment2,matrix){var p1=segment1._point,h1=segment1._handleOut,h2=segment2._handleIn,p2=segment2._point,values=[p1._x,p1._y,p1._x+h1._x,p1._y+h1._y,p2._x+h2._x,p2._y+h2._y,p2._x,p2._y];if(matrix)matrix._transformCoordinates(values,values,4);return values},subdivide:function(v,t){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7];if(t===undefined)t=.5;var u=1-t,p3x=u*p1x+t*c1x,p3y=u*p1y+t*c1y,p4x=u*c1x+t*c2x,p4y=u*c1y+t*c2y,p5x=u*c2x+t*p2x,p5y=u*c2y+t*p2y,p6x=u*p3x+t*p4x,p6y=u*p3y+t*p4y,p7x=u*p4x+t*p5x,p7y=u*p4y+t*p5y,p8x=u*p6x+t*p7x,p8y=u*p6y+t*p7y;return[[p1x,p1y,p3x,p3y,p6x,p6y,p8x,p8y],[p8x,p8y,p7x,p7y,p5x,p5y,p2x,p2y]]},solveCubic:function(v,coord,val,roots,min,max){var p1=v[coord],c1=v[coord+2],c2=v[coord+4],p2=v[coord+6],c=3*(c1-p1),b=3*(c2-c1)-c,a=p2-p1-c-b;return Numerical.solveCubic(a,b,c,p1-val,roots,min,max)},getParameterOf:function(v,point){var p1=new Point(v[0],v[1]),p2=new Point(v[6],v[7]),epsilon=1e-12,t=point.isClose(p1,epsilon)?0:point.isClose(p2,epsilon)?1:null;if(t!==null)return t;var coords=[point.x,point.y],roots=[],geomEpsilon=2e-7;for(var c=0;c<2;c++){var count=Curve.solveCubic(v,c,coords[c],roots,0,1);for(var i=0;i<count;i++){t=roots[i];if(point.isClose(Curve.getPoint(v,t),geomEpsilon))return t}}return point.isClose(p1,geomEpsilon)?0:point.isClose(p2,geomEpsilon)?1:null},getNearestParameter:function(v,point){if(Curve.isStraight(v)){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7],vx=p2x-p1x,vy=p2y-p1y,det=vx*vx+vy*vy;if(det===0)return 0;var u=((point.x-p1x)*vx+(point.y-p1y)*vy)/det;return u<1e-12?0:u>.999999999999?1:Curve.getParameterOf(v,new Point(p1x+u*vx,p1y+u*vy))}var count=100,minDist=Infinity,minT=0;function refine(t){if(t>=0&&t<=1){var dist=point.getDistance(Curve.getPoint(v,t),true);if(dist<minDist){minDist=dist;minT=t;return true}}}for(var i=0;i<=count;i++)refine(i/count);var step=1/(count*2);while(step>4e-7){if(!refine(minT-step)&&!refine(minT+step))step/=2}return minT},getPart:function(v,from,to){var flip=from>to;if(flip){var tmp=from;from=to;to=tmp}if(from>0)v=Curve.subdivide(v,from)[1];if(to<1)v=Curve.subdivide(v,(to-from)/(1-from))[0];return flip?[v[6],v[7],v[4],v[5],v[2],v[3],v[0],v[1]]:v},hasHandles:function(v){var isZero=Numerical.isZero;return!(isZero(v[0]-v[2])&&isZero(v[1]-v[3])&&isZero(v[4]-v[6])&&isZero(v[5]-v[7]))},isFlatEnough:function(v,tolerance){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ux=3*c1x-2*p1x-p2x,uy=3*c1y-2*p1y-p2y,vx=3*c2x-2*p2x-p1x,vy=3*c2y-2*p2y-p1y;return Math.max(ux*ux,vx*vx)+Math.max(uy*uy,vy*vy)<10*tolerance*tolerance},getArea:function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7],h1x=(v[2]+p1x)/2,h1y=(v[3]+p1y)/2,h2x=(v[4]+v[6])/2,h2y=(v[5]+v[7])/2;return 6*((p1x-h1x)*(h1y+p1y)+(h1x-h2x)*(h2y+h1y)+(h2x-p2x)*(p2y+h2y))/10},getBounds:function(v){var min=v.slice(0,2),max=min.slice(),roots=[0,0];for(var i=0;i<2;i++)Curve._addBounds(v[i],v[i+2],v[i+4],v[i+6],i,0,min,max,roots);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},_addBounds:function(v0,v1,v2,v3,coord,padding,min,max,roots){function add(value,padding){var left=value-padding,right=value+padding;if(left<min[coord])min[coord]=left;if(right>max[coord])max[coord]=right}var a=3*(v1-v2)-v0+v3,b=2*(v0+v2)-4*v1,c=v1-v0,count=Numerical.solveQuadratic(a,b,c,roots),tMin=4e-7,tMax=1-tMin;add(v3,0);for(var i=0;i<count;i++){var t=roots[i],u=1-t;if(tMin<t&&t<tMax)add(u*u*u*v0+3*u*u*t*v1+3*u*t*t*v2+t*t*t*v3,padding)}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(name){this[name]=function(){if(!this._bounds)this._bounds={};var bounds=this._bounds[name];if(!bounds){var path=this._path;bounds=this._bounds[name]=Path[name]([this._segment1,this._segment2],false,path&&path.getStyle())}return bounds.clone()}},{}),Base.each({isStraight:function(l,h1,h2){if(h1.isZero()&&h2.isZero()){return true}else if(l.isZero()){return false}else if(h1.isCollinear(l)&&h2.isCollinear(l)){var div=l.dot(l),p1=l.dot(h1)/div,p2=l.dot(h2)/div;return p1>=0&&p1<=1&&p2<=0&&p2>=-1}return false},isLinear:function(l,h1,h2){var third=l.divide(3);return h1.equals(third)&&h2.negate().equals(third)}},function(test,name){this[name]=function(){var seg1=this._segment1,seg2=this._segment2;return test(seg2._point.subtract(seg1._point),seg1._handleOut,seg2._handleIn)};this.statics[name]=function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7];return test(new Point(p2x-p1x,p2y-p1y),new Point(v[2]-p1x,v[3]-p1y),new Point(v[4]-p2x,v[5]-p2y))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(curve){return curve&&this.isStraight()&&curve.isStraight()&&this.getLine().isCollinear(curve.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,true).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,true).x)<1e-7}}),{beans:false,getParameterAt:function(offset,start){return Curve.getParameterAt(this.getValues(),offset,start)},getParameterOf:function(){return Curve.getParameterOf(this.getValues(),Point.read(arguments))},getLocationAt:function(offset,isParameter){var t=isParameter?offset:this.getParameterAt(offset);return t!=null&&t>=0&&t<=1?new CurveLocation(this,t):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(Point.read(arguments)),true)},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getNearestLocation:function(){var point=Point.read(arguments),values=this.getValues(),t=Curve.getNearestParameter(values,point),pt=Curve.getPoint(values,t);return new CurveLocation(this,t,pt,null,point.getDistance(pt))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var methods=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(methods,function(name){this[name+"At"]=function(offset,isParameter){var values=this.getValues();return Curve[name](values,isParameter?offset:Curve.getParameterAt(values,offset,0))}},{statics:{evaluateMethods:methods}})},new function(){function getLengthIntegrand(v){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ax=9*(c1x-c2x)+3*(p2x-p1x),bx=6*(p1x+c2x)-12*c1x,cx=3*(c1x-p1x),ay=9*(c1y-c2y)+3*(p2y-p1y),by=6*(p1y+c2y)-12*c1y,cy=3*(c1y-p1y);return function(t){var dx=(ax*t+bx)*t+cx,dy=(ay*t+by)*t+cy;return Math.sqrt(dx*dx+dy*dy)}}function getIterations(a,b){return Math.max(2,Math.min(16,Math.ceil(Math.abs(b-a)*32)))}function evaluate(v,t,type,normalized){if(t==null||t<0||t>1)return null;var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],tMin=4e-7,tMax=1-tMin,x,y;if(type===0&&(t<tMin||t>tMax)){var isZero=t<tMin;x=isZero?p1x:p2x;y=isZero?p1y:p2y}else{var cx=3*(c1x-p1x),bx=3*(c2x-c1x)-cx,ax=p2x-p1x-cx-bx,cy=3*(c1y-p1y),by=3*(c2y-c1y)-cy,ay=p2y-p1y-cy-by;if(type===0){x=((ax*t+bx)*t+cx)*t+p1x;y=((ay*t+by)*t+cy)*t+p1y}else{if(t<tMin){x=cx;y=cy}else if(t>tMax){x=3*(p2x-c2x);y=3*(p2y-c2y)}else{x=(3*ax*t+2*bx)*t+cx;y=(3*ay*t+2*by)*t+cy}if(normalized){if(x===0&&y===0&&(t<tMin||t>tMax)){x=c2x-c1x;y=c2y-c1y}var len=Math.sqrt(x*x+y*y);if(len){x/=len;y/=len}}if(type===3){var x2=6*ax*t+2*bx,y2=6*ay*t+2*by,d=Math.pow(x*x+y*y,3/2);x=d!==0?(x*y2-y*x2)/d:0;y=0}}}return type===2?new Point(y,-x):new Point(x,y)}return{statics:{getLength:function(v,a,b){if(a===undefined)a=0;if(b===undefined)b=1;if(a===0&&b===1&&Curve.isStraight(v)){var dx=v[6]-v[0],dy=v[7]-v[1];return Math.sqrt(dx*dx+dy*dy)}var ds=getLengthIntegrand(v);return Numerical.integrate(ds,a,b,getIterations(a,b))},getParameterAt:function(v,offset,start){if(start===undefined)start=offset<0?1:0;if(offset===0)return start;var abs=Math.abs,forward=offset>0,a=forward?start:0,b=forward?1:start,ds=getLengthIntegrand(v),rangeLength=Numerical.integrate(ds,a,b,getIterations(a,b));if(abs(offset-rangeLength)<1e-12){return forward?b:a}else if(abs(offset)>rangeLength){return null}var guess=offset/rangeLength,length=0;function f(t){length+=Numerical.integrate(ds,start,t,getIterations(start,t));start=t;return length-offset}return Numerical.findRoot(f,ds,start+guess,a,b,32,1e-12)},getPoint:function(v,t){return evaluate(v,t,0,false)},getTangent:function(v,t){return evaluate(v,t,1,true)},getWeightedTangent:function(v,t){return evaluate(v,t,1,false)},getNormal:function(v,t){return evaluate(v,t,2,true)},getWeightedNormal:function(v,t){return evaluate(v,t,2,false)},getCurvature:function(v,t){return evaluate(v,t,3,false).x}}}},new function(){function addLocation(locations,param,v1,c1,t1,p1,v2,c2,t2,p2,overlap){var startConnected=param.startConnected,endConnected=param.endConnected,tMin=4e-7,tMax=1-tMin;if(t1==null)t1=Curve.getParameterOf(v1,p1);if(t1!==null&&t1>=(startConnected?tMin:0)&&t1<=(endConnected?tMax:1)){if(t2==null)t2=Curve.getParameterOf(v2,p2);if(t2!==null&&t2>=(endConnected?tMin:0)&&t2<=(startConnected?tMax:1)){var renormalize=param.renormalize;if(renormalize){var res=renormalize(t1,t2);t1=res[0];t2=res[1]}var loc1=new CurveLocation(c1,t1,p1||Curve.getPoint(v1,t1),overlap),loc2=new CurveLocation(c2,t2,p2||Curve.getPoint(v2,t2),overlap),flip=loc1.getPath()===loc2.getPath()&&loc1.getIndex()>loc2.getIndex(),loc=flip?loc2:loc1,include=param.include;loc1._intersection=loc2;loc2._intersection=loc1;if(!include||include(loc)){CurveLocation.insert(locations,loc,true)}}}}function addCurveIntersections(v1,v2,c1,c2,locations,param,tMin,tMax,uMin,uMax,oldTDiff,reverse,recursion){if(++recursion>=24)return;var q0x=v2[0],q0y=v2[1],q3x=v2[6],q3y=v2[7],getSignedDistance=Line.getSignedDistance,d1=getSignedDistance(q0x,q0y,q3x,q3y,v2[2],v2[3]),d2=getSignedDistance(q0x,q0y,q3x,q3y,v2[4],v2[5]),factor=d1*d2>0?3/4:4/9,dMin=factor*Math.min(0,d1,d2),dMax=factor*Math.max(0,d1,d2),dp0=getSignedDistance(q0x,q0y,q3x,q3y,v1[0],v1[1]),dp1=getSignedDistance(q0x,q0y,q3x,q3y,v1[2],v1[3]),dp2=getSignedDistance(q0x,q0y,q3x,q3y,v1[4],v1[5]),dp3=getSignedDistance(q0x,q0y,q3x,q3y,v1[6],v1[7]),hull=getConvexHull(dp0,dp1,dp2,dp3),top=hull[0],bottom=hull[1],tMinClip,tMaxClip;

if((tMinClip=clipConvexHull(top,bottom,dMin,dMax))==null||(tMaxClip=clipConvexHull(top.reverse(),bottom.reverse(),dMin,dMax))==null)return;v1=Curve.getPart(v1,tMinClip,tMaxClip);var tDiff=tMaxClip-tMinClip,tMinNew=tMin+(tMax-tMin)*tMinClip,tMaxNew=tMin+(tMax-tMin)*tMaxClip;if(oldTDiff>.5&&tDiff>.5){if(tMaxNew-tMinNew>uMax-uMin){var parts=Curve.subdivide(v1,.5),t=tMinNew+(tMaxNew-tMinNew)/2;addCurveIntersections(v2,parts[0],c2,c1,locations,param,uMin,uMax,tMinNew,t,tDiff,!reverse,recursion);addCurveIntersections(v2,parts[1],c2,c1,locations,param,uMin,uMax,t,tMaxNew,tDiff,!reverse,recursion)}else{var parts=Curve.subdivide(v2,.5),t=uMin+(uMax-uMin)/2;addCurveIntersections(parts[0],v1,c2,c1,locations,param,uMin,t,tMinNew,tMaxNew,tDiff,!reverse,recursion);addCurveIntersections(parts[1],v1,c2,c1,locations,param,t,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}else if(Math.max(uMax-uMin,tMaxNew-tMinNew)<1e-7){var t1=tMinNew+(tMaxNew-tMinNew)/2,t2=uMin+(uMax-uMin)/2;v1=c1.getValues();v2=c2.getValues();addLocation(locations,param,reverse?v2:v1,reverse?c2:c1,reverse?t2:t1,null,reverse?v1:v2,reverse?c1:c2,reverse?t1:t2,null)}else if(tDiff>1e-12){addCurveIntersections(v2,v1,c2,c1,locations,param,uMin,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}function getConvexHull(dq0,dq1,dq2,dq3){var p0=[0,dq0],p1=[1/3,dq1],p2=[2/3,dq2],p3=[1,dq3],dist1=dq1-(2*dq0+dq3)/3,dist2=dq2-(dq0+2*dq3)/3,hull;if(dist1*dist2<0){hull=[[p0,p1,p3],[p0,p2,p3]]}else{var distRatio=dist1/dist2;hull=[distRatio>=2?[p0,p1,p3]:distRatio<=.5?[p0,p2,p3]:[p0,p1,p2,p3],[p0,p3]]}return(dist1||dist2)<0?hull.reverse():hull}function clipConvexHull(hullTop,hullBottom,dMin,dMax){if(hullTop[0][1]<dMin){return clipConvexHullPart(hullTop,true,dMin)}else if(hullBottom[0][1]>dMax){return clipConvexHullPart(hullBottom,false,dMax)}else{return hullTop[0][0]}}function clipConvexHullPart(part,top,threshold){var px=part[0][0],py=part[0][1];for(var i=1,l=part.length;i<l;i++){var qx=part[i][0],qy=part[i][1];if(top?qy>=threshold:qy<=threshold){return qy===threshold?qx:px+(threshold-py)*(qx-px)/(qy-py)}px=qx;py=qy}return null}function addCurveLineIntersections(v1,v2,c1,c2,locations,param){var flip=Curve.isStraight(v1),vc=flip?v2:v1,vl=flip?v1:v2,lx1=vl[0],ly1=vl[1],lx2=vl[6],ly2=vl[7],ldx=lx2-lx1,ldy=ly2-ly1,angle=Math.atan2(-ldy,ldx),sin=Math.sin(angle),cos=Math.cos(angle),rvc=[];for(var i=0;i<8;i+=2){var x=vc[i]-lx1,y=vc[i+1]-ly1;rvc.push(x*cos-y*sin,x*sin+y*cos)}var roots=[],count=Curve.solveCubic(rvc,1,0,roots,0,1);for(var i=0;i<count;i++){var tc=roots[i],pc=Curve.getPoint(vc,tc),tl=Curve.getParameterOf(vl,pc);if(tl!==null){var pl=Curve.getPoint(vl,tl),t1=flip?tl:tc,t2=flip?tc:tl;if(!param.endConnected||t2>Numerical.CURVETIME_EPSILON){addLocation(locations,param,v1,c1,t1,flip?pl:pc,v2,c2,t2,flip?pc:pl)}}}}function addLineIntersection(v1,v2,c1,c2,locations,param){var pt=Line.intersect(v1[0],v1[1],v1[6],v1[7],v2[0],v2[1],v2[6],v2[7]);if(pt){addLocation(locations,param,v1,c1,null,pt,v2,c2,null,pt)}}return{statics:{_getIntersections:function(v1,v2,c1,c2,locations,param){if(!v2){return Curve._getSelfIntersection(v1,c1,locations,param)}var c1p1x=v1[0],c1p1y=v1[1],c1p2x=v1[6],c1p2y=v1[7],c2p1x=v2[0],c2p1y=v2[1],c2p2x=v2[6],c2p2y=v2[7],c1s1x=(3*v1[2]+c1p1x)/4,c1s1y=(3*v1[3]+c1p1y)/4,c1s2x=(3*v1[4]+c1p2x)/4,c1s2y=(3*v1[5]+c1p2y)/4,c2s1x=(3*v2[2]+c2p1x)/4,c2s1y=(3*v2[3]+c2p1y)/4,c2s2x=(3*v2[4]+c2p2x)/4,c2s2y=(3*v2[5]+c2p2y)/4,min=Math.min,max=Math.max;if(!(max(c1p1x,c1s1x,c1s2x,c1p2x)>=min(c2p1x,c2s1x,c2s2x,c2p2x)&&min(c1p1x,c1s1x,c1s2x,c1p2x)<=max(c2p1x,c2s1x,c2s2x,c2p2x)&&max(c1p1y,c1s1y,c1s2y,c1p2y)>=min(c2p1y,c2s1y,c2s2y,c2p2y)&&min(c1p1y,c1s1y,c1s2y,c1p2y)<=max(c2p1y,c2s1y,c2s2y,c2p2y)))return locations;if(!param.startConnected&&!param.endConnected){var overlaps=Curve.getOverlaps(v1,v2);if(overlaps){for(var i=0;i<2;i++){var overlap=overlaps[i];addLocation(locations,param,v1,c1,overlap[0],null,v2,c2,overlap[1],null,true)}return locations}}var straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2,epsilon=1e-12,before=locations.length;(straight?addLineIntersection:straight1||straight2?addCurveLineIntersections:addCurveIntersections)(v1,v2,c1,c2,locations,param,0,1,0,1,0,false,0);if(straight&&locations.length>before)return locations;var c1p1=new Point(c1p1x,c1p1y),c1p2=new Point(c1p2x,c1p2y),c2p1=new Point(c2p1x,c2p1y),c2p2=new Point(c2p2x,c2p2y);if(c1p1.isClose(c2p1,epsilon))addLocation(locations,param,v1,c1,0,c1p1,v2,c2,0,c2p1);if(!param.startConnected&&c1p1.isClose(c2p2,epsilon))addLocation(locations,param,v1,c1,0,c1p1,v2,c2,1,c2p2);if(!param.endConnected&&c1p2.isClose(c2p1,epsilon))addLocation(locations,param,v1,c1,1,c1p2,v2,c2,0,c2p1);if(c1p2.isClose(c2p2,epsilon))addLocation(locations,param,v1,c1,1,c1p2,v2,c2,1,c2p2);return locations},_getSelfIntersection:function(v1,c1,locations,param){var p1x=v1[0],p1y=v1[1],h1x=v1[2],h1y=v1[3],h2x=v1[4],h2y=v1[5],p2x=v1[6],p2y=v1[7];var line=new Line(p1x,p1y,p2x,p2y,false),side1=line.getSide(new Point(h1x,h1y),true),side2=line.getSide(new Point(h2x,h2y),true);if(side1===side2){var edgeSum=(p1x-h2x)*(h1y-p2y)+(h1x-p2x)*(h2y-p1y);if(edgeSum*side1>0)return locations}var ax=p2x-3*h2x+3*h1x-p1x,bx=h2x-2*h1x+p1x,cx=h1x-p1x,ay=p2y-3*h2y+3*h1y-p1y,by=h2y-2*h1y+p1y,cy=h1y-p1y,ac=ay*cx-ax*cy,ab=ay*bx-ax*by,bc=by*cx-bx*cy;if(ac*ac-4*ab*bc<0){var roots=[],tSplit,count=Numerical.solveCubic(ax*ax+ay*ay,3*(ax*bx+ay*by),2*(bx*bx+by*by)+ax*cx+ay*cy,bx*cx+by*cy,roots,0,1);if(count>0){for(var i=0,maxCurvature=0;i<count;i++){var curvature=Math.abs(c1.getCurvatureAt(roots[i],true));if(curvature>maxCurvature){maxCurvature=curvature;tSplit=roots[i]}}var parts=Curve.subdivide(v1,tSplit);param.endConnected=true;param.renormalize=function(t1,t2){return[t1*tSplit,t2*(1-tSplit)+tSplit]};Curve._getIntersections(parts[0],parts[1],c1,c1,locations,param)}}return locations},getOverlaps:function(v1,v2){var abs=Math.abs,timeEpsilon=4e-7,geomEpsilon=2e-7,straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2;function getLineLengthSquared(v){var x=v[6]-v[0],y=v[7]-v[1];return x*x+y*y}if(straight){var flip=getLineLengthSquared(v1)<getLineLengthSquared(v2),l1=flip?v2:v1,l2=flip?v1:v2,line=new Line(l1[0],l1[1],l1[6],l1[7]);if(line.getDistance(new Point(l2[0],l2[1]))>geomEpsilon||line.getDistance(new Point(l2[6],l2[7]))>geomEpsilon)return null}else if(straight1^straight2){return null}var v=[v1,v2],pairs=[];for(var i=0,t1=0;i<2&&pairs.length<2;i+=t1===0?0:1,t1=t1^1){var t2=Curve.getParameterOf(v[i^1],new Point(v[i][t1===0?0:6],v[i][t1===0?1:7]));if(t2!=null){var pair=i===0?[t1,t2]:[t2,t1];if(pairs.length===0||abs(pair[0]-pairs[0][0])>timeEpsilon&&abs(pair[1]-pairs[0][1])>timeEpsilon)pairs.push(pair)}if(i===1&&pairs.length===0)break}if(pairs.length!==2){pairs=null}else if(!straight){var o1=Curve.getPart(v1,pairs[0][0],pairs[1][0]),o2=Curve.getPart(v2,pairs[0][1],pairs[1][1]);if(abs(o2[2]-o1[2])>geomEpsilon||abs(o2[3]-o1[3])>geomEpsilon||abs(o2[4]-o1[4])>geomEpsilon||abs(o2[5]-o1[5])>geomEpsilon)pairs=null}return pairs}}}});var CurveLocation=Base.extend({_class:"CurveLocation",beans:true,initialize:function CurveLocation(curve,parameter,point,_overlap,_distance){if(parameter>.9999996){var next=curve.getNext();if(next){parameter=0;curve=next}}this._id=UID.get(CurveLocation);this._setCurve(curve);this._parameter=parameter;this._point=point||curve.getPointAt(parameter,true);this._overlap=_overlap;this._distance=_distance;this._intersection=this._next=this._prev=null},_setCurve:function(curve){var path=curve._path;this._version=path?path._version:0;this._curve=curve;this._segment=null;this._segment1=curve._segment1;this._segment2=curve._segment2},_setSegment:function(segment){this._setCurve(segment.getCurve());this._segment=segment;this._parameter=segment===this._segment1?0:1;this._point=segment._point.clone()},getSegment:function(){var curve=this.getCurve(),segment=this._segment;if(!segment){var parameter=this.getParameter();if(parameter===0){segment=curve._segment1}else if(parameter===1){segment=curve._segment2}else if(parameter!=null){segment=curve.getPartLength(0,parameter)<curve.getPartLength(parameter,1)?curve._segment1:curve._segment2}this._segment=segment}return segment},getCurve:function(){var curve=this._curve,path=curve&&curve._path,that=this;if(path&&path._version!==this._version){curve=this._parameter=this._curve=this._offset=null}function trySegment(segment){var curve=segment&&segment.getCurve();if(curve&&(that._parameter=curve.getParameterOf(that._point))!=null){that._setCurve(curve);that._segment=segment;return curve}}return curve||trySegment(this._segment)||trySegment(this._segment1)||trySegment(this._segment2.getPrevious())},getPath:function(){var curve=this.getCurve();return curve&&curve._path},getIndex:function(){var curve=this.getCurve();return curve&&curve.getIndex()},getParameter:function(){var curve=this.getCurve(),parameter=this._parameter;return curve&&parameter==null?this._parameter=curve.getParameterOf(this._point):parameter},getPoint:function(){return this._point},getOffset:function(){var offset=this._offset;if(offset==null){offset=0;var path=this.getPath(),index=this.getIndex();if(path&&index!=null){var curves=path.getCurves();for(var i=0;i<index;i++)offset+=curves[i].getLength()}this._offset=offset+=this.getCurveOffset()}return offset},getCurveOffset:function(){var curve=this.getCurve(),parameter=this.getParameter();return parameter!=null&&curve&&curve.getPartLength(0,parameter)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var curve=this.getCurve(),res=null;if(curve){res=curve.divide(this.getParameter(),true);if(res)this._setSegment(res._segment1)}return res},split:function(){var curve=this.getCurve();return curve?curve.split(this.getParameter(),true):null},equals:function(loc,_ignoreOther){var res=this===loc,epsilon=2e-7;if(!res&&loc instanceof CurveLocation&&this.getPath()===loc.getPath()&&this.getPoint().isClose(loc.getPoint(),epsilon)){var c1=this.getCurve(),c2=loc.getCurve(),abs=Math.abs,diff=abs((c1.isLast()&&c2.isFirst()?-1:c1.getIndex())+this.getParameter()-((c2.isLast()&&c1.isFirst()?-1:c2.getIndex())+loc.getParameter()));res=(diff<4e-7||((diff=abs(this.getOffset()-loc.getOffset()))<epsilon||abs(this.getPath().getLength()-diff)<epsilon))&&(_ignoreOther||(!this._intersection&&!loc._intersection||this._intersection&&this._intersection.equals(loc._intersection,true)))}return res},toString:function(){var parts=[],point=this.getPoint(),f=Formatter.instance;if(point)parts.push("point: "+point);var index=this.getIndex();if(index!=null)parts.push("index: "+index);var parameter=this.getParameter();if(parameter!=null)parts.push("parameter: "+f.number(parameter));if(this._distance!=null)parts.push("distance: "+f.number(this._distance));return"{ "+parts.join(", ")+" }"},isTouching:function(){var inter=this._intersection;if(inter&&this.getTangent().isCollinear(inter.getTangent())){var curve1=this.getCurve(),curve2=inter.getCurve();return!(curve1.isStraight()&&curve2.isStraight()&&curve1.getLine().intersect(curve2.getLine()))}return false},isCrossing:function(){var inter=this._intersection;if(!inter)return false;var t1=this.getParameter(),t2=inter.getParameter(),tMin=4e-7,tMax=1-tMin;if(t1>=tMin&&t1<=tMax||t2>=tMin&&t2<=tMax)return!this.isTouching();var c2=this.getCurve(),c1=c2.getPrevious(),c4=inter.getCurve(),c3=c4.getPrevious(),PI=Math.PI;if(!c1||!c3)return false;function isInRange(angle,min,max){return min<max?angle>min&&angle<max:angle>min&&angle<=PI||angle>=-PI&&angle<max}var a1=c1.getTangentAt(tMax,true).negate().getAngleInRadians(),a2=c2.getTangentAt(tMin,true).getAngleInRadians(),a3=c3.getTangentAt(tMax,true).negate().getAngleInRadians(),a4=c4.getTangentAt(tMin,true).getAngleInRadians();return isInRange(a3,a1,a2)^isInRange(a4,a1,a2)&&isInRange(a3,a2,a1)^isInRange(a4,a2,a1)},isOverlap:function(){return!!this._overlap}},Base.each(Curve.evaluateMethods,function(name){var get=name+"At";this[name]=function(){var parameter=this.getParameter(),curve=this.getCurve();return parameter!=null&&curve&&curve[get](parameter,true)}},{preserve:true}),new function(){function insert(locations,loc,merge){var length=locations.length,l=0,r=length-1;function search(index,dir){for(var i=index+dir;i>=-1&&i<=length;i+=dir){var loc2=locations[(i%length+length)%length];if(!loc.getPoint().isClose(loc2.getPoint(),2e-7))break;if(loc.equals(loc2))return loc2}return null}while(l<=r){var m=l+r>>>1,loc2=locations[m],found;if(merge&&(found=loc.equals(loc2)?loc2:search(m,-1)||search(m,1))){if(loc._overlap){found._overlap=found._intersection._overlap=true}return found}var path1=loc.getPath(),path2=loc2.getPath(),diff=path1===path2?loc.getIndex()+loc.getParameter()-(loc2.getIndex()+loc2.getParameter()):path1._id-path2._id;if(diff<0){r=m-1}else{l=m+1}}locations.splice(l,0,loc);return loc}return{statics:{insert:insert,expand:function(locations){var expanded=locations.slice();for(var i=0,l=locations.length;i<l;i++){insert(expanded,locations[i]._intersection,false)}return expanded}}}});var PathItem=Item.extend({_class:"PathItem",initialize:function PathItem(){},getIntersections:function(path,include,_matrix,_returnFirst){var self=this===path||!path,matrix1=this._matrix.orNullIfIdentity(),matrix2=self?matrix1:(_matrix||path._matrix).orNullIfIdentity();if(!self&&!this.getBounds(matrix1).touches(path.getBounds(matrix2)))return[];var curves1=this.getCurves(),curves2=self?curves1:path.getCurves(),length1=curves1.length,length2=self?length1:curves2.length,values2=[],arrays=[],locations,path;for(var i=0;i<length2;i++)values2[i]=curves2[i].getValues(matrix2);for(var i=0;i<length1;i++){var curve1=curves1[i],values1=self?values2[i]:curve1.getValues(matrix1),path1=curve1.getPath();if(path1!==path){path=path1;locations=[];arrays.push(locations)}if(self){Curve._getSelfIntersection(values1,curve1,locations,{include:include,startConnected:length1===1&&curve1.getPoint1().equals(curve1.getPoint2())})}for(var j=self?i+1:0;j<length2;j++){if(_returnFirst&&locations.length)return locations;var curve2=curves2[j];Curve._getIntersections(values1,values2[j],curve1,curve2,locations,{include:include,startConnected:self&&curve1.getPrevious()===curve2,endConnected:self&&curve1.getNext()===curve2})}}locations=[];for(var i=0,l=arrays.length;i<l;i++){locations.push.apply(locations,arrays[i])}return locations},getCrossings:function(path){return this.getIntersections(path,function(inter){return inter.isCrossing()})},_asPathItem:function(){return this},setPathData:function(data){var parts=data.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),coords,relative=false,previous,control,current=new Point,start=new Point;function getCoord(index,coord){var val=+coords[index];if(relative)val+=current[coord];return val}function getPoint(index){return new Point(getCoord(index,"x"),getCoord(index+1,"y"))}this.clear();for(var i=0,l=parts&&parts.length;i<l;i++){var part=parts[i],command=part[0],lower=command.toLowerCase();coords=part.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var length=coords&&coords.length;relative=command===lower;if(previous==="z"&&!/[mz]/.test(lower))this.moveTo(current=start);switch(lower){case"m":case"l":var move=lower==="m";for(var j=0;j<length;j+=2)this[j===0&&move?"moveTo":"lineTo"](current=getPoint(j));control=current;if(move)start=current;break;case"h":case"v":var coord=lower==="h"?"x":"y";for(var j=0;j<length;j++){current[coord]=getCoord(j,coord);this.lineTo(current)}control=current;break;case"c":for(var j=0;j<length;j+=6){this.cubicCurveTo(getPoint(j),control=getPoint(j+2),current=getPoint(j+4))}break;case"s":for(var j=0;j<length;j+=4){this.cubicCurveTo(/[cs]/.test(previous)?current.multiply(2).subtract(control):current,control=getPoint(j),current=getPoint(j+2));previous=lower}break;case"q":for(var j=0;j<length;j+=4){this.quadraticCurveTo(control=getPoint(j),current=getPoint(j+2))}break;case"t":for(var j=0;j<length;j+=2){this.quadraticCurveTo(control=/[qt]/.test(previous)?current.multiply(2).subtract(control):current,current=getPoint(j));previous=lower}break;case"a":for(var j=0;j<length;j+=7){this.arcTo(current=getPoint(j+5),new Size(+coords[j],+coords[j+1]),+coords[j+2],+coords[j+4],+coords[j+3])}break;case"z":this.closePath(true);break}previous=lower}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(point){var winding=this._getWinding(point,false,true);return!!(this.getWindingRule()==="evenodd"?winding&1:winding)}});var Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:false},initialize:function Path(arg){this._closed=false;this._segments=[];this._version=0;var segments=Array.isArray(arg)?typeof arg[0]==="object"?arg:arguments:arg&&(arg.size===undefined&&(arg.x!==undefined||arg.point!==undefined))?arguments:null;if(segments&&segments.length>0){this.setSegments(segments)}else{this._curves=undefined;this._selectedSegmentState=0;if(!segments&&typeof arg==="string"){this.setPathData(arg);arg=null}}this._initialize(!segments&&arg)},_equals:function(item){return this._closed===item._closed&&Base.equals(this._segments,item._segments)},clone:function(insert){var copy=new Path(Item.NO_INSERT);copy.setSegments(this._segments);copy._closed=this._closed;if(this._clockwise!==undefined)copy._clockwise=this._clockwise;return this._clone(copy,insert)},_changed:function _changed(flags){_changed.base.call(this,flags);if(flags&8){var parent=this._parent;if(parent)parent._currentPath=undefined;this._length=this._area=this._clockwise=this._monoCurves=undefined;if(flags&16){this._version++}else if(this._curves){for(var i=0,l=this._curves.length;i<l;i++)this._curves[i]._changed()}}else if(flags&32){this._bounds=undefined}},getStyle:function(){var parent=this._parent;return(parent instanceof CompoundPath?parent:this)._style},getSegments:function(){return this._segments},setSegments:function(segments){var fullySelected=this.isFullySelected();this._segments.length=0;this._selectedSegmentState=0;this._curves=undefined;if(segments&&segments.length>0)this._add(Segment.readAll(segments));if(fullySelected)this.setFullySelected(true)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var curves=this._curves,segments=this._segments;if(!curves){var length=this._countCurves();curves=this._curves=new Array(length);for(var i=0;i<length;i++)curves[i]=new Curve(this,segments[i],segments[i+1]||segments[0])}return curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var curves=this.getCurves();return curves[curves.length-1]},isClosed:function(){return this._closed},setClosed:function(closed){if(this._closed!=(closed=!!closed)){this._closed=closed;if(this._curves){var length=this._curves.length=this._countCurves();if(closed)this._curves[length-1]=new Curve(this,this._segments[length-1],this._segments[0])}this._changed(25)}}},{beans:true,getPathData:function(_matrix,_precision){var segments=this._segments,length=segments.length,f=new Formatter(_precision),coords=new Array(6),first=true,curX,curY,prevX,prevY,inX,inY,outX,outY,parts=[];function addSegment(segment,skipLine){segment._transformCoordinates(_matrix,coords,false);curX=coords[0];curY=coords[1];if(first){parts.push("M"+f.pair(curX,curY));first=false}else{inX=coords[2];inY=coords[3];if(inX===curX&&inY===curY&&outX===prevX&&outY===prevY){if(!skipLine)parts.push("l"+f.pair(curX-prevX,curY-prevY))}else{parts.push("c"+f.pair(outX-prevX,outY-prevY)+" "+f.pair(inX-prevX,inY-prevY)+" "+f.pair(curX-prevX,curY-prevY))}}prevX=curX;prevY=curY;outX=coords[4];outY=coords[5]}if(length===0)return"";for(var i=0;i<length;i++)addSegment(segments[i]);if(this._closed&&length>0){addSegment(segments[0],true);parts.push("z")}return parts.join("")}},{isEmpty:function(){return this._segments.length===0},_transformContent:function(matrix){var coords=new Array(6);for(var i=0,l=this._segments.length;i<l;i++)this._segments[i]._transformCoordinates(matrix,coords,true);return true},_add:function(segs,index){var segments=this._segments,curves=this._curves,amount=segs.length,append=index==null,index=append?segments.length:index;for(var i=0;i<amount;i++){var segment=segs[i];if(segment._path)segment=segs[i]=segment.clone();segment._path=this;segment._index=index+i;if(segment._selectionState)this._updateSelection(segment,0,segment._selectionState)}if(append){segments.push.apply(segments,segs)}else{segments.splice.apply(segments,[index,0].concat(segs));for(var i=index+amount,l=segments.length;i<l;i++)segments[i]._index=i}if(curves){var total=this._countCurves(),from=index+amount-1===total?index-1:index,start=from,to=Math.min(from+amount,total);if(segs._curves){curves.splice.apply(curves,[from,0].concat(segs._curves));start+=segs._curves.length}for(var i=start;i<to;i++)curves.splice(i,0,new Curve(this,null,null));this._adjustCurves(from,to)}this._changed(25);return segs},_adjustCurves:function(from,to){var segments=this._segments,curves=this._curves,curve;for(var i=from;i<to;i++){curve=curves[i];curve._path=this;curve._segment1=segments[i];curve._segment2=segments[i+1]||segments[0];curve._changed()}if(curve=curves[this._closed&&from===0?segments.length-1:from-1]){curve._segment2=segments[from]||segments[0];curve._changed()}if(curve=curves[to]){curve._segment1=segments[to];curve._changed()}},_countCurves:function(){var length=this._segments.length;return!this._closed&&length>0?length-1:length},add:function(segment1){return arguments.length>1&&typeof segment1!=="number"?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(index,segment1){return arguments.length>2&&typeof segment1!=="number"?this._add(Segment.readAll(arguments,1),index):this._add([Segment.read(arguments,1)],index)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(index){return this._add([Segment.read(arguments,1)],index)[0]},addSegments:function(segments){return this._add(Segment.readAll(segments))},insertSegments:function(index,segments){return this._add(Segment.readAll(segments),index)},removeSegment:function(index){return this.removeSegments(index,index+1)[0]||null},removeSegments:function(from,to,_includeCurves){from=from||0;to=Base.pick(to,this._segments.length);var segments=this._segments,curves=this._curves,count=segments.length,removed=segments.splice(from,to-from),amount=removed.length;if(!amount)return removed;for(var i=0;i<amount;i++){var segment=removed[i];if(segment._selectionState)this._updateSelection(segment,segment._selectionState,0);segment._index=segment._path=null}for(var i=from,l=segments.length;i<l;i++)segments[i]._index=i;if(curves){var index=from>0&&to===count+(this._closed?1:0)?from-1:from,curves=curves.splice(index,amount);if(_includeCurves)removed._curves=curves.slice(1);this._adjustCurves(index,index)}this._changed(25);return removed},clear:"#removeSegments",hasHandles:function(){var segments=this._segments;for(var i=0,l=segments.length;i<l;i++){if(segments[i].hasHandles())return true}return false},clearHandles:function(){var segments=this._segments;for(var i=0,l=segments.length;i<l;i++)segments[i].clearHandles()},getLength:function(){if(this._length==null){var curves=this.getCurves(),length=0;for(var i=0,l=curves.length;i<l;i++)length+=curves[i].getLength();this._length=length}return this._length},getArea:function(){if(this._area==null){var segments=this._segments,count=segments.length,last=count-1,area=0;for(var i=0,l=this._closed?count:last;i<l;i++){area+=Curve.getArea(Curve.getValues(segments[i],segments[i<last?i+1:0]))}this._area=area}return this._area},isClockwise:function(){if(this._clockwise!==undefined)return this._clockwise;return this.getArea()>=0},setClockwise:function(clockwise){if(this.isClockwise()!=(clockwise=!!clockwise))this.reverse();this._clockwise=clockwise},isFullySelected:function(){var length=this._segments.length;return this._selected&&length>0&&this._selectedSegmentState===length*7},setFullySelected:function(selected){if(selected)this._selectSegments(true);this.setSelected(selected)},setSelected:function setSelected(selected){if(!selected)this._selectSegments(false);setSelected.base.call(this,selected)},_selectSegments:function(selected){var length=this._segments.length;this._selectedSegmentState=selected?length*7:0;for(var i=0;i<length;i++)this._segments[i]._selectionState=selected?7:0},_updateSelection:function(segment,oldState,newState){segment._selectionState=newState;var total=this._selectedSegmentState+=newState-oldState;if(total>0)this.setSelected(true)},flatten:function(maxDistance){var iterator=new PathIterator(this,64,.1),pos=0,step=iterator.length/Math.ceil(iterator.length/maxDistance),end=iterator.length+(this._closed?-step:step)/2;var segments=[];while(pos<=end){segments.push(new Segment(iterator.getPointAt(pos)));pos+=step}this.setSegments(segments)},reduce:function(){var curves=this.getCurves();for(var i=curves.length-1;i>=0;i--){var curve=curves[i];if(!curve.hasHandles()&&(curve.getLength()===0||curve.isCollinear(curve.getNext())))curve.remove()}return this},simplify:function(tolerance){if(this._segments.length>2){var fitter=new PathFitter(this,tolerance||2.5);this.setSegments(fitter.fit())}},split:function(index,parameter){if(parameter===null)return null;if(arguments.length===1){var arg=index;if(typeof arg==="number")arg=this.getLocationAt(arg);if(!arg)return null;index=arg.index;parameter=arg.parameter}var tMin=4e-7,tMax=1-tMin;if(parameter>=tMax){index++;parameter--}var curves=this.getCurves();if(index>=0&&index<curves.length){if(parameter>=tMin){curves[index++].divide(parameter,true)}var segs=this.removeSegments(index,this._segments.length,true),path;if(this._closed){this.setClosed(false);path=this}else{path=new Path(Item.NO_INSERT);path.insertAbove(this,true);this._clone(path)}path._add(segs,0);this.addSegment(segs[0]);return path}return null},reverse:function(){this._segments.reverse();for(var i=0,l=this._segments.length;i<l;i++){var segment=this._segments[i];var handleIn=segment._handleIn;segment._handleIn=segment._handleOut;segment._handleOut=handleIn;segment._index=i}this._curves=null;if(this._clockwise!==undefined)this._clockwise=!this._clockwise;this._changed(9)},join:function(path){if(path){var segments=path._segments,last1=this.getLastSegment(),last2=path.getLastSegment();if(!last2)return this;if(last1&&last1._point.equals(last2._point))path.reverse();var first2=path.getFirstSegment();if(last1&&last1._point.equals(first2._point)){last1.setHandleOut(first2._handleOut);this._add(segments.slice(1))}else{var first1=this.getFirstSegment();if(first1&&first1._point.equals(first2._point))path.reverse();last2=path.getLastSegment();if(first1&&first1._point.equals(last2._point)){first1.setHandleIn(last2._handleIn);this._add(segments.slice(0,segments.length-1),0)}else{this._add(segments.slice())}}if(path._closed)this._add([segments[0]]);path.remove()}var first=this.getFirstSegment(),last=this.getLastSegment();if(first!==last&&first._point.equals(last._point)){first.setHandleIn(last._handleIn);last.remove();this.setClosed(true)}return this},toShape:function(insert){if(!this._closed)return null;var segments=this._segments,type,size,radius,topCenter;function isCollinear(i,j){var seg1=segments[i],seg2=seg1.getNext(),seg3=segments[j],seg4=seg3.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg3._handleOut.isZero()&&seg4._handleIn.isZero()&&seg2._point.subtract(seg1._point).isCollinear(seg4._point.subtract(seg3._point))}function isOrthogonal(i){var seg2=segments[i],seg1=seg2.getPrevious(),seg3=seg2.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg2._handleOut.isZero()&&seg3._handleIn.isZero()&&seg2._point.subtract(seg1._point).isOrthogonal(seg3._point.subtract(seg2._point))}function isArc(i){var seg1=segments[i],seg2=seg1.getNext(),handle1=seg1._handleOut,handle2=seg2._handleIn,kappa=.5522847498307936;if(handle1.isOrthogonal(handle2)){var pt1=seg1._point,pt2=seg2._point,corner=new Line(pt1,handle1,true).intersect(new Line(pt2,handle2,true),true);return corner&&Numerical.isZero(handle1.getLength()/corner.subtract(pt1).getLength()-kappa)&&Numerical.isZero(handle2.getLength()/corner.subtract(pt2).getLength()-kappa)}return false}function getDistance(i,j){return segments[i]._point.getDistance(segments[j]._point)}if(!this.hasHandles()&&segments.length===4&&isCollinear(0,2)&&isCollinear(1,3)&&isOrthogonal(1)){type=Shape.Rectangle;size=new Size(getDistance(0,3),getDistance(0,1));topCenter=segments[1]._point.add(segments[2]._point).divide(2)}else if(segments.length===8&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isCollinear(1,5)&&isCollinear(3,7)){type=Shape.Rectangle;size=new Size(getDistance(1,6),getDistance(0,3));radius=size.subtract(new Size(getDistance(0,7),getDistance(1,2))).divide(2);topCenter=segments[3]._point.add(segments[4]._point).divide(2)}else if(segments.length===4&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)){if(Numerical.isZero(getDistance(0,2)-getDistance(1,3))){type=Shape.Circle;radius=getDistance(0,2)/2}else{type=Shape.Ellipse;radius=new Size(getDistance(2,0)/2,getDistance(3,1)/2)}topCenter=segments[1]._point}if(type){var center=this.getPosition(true),shape=this._clone(new type({center:center,size:size,radius:radius,insert:false}),insert,false);shape.rotate(topCenter.subtract(center).getAngle()+90);return shape}return null},_hitTestSelf:function(point,options){var that=this,style=this.getStyle(),segments=this._segments,numSegments=segments.length,closed=this._closed,tolerancePadding=options._tolerancePadding,strokePadding=tolerancePadding,join,cap,miterLimit,area,loc,res,hitStroke=options.stroke&&style.hasStroke(),hitFill=options.fill&&style.hasFill(),hitCurves=options.curves,radius=hitStroke?style.getStrokeWidth()/2:hitFill&&options.tolerance>0||hitCurves?0:null;if(radius!==null){if(radius>0){join=style.getStrokeJoin();cap=style.getStrokeCap();miterLimit=radius*style.getMiterLimit();strokePadding=tolerancePadding.add(new Point(radius,radius))}else{join=cap="round"}}function isCloseEnough(pt,padding){return point.subtract(pt).divide(padding).length<=1}function checkSegmentPoint(seg,pt,name){if(!options.selected||pt.isSelected()){var anchor=seg._point;if(pt!==anchor)pt=pt.add(anchor);if(isCloseEnough(pt,strokePadding)){return new HitResult(name,that,{segment:seg,point:pt})}}}function checkSegmentPoints(seg,ends){return(ends||options.segments)&&checkSegmentPoint(seg,seg._point,"segment")||!ends&&options.handles&&(checkSegmentPoint(seg,seg._handleIn,"handle-in")||checkSegmentPoint(seg,seg._handleOut,"handle-out"))}function addToArea(point){area.add(point)}function checkSegmentStroke(segment){if(join!=="round"||cap!=="round"){area=new Path({internal:true,closed:true});if(closed||segment._index>0&&segment._index<numSegments-1){if(join!=="round"&&(segment._handleIn.isZero()||segment._handleOut.isZero()))Path._addBevelJoin(segment,join,radius,miterLimit,addToArea,true)}else if(cap!=="round"){Path._addSquareCap(segment,cap,radius,addToArea,true)}if(!area.isEmpty()){var loc;return area.contains(point)||(loc=area.getNearestLocation(point))&&isCloseEnough(loc.getPoint(),tolerancePadding)}}return isCloseEnough(segment._point,strokePadding)}if(options.ends&&!options.segments&&!closed){if(res=checkSegmentPoints(segments[0],true)||checkSegmentPoints(segments[numSegments-1],true))return res}else if(options.segments||options.handles){for(var i=0;i<numSegments;i++)if(res=checkSegmentPoints(segments[i]))return res}if(radius!==null){loc=this.getNearestLocation(point);if(loc){var parameter=loc.getParameter();if(parameter===0||parameter===1&&numSegments>1){if(!checkSegmentStroke(loc.getSegment()))loc=null}else if(!isCloseEnough(loc.getPoint(),strokePadding)){loc=null}}if(!loc&&join==="miter"&&numSegments>1){for(var i=0;i<numSegments;i++){var segment=segments[i];if(point.getDistance(segment._point)<=miterLimit&&checkSegmentStroke(segment)){
loc=segment.getLocation();break}}}}return!loc&&hitFill&&this._contains(point)||loc&&!hitStroke&&!hitCurves?new HitResult("fill",this):loc?new HitResult(hitStroke?"stroke":"curve",this,{location:loc,point:loc.getPoint()}):null}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc[name]()}},{beans:false,getLocationOf:function(){var point=Point.read(arguments),curves=this.getCurves();for(var i=0,l=curves.length;i<l;i++){var loc=curves[i].getLocationOf(point);if(loc)return loc}return null},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getLocationAt:function(offset,isParameter){var curves=this.getCurves(),length=0;if(isParameter){var index=~~offset,curve=curves[index];return curve?curve.getLocationAt(offset-index,true):null}for(var i=0,l=curves.length;i<l;i++){var start=length,curve=curves[i];length+=curve.getLength();if(length>offset){return curve.getLocationAt(offset-start)}}if(curves.length>0&&offset<=this.getLength())return new CurveLocation(curves[curves.length-1],1);return null},getNearestLocation:function(){var point=Point.read(arguments),curves=this.getCurves(),minDist=Infinity,minLoc=null;for(var i=0,l=curves.length;i<l;i++){var loc=curves[i].getNearestLocation(point);if(loc._distance<minDist){minDist=loc._distance;minLoc=loc}}return minLoc},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function drawHandles(ctx,segments,matrix,size){var half=size/2;function drawHandle(index){var hX=coords[index],hY=coords[index+1];if(pX!=hX||pY!=hY){ctx.beginPath();ctx.moveTo(pX,pY);ctx.lineTo(hX,hY);ctx.stroke();ctx.beginPath();ctx.arc(hX,hY,half,0,Math.PI*2,true);ctx.fill()}}var coords=new Array(6);for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];segment._transformCoordinates(matrix,coords,false);var state=segment._selectionState,pX=coords[0],pY=coords[1];if(state&1)drawHandle(2);if(state&2)drawHandle(4);ctx.fillRect(pX-half,pY-half,size,size);if(!(state&4)){var fillStyle=ctx.fillStyle;ctx.fillStyle="#ffffff";ctx.fillRect(pX-half+1,pY-half+1,size-2,size-2);ctx.fillStyle=fillStyle}}}function drawSegments(ctx,path,matrix){var segments=path._segments,length=segments.length,coords=new Array(6),first=true,curX,curY,prevX,prevY,inX,inY,outX,outY;function drawSegment(segment){if(matrix){segment._transformCoordinates(matrix,coords,false);curX=coords[0];curY=coords[1]}else{var point=segment._point;curX=point._x;curY=point._y}if(first){ctx.moveTo(curX,curY);first=false}else{if(matrix){inX=coords[2];inY=coords[3]}else{var handle=segment._handleIn;inX=curX+handle._x;inY=curY+handle._y}if(inX===curX&&inY===curY&&outX===prevX&&outY===prevY){ctx.lineTo(curX,curY)}else{ctx.bezierCurveTo(outX,outY,inX,inY,curX,curY)}}prevX=curX;prevY=curY;if(matrix){outX=coords[4];outY=coords[5]}else{var handle=segment._handleOut;outX=prevX+handle._x;outY=prevY+handle._y}}for(var i=0;i<length;i++)drawSegment(segments[i]);if(path._closed&&length>0)drawSegment(segments[0])}return{_draw:function(ctx,param,strokeMatrix){var dontStart=param.dontStart,dontPaint=param.dontFinish||param.clip,style=this.getStyle(),hasFill=style.hasFill(),hasStroke=style.hasStroke(),dashArray=style.getDashArray(),dashLength=!paper.support.nativeDash&&hasStroke&&dashArray&&dashArray.length;if(!dontStart)ctx.beginPath();if(!dontStart&&this._currentPath){ctx.currentPath=this._currentPath}else if(hasFill||hasStroke&&!dashLength||dontPaint){drawSegments(ctx,this,strokeMatrix);if(this._closed)ctx.closePath();if(!dontStart)this._currentPath=ctx.currentPath}function getOffset(i){return dashArray[(i%dashLength+dashLength)%dashLength]}if(!dontPaint&&(hasFill||hasStroke)){this._setStyles(ctx);if(hasFill){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(hasStroke){if(dashLength){if(!dontStart)ctx.beginPath();var iterator=new PathIterator(this,32,.25,strokeMatrix),length=iterator.length,from=-style.getDashOffset(),to,i=0;from=from%length;while(from>0){from-=getOffset(i--)+getOffset(i--)}while(from<length){to=from+getOffset(i++);if(from>0||to>0)iterator.drawPart(ctx,Math.max(from,0),Math.max(to,0));from=to+getOffset(i++)}}ctx.stroke()}}},_drawSelected:function(ctx,matrix){ctx.beginPath();drawSegments(ctx,this,matrix);ctx.stroke();drawHandles(ctx,this._segments,matrix,paper.settings.handleSize)}}},new function(){function getFirstControlPoints(rhs){var n=rhs.length,x=[],tmp=[],b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++){tmp[i]=1/b;b=(i<n-1?4:2)-tmp[i];x[i]=(rhs[i]-x[i-1])/b}for(var i=1;i<n;i++){x[n-i-1]-=tmp[n-i]*x[n-i]}return x}return{smooth:function(){var segments=this._segments,size=segments.length,closed=this._closed,n=size,overlap=0;if(size<=2)return;if(closed){overlap=Math.min(size,4);n+=Math.min(size,overlap)*2}var knots=[];for(var i=0;i<size;i++)knots[i+overlap]=segments[i]._point;if(closed){for(var i=0;i<overlap;i++){knots[i]=segments[i+size-overlap]._point;knots[i+size+overlap]=segments[i]._point}}else{n--}var rhs=[];for(var i=1;i<n-1;i++)rhs[i]=4*knots[i]._x+2*knots[i+1]._x;rhs[0]=knots[0]._x+2*knots[1]._x;rhs[n-1]=3*knots[n-1]._x;var x=getFirstControlPoints(rhs);for(var i=1;i<n-1;i++)rhs[i]=4*knots[i]._y+2*knots[i+1]._y;rhs[0]=knots[0]._y+2*knots[1]._y;rhs[n-1]=3*knots[n-1]._y;var y=getFirstControlPoints(rhs);if(closed){for(var i=0,j=size;i<overlap;i++,j++){var f1=i/overlap,f2=1-f1,ie=i+overlap,je=j+overlap;x[j]=x[i]*f1+x[j]*f2;y[j]=y[i]*f1+y[j]*f2;x[je]=x[ie]*f2+x[je]*f1;y[je]=y[ie]*f2+y[je]*f1}n--}var handleIn=null;for(var i=overlap;i<=n-overlap;i++){var segment=segments[i-overlap];if(handleIn)segment.setHandleIn(handleIn.subtract(segment._point));if(i<n){segment.setHandleOut(new Point(x[i],y[i]).subtract(segment._point));handleIn=i<n-1?new Point(2*knots[i+1]._x-x[i+1],2*knots[i+1]._y-y[i+1]):new Point((knots[n]._x+x[n-1])/2,(knots[n]._y+y[n-1])/2)}}if(closed&&handleIn){var segment=this._segments[0];segment.setHandleIn(handleIn.subtract(segment._point))}}}},new function(){function getCurrentSegment(that){var segments=that._segments;if(segments.length===0)throw new Error("Use a moveTo() command first");return segments[segments.length-1]}return{moveTo:function(){var segments=this._segments;if(segments.length===1)this.removeSegment(0);if(!segments.length)this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this);current.setHandleOut(handle1.subtract(current._point));this._add([new Segment(to,handle2.subtract(to))])},quadraticCurveTo:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(handle.add(current.subtract(handle).multiply(1/3)),handle.add(to.subtract(handle).multiply(1/3)),to)},curveTo:function(){var through=Point.read(arguments),to=Point.read(arguments),t=Base.pick(Base.read(arguments),.5),t1=1-t,current=getCurrentSegment(this)._point,handle=through.subtract(current.multiply(t1*t1)).subtract(to.multiply(t*t)).divide(2*t*t1);if(handle.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(handle,to)},arcTo:function(){var current=getCurrentSegment(this),from=current._point,to=Point.read(arguments),through,peek=Base.peek(arguments),clockwise=Base.pick(peek,true),center,extent,vector,matrix;if(typeof clockwise==="boolean"){var middle=from.add(to).divide(2),through=middle.add(middle.subtract(from).rotate(clockwise?-90:90))}else if(Base.remain(arguments)<=2){through=to;to=Point.read(arguments)}else{var radius=Size.read(arguments);if(radius.isZero())return this.lineTo(to);var rotation=Base.read(arguments),clockwise=!!Base.read(arguments),large=!!Base.read(arguments),middle=from.add(to).divide(2),pt=from.subtract(middle).rotate(-rotation),x=pt.x,y=pt.y,abs=Math.abs,rx=abs(radius.width),ry=abs(radius.height),rxSq=rx*rx,rySq=ry*ry,xSq=x*x,ySq=y*y;var factor=Math.sqrt(xSq/rxSq+ySq/rySq);if(factor>1){rx*=factor;ry*=factor;rxSq=rx*rx;rySq=ry*ry}factor=(rxSq*rySq-rxSq*ySq-rySq*xSq)/(rxSq*ySq+rySq*xSq);if(abs(factor)<1e-12)factor=0;if(factor<0)throw new Error("Cannot create an arc with the given arguments");center=new Point(rx*y/ry,-ry*x/rx).multiply((large===clockwise?-1:1)*Math.sqrt(factor)).rotate(rotation).add(middle);matrix=(new Matrix).translate(center).rotate(rotation).scale(rx,ry);vector=matrix._inverseTransform(from);extent=vector.getDirectedAngle(matrix._inverseTransform(to));if(!clockwise&&extent>0)extent-=360;else if(clockwise&&extent<0)extent+=360}if(through){var l1=new Line(from.add(through).divide(2),through.subtract(from).rotate(90),true),l2=new Line(through.add(to).divide(2),to.subtract(through).rotate(90),true),line=new Line(from,to),throughSide=line.getSide(through);center=l1.intersect(l2,true);if(!center){if(!throughSide)return this.lineTo(to);throw new Error("Cannot create an arc with the given arguments")}vector=from.subtract(center);extent=vector.getDirectedAngle(to.subtract(center));var centerSide=line.getSide(center);if(centerSide===0){extent=throughSide*Math.abs(extent)}else if(throughSide===centerSide){extent+=extent<0?360:-360}}var ext=Math.abs(extent),count=ext>=360?4:Math.ceil(ext/90),inc=extent/count,half=inc*Math.PI/360,z=4/3*Math.sin(half)/(1+Math.cos(half)),segments=[];for(var i=0;i<=count;i++){var pt=to,out=null;if(i<count){out=vector.rotate(90).multiply(z);if(matrix){pt=matrix._transformPoint(vector);out=matrix._transformPoint(vector.add(out)).subtract(pt)}else{pt=center.add(vector)}}if(i===0){current.setHandleOut(out)}else{var _in=vector.rotate(-90).multiply(z);if(matrix){_in=matrix._transformPoint(vector.add(_in)).subtract(pt)}segments.push(new Segment(pt,_in,out))}vector=vector.rotate(inc)}this._add(segments)},lineBy:function(){var to=Point.read(arguments),current=getCurrentSegment(this)._point;this.lineTo(current.add(to))},curveBy:function(){var through=Point.read(arguments),to=Point.read(arguments),parameter=Base.read(arguments),current=getCurrentSegment(this)._point;this.curveTo(current.add(through),current.add(to),parameter)},cubicCurveBy:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(current.add(handle1),current.add(handle2),current.add(to))},quadraticCurveBy:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.quadraticCurveTo(current.add(handle),current.add(to))},arcBy:function(){var current=getCurrentSegment(this)._point,point=current.add(Point.read(arguments)),clockwise=Base.pick(Base.peek(arguments),true);if(typeof clockwise==="boolean"){this.arcTo(point,clockwise)}else{this.arcTo(point,current.add(Point.read(arguments)))}},closePath:function(join){this.setClosed(true);if(join)this.join()}}},{_getBounds:function(getter,matrix){return Path[getter](this._segments,this._closed,this.getStyle(),matrix)},statics:{getBounds:function(segments,closed,style,matrix,strokePadding){var first=segments[0];if(!first)return new Rectangle;var coords=new Array(6),prevCoords=first._transformCoordinates(matrix,new Array(6),false),min=prevCoords.slice(0,2),max=min.slice(),roots=new Array(2);function processSegment(segment){segment._transformCoordinates(matrix,coords,false);for(var i=0;i<2;i++){Curve._addBounds(prevCoords[i],prevCoords[i+4],coords[i+2],coords[i],i,strokePadding?strokePadding[i]:0,min,max,roots)}var tmp=prevCoords;prevCoords=coords;coords=tmp}for(var i=1,l=segments.length;i<l;i++)processSegment(segments[i]);if(closed)processSegment(first);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},getStrokeBounds:function(segments,closed,style,matrix){if(!style.hasStroke())return Path.getBounds(segments,closed,style,matrix);var length=segments.length-(closed?0:1),radius=style.getStrokeWidth()/2,padding=Path._getPenPadding(radius,matrix),bounds=Path.getBounds(segments,closed,style,matrix,padding),join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit();var joinBounds=new Rectangle(new Size(padding).multiply(2));function add(point){bounds=bounds.include(matrix?matrix._transformPoint(point,point):point)}function addRound(segment){bounds=bounds.unite(joinBounds.setCenter(matrix?matrix._transformPoint(segment._point):segment._point))}function addJoin(segment,join){var handleIn=segment._handleIn,handleOut=segment._handleOut;if(join==="round"||!handleIn.isZero()&&!handleOut.isZero()&&handleIn.isCollinear(handleOut)){addRound(segment)}else{Path._addBevelJoin(segment,join,radius,miterLimit,add)}}function addCap(segment,cap){if(cap==="round"){addRound(segment)}else{Path._addSquareCap(segment,cap,radius,add)}}for(var i=1;i<length;i++)addJoin(segments[i],join);if(closed){addJoin(segments[0],join)}else if(length>0){addCap(segments[0],cap);addCap(segments[segments.length-1],cap)}return bounds},_getPenPadding:function(radius,matrix){if(!matrix)return[radius,radius];var mx=matrix.shiftless(),hor=mx.transform(new Point(radius,0)),ver=mx.transform(new Point(0,radius)),phi=hor.getAngleInRadians(),a=hor.getLength(),b=ver.getLength();var sin=Math.sin(phi),cos=Math.cos(phi),tan=Math.tan(phi),tx=-Math.atan(b*tan/a),ty=Math.atan(b/(tan*a));return[Math.abs(a*Math.cos(tx)*cos-b*Math.sin(tx)*sin),Math.abs(b*Math.sin(ty)*cos+a*Math.cos(ty)*sin)]},_addBevelJoin:function(segment,join,radius,miterLimit,addPoint,area){var curve2=segment.getCurve(),curve1=curve2.getPrevious(),point=curve2.getPointAt(0,true),normal1=curve1.getNormalAt(1,true),normal2=curve2.getNormalAt(0,true),step=normal1.getDirectedAngle(normal2)<0?-radius:radius;normal1.setLength(step);normal2.setLength(step);if(area){addPoint(point);addPoint(point.add(normal1))}if(join==="miter"){var corner=new Line(point.add(normal1),new Point(-normal1.y,normal1.x),true).intersect(new Line(point.add(normal2),new Point(-normal2.y,normal2.x),true),true);if(corner&&point.getDistance(corner)<=miterLimit){addPoint(corner);if(!area)return}}if(!area)addPoint(point.add(normal1));addPoint(point.add(normal2))},_addSquareCap:function(segment,cap,radius,addPoint,area){var point=segment._point,loc=segment.getLocation(),normal=loc.getNormal().multiply(radius);if(area){addPoint(point.subtract(normal));addPoint(point.add(normal))}if(cap==="square")point=point.add(normal.rotate(loc.getParameter()===0?-90:90));addPoint(point.add(normal));addPoint(point.subtract(normal))},getHandleBounds:function(segments,closed,style,matrix,strokePadding,joinPadding){var coords=new Array(6),x1=Infinity,x2=-x1,y1=x1,y2=x2;for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];segment._transformCoordinates(matrix,coords,false);for(var j=0;j<6;j+=2){var padding=j===0?joinPadding:strokePadding,paddingX=padding?padding[0]:0,paddingY=padding?padding[1]:0,x=coords[j],y=coords[j+1],xn=x-paddingX,xx=x+paddingX,yn=y-paddingY,yx=y+paddingY;if(xn<x1)x1=xn;if(xx>x2)x2=xx;if(yn<y1)y1=yn;if(yx>y2)y2=yx}}return new Rectangle(x1,y1,x2-x1,y2-y1)},getRoughBounds:function(segments,closed,style,matrix){var strokeRadius=style.hasStroke()?style.getStrokeWidth()/2:0,joinRadius=strokeRadius;if(strokeRadius>0){if(style.getStrokeJoin()==="miter")joinRadius=strokeRadius*style.getMiterLimit();if(style.getStrokeCap()==="square")joinRadius=Math.max(joinRadius,strokeRadius*Math.sqrt(2))}return Path.getHandleBounds(segments,closed,style,matrix,Path._getPenPadding(strokeRadius,matrix),Path._getPenPadding(joinRadius,matrix))}}});Path.inject({statics:new function(){var kappa=.5522847498307936,ellipseSegments=[new Segment([-1,0],[0,kappa],[0,-kappa]),new Segment([0,-1],[-kappa,0],[kappa,0]),new Segment([1,0],[0,-kappa],[0,kappa]),new Segment([0,1],[kappa,0],[-kappa,0])];function createPath(segments,closed,args){var props=Base.getNamed(args),path=new Path(props&&props.insert===false&&Item.NO_INSERT);path._add(segments);path._closed=closed;return path.set(props)}function createEllipse(center,radius,args){var segments=new Array(4);for(var i=0;i<4;i++){var segment=ellipseSegments[i];segments[i]=new Segment(segment._point.multiply(radius).add(center),segment._handleIn.multiply(radius),segment._handleOut.multiply(radius))}return createPath(segments,true,args)}return{Line:function(){return createPath([new Segment(Point.readNamed(arguments,"from")),new Segment(Point.readNamed(arguments,"to"))],false,arguments)},Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createEllipse(center,new Size(radius),arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.readNamed(arguments,"radius",0,{readNull:true}),bl=rect.getBottomLeft(true),tl=rect.getTopLeft(true),tr=rect.getTopRight(true),br=rect.getBottomRight(true),segments;if(!radius||radius.isZero()){segments=[new Segment(bl),new Segment(tl),new Segment(tr),new Segment(br)]}else{radius=Size.min(radius,rect.getSize(true).divide(2));var rx=radius.width,ry=radius.height,hx=rx*kappa,hy=ry*kappa;segments=[new Segment(bl.add(rx,0),null,[-hx,0]),new Segment(bl.subtract(0,ry),[0,hy]),new Segment(tl.add(0,ry),null,[0,-hy]),new Segment(tl.add(rx,0),[-hx,0],null),new Segment(tr.subtract(rx,0),null,[hx,0]),new Segment(tr.add(0,ry),[0,-hy],null),new Segment(br.subtract(0,ry),null,[0,hy]),new Segment(br.subtract(rx,0),[hx,0])]}return createPath(segments,true,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var ellipse=Shape._readEllipse(arguments);return createEllipse(ellipse.center,ellipse.radius,arguments)},Oval:"#Ellipse",Arc:function(){var from=Point.readNamed(arguments,"from"),through=Point.readNamed(arguments,"through"),to=Point.readNamed(arguments,"to"),props=Base.getNamed(arguments),path=new Path(props&&props.insert===false&&Item.NO_INSERT);path.moveTo(from);path.arcTo(through,to);return path.set(props)},RegularPolygon:function(){var center=Point.readNamed(arguments,"center"),sides=Base.readNamed(arguments,"sides"),radius=Base.readNamed(arguments,"radius"),step=360/sides,three=!(sides%3),vector=new Point(0,three?-radius:radius),offset=three?-1:.5,segments=new Array(sides);for(var i=0;i<sides;i++)segments[i]=new Segment(center.add(vector.rotate((i+offset)*step)));return createPath(segments,true,arguments)},Star:function(){var center=Point.readNamed(arguments,"center"),points=Base.readNamed(arguments,"points")*2,radius1=Base.readNamed(arguments,"radius1"),radius2=Base.readNamed(arguments,"radius2"),step=360/points,vector=new Point(0,-1),segments=new Array(points);for(var i=0;i<points;i++)segments[i]=new Segment(center.add(vector.rotate(step*i).multiply(i%2?radius2:radius1)));return createPath(segments,true,arguments)}}}});var CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function CompoundPath(arg){this._children=[];this._namedChildren={};if(!this._initialize(arg)){if(typeof arg==="string"){this.setPathData(arg)}else{this.addChildren(Array.isArray(arg)?arg:arguments)}}},insertChildren:function insertChildren(index,items,_preserve){for(var i=items.length-1;i>=0;i--){var item=items[i];if(item instanceof CompoundPath){items.splice.apply(items,[i,1].concat(item.removeChildren()));item.remove()}}items=insertChildren.base.call(this,index,items,_preserve,Path);for(var i=0,l=!_preserve&&items&&items.length;i<l;i++){var item=items[i];if(item._clockwise===undefined)item.setClockwise(item._index===0)}return items},reverse:function(){var children=this._children;for(var i=0,l=children.length;i<l;i++)children[i].reverse()},smooth:function(){for(var i=0,l=this._children.length;i<l;i++)this._children[i].smooth()},reduce:function reduce(){var children=this._children;for(var i=children.length-1;i>=0;i--){var path=children[i].reduce();if(path.isEmpty())children.splice(i,1)}if(children.length===0){var path=new Path(Item.NO_INSERT);path.insertAbove(this);path.setStyle(this._style);this.remove();return path}return reduce.base.call(this)},isClockwise:function(){var child=this.getFirstChild();return child&&child.isClockwise()},setClockwise:function(clockwise){if(this.isClockwise()!==!!clockwise)this.reverse()},getFirstSegment:function(){var first=this.getFirstChild();return first&&first.getFirstSegment()},getLastSegment:function(){var last=this.getLastChild();return last&&last.getLastSegment()},getCurves:function(){var children=this._children,curves=[];for(var i=0,l=children.length;i<l;i++)curves.push.apply(curves,children[i].getCurves());return curves},getFirstCurve:function(){var first=this.getFirstChild();return first&&first.getFirstCurve()},getLastCurve:function(){var last=this.getLastChild();return last&&last.getFirstCurve()},getArea:function(){var children=this._children,area=0;for(var i=0,l=children.length;i<l;i++)area+=children[i].getArea();return area}},{beans:true,getPathData:function(_matrix,_precision){var children=this._children,paths=[];for(var i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;paths.push(child.getPathData(_matrix&&!mx.isIdentity()?_matrix.chain(mx):_matrix,_precision))}return paths.join(" ")}},{_getChildHitTestOptions:function(options){return options.class===Path||options.type==="path"?options:new Base(options,{fill:false})},_draw:function(ctx,param,strokeMatrix){var children=this._children;if(children.length===0)return;if(this._currentPath){ctx.currentPath=this._currentPath}else{param=param.extend({dontStart:true,dontFinish:true});ctx.beginPath();for(var i=0,l=children.length;i<l;i++)children[i].draw(ctx,param,strokeMatrix);this._currentPath=ctx.currentPath}if(!param.clip){this._setStyles(ctx);var style=this._style;if(style.hasFill()){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(style.hasStroke())ctx.stroke()}},_drawSelected:function(ctx,matrix,selectedItems){var children=this._children;for(var i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;if(!selectedItems[child._id])child._drawSelected(ctx,mx.isIdentity()?matrix:matrix.chain(mx))}}},new function(){function getCurrentPath(that,check){var children=that._children;if(check&&children.length===0)throw new Error("Use a moveTo() command first");return children[children.length-1]}var fields={moveTo:function(){var current=getCurrentPath(this),path=current&&current.isEmpty()?current:new Path(Item.NO_INSERT);if(path!==current)this.addChild(path);path.moveTo.apply(path,arguments)},moveBy:function(){var current=getCurrentPath(this,true),last=current&&current.getLastSegment(),point=Point.read(arguments);this.moveTo(last?point.add(last._point):point)},closePath:function(join){getCurrentPath(this,true).closePath(join)}};Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(key){fields[key]=function(){var path=getCurrentPath(this,true);path[key].apply(path,arguments)}});return fields});PathItem.inject(new function(){var operators={unite:function(w){return w===1||w===0},intersect:function(w){return w===2},subtract:function(w){return w===1},exclude:function(w){return w===1}};function preparePath(path,resolve){var res=path.clone(false).reduce().transform(null,true,true);return resolve?res.resolveCrossings().reorient():res}function finishBoolean(ctor,paths,path1,path2,reduce){var result=new ctor(Item.NO_INSERT);result.addChildren(paths,true);if(reduce)result=result.reduce();result.insertAbove(path2&&path1.isSibling(path2)&&path1.getIndex()<path2.getIndex()?path2:path1);result.setStyle(path1._style);return result}function computeBoolean(path1,path2,operation){if(!path1._children&&!path1._closed)return computeOpenBoolean(path1,path2,operation);var _path1=preparePath(path1,true),_path2=path2&&path1!==path2&&preparePath(path2,true);if(_path2&&/^(subtract|exclude)$/.test(operation)^_path2.isClockwise()!==_path1.isClockwise())_path2.reverse();var intersections=CurveLocation.expand(_path1.getIntersections(_path2,function(inter){return _path2&&inter.isOverlap()||inter.isCrossing()}));divideLocations(intersections);var segments=[],monoCurves=[];function collect(paths){for(var i=0,l=paths.length;i<l;i++){var path=paths[i];segments.push.apply(segments,path._segments);monoCurves.push.apply(monoCurves,path._getMonoCurves())}}collect(_path1._children||[_path1]);if(_path2)collect(_path2._children||[_path2]);for(var i=0,l=intersections.length;i<l;i++){propagateWinding(intersections[i]._segment,_path1,_path2,monoCurves,operation)}for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];if(segment._winding==null){propagateWinding(segment,_path1,_path2,monoCurves,operation)}}return finishBoolean(CompoundPath,tracePaths(segments,operation),path1,path2,true)}function computeOpenBoolean(path1,path2,operation){if(!path2||!path2._children&&!path2._closed||!/^(subtract|intersect)$/.test(operation))return null;var _path1=preparePath(path1,false),_path2=preparePath(path2,false),intersections=_path1.getIntersections(_path2,function(inter){return inter.isOverlap()||inter.isCrossing()}),sub=operation==="subtract",paths=[];function addPath(path){if(_path2.contains(path.getPointAt(path.getLength()/2))^sub){paths.unshift(path);return true}}for(var i=intersections.length-1;i>=0;i--){var path=intersections[i].split();if(path){if(addPath(path))path.getFirstSegment().setHandleIn(0,0);_path1.getLastSegment().setHandleOut(0,0)}}addPath(_path1);return finishBoolean(Group,paths,path1,path2)}function linkIntersections(from,to){var prev=from;while(prev){if(prev===to)return;prev=prev._prev}while(from._next&&from._next!==to)from=from._next;if(!from._next){while(to._prev)to=to._prev;from._next=to;to._prev=from}}function divideLocations(locations){var tMin=4e-7,tMax=1-tMin,noHandles=false,clearSegments=[],prevCurve,prevT;for(var i=locations.length-1;i>=0;i--){var loc=locations[i],curve=loc._curve,t=loc._parameter,origT=t;if(curve!==prevCurve){noHandles=!curve.hasHandles()}else if(prevT>0){t/=prevT}var segment;if(t<tMin){segment=curve._segment1}else if(t>tMax){segment=curve._segment2}else{segment=curve.divide(t,true,true)._segment1;if(noHandles)clearSegments.push(segment)}loc._setSegment(segment);var inter=segment._intersection,dest=loc._intersection;if(inter){linkIntersections(inter,dest);var other=inter;while(other){linkIntersections(other._intersection,inter);other=other._next}}else{segment._intersection=dest}prevCurve=curve;prevT=origT}for(var i=0,l=clearSegments.length;i<l;i++){clearSegments[i].clearHandles()}}function getWinding(point,curves,horizontal,testContains){var epsilon=2e-7,tMin=4e-7,tMax=1-tMin,px=point.x,py=point.y,windLeft=0,windRight=0,roots=[],abs=Math.abs;if(horizontal){var yTop=-Infinity,yBottom=Infinity,yBefore=py-epsilon,yAfter=py+epsilon;for(var i=0,l=curves.length;i<l;i++){var values=curves[i].values;if(Curve.solveCubic(values,0,px,roots,0,1)>0){for(var j=roots.length-1;j>=0;j--){var y=Curve.getPoint(values,roots[j]).y;if(y<yBefore&&y>yTop){yTop=y}else if(y>yAfter&&y<yBottom){yBottom=y}}}}yTop=(yTop+py)/2;yBottom=(yBottom+py)/2;if(yTop>-Infinity)windLeft=getWinding(new Point(px,yTop),curves,false,testContains);if(yBottom<Infinity)windRight=getWinding(new Point(px,yBottom),curves,false,testContains)}else{var xBefore=px-epsilon,xAfter=px+epsilon;var startCounted=false,prevCurve,prevT;for(var i=0,l=curves.length;i<l;i++){var curve=curves[i],values=curve.values,winding=curve.winding;if(winding&&(winding===1&&py>=values[1]&&py<=values[7]||py>=values[7]&&py<=values[1])&&Curve.solveCubic(values,1,py,roots,0,1)===1){var t=roots[0];if(!(t>tMax&&startCounted&&curve.next!==curves[i+1]||t<tMin&&prevT>tMax&&curve.previous===prevCurve)){var x=Curve.getPoint(values,t).x,slope=Curve.getTangent(values,t).y,counted=false;if(Numerical.isZero(slope)&&!Curve.isStraight(values)||t<tMin&&slope*Curve.getTangent(curve.previous.values,1).y<0||t>tMax&&slope*Curve.getTangent(curve.next.values,0).y<0){if(testContains&&x>=xBefore&&x<=xAfter){++windLeft;++windRight;counted=true}}else if(x<=xBefore){windLeft+=winding;counted=true}else if(x>=xAfter){windRight+=winding;counted=true}if(curve.previous!==curves[i-1])startCounted=t<tMin&&counted}prevCurve=curve;prevT=t}}}return Math.max(abs(windLeft),abs(windRight))}function propagateWinding(segment,path1,path2,monoCurves,operation){var epsilon=2e-7,chain=[],start=segment,totalLength=0,windingSum=0;do{var curve=segment.getCurve(),length=curve.getLength();chain.push({segment:segment,curve:curve,length:length});totalLength+=length;segment=segment.getNext()}while(segment&&!segment._intersection&&segment!==start);for(var i=0;i<3;i++){var length=totalLength*(i+1)/4;for(var k=0,m=chain.length;k<m;k++){var node=chain[k],curveLength=node.length;if(length<=curveLength){if(length<epsilon||curveLength-length<epsilon)length=curveLength/2;var curve=node.curve,path=curve._path,parent=path._parent,pt=curve.getPointAt(length),hor=curve.isHorizontal();if(parent instanceof CompoundPath)path=parent;windingSum+=operation==="subtract"&&path2&&(path===path1&&path2._getWinding(pt,hor)||path===path2&&!path1._getWinding(pt,hor))?0:getWinding(pt,monoCurves,hor);break}length-=curveLength}}var winding=Math.round(windingSum/3);for(var j=chain.length-1;j>=0;j--)chain[j].segment._winding=winding}function tracePaths(segments,operation){var paths=[],start,otherStart,operator=operators[operation],overlapWinding={unite:{1:2},intersect:{2:1}}[operation];function isValid(seg,adjusted){if(seg._visited)return false;if(!operator)return true;var winding=seg._winding,inter=seg._intersection;if(inter&&adjusted&&overlapWinding&&inter.isOverlap())winding=overlapWinding[winding]||winding;return operator(winding)}function isStart(seg){return seg===start||seg===otherStart}function findBestIntersection(inter,strict){if(!inter._next)return inter;while(inter){var seg=inter._segment,nextSeg=seg.getNext(),nextInter=nextSeg._intersection;if(isStart(nextSeg)||!seg._visited&&!nextSeg._visited&&(!operator||(!strict||isValid(seg))&&(!(strict&&nextInter&&nextInter.isOverlap())&&isValid(nextSeg)||!strict&&nextInter&&isValid(nextInter._segment))))return inter;inter=inter._next}return null}function findStartSegment(inter,next){while(inter){var seg=inter._segment;if(isStart(seg))return seg;inter=inter[next?"_next":"_prev"]}}for(var i=0,l=segments.length;i<l;i++){var seg=segments[i],path=null,finished=false;if(!isValid(seg,true))continue;start=otherStart=null;while(!finished){var inter=seg._intersection,handleIn=path&&seg._handleIn;inter=inter&&(findBestIntersection(inter,true)||findBestIntersection(inter,false))||inter;var other=inter&&inter._segment;if(other&&isValid(other))seg=other;if(seg._visited){finished=isStart(seg);if(!finished&&inter){var found=findStartSegment(inter,true)||findStartSegment(inter,false);if(found){seg=found;finished=true}}break}if(!path){path=new Path(Item.NO_INSERT);start=seg;otherStart=other}path.add(new Segment(seg._point,handleIn,seg._handleOut));seg._visited=true;seg=seg.getNext();finished=isStart(seg)}if(finished){path.firstSegment.setHandleIn(seg._handleIn);path.setClosed(true)}else if(path){console.error("Boolean operation resulted in open path","segments =",path._segments.length,"length =",path.getLength());path=null}if(path&&(path._segments.length>8||!Numerical.isZero(path.getArea()))){paths.push(path);path=null}}return paths}return{_getWinding:function(point,horizontal,testContains){return getWinding(point,this._getMonoCurves(),horizontal,testContains)},unite:function(path){return computeBoolean(this,path,"unite")},intersect:function(path){return computeBoolean(this,path,"intersect")},subtract:function(path){return computeBoolean(this,path,"subtract")},exclude:function(path){return computeBoolean(this,path,"exclude")},divide:function(path){return finishBoolean(Group,[this.subtract(path),this.intersect(path)],this,path,true)},resolveCrossings:function(){var crossings=this.getCrossings();

if(!crossings.length)return this;divideLocations(CurveLocation.expand(crossings));var paths=this._children||[this],segments=[];for(var i=0,l=paths.length;i<l;i++){segments.push.apply(segments,paths[i]._segments)}return finishBoolean(CompoundPath,tracePaths(segments),this,null,false)}}});Path.inject({_getMonoCurves:function(){var monoCurves=this._monoCurves,prevCurve;function insertCurve(v){var y0=v[1],y1=v[7],curve={values:v,winding:y0===y1?0:y0>y1?-1:1,previous:prevCurve,next:null};if(prevCurve)prevCurve.next=curve;monoCurves.push(curve);prevCurve=curve}function handleCurve(v){if(Curve.getLength(v)===0)return;var y0=v[1],y1=v[3],y2=v[5],y3=v[7];if(Curve.isStraight(v)){insertCurve(v)}else{var a=3*(y1-y2)-y0+y3,b=2*(y0+y2)-4*y1,c=y1-y0,tMin=4e-7,tMax=1-tMin,roots=[],n=Numerical.solveQuadratic(a,b,c,roots,tMin,tMax);if(n===0){insertCurve(v)}else{roots.sort();var t=roots[0],parts=Curve.subdivide(v,t);insertCurve(parts[0]);if(n>1){t=(roots[1]-t)/(1-t);parts=Curve.subdivide(parts[1],t);insertCurve(parts[0])}insertCurve(parts[1])}}}if(!monoCurves){monoCurves=this._monoCurves=[];var curves=this.getCurves(),segments=this._segments;for(var i=0,l=curves.length;i<l;i++)handleCurve(curves[i].getValues());if(!this._closed&&segments.length>1){var p1=segments[segments.length-1]._point,p2=segments[0]._point,p1x=p1._x,p1y=p1._y,p2x=p2._x,p2y=p2._y;handleCurve([p1x,p1y,p1x,p1y,p2x,p2y,p2x,p2y])}if(monoCurves.length>0){var first=monoCurves[0],last=monoCurves[monoCurves.length-1];first.previous=last;last.next=first}}return monoCurves},getInteriorPoint:function(){var bounds=this.getBounds(),point=bounds.getCenter(true);if(!this.contains(point)){var curves=this._getMonoCurves(),roots=[],y=point.y,xIntercepts=[];for(var i=0,l=curves.length;i<l;i++){var values=curves[i].values;if((curves[i].winding===1&&y>=values[1]&&y<=values[7]||y>=values[7]&&y<=values[1])&&Curve.solveCubic(values,1,y,roots,0,1)>0){for(var j=roots.length-1;j>=0;j--)xIntercepts.push(Curve.getPoint(values,roots[j]).x)}if(xIntercepts.length>1)break}point.x=(xIntercepts[0]+xIntercepts[1])/2}return point},reorient:function(){this.setClockwise(true);return this}});CompoundPath.inject({_getMonoCurves:function(){var children=this._children,monoCurves=[];for(var i=0,l=children.length;i<l;i++)monoCurves.push.apply(monoCurves,children[i]._getMonoCurves());return monoCurves},reorient:function(){var children=this.removeChildren().sort(function(a,b){return b.getBounds().getArea()-a.getBounds().getArea()});if(children.length>0){this.addChildren(children);var clockwise=children[0].isClockwise();for(var i=1,l=children.length;i<l;i++){var point=children[i].getInteriorPoint(),counters=0;for(var j=i-1;j>=0;j--){if(children[j].contains(point))counters++}children[i].setClockwise(counters%2===0&&clockwise)}}return this}});var PathIterator=Base.extend({_class:"PathIterator",initialize:function(path,maxRecursion,tolerance,matrix){var curves=[],parts=[],length=0,minDifference=1/(maxRecursion||32),segments=path._segments,segment1=segments[0],segment2;function addCurve(segment1,segment2){var curve=Curve.getValues(segment1,segment2,matrix);curves.push(curve);computeParts(curve,segment1._index,0,1)}function computeParts(curve,index,minT,maxT){if(maxT-minT>minDifference&&!Curve.isFlatEnough(curve,tolerance||.25)){var split=Curve.subdivide(curve,.5),halfT=(minT+maxT)/2;computeParts(split[0],index,minT,halfT);computeParts(split[1],index,halfT,maxT)}else{var x=curve[6]-curve[0],y=curve[7]-curve[1],dist=Math.sqrt(x*x+y*y);if(dist>1e-6){length+=dist;parts.push({offset:length,value:maxT,index:index})}}}for(var i=1,l=segments.length;i<l;i++){segment2=segments[i];addCurve(segment1,segment2);segment1=segment2}if(path._closed)addCurve(segment2,segments[0]);this.curves=curves;this.parts=parts;this.length=length;this.index=0},getParameterAt:function(offset){var i,j=this.index;for(;;){i=j;if(j==0||this.parts[--j].offset<offset)break}for(var l=this.parts.length;i<l;i++){var part=this.parts[i];if(part.offset>=offset){this.index=i;var prev=this.parts[i-1];var prevVal=prev&&prev.index==part.index?prev.value:0,prevLen=prev?prev.offset:0;return{value:prevVal+(part.value-prevVal)*(offset-prevLen)/(part.offset-prevLen),index:part.index}}}var part=this.parts[this.parts.length-1];return{value:1,index:part.index}},drawPart:function(ctx,from,to){from=this.getParameterAt(from);to=this.getParameterAt(to);for(var i=from.index;i<=to.index;i++){var curve=Curve.getPart(this.curves[i],i==from.index?from.value:0,i==to.index?to.value:1);if(i==from.index)ctx.moveTo(curve[0],curve[1]);ctx.bezierCurveTo.apply(ctx,curve.slice(2))}}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,weighted){var param=this.getParameterAt(offset);return Curve[name](this.curves[param.index],param.value,weighted)}},{}));var PathFitter=Base.extend({initialize:function(path,error){var points=this.points=[],segments=path._segments,prev;for(var i=0,l=segments.length;i<l;i++){var point=segments[i].point.clone();if(!prev||!prev.equals(point)){points.push(point);prev=point}}if(path._closed){this.closed=true;points.unshift(points[points.length-1]);points.push(points[1])}this.error=error},fit:function(){var points=this.points,length=points.length,segments=this.segments=length>0?[new Segment(points[0])]:[];if(length>1)this.fitCubic(0,length-1,points[1].subtract(points[0]).normalize(),points[length-2].subtract(points[length-1]).normalize());if(this.closed){segments.shift();segments.pop()}return segments},fitCubic:function(first,last,tan1,tan2){if(last-first==1){var pt1=this.points[first],pt2=this.points[last],dist=pt1.getDistance(pt2)/3;this.addCurve([pt1,pt1.add(tan1.normalize(dist)),pt2.add(tan2.normalize(dist)),pt2]);return}var uPrime=this.chordLengthParameterize(first,last),maxError=Math.max(this.error,this.error*this.error),split,parametersInOrder=true;for(var i=0;i<=4;i++){var curve=this.generateBezier(first,last,uPrime,tan1,tan2);var max=this.findMaxError(first,last,curve,uPrime);if(max.error<this.error&&parametersInOrder){this.addCurve(curve);return}split=max.index;if(max.error>=maxError)break;parametersInOrder=this.reparameterize(first,last,uPrime,curve);maxError=max.error}var V1=this.points[split-1].subtract(this.points[split]),V2=this.points[split].subtract(this.points[split+1]),tanCenter=V1.add(V2).divide(2).normalize();this.fitCubic(first,split,tan1,tanCenter);this.fitCubic(split,last,tanCenter.negate(),tan2)},addCurve:function(curve){var prev=this.segments[this.segments.length-1];prev.setHandleOut(curve[1].subtract(curve[0]));this.segments.push(new Segment(curve[3],curve[2].subtract(curve[3])))},generateBezier:function(first,last,uPrime,tan1,tan2){var epsilon=1e-12,pt1=this.points[first],pt2=this.points[last],C=[[0,0],[0,0]],X=[0,0];for(var i=0,l=last-first+1;i<l;i++){var u=uPrime[i],t=1-u,b=3*u*t,b0=t*t*t,b1=b*t,b2=b*u,b3=u*u*u,a1=tan1.normalize(b1),a2=tan2.normalize(b2),tmp=this.points[first+i].subtract(pt1.multiply(b0+b1)).subtract(pt2.multiply(b2+b3));C[0][0]+=a1.dot(a1);C[0][1]+=a1.dot(a2);C[1][0]=C[0][1];C[1][1]+=a2.dot(a2);X[0]+=a1.dot(tmp);X[1]+=a2.dot(tmp)}var detC0C1=C[0][0]*C[1][1]-C[1][0]*C[0][1],alpha1,alpha2;if(Math.abs(detC0C1)>epsilon){var detC0X=C[0][0]*X[1]-C[1][0]*X[0],detXC1=X[0]*C[1][1]-X[1]*C[0][1];alpha1=detXC1/detC0C1;alpha2=detC0X/detC0C1}else{var c0=C[0][0]+C[0][1],c1=C[1][0]+C[1][1];if(Math.abs(c0)>epsilon){alpha1=alpha2=X[0]/c0}else if(Math.abs(c1)>epsilon){alpha1=alpha2=X[1]/c1}else{alpha1=alpha2=0}}var segLength=pt2.getDistance(pt1),eps=epsilon*segLength,handle1,handle2;if(alpha1<eps||alpha2<eps){alpha1=alpha2=segLength/3}else{var line=pt2.subtract(pt1);handle1=tan1.normalize(alpha1);handle2=tan2.normalize(alpha2);if(handle1.dot(line)-handle2.dot(line)>segLength*segLength){alpha1=alpha2=segLength/3;handle1=handle2=null}}return[pt1,pt1.add(handle1||tan1.normalize(alpha1)),pt2.add(handle2||tan2.normalize(alpha2)),pt2]},reparameterize:function(first,last,u,curve){for(var i=first;i<=last;i++){u[i-first]=this.findRoot(curve,this.points[i],u[i-first])}for(var i=1,l=u.length;i<l;i++){if(u[i]<=u[i-1])return false}return true},findRoot:function(curve,point,u){var curve1=[],curve2=[];for(var i=0;i<=2;i++){curve1[i]=curve[i+1].subtract(curve[i]).multiply(3)}for(var i=0;i<=1;i++){curve2[i]=curve1[i+1].subtract(curve1[i]).multiply(2)}var pt=this.evaluate(3,curve,u),pt1=this.evaluate(2,curve1,u),pt2=this.evaluate(1,curve2,u),diff=pt.subtract(point),df=pt1.dot(pt1)+diff.dot(pt2);if(Math.abs(df)<1e-6)return u;return u-diff.dot(pt1)/df},evaluate:function(degree,curve,t){var tmp=curve.slice();for(var i=1;i<=degree;i++){for(var j=0;j<=degree-i;j++){tmp[j]=tmp[j].multiply(1-t).add(tmp[j+1].multiply(t))}}return tmp[0]},chordLengthParameterize:function(first,last){var u=[0];for(var i=first+1;i<=last;i++){u[i-first]=u[i-first-1]+this.points[i].getDistance(this.points[i-1])}for(var i=1,m=last-first;i<=m;i++){u[i]/=u[m]}return u},findMaxError:function(first,last,curve,u){var index=Math.floor((last-first+1)/2),maxDist=0;for(var i=first+1;i<last;i++){var P=this.evaluate(3,curve,u[i-first]);var v=P.subtract(this.points[i]);var dist=v.x*v.x+v.y*v.y;if(dist>=maxDist){maxDist=dist;index=i}}return{error:maxDist,index:index}}});var TextItem=Item.extend({_class:"TextItem",_boundsSelected:true,_applyMatrix:false,_canApplyMatrix:false,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function TextItem(arg){this._content="";this._lines=[];var hasProps=arg&&Base.isPlainObject(arg)&&arg.x===undefined&&arg.y===undefined;this._initialize(hasProps&&arg,!hasProps&&Point.read(arguments))},_equals:function(item){return this._content===item._content},_clone:function _clone(copy,insert,includeMatrix){copy.setContent(this._content);return _clone.base.call(this,copy,insert,includeMatrix)},getContent:function(){return this._content},setContent:function(content){this._content=""+content;this._lines=this._content.split(/\r\n|\n|\r/gm);this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"});var PointText=TextItem.extend({_class:"PointText",initialize:function PointText(){TextItem.apply(this,arguments)},clone:function(insert){return this._clone(new PointText(Item.NO_INSERT),insert)},getPoint:function(){var point=this._matrix.getTranslation();return new LinkedPoint(point.x,point.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.translate(point.subtract(this._matrix.getTranslation()))},_draw:function(ctx){if(!this._content)return;this._setStyles(ctx);var style=this._style,lines=this._lines,leading=style.getLeading(),shadowColor=ctx.shadowColor;ctx.font=style.getFontStyle();ctx.textAlign=style.getJustification();for(var i=0,l=lines.length;i<l;i++){ctx.shadowColor=shadowColor;var line=lines[i];if(style.hasFill()){ctx.fillText(line,0,0);ctx.shadowColor="rgba(0,0,0,0)"}if(style.hasStroke())ctx.strokeText(line,0,0);ctx.translate(0,leading)}},_getBounds:function(getter,matrix){var style=this._style,lines=this._lines,numLines=lines.length,justification=style.getJustification(),leading=style.getLeading(),width=this.getView().getTextWidth(style.getFontStyle(),lines),x=0;if(justification!=="left")x-=width/(justification==="center"?2:1);var bounds=new Rectangle(x,numLines?-.75*leading:0,width,numLines*leading);return matrix?matrix._transformBounds(bounds,bounds):bounds}});var Color=Base.extend(new function(){var types={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]};var componentParsers={},colorCache={},colorCtx;function fromCSS(string){var match=string.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/),components;if(match){components=[0,0,0];for(var i=0;i<3;i++){var value=match[i+1];components[i]=parseInt(value.length==1?value+value:value,16)/255}}else if(match=string.match(/^rgba?\((.*)\)$/)){components=match[1].split(",");for(var i=0,l=components.length;i<l;i++){var value=+components[i];components[i]=i<3?value/255:value}}else{var cached=colorCache[string];if(!cached){if(!colorCtx){colorCtx=CanvasProvider.getContext(1,1);colorCtx.globalCompositeOperation="copy"}colorCtx.fillStyle="rgba(0,0,0,0)";colorCtx.fillStyle=string;colorCtx.fillRect(0,0,1,1);var data=colorCtx.getImageData(0,0,1,1).data;cached=colorCache[string]=[data[0]/255,data[1]/255,data[2]/255]}components=cached.slice()}return components}var hsbIndices=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];var converters={"rgb-hsb":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,h=delta===0?0:(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4)*60;return[h,max===0?0:delta/max,max]},"hsb-rgb":function(h,s,b){h=(h/60%6+6)%6;var i=Math.floor(h),f=h-i,i=hsbIndices[i],v=[b,b*(1-s),b*(1-s*f),b*(1-s*(1-f))];return[v[i[0]],v[i[1]],v[i[2]]]},"rgb-hsl":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,achromatic=delta===0,h=achromatic?0:(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4)*60,l=(max+min)/2,s=achromatic?0:l<.5?delta/(max+min):delta/(2-max-min);return[h,s,l]},"hsl-rgb":function(h,s,l){h=(h/360%1+1)%1;if(s===0)return[l,l,l];var t3s=[h+1/3,h,h-1/3],t2=l<.5?l*(1+s):l+s-l*s,t1=2*l-t2,c=[];for(var i=0;i<3;i++){var t3=t3s[i];if(t3<0)t3+=1;if(t3>1)t3-=1;c[i]=6*t3<1?t1+(t2-t1)*6*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1}return c},"rgb-gray":function(r,g,b){return[r*.2989+g*.587+b*.114]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return Base.each(types,function(properties,type){componentParsers[type]=[];Base.each(properties,function(name,index){var part=Base.capitalize(name),hasOverlap=/^(hue|saturation)$/.test(name),parser=componentParsers[type][index]=name==="gradient"?function(value){var current=this._components[0];value=Gradient.read(Array.isArray(value)?value:arguments,0,{readNull:true});if(current!==value){if(current)current._removeOwner(this);if(value)value._addOwner(this)}return value}:type==="gradient"?function(){return Point.read(arguments,0,{readNull:name==="highlight",clone:true})}:function(value){return value==null||isNaN(value)?0:value};this["get"+part]=function(){return this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)?this._components[index]:this._convert(type)[index]};this["set"+part]=function(value){if(this._type!==type&&!(hasOverlap&&/^hs[bl]$/.test(this._type))){this._components=this._convert(type);this._properties=types[type];this._type=type}this._components[index]=parser.call(this,value);this._changed()}},this)},{_class:"Color",_readIndex:true,initialize:function Color(arg){var slice=Array.prototype.slice,args=arguments,read=0,type,components,alpha,values;if(Array.isArray(arg)){args=arg;arg=args[0]}var argType=arg!=null&&typeof arg;if(argType==="string"&&arg in types){type=arg;arg=args[1];if(Array.isArray(arg)){components=arg;alpha=args[2]}else{if(this.__read)read=1;args=slice.call(args,1);argType=typeof arg}}if(!components){values=argType==="number"?args:argType==="object"&&arg.length!=null?arg:null;if(values){if(!type)type=values.length>=3?"rgb":"gray";var length=types[type].length;alpha=values[length];if(this.__read)read+=values===arguments?length+(alpha!=null?1:0):1;if(values.length>length)values=slice.call(values,0,length)}else if(argType==="string"){type="rgb";components=fromCSS(arg);if(components.length===4){alpha=components[3];components.length--}}else if(argType==="object"){if(arg.constructor===Color){type=arg._type;components=arg._components.slice();alpha=arg._alpha;if(type==="gradient"){for(var i=1,l=components.length;i<l;i++){var point=components[i];if(point)components[i]=point.clone()}}}else if(arg.constructor===Gradient){type="gradient";values=args}else{type="hue"in arg?"lightness"in arg?"hsl":"hsb":"gradient"in arg||"stops"in arg||"radial"in arg?"gradient":"gray"in arg?"gray":"rgb";var properties=types[type],parsers=componentParsers[type];this._components=components=[];for(var i=0,l=properties.length;i<l;i++){var value=arg[properties[i]];if(value==null&&i===0&&type==="gradient"&&"stops"in arg){value={stops:arg.stops,radial:arg.radial}}value=parsers[i].call(this,value);if(value!=null)components[i]=value}alpha=arg.alpha}}if(this.__read&&type)read=1}this._type=type||"rgb";this._id=UID.get(Color);if(!components){this._components=components=[];var parsers=componentParsers[this._type];for(var i=0,l=parsers.length;i<l;i++){var value=parsers[i].call(this,values&&values[i]);if(value!=null)components[i]=value}}this._components=components;this._properties=types[this._type];this._alpha=alpha;if(this.__read)this.__read=read},_serialize:function(options,dictionary){var components=this.getComponents();return Base.serialize(/^(gray|rgb)$/.test(this._type)?components:[this._type].concat(components),options,true,dictionary)},_changed:function(){this._canvasStyle=null;if(this._owner)this._owner._changed(65)},_convert:function(type){var converter;return this._type===type?this._components.slice():(converter=converters[this._type+"-"+type])?converter.apply(this,this._components):converters["rgb-"+type].apply(this,converters[this._type+"-rgb"].apply(this,this._components))},convert:function(type){return new Color(type,this._convert(type),this._alpha)},getType:function(){return this._type},setType:function(type){this._components=this._convert(type);this._properties=types[type];this._type=type},getComponents:function(){var components=this._components.slice();if(this._alpha!=null)components.push(this._alpha);return components},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(alpha){this._alpha=alpha==null?null:Math.min(Math.max(alpha,0),1);this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(color){var col=Base.isPlainValue(color,true)?Color.read(arguments):color;return col===this||col&&this._class===col._class&&this._type===col._type&&this._alpha===col._alpha&&Base.equals(this._components,col._components)||false},toString:function(){var properties=this._properties,parts=[],isGradient=this._type==="gradient",f=Formatter.instance;for(var i=0,l=properties.length;i<l;i++){var value=this._components[i];if(value!=null)parts.push(properties[i]+": "+(isGradient?value:f.number(value)))}if(this._alpha!=null)parts.push("alpha: "+f.number(this._alpha));return"{ "+parts.join(", ")+" }"},toCSS:function(hex){var components=this._convert("rgb"),alpha=hex||this._alpha==null?1:this._alpha;function convert(val){return Math.round((val<0?0:val>1?1:val)*255)}components=[convert(components[0]),convert(components[1]),convert(components[2])];if(alpha<1)components.push(alpha<0?0:alpha);return hex?"#"+((1<<24)+(components[0]<<16)+(components[1]<<8)+components[2]).toString(16).slice(1):(components.length==4?"rgba(":"rgb(")+components.join(",")+")"},toCanvasStyle:function(ctx){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var components=this._components,gradient=components[0],stops=gradient._stops,origin=components[1],destination=components[2],canvasGradient;if(gradient._radial){var radius=destination.getDistance(origin),highlight=components[3];if(highlight){var vector=highlight.subtract(origin);if(vector.getLength()>radius)highlight=origin.add(vector.normalize(radius-.1))}var start=highlight||origin;canvasGradient=ctx.createRadialGradient(start.x,start.y,0,origin.x,origin.y,radius)}else{canvasGradient=ctx.createLinearGradient(origin.x,origin.y,destination.x,destination.y)}for(var i=0,l=stops.length;i<l;i++){var stop=stops[i];canvasGradient.addColorStop(stop._rampPoint,stop._color.toCanvasStyle())}return this._canvasStyle=canvasGradient},transform:function(matrix){if(this._type==="gradient"){var components=this._components;for(var i=1,l=components.length;i<l;i++){var point=components[i];matrix._transformPoint(point,point,true)}this._changed()}},statics:{_types:types,random:function(){var random=Math.random;return new Color(random(),random(),random())}}})},new function(){var operators={add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}};return Base.each(operators,function(operator,name){this[name]=function(color){color=Color.read(arguments);var type=this._type,components1=this._components,components2=color._convert(type);for(var i=0,l=components1.length;i<l;i++)components2[i]=operator(components1[i],components2[i]);return new Color(type,components2,this._alpha!=null?operator(this._alpha,color.getAlpha()):null)}},{})});var Gradient=Base.extend({_class:"Gradient",initialize:function Gradient(stops,radial){this._id=UID.get();if(stops&&this._set(stops))stops=radial=null;if(!this._stops)this.setStops(stops||["white","black"]);if(this._radial==null)this.setRadial(typeof radial==="string"&&radial==="radial"||radial||false)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._stops,this._radial],options,true,dictionary)})},_changed:function(){for(var i=0,l=this._owners&&this._owners.length;i<l;i++)this._owners[i]._changed()},_addOwner:function(color){if(!this._owners)this._owners=[];this._owners.push(color)},_removeOwner:function(color){var index=this._owners?this._owners.indexOf(color):-1;if(index!=-1){this._owners.splice(index,1);if(this._owners.length===0)this._owners=undefined}},clone:function(){var stops=[];for(var i=0,l=this._stops.length;i<l;i++)stops[i]=this._stops[i].clone();return new Gradient(stops,this._radial)},getStops:function(){return this._stops},setStops:function(stops){if(this.stops){for(var i=0,l=this._stops.length;i<l;i++)this._stops[i]._owner=undefined}if(stops.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(stops,0,{clone:true});for(var i=0,l=this._stops.length;i<l;i++){var stop=this._stops[i];stop._owner=this;if(stop._defaultRamp)stop.setRampPoint(i/(l-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(radial){this._radial=radial;this._changed()},equals:function(gradient){if(gradient===this)return true;if(gradient&&this._class===gradient._class&&this._stops.length===gradient._stops.length){for(var i=0,l=this._stops.length;i<l;i++){if(!this._stops[i].equals(gradient._stops[i]))return false}return true}return false}});var GradientStop=Base.extend({_class:"GradientStop",initialize:function GradientStop(arg0,arg1){if(arg0){var color,rampPoint;if(arg1===undefined&&Array.isArray(arg0)){color=arg0[0];rampPoint=arg0[1]}else if(arg0.color){color=arg0.color;rampPoint=arg0.rampPoint}else{color=arg0;rampPoint=arg1}this.setColor(color);this.setRampPoint(rampPoint)}},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_serialize:function(options,dictionary){return Base.serialize([this._color,this._rampPoint],options,true,dictionary)},_changed:function(){if(this._owner)this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(rampPoint){this._defaultRamp=rampPoint==null;this._rampPoint=rampPoint||0;this._changed()},getColor:function(){return this._color},setColor:function(color){this._color=Color.read(arguments);if(this._color===color)this._color=color.clone();this._color._owner=this;this._changed()},equals:function(stop){return stop===this||stop&&this._class===stop._class&&this._color.equals(stop._color)&&this._rampPoint==stop._rampPoint||false}});var Style=Base.extend(new function(){var defaults={fillColor:undefined,strokeColor:undefined,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:true,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:undefined,shadowBlur:0,shadowOffset:new Point,selectedColor:undefined,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"};var flags={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9};var item={beans:true},fields={_defaults:defaults,_textDefaults:new Base(defaults,{fillColor:new Color}),beans:true};Base.each(defaults,function(value,key){var isColor=/Color$/.test(key),isPoint=key==="shadowOffset",part=Base.capitalize(key),flag=flags[key],set="set"+part,get="get"+part;fields[set]=function(value){var owner=this._owner,children=owner&&owner._children;if(children&&children.length>0&&!(owner instanceof CompoundPath)){for(var i=0,l=children.length;i<l;i++)children[i]._style[set](value)}else{var old=this._values[key];if(old!==value){if(isColor){if(old)old._owner=undefined;if(value&&value.constructor===Color){if(value._owner)value=value.clone();value._owner=owner}}this._values[key]=value;if(owner)owner._changed(flag||65)}}};fields[get]=function(_dontMerge){var owner=this._owner,children=owner&&owner._children,value;if(!children||children.length===0||_dontMerge||owner instanceof CompoundPath){var value=this._values[key];if(value===undefined){value=this._defaults[key];if(value&&value.clone)value=value.clone()}else{var ctor=isColor?Color:isPoint?Point:null;if(ctor&&!(value&&value.constructor===ctor)){this._values[key]=value=ctor.read([value],0,{readNull:true,clone:true});if(value&&isColor)value._owner=owner}}return value}for(var i=0,l=children.length;i<l;i++){var childValue=children[i]._style[get]();if(i===0){value=childValue}else if(!Base.equals(value,childValue)){return undefined}}return value};item[get]=function(_dontMerge){return this._style[get](_dontMerge)};item[set]=function(value){this._style[set](value)}});Item.inject(item);return fields},{_class:"Style",initialize:function Style(style,_owner,_project){this._values={};this._owner=_owner;this._project=_owner&&_owner._project||_project||paper.project;if(_owner instanceof TextItem)this._defaults=this._textDefaults;if(style)this.set(style)},set:function(style){var isStyle=style instanceof Style,values=isStyle?style._values:style;if(values){for(var key in values){if(key in this._defaults){var value=values[key];this[key]=value&&isStyle&&value.clone?value.clone():value}}}},equals:function(style){return style===this||style&&this._class===style._class&&Base.equals(this._values,style._values)||false},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var fontSize=this.getFontSize();return this.getFontWeight()+" "+fontSize+(/[a-z]/i.test(fontSize+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var leading=getLeading.base.call(this),fontSize=this.getFontSize();if(/pt|em|%|px/.test(fontSize))fontSize=this.getView().getPixelSize(fontSize);return leading!=null?leading:fontSize*1.2}});var DomElement=new function(){function handlePrefix(el,name,set,value){var prefixes=["","webkit","moz","Moz","ms","o"],suffix=name[0].toUpperCase()+name.substring(1);for(var i=0;i<6;i++){var prefix=prefixes[i],key=prefix?prefix+suffix:name;if(key in el){if(set){el[key]=value}else{return el[key]}break}}}return{getStyles:function(el){var doc=el&&el.nodeType!==9?el.ownerDocument:el,view=doc&&doc.defaultView;return view&&view.getComputedStyle(el,"")},getBounds:function(el,viewport){var doc=el.ownerDocument,body=doc.body,html=doc.documentElement,rect;try{rect=el.getBoundingClientRect()}catch(e){rect={left:0,top:0,width:0,height:0}}var x=rect.left-(html.clientLeft||body.clientLeft||0),y=rect.top-(html.clientTop||body.clientTop||0);if(!viewport){var view=doc.defaultView;x+=view.pageXOffset||html.scrollLeft||body.scrollLeft;y+=view.pageYOffset||html.scrollTop||body.scrollTop}return new Rectangle(x,y,rect.width,rect.height)},getViewportBounds:function(el){var doc=el.ownerDocument,view=doc.defaultView,html=doc.documentElement;return new Rectangle(0,0,view.innerWidth||html.clientWidth,view.innerHeight||html.clientHeight)},getOffset:function(el,viewport){return DomElement.getBounds(el,viewport).getPoint()},getSize:function(el){return DomElement.getBounds(el,true).getSize()},isInvisible:function(el){return DomElement.getSize(el).equals(new Size(0,0))},isInView:function(el){return!DomElement.isInvisible(el)&&DomElement.getViewportBounds(el).intersects(DomElement.getBounds(el,true))},getPrefixed:function(el,name){return handlePrefix(el,name)},setPrefixed:function(el,name,value){if(typeof name==="object"){for(var key in name)handlePrefix(el,key,true,name[key])}else{handlePrefix(el,name,true,value)}}}};var DomEvent={add:function(el,events){for(var type in events){var func=events[type],parts=type.split(/[\s,]+/g);for(var i=0,l=parts.length;i<l;i++)el.addEventListener(parts[i],func,false)}},remove:function(el,events){for(var type in events){var func=events[type],parts=type.split(/[\s,]+/g);for(var i=0,l=parts.length;i<l;i++)el.removeEventListener(parts[i],func,false)}},getPoint:function(event){var pos=event.targetTouches?event.targetTouches.length?event.targetTouches[0]:event.changedTouches[0]:event;return new Point(pos.pageX||pos.clientX+document.documentElement.scrollLeft,pos.pageY||pos.clientY+document.documentElement.scrollTop)},getTarget:function(event){return event.target||event.srcElement},getRelatedTarget:function(event){return event.relatedTarget||event.toElement},getOffset:function(event,target){return DomEvent.getPoint(event).subtract(DomElement.getOffset(target||DomEvent.getTarget(event)))},stop:function(event){event.stopPropagation();event.preventDefault()}};DomEvent.requestAnimationFrame=new function(){var nativeRequest=DomElement.getPrefixed(window,"requestAnimationFrame"),requested=false,callbacks=[],focused=true,timer;DomEvent.add(window,{focus:function(){focused=true},blur:function(){focused=false}});function handleCallbacks(){for(var i=callbacks.length-1;i>=0;i--){var entry=callbacks[i],func=entry[0],el=entry[1];if(!el||(PaperScope.getAttribute(el,"keepalive")=="true"||focused)&&DomElement.isInView(el)){callbacks.splice(i,1);func()}}if(nativeRequest){if(callbacks.length){nativeRequest(handleCallbacks)}else{requested=false}}}return function(callback,element){callbacks.push([callback,element]);if(nativeRequest){if(!requested){nativeRequest(handleCallbacks);requested=true}}else if(!timer){timer=setInterval(handleCallbacks,1e3/60)}}};var View=Base.extend(Emitter,{_class:"View",initialize:function View(project,element){this._project=project;this._scope=project._scope;this._element=element;var size;if(!this._pixelRatio)this._pixelRatio=window.devicePixelRatio||1;this._id=element.getAttribute("id");if(this._id==null)element.setAttribute("id",this._id="view-"+View._id++);DomEvent.add(element,this._viewEvents);var none="none";DomElement.setPrefixed(element.style,{userSelect:none,touchAction:none,touchCallout:none,contentZooming:none,userDrag:none,tapHighlightColor:"rgba(0,0,0,0)"});function getSize(name){return element[name]||parseInt(element.getAttribute(name),10)}function getCanvasSize(){var size=DomElement.getSize(element);return size.isNaN()||size.isZero()?new Size(getSize("width"),getSize("height")):size}if(PaperScope.hasAttribute(element,"resize")){var that=this;DomEvent.add(window,this._windowEvents={resize:function(){that.setViewSize(getCanvasSize())}})}this._setViewSize(size=getCanvasSize());if(PaperScope.hasAttribute(element,"stats")&&typeof Stats!=="undefined"){this._stats=new Stats;var stats=this._stats.domElement,style=stats.style,offset=DomElement.getOffset(element);style.position="absolute";style.left=offset.x+"px";style.top=offset.y+"px";document.body.appendChild(stats)}View._views.push(this);View._viewsById[this._id]=this;this._viewSize=size;(this._matrix=new Matrix)._owner=this;this._zoom=1;if(!View._focused)View._focused=this;this._frameItems={};

this._frameItemCount=0},remove:function(){if(!this._project)return false;if(View._focused===this)View._focused=null;View._views.splice(View._views.indexOf(this),1);delete View._viewsById[this._id];if(this._project._view===this)this._project._view=null;DomEvent.remove(this._element,this._viewEvents);DomEvent.remove(window,this._windowEvents);this._element=this._project=null;this.off("frame");this._animate=false;this._frameItems={};return true},_events:Base.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(name){this[name]={install:function(type){this._installEvent(type)},uninstall:function(type){this._uninstallEvent(type)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:false,_time:0,_count:0,_requestFrame:function(){var that=this;DomEvent.requestAnimationFrame(function(){that._requested=false;if(!that._animate)return;that._requestFrame();that._handleFrame()},this._element);this._requested=true},_handleFrame:function(){paper=this._scope;var now=Date.now()/1e3,delta=this._before?now-this._before:0;this._before=now;this._handlingFrame=true;this.emit("frame",new Base({delta:delta,time:this._time+=delta,count:this._count++}));if(this._stats)this._stats.update();this._handlingFrame=false;this.update()},_animateItem:function(item,animate){var items=this._frameItems;if(animate){items[item._id]={item:item,time:0,count:0};if(++this._frameItemCount===1)this.on("frame",this._handleFrameItems)}else{delete items[item._id];if(--this._frameItemCount===0){this.off("frame",this._handleFrameItems)}}},_handleFrameItems:function(event){for(var i in this._frameItems){var entry=this._frameItems[i];entry.item.emit("frame",new Base(event,{time:entry.time+=event.delta,count:entry.count++}))}},_update:function(){this._project._needsUpdate=true;if(this._handlingFrame)return;if(this._animate){this._handleFrame()}else{this.update()}},_changed:function(flags){if(flags&1)this._project._needsUpdate=true},_transform:function(matrix){this._matrix.concatenate(matrix);this._bounds=null;this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var size=this._viewSize;return new LinkedSize(size.width,size.height,this,"setViewSize")},setViewSize:function(){var size=Size.read(arguments),delta=size.subtract(this._viewSize);if(delta.isZero())return;this._viewSize.set(size.width,size.height);this._setViewSize(size);this._bounds=null;this.emit("resize",{size:size,delta:delta});this._update()},_setViewSize:function(size){var element=this._element;element.width=size.width;element.height=size.height},getBounds:function(){if(!this._bounds)this._bounds=this._matrix.inverted()._transformBounds(new Rectangle(new Point,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var center=Point.read(arguments);this.scrollBy(center.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(zoom){this._transform((new Matrix).scale(zoom/this._zoom,this.getCenter()));this._zoom=zoom},isVisible:function(){return DomElement.isInView(this._element)},scrollBy:function(){this._transform((new Matrix).translate(Point.read(arguments).negate()))},play:function(){this._animate=true;if(!this._requested)this._requestFrame()},pause:function(){this._animate=false},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(Point.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(project,element){if(typeof element==="string")element=document.getElementById(element);return new CanvasView(project,element)}}},new function(){var tool,prevFocus,tempFocus,dragging=false;function getView(event){var target=DomEvent.getTarget(event);return target.getAttribute&&View._viewsById[target.getAttribute("id")]}function viewToProject(view,event){return view.viewToProject(DomEvent.getOffset(event,view._element))}function updateFocus(){if(!View._focused||!View._focused.isVisible()){for(var i=0,l=View._views.length;i<l;i++){var view=View._views[i];if(view&&view.isVisible()){View._focused=tempFocus=view;break}}}}function handleMouseMove(view,point,event){view._handleEvent("mousemove",point,event);var tool=view._scope.tool;if(tool){tool._handleEvent(dragging&&tool.responds("mousedrag")?"mousedrag":"mousemove",point,event)}view.update();return tool}var navigator=window.navigator,mousedown,mousemove,mouseup;if(navigator.pointerEnabled||navigator.msPointerEnabled){mousedown="pointerdown MSPointerDown";mousemove="pointermove MSPointerMove";mouseup="pointerup pointercancel MSPointerUp MSPointerCancel"}else{mousedown="touchstart";mousemove="touchmove";mouseup="touchend touchcancel";if(!("ontouchstart"in window&&navigator.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i))){mousedown+=" mousedown";mousemove+=" mousemove";mouseup+=" mouseup"}}var viewEvents={"selectstart dragstart":function(event){if(dragging)event.preventDefault()}};var docEvents={mouseout:function(event){var view=View._focused,target=DomEvent.getRelatedTarget(event);if(view&&(!target||target.nodeName==="HTML"))handleMouseMove(view,viewToProject(view,event),event)},scroll:updateFocus};viewEvents[mousedown]=function(event){var view=View._focused=getView(event),point=viewToProject(view,event);dragging=true;view._handleEvent("mousedown",point,event);if(tool=view._scope.tool)tool._handleEvent("mousedown",point,event);view.update()};docEvents[mousemove]=function(event){var view=View._focused;if(!dragging){var target=getView(event);if(target){if(view!==target)handleMouseMove(view,viewToProject(view,event),event);prevFocus=view;view=View._focused=tempFocus=target}else if(tempFocus&&tempFocus===view){view=View._focused=prevFocus;updateFocus()}}if(view){var point=viewToProject(view,event);if(dragging||view.getBounds().contains(point))tool=handleMouseMove(view,point,event)}};docEvents[mouseup]=function(event){var view=View._focused;if(!view||!dragging)return;var point=viewToProject(view,event);dragging=false;view._handleEvent("mouseup",point,event);if(tool)tool._handleEvent("mouseup",point,event);view.update()};DomEvent.add(document,docEvents);DomEvent.add(window,{load:updateFocus});var mouseFlags={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:viewEvents,_handleEvent:function(){},_installEvent:function(type){var counters=this._eventCounters;if(counters){for(var key in mouseFlags){counters[key]=(counters[key]||0)+(mouseFlags[key][type]||0)}}},_uninstallEvent:function(type){var counters=this._eventCounters;if(counters){for(var key in mouseFlags)counters[key]-=mouseFlags[key][type]||0}},statics:{updateFocus:updateFocus}}});var CanvasView=View.extend({_class:"CanvasView",initialize:function CanvasView(project,canvas){if(!(canvas instanceof HTMLCanvasElement)){var size=Size.read(arguments,1);if(size.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));canvas=CanvasProvider.getCanvas(size)}this._context=canvas.getContext("2d");this._eventCounters={};this._pixelRatio=1;if(!/^off|false$/.test(PaperScope.getAttribute(canvas,"hidpi"))){var deviceRatio=window.devicePixelRatio||1,backingStoreRatio=DomElement.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=deviceRatio/backingStoreRatio}View.call(this,project,canvas)},_setViewSize:function(size){var element=this._element,pixelRatio=this._pixelRatio,width=size.width,height=size.height;element.width=width*pixelRatio;element.height=height*pixelRatio;if(pixelRatio!==1){if(!PaperScope.hasAttribute(element,"resize")){var style=element.style;style.width=width+"px";style.height=height+"px"}this._context.scale(pixelRatio,pixelRatio)}},getPixelSize:function(size){var browser=paper.browser,pixels;if(browser&&browser.firefox){var parent=this._element.parentNode,temp=document.createElement("div");temp.style.fontSize=size;parent.appendChild(temp);pixels=parseFloat(DomElement.getStyles(temp).fontSize);parent.removeChild(temp)}else{var ctx=this._context,prevFont=ctx.font;ctx.font=size+" serif";pixels=parseFloat(ctx.font);ctx.font=prevFont}return pixels},getTextWidth:function(font,lines){var ctx=this._context,prevFont=ctx.font,width=0;ctx.font=font;for(var i=0,l=lines.length;i<l;i++)width=Math.max(width,ctx.measureText(lines[i]).width);ctx.font=prevFont;return width},update:function(force){var project=this._project;if(!project||!force&&!project._needsUpdate)return false;var ctx=this._context,size=this._viewSize;ctx.clearRect(0,0,size.width+1,size.height+1);project.draw(ctx,this._matrix,this._pixelRatio);project._needsUpdate=false;return true}},new function(){var downPoint,lastPoint,overPoint,downItem,lastItem,overItem,dragItem,dblClick,clickTime;function callEvent(view,type,event,point,target,lastPoint){var item=target,mouseEvent;function call(obj){if(obj.responds(type)){if(!mouseEvent){mouseEvent=new MouseEvent(type,event,point,target,lastPoint?point.subtract(lastPoint):null)}if(obj.emit(type,mouseEvent)&&mouseEvent.isStopped){event.preventDefault();return true}}}while(item){if(call(item))return true;item=item.getParent()}if(call(view))return true;return false}return{_handleEvent:function(type,point,event){if(!this._eventCounters[type])return;var project=this._project,hit=project.hitTest(point,{tolerance:0,fill:true,stroke:true}),item=hit&&hit.item,stopped=false;switch(type){case"mousedown":stopped=callEvent(this,type,event,point,item);dblClick=lastItem==item&&Date.now()-clickTime<300;downItem=lastItem=item;downPoint=lastPoint=overPoint=point;dragItem=!stopped&&item;while(dragItem&&!dragItem.responds("mousedrag"))dragItem=dragItem._parent;break;case"mouseup":stopped=callEvent(this,type,event,point,item,downPoint);if(dragItem){if(lastPoint&&!lastPoint.equals(point))callEvent(this,"mousedrag",event,point,dragItem,lastPoint);if(item!==dragItem){overPoint=point;callEvent(this,"mousemove",event,point,item,overPoint)}}if(!stopped&&item&&item===downItem){clickTime=Date.now();callEvent(this,dblClick&&downItem.responds("doubleclick")?"doubleclick":"click",event,downPoint,item);dblClick=false}downItem=dragItem=null;break;case"mousemove":if(dragItem)stopped=callEvent(this,"mousedrag",event,point,dragItem,lastPoint);if(!stopped){if(item!==overItem)overPoint=point;stopped=callEvent(this,type,event,point,item,overPoint)}lastPoint=overPoint=point;if(item!==overItem){callEvent(this,"mouseleave",event,point,overItem);overItem=item;callEvent(this,"mouseenter",event,point,item)}break}return stopped}}});var Event=Base.extend({_class:"Event",initialize:function Event(event){this.event=event},isPrevented:false,isStopped:false,preventDefault:function(){this.isPrevented=true;this.event.preventDefault()},stopPropagation:function(){this.isStopped=true;this.event.stopPropagation()},stop:function(){this.stopPropagation();this.preventDefault()},getModifiers:function(){return Key.modifiers}});var KeyEvent=Event.extend({_class:"KeyEvent",initialize:function KeyEvent(down,key,character,event){Event.call(this,event);this.type=down?"keydown":"keyup";this.key=key;this.character=character},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}});var Key=new function(){var specialKeys={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},specialChars={9:true,13:true,32:true},modifiers=new Base({shift:false,control:false,option:false,command:false,capsLock:false,space:false}),charCodeMap={},keyMap={},commandFixMap,downCode;function handleKey(down,keyCode,charCode,event){var character=charCode?String.fromCharCode(charCode):"",specialKey=specialKeys[keyCode],key=specialKey||character.toLowerCase(),type=down?"keydown":"keyup",view=View._focused,scope=view&&view.isVisible()&&view._scope,tool=scope&&scope.tool,name;keyMap[key]=down;if(down){charCodeMap[keyCode]=charCode}else{delete charCodeMap[keyCode]}if(specialKey&&(name=Base.camelize(specialKey))in modifiers){modifiers[name]=down;var browser=paper.browser;if(name==="command"&&browser&&browser.mac){if(down){commandFixMap={}}else{for(var code in commandFixMap){if(code in charCodeMap)handleKey(false,code,commandFixMap[code],event)}commandFixMap=null}}}else if(down&&commandFixMap){commandFixMap[keyCode]=charCode}if(tool&&tool.responds(type)){paper=scope;tool.emit(type,new KeyEvent(down,key,character,event));if(view)view.update()}}DomEvent.add(document,{keydown:function(event){var code=event.which||event.keyCode;if(code in specialKeys||modifiers.command){handleKey(true,code,code in specialChars||modifiers.command?code:0,event)}else{downCode=code}},keypress:function(event){if(downCode!=null){handleKey(true,downCode,event.which||event.keyCode,event);downCode=null}},keyup:function(event){var code=event.which||event.keyCode;if(code in charCodeMap)handleKey(false,code,charCodeMap[code],event)}});DomEvent.add(window,{blur:function(event){for(var code in charCodeMap)handleKey(false,code,charCodeMap[code],event)}});return{modifiers:modifiers,isDown:function(key){return!!keyMap[key]}}};var MouseEvent=Event.extend({_class:"MouseEvent",initialize:function MouseEvent(type,event,point,target,delta){Event.call(this,event);this.type=type;this.point=point;this.target=target;this.delta=delta},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}});var ToolEvent=Event.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent(tool,type,event){this.tool=tool;this.type=type;this.event=event},_choosePoint:function(point,toolPoint){return point?point:toolPoint?toolPoint.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(point){this._point=point},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(lastPoint){this._lastPoint=lastPoint},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(downPoint){this._downPoint=downPoint},getMiddlePoint:function(){if(!this._middlePoint&&this.tool._lastPoint){return this.tool._point.add(this.tool._lastPoint).divide(2)}return this._middlePoint},setMiddlePoint:function(middlePoint){this._middlePoint=middlePoint},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(delta){this._delta=delta},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(count){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=count},getItem:function(){if(!this._item){var result=this.tool._scope.project.hitTest(this.getPoint());if(result){var item=result.item,parent=item._parent;while(/^(Group|CompoundPath)$/.test(parent._class)){item=parent;parent=parent._parent}this._item=item}}return this._item},setItem:function(item){this._item=item},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});var Tool=PaperScopeItem.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function Tool(props){PaperScopeItem.call(this);this._firstMove=true;this._count=0;this._downCount=0;this._set(props)},getMinDistance:function(){return this._minDistance},setMinDistance:function(minDistance){this._minDistance=minDistance;if(minDistance!=null&&this._maxDistance!=null&&minDistance>this._maxDistance){this._maxDistance=minDistance}},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(maxDistance){this._maxDistance=maxDistance;if(this._minDistance!=null&&maxDistance!=null&&maxDistance<this._minDistance){this._minDistance=maxDistance}},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(distance){this._minDistance=this._maxDistance=distance},_updateEvent:function(type,point,minDistance,maxDistance,start,needsChange,matchMaxDistance){if(!start){if(minDistance!=null||maxDistance!=null){var minDist=minDistance!=null?minDistance:0,vector=point.subtract(this._point),distance=vector.getLength();if(distance<minDist)return false;if(maxDistance!=null&&maxDistance!=0){if(distance>maxDistance){point=this._point.add(vector.normalize(maxDistance))}else if(matchMaxDistance){return false}}}if(needsChange&&point.equals(this._point))return false}this._lastPoint=start&&type=="mousemove"?point:this._point;this._point=point;switch(type){case"mousedown":this._lastPoint=this._downPoint;this._downPoint=this._point;this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint;break}this._count=start?0:this._count+1;return true},_fireEvent:function(type,event){var sets=paper.project._removeSets;if(sets){if(type==="mouseup")sets.mousedrag=null;var set=sets[type];if(set){for(var id in set){var item=set[id];for(var key in sets){var other=sets[key];if(other&&other!=set)delete other[item._id]}item.remove()}sets[type]=null}}return this.responds(type)&&this.emit(type,new ToolEvent(this,type,event))},_handleEvent:function(type,point,event){paper=this._scope;var called=false;switch(type){case"mousedown":this._updateEvent(type,point,null,null,true,false,false);called=this._fireEvent(type,event);break;case"mousedrag":var needsChange=false,matchMaxDistance=false;while(this._updateEvent(type,point,this.minDistance,this.maxDistance,false,needsChange,matchMaxDistance)){called=this._fireEvent(type,event)||called;needsChange=true;matchMaxDistance=true}break;case"mouseup":if(!point.equals(this._point)&&this._updateEvent("mousedrag",point,this.minDistance,this.maxDistance,false,false,false)){called=this._fireEvent("mousedrag",event)}this._updateEvent(type,point,null,this.maxDistance,false,false,false);called=this._fireEvent(type,event)||called;this._updateEvent(type,point,null,null,true,false,false);this._firstMove=true;break;case"mousemove":while(this._updateEvent(type,point,this.minDistance,this.maxDistance,this._firstMove,true,false)){called=this._fireEvent(type,event)||called;this._firstMove=false}break}if(called)event.preventDefault();return called}});var Http={request:function(method,url,callback,async){async=async===undefined?true:async;var xhr=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");xhr.open(method.toUpperCase(),url,async);if("overrideMimeType"in xhr)xhr.overrideMimeType("text/plain");xhr.onreadystatechange=function(){if(xhr.readyState===4){var status=xhr.status;if(status===0||status===200){callback.call(xhr,xhr.responseText)}else{throw new Error("Could not load "+url+" (Error "+status+")")}}};return xhr.send(null)}};var CanvasProvider={canvases:[],getCanvas:function(width,height){var canvas,clear=true;if(typeof width==="object"){height=width.height;width=width.width}if(this.canvases.length){canvas=this.canvases.pop()}else{canvas=document.createElement("canvas")}var ctx=canvas.getContext("2d");if(canvas.width===width&&canvas.height===height){if(clear)ctx.clearRect(0,0,width+1,height+1)}else{canvas.width=width;canvas.height=height}ctx.save();return canvas},getContext:function(width,height){return this.getCanvas(width,height).getContext("2d")},release:function(obj){var canvas=obj.canvas?obj.canvas:obj;canvas.getContext("2d").restore();this.canvases.push(canvas)}};var BlendMode=new function(){var min=Math.min,max=Math.max,abs=Math.abs,sr,sg,sb,sa,br,bg,bb,ba,dr,dg,db;function getLum(r,g,b){return.2989*r+.587*g+.114*b}function setLum(r,g,b,l){var d=l-getLum(r,g,b);dr=r+d;dg=g+d;db=b+d;var l=getLum(dr,dg,db),mn=min(dr,dg,db),mx=max(dr,dg,db);if(mn<0){var lmn=l-mn;dr=l+(dr-l)*l/lmn;dg=l+(dg-l)*l/lmn;db=l+(db-l)*l/lmn}if(mx>255){var ln=255-l,mxl=mx-l;dr=l+(dr-l)*ln/mxl;dg=l+(dg-l)*ln/mxl;db=l+(db-l)*ln/mxl}}function getSat(r,g,b){return max(r,g,b)-min(r,g,b)}function setSat(r,g,b,s){var col=[r,g,b],mx=max(r,g,b),mn=min(r,g,b),md;mn=mn===r?0:mn===g?1:2;mx=mx===r?0:mx===g?1:2;md=min(mn,mx)===0?max(mn,mx)===1?2:1:0;if(col[mx]>col[mn]){col[md]=(col[md]-col[mn])*s/(col[mx]-col[mn]);col[mx]=s}else{col[md]=col[mx]=0}col[mn]=0;dr=col[0];dg=col[1];db=col[2]}var modes={multiply:function(){dr=br*sr/255;dg=bg*sg/255;db=bb*sb/255},screen:function(){dr=br+sr-br*sr/255;dg=bg+sg-bg*sg/255;db=bb+sb-bb*sb/255},overlay:function(){dr=br<128?2*br*sr/255:255-2*(255-br)*(255-sr)/255;dg=bg<128?2*bg*sg/255:255-2*(255-bg)*(255-sg)/255;db=bb<128?2*bb*sb/255:255-2*(255-bb)*(255-sb)/255},"soft-light":function(){var t=sr*br/255;dr=t+br*(255-(255-br)*(255-sr)/255-t)/255;t=sg*bg/255;dg=t+bg*(255-(255-bg)*(255-sg)/255-t)/255;t=sb*bb/255;db=t+bb*(255-(255-bb)*(255-sb)/255-t)/255},"hard-light":function(){dr=sr<128?2*sr*br/255:255-2*(255-sr)*(255-br)/255;dg=sg<128?2*sg*bg/255:255-2*(255-sg)*(255-bg)/255;db=sb<128?2*sb*bb/255:255-2*(255-sb)*(255-bb)/255},"color-dodge":function(){dr=br===0?0:sr===255?255:min(255,255*br/(255-sr));dg=bg===0?0:sg===255?255:min(255,255*bg/(255-sg));db=bb===0?0:sb===255?255:min(255,255*bb/(255-sb))},"color-burn":function(){dr=br===255?255:sr===0?0:max(0,255-(255-br)*255/sr);dg=bg===255?255:sg===0?0:max(0,255-(255-bg)*255/sg);db=bb===255?255:sb===0?0:max(0,255-(255-bb)*255/sb)},darken:function(){dr=br<sr?br:sr;dg=bg<sg?bg:sg;db=bb<sb?bb:sb},lighten:function(){dr=br>sr?br:sr;dg=bg>sg?bg:sg;db=bb>sb?bb:sb},difference:function(){dr=br-sr;if(dr<0)dr=-dr;dg=bg-sg;if(dg<0)dg=-dg;db=bb-sb;if(db<0)db=-db},exclusion:function(){dr=br+sr*(255-br-br)/255;dg=bg+sg*(255-bg-bg)/255;db=bb+sb*(255-bb-bb)/255},hue:function(){setSat(sr,sg,sb,getSat(br,bg,bb));setLum(dr,dg,db,getLum(br,bg,bb))},saturation:function(){setSat(br,bg,bb,getSat(sr,sg,sb));setLum(dr,dg,db,getLum(br,bg,bb))},luminosity:function(){setLum(br,bg,bb,getLum(sr,sg,sb))},color:function(){setLum(sr,sg,sb,getLum(br,bg,bb))},add:function(){dr=min(br+sr,255);dg=min(bg+sg,255);db=min(bb+sb,255)},subtract:function(){dr=max(br-sr,0);dg=max(bg-sg,0);db=max(bb-sb,0)},average:function(){dr=(br+sr)/2;dg=(bg+sg)/2;db=(bb+sb)/2},negation:function(){dr=255-abs(255-sr-br);dg=255-abs(255-sg-bg);db=255-abs(255-sb-bb)}};var nativeModes=this.nativeModes=Base.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(mode){this[mode]=true},{});var ctx=CanvasProvider.getContext(1,1);Base.each(modes,function(func,mode){var darken=mode==="darken",ok=false;ctx.save();try{ctx.fillStyle=darken?"#300":"#a00";ctx.fillRect(0,0,1,1);ctx.globalCompositeOperation=mode;if(ctx.globalCompositeOperation===mode){ctx.fillStyle=darken?"#a00":"#300";ctx.fillRect(0,0,1,1);ok=ctx.getImageData(0,0,1,1).data[0]!==darken?170:51}}catch(e){}ctx.restore();nativeModes[mode]=ok});CanvasProvider.release(ctx);this.process=function(mode,srcContext,dstContext,alpha,offset){var srcCanvas=srcContext.canvas,normal=mode==="normal";if(normal||nativeModes[mode]){dstContext.save();dstContext.setTransform(1,0,0,1,0,0);dstContext.globalAlpha=alpha;if(!normal)dstContext.globalCompositeOperation=mode;dstContext.drawImage(srcCanvas,offset.x,offset.y);dstContext.restore()}else{var process=modes[mode];if(!process)return;var dstData=dstContext.getImageData(offset.x,offset.y,srcCanvas.width,srcCanvas.height),dst=dstData.data,src=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height).data;for(var i=0,l=dst.length;i<l;i+=4){sr=src[i];br=dst[i];sg=src[i+1];bg=dst[i+1];sb=src[i+2];bb=dst[i+2];sa=src[i+3];ba=dst[i+3];process();var a1=sa*alpha/255,a2=1-a1;dst[i]=a1*dr+a2*br;dst[i+1]=a1*dg+a2*bg;dst[i+2]=a1*db+a2*bb;dst[i+3]=sa*alpha+a2*ba}dstContext.putImageData(dstData,offset.x,offset.y)}}};var SVGStyles=Base.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{"true":"none","false":"non-scaling-stroke"},function(item,value){return!value&&(item instanceof PathItem||item instanceof Shape||item instanceof TextItem)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(entry,key){var part=Base.capitalize(key),lookup=entry[2];this[key]={type:entry[1],property:key,attribute:entry[0],toSVG:lookup,fromSVG:lookup&&Base.each(lookup,function(value,name){this[value]=name},{}),exportFilter:entry[3],get:"get"+part,set:"set"+part}},{});var SVGNamespaces={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};new function(){var formatter;function setAttributes(node,attrs){for(var key in attrs){var val=attrs[key],namespace=SVGNamespaces[key];if(typeof val==="number")val=formatter.number(val);if(namespace){node.setAttributeNS(namespace,key,val)}else{node.setAttribute(key,val)}}return node}function createElement(tag,attrs){return setAttributes(document.createElementNS("http://www.w3.org/2000/svg",tag),attrs)}function getTransform(matrix,coordinates,center){var attrs=new Base,trans=matrix.getTranslation();if(coordinates){matrix=matrix.shiftless();var point=matrix._inverseTransform(trans);attrs[center?"cx":"x"]=point.x;attrs[center?"cy":"y"]=point.y;trans=null}if(!matrix.isIdentity()){var decomposed=matrix.decompose();if(decomposed&&!decomposed.shearing){var parts=[],angle=decomposed.rotation,scale=decomposed.scaling;if(trans&&!trans.isZero())parts.push("translate("+formatter.point(trans)+")");if(!Numerical.isZero(scale.x-1)||!Numerical.isZero(scale.y-1))parts.push("scale("+formatter.point(scale)+")");if(angle)parts.push("rotate("+formatter.number(angle)+")");attrs.transform=parts.join(" ")}else{attrs.transform="matrix("+matrix.getValues().join(",")+")"}}return attrs}function exportGroup(item,options){var attrs=getTransform(item._matrix),children=item._children;var node=createElement("g",attrs);for(var i=0,l=children.length;i<l;i++){var child=children[i];var childNode=exportSVG(child,options);if(childNode){if(child.isClipMask()){var clip=createElement("clipPath");clip.appendChild(childNode);setDefinition(child,clip,"clip");setAttributes(node,{"clip-path":"url(#"+clip.id+")"})}else{node.appendChild(childNode)}}}return node}function exportRaster(item,options){var attrs=getTransform(item._matrix,true),size=item.getSize(),image=item.getImage();attrs.x-=size.width/2;attrs.y-=size.height/2;attrs.width=size.width;attrs.height=size.height;attrs.href=options.embedImages===false&&image&&image.src||item.toDataURL();return createElement("image",attrs)}function exportPath(item,options){var matchShapes=options.matchShapes;if(matchShapes){var shape=item.toShape(false);if(shape)return exportShape(shape,options)}var segments=item._segments,type,attrs=getTransform(item._matrix);if(segments.length===0)return null;if(matchShapes&&!item.hasHandles()){if(segments.length>=3){type=item._closed?"polygon":"polyline";var parts=[];for(var i=0,l=segments.length;i<l;i++)parts.push(formatter.point(segments[i]._point));attrs.points=parts.join(" ")}else{type="line";var first=segments[0]._point,last=segments[segments.length-1]._point;attrs.set({x1:first.x,y1:first.y,x2:last.x,y2:last.y})}}else{type="path";attrs.d=item.getPathData(null,options.precision)}return createElement(type,attrs)}function exportShape(item){var type=item._type,radius=item._radius,attrs=getTransform(item._matrix,true,type!=="rectangle");if(type==="rectangle"){type="rect";var size=item._size,width=size.width,height=size.height;attrs.x-=width/2;attrs.y-=height/2;attrs.width=width;attrs.height=height;if(radius.isZero())radius=null}if(radius){if(type==="circle"){attrs.r=radius}else{attrs.rx=radius.width;attrs.ry=radius.height}}return createElement(type,attrs)}function exportCompoundPath(item,options){var attrs=getTransform(item._matrix);var data=item.getPathData(null,options.precision);if(data)attrs.d=data;return createElement("path",attrs)}function exportPlacedSymbol(item,options){var attrs=getTransform(item._matrix,true),symbol=item.getSymbol(),symbolNode=getDefinition(symbol,"symbol"),definition=symbol.getDefinition(),bounds=definition.getBounds();if(!symbolNode){symbolNode=createElement("symbol",{viewBox:formatter.rectangle(bounds)});symbolNode.appendChild(exportSVG(definition,options));setDefinition(symbol,symbolNode,"symbol")}attrs.href="#"+symbolNode.id;attrs.x+=bounds.x;attrs.y+=bounds.y;attrs.width=formatter.number(bounds.width);attrs.height=formatter.number(bounds.height);attrs.overflow="visible";return createElement("use",attrs)}function exportGradient(color){var gradientNode=getDefinition(color,"color");if(!gradientNode){var gradient=color.getGradient(),radial=gradient._radial,origin=color.getOrigin().transform(),destination=color.getDestination().transform(),attrs;if(radial){attrs={cx:origin.x,cy:origin.y,r:origin.getDistance(destination)};var highlight=color.getHighlight();if(highlight){highlight=highlight.transform();attrs.fx=highlight.x;attrs.fy=highlight.y}}else{attrs={x1:origin.x,y1:origin.y,x2:destination.x,y2:destination.y}}attrs.gradientUnits="userSpaceOnUse";gradientNode=createElement((radial?"radial":"linear")+"Gradient",attrs);var stops=gradient._stops;for(var i=0,l=stops.length;i<l;i++){var stop=stops[i],stopColor=stop._color,alpha=stopColor.getAlpha();attrs={offset:stop._rampPoint,"stop-color":stopColor.toCSS(true)};if(alpha<1)attrs["stop-opacity"]=alpha;gradientNode.appendChild(createElement("stop",attrs))}setDefinition(color,gradientNode,"color")}return"url(#"+gradientNode.id+")"}function exportText(item){var node=createElement("text",getTransform(item._matrix,true));node.textContent=item._content;return node}var exporters={Group:exportGroup,Layer:exportGroup,Raster:exportRaster,Path:exportPath,Shape:exportShape,CompoundPath:exportCompoundPath,PlacedSymbol:exportPlacedSymbol,PointText:exportText};function applyStyle(item,node,isRoot){var attrs={},parent=!isRoot&&item.getParent();if(item._name!=null)attrs.id=item._name;Base.each(SVGStyles,function(entry){var get=entry.get,type=entry.type,value=item[get]();if(entry.exportFilter?entry.exportFilter(item,value):!parent||!Base.equals(parent[get](),value)){if(type==="color"&&value!=null){var alpha=value.getAlpha();if(alpha<1)attrs[entry.attribute+"-opacity"]=alpha}attrs[entry.attribute]=value==null?"none":type==="number"?formatter.number(value):type==="color"?value.gradient?exportGradient(value,item):value.toCSS(true):type==="array"?value.join(","):type==="lookup"?entry.toSVG[value]:value}});if(attrs.opacity===1)delete attrs.opacity;if(!item._visible)attrs.visibility="hidden";return setAttributes(node,attrs)}var definitions;function getDefinition(item,type){if(!definitions)definitions={ids:{},svgs:{}};return item&&definitions.svgs[type+"-"+item._id]}function setDefinition(item,node,type){if(!definitions)getDefinition();var id=definitions.ids[type]=(definitions.ids[type]||0)+1;node.id=type+"-"+id;definitions.svgs[type+"-"+item._id]=node}function exportDefinitions(node,options){var svg=node,defs=null;if(definitions){svg=node.nodeName.toLowerCase()==="svg"&&node;for(var i in definitions.svgs){if(!defs){if(!svg){svg=createElement("svg");svg.appendChild(node);

}defs=svg.insertBefore(createElement("defs"),svg.firstChild)}defs.appendChild(definitions.svgs[i])}definitions=null}return options.asString?(new XMLSerializer).serializeToString(svg):svg}function exportSVG(item,options,isRoot){var exporter=exporters[item._class],node=exporter&&exporter(item,options);if(node){var onExport=options.onExport;if(onExport)node=onExport(item,node,options)||node;var data=JSON.stringify(item._data);if(data&&data!=="{}"&&data!=="null")node.setAttribute("data-paper-data",data)}return node&&applyStyle(item,node,isRoot)}function setOptions(options){if(!options)options={};formatter=new Formatter(options.precision);return options}Item.inject({exportSVG:function(options){options=setOptions(options);return exportDefinitions(exportSVG(this,options,true),options)}});Project.inject({exportSVG:function(options){options=setOptions(options);var layers=this.layers,view=this.getView(),size=view.getViewSize(),node=createElement("svg",{x:0,y:0,width:size.width,height:size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),parent=node,matrix=view._matrix;if(!matrix.isIdentity())parent=node.appendChild(createElement("g",getTransform(matrix)));for(var i=0,l=layers.length;i<l;i++)parent.appendChild(exportSVG(layers[i],options,true));return exportDefinitions(node,options)}})};new function(){function getValue(node,name,isString,allowNull){var namespace=SVGNamespaces[name],value=namespace?node.getAttributeNS(namespace,name):node.getAttribute(name);if(value==="null")value=null;return value==null?allowNull?null:isString?"":0:isString?value:parseFloat(value)}function getPoint(node,x,y,allowNull){x=getValue(node,x,false,allowNull);y=getValue(node,y,false,allowNull);return allowNull&&(x==null||y==null)?null:new Point(x,y)}function getSize(node,w,h,allowNull){w=getValue(node,w,false,allowNull);h=getValue(node,h,false,allowNull);return allowNull&&(w==null||h==null)?null:new Size(w,h)}function convertValue(value,type,lookup){return value==="none"?null:type==="number"?parseFloat(value):type==="array"?value?value.split(/[\s,]+/g).map(parseFloat):[]:type==="color"?getDefinition(value)||value:type==="lookup"?lookup[value]:value}function importGroup(node,type,options,isRoot){var nodes=node.childNodes,isClip=type==="clippath",item=new Group,project=item._project,currentStyle=project._currentStyle,children=[];if(!isClip){item=applyAttributes(item,node,isRoot);project._currentStyle=item._style.clone()}if(isRoot){var defs=node.querySelectorAll("defs");for(var i=0,l=defs.length;i<l;i++){importSVG(defs[i],options,false)}}for(var i=0,l=nodes.length;i<l;i++){var childNode=nodes[i],child;if(childNode.nodeType===1&&childNode.nodeName.toLowerCase()!=="defs"&&(child=importSVG(childNode,options,false))&&!(child instanceof Symbol))children.push(child)}item.addChildren(children);if(isClip)item=applyAttributes(item.reduce(),node,isRoot);project._currentStyle=currentStyle;if(isClip||type==="defs"){item.remove();item=null}return item}function importPoly(node,type){var coords=node.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),points=[];for(var i=0,l=coords.length;i<l;i+=2)points.push(new Point(parseFloat(coords[i]),parseFloat(coords[i+1])));var path=new Path(points);if(type==="polygon")path.closePath();return path}function importPath(node){var data=node.getAttribute("d"),param={pathData:data};return(data.match(/m/gi)||[]).length>1||/z\S+/i.test(data)?new CompoundPath(param):new Path(param)}function importGradient(node,type){var id=(getValue(node,"href",true)||"").substring(1),isRadial=type==="radialgradient",gradient;if(id){gradient=definitions[id].getGradient()}else{var nodes=node.childNodes,stops=[];for(var i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(child.nodeType===1)stops.push(applyAttributes(new GradientStop,child))}gradient=new Gradient(stops,isRadial)}var origin,destination,highlight;if(isRadial){origin=getPoint(node,"cx","cy");destination=origin.add(getValue(node,"r"),0);highlight=getPoint(node,"fx","fy",true)}else{origin=getPoint(node,"x1","y1");destination=getPoint(node,"x2","y2")}applyAttributes(new Color(gradient,origin,destination,highlight),node);return null}var importers={"#document":function(node,type,options,isRoot){var nodes=node.childNodes;for(var i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(child.nodeType===1){var next=child.nextSibling;document.body.appendChild(child);var item=importSVG(child,options,isRoot);if(next){node.insertBefore(child,next)}else{node.appendChild(child)}return item}}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:importPath,lineargradient:importGradient,radialgradient:importGradient,image:function(node){var raster=new Raster(getValue(node,"href",true));raster.on("load",function(){var size=getSize(node,"width","height");this.setSize(size);var center=this._matrix._transformPoint(getPoint(node,"x","y").add(size.divide(2)));this.translate(center)});return raster},symbol:function(node,type,options,isRoot){return new Symbol(importGroup(node,type,options,isRoot),true)},defs:importGroup,use:function(node){var id=(getValue(node,"href",true)||"").substring(1),definition=definitions[id],point=getPoint(node,"x","y");return definition?definition instanceof Symbol?definition.place(point):definition.clone().translate(point):null},circle:function(node){return new Shape.Circle(getPoint(node,"cx","cy"),getValue(node,"r"))},ellipse:function(node){return new Shape.Ellipse({center:getPoint(node,"cx","cy"),radius:getSize(node,"rx","ry")})},rect:function(node){var point=getPoint(node,"x","y"),size=getSize(node,"width","height"),radius=getSize(node,"rx","ry");return new Shape.Rectangle(new Rectangle(point,size),radius)},line:function(node){return new Path.Line(getPoint(node,"x1","y1"),getPoint(node,"x2","y2"))},text:function(node){var text=new PointText(getPoint(node,"x","y").add(getPoint(node,"dx","dy")));text.setContent(node.textContent.trim()||"");return text}};function applyTransform(item,value,name,node){var transforms=(node.getAttribute(name)||"").split(/\)\s*/g),matrix=new Matrix;for(var i=0,l=transforms.length;i<l;i++){var transform=transforms[i];if(!transform)break;var parts=transform.split(/\(\s*/),command=parts[0],v=parts[1].split(/[\s,]+/g);for(var j=0,m=v.length;j<m;j++)v[j]=parseFloat(v[j]);switch(command){case"matrix":matrix.concatenate(new Matrix(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"rotate":matrix.rotate(v[0],v[1],v[2]);break;case"translate":matrix.translate(v[0],v[1]);break;case"scale":matrix.scale(v);break;case"skewX":matrix.skew(v[0],0);break;case"skewY":matrix.skew(0,v[0]);break}}item.transform(matrix)}function applyOpacity(item,value,name){var color=item[name==="fill-opacity"?"getFillColor":"getStrokeColor"]();if(color)color.setAlpha(parseFloat(value))}var attributes=Base.set(Base.each(SVGStyles,function(entry){this[entry.attribute]=function(item,value){item[entry.set](convertValue(value,entry.type,entry.fromSVG));if(entry.type==="color"&&item instanceof Shape){var color=item[entry.get]();if(color)color.transform((new Matrix).translate(item.getPosition(true).negate()))}}},{}),{id:function(item,value){definitions[value]=item;if(item.setName)item.setName(value)},"clip-path":function(item,value){var clip=getDefinition(value);if(clip){clip=clip.clone();clip.setClipMask(true);if(item instanceof Group){item.insertChild(0,clip)}else{return new Group(clip,item)}}},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(item,value){item.setVisible(value==="visible")},display:function(item,value){item.setVisible(value!==null)},"stop-color":function(item,value){if(item.setColor)item.setColor(value)},"stop-opacity":function(item,value){if(item._color)item._color.setAlpha(parseFloat(value))},offset:function(item,value){var percentage=value.match(/(.*)%$/);item.setRampPoint(percentage?percentage[1]/100:parseFloat(value))},viewBox:function(item,value,name,node,styles){var rect=new Rectangle(convertValue(value,"array")),size=getSize(node,"width","height",true);if(item instanceof Group){var scale=size?rect.getSize().divide(size):1,matrix=(new Matrix).translate(rect.getPoint()).scale(scale);item.transform(matrix.inverted())}else if(item instanceof Symbol){if(size)rect.setSize(size);var clip=getAttribute(node,"overflow",styles)!="visible",group=item._definition;if(clip&&!rect.contains(group.getBounds())){clip=new Shape.Rectangle(rect).transform(group._matrix);clip.setClipMask(true);group.addChild(clip)}}}});function getAttribute(node,name,styles){var attr=node.attributes[name],value=attr&&attr.value;if(!value){var style=Base.camelize(name);value=node.style[style];if(!value&&styles.node[style]!==styles.parent[style])value=styles.node[style]}return!value?undefined:value==="none"?null:value}function applyAttributes(item,node,isRoot){var styles={node:DomElement.getStyles(node)||{},parent:!isRoot&&DomElement.getStyles(node.parentNode)||{}};Base.each(attributes,function(apply,name){var value=getAttribute(node,name,styles);if(value!==undefined)item=Base.pick(apply(item,value,name,node,styles),item)});return item}var definitions={};function getDefinition(value){var match=value&&value.match(/\((?:#|)([^)']+)/);return match&&definitions[match[1]]}function importSVG(source,options,isRoot){if(!source)return null;if(!options){options={}}else if(typeof options==="function"){options={onLoad:options}}var node=source,scope=paper;function onLoadCallback(svg){paper=scope;var item=importSVG(svg,options,isRoot),onLoad=options.onLoad,view=scope.project&&scope.getView();if(onLoad)onLoad.call(this,item);view.update()}if(isRoot){if(typeof source==="string"&&!/^.*</.test(source)){node=document.getElementById(source);if(node){source=null}else{return Http.request("get",source,onLoadCallback)}}else if(typeof File!=="undefined"&&source instanceof File){var reader=new FileReader;reader.onload=function(){onLoadCallback(reader.result)};return reader.readAsText(source)}}if(typeof source==="string")node=(new DOMParser).parseFromString(source,"image/svg+xml");if(!node.nodeName)throw new Error("Unsupported SVG source: "+source);var type=node.nodeName.toLowerCase(),importer=importers[type],item,data=node.getAttribute&&node.getAttribute("data-paper-data"),settings=scope.settings,applyMatrix=settings.applyMatrix;settings.applyMatrix=false;item=importer&&importer(node,type,options,isRoot)||null;settings.applyMatrix=applyMatrix;if(item){if(type!=="#document"&&!(item instanceof Group))item=applyAttributes(item,node,isRoot);var onImport=options.onImport;if(onImport)item=onImport(node,item,options)||item;if(options.expandShapes&&item instanceof Shape){item.remove();item=item.toPath()}if(data)item._data=JSON.parse(data)}if(isRoot){definitions={};if(item&&Base.pick(options.applyMatrix,applyMatrix))item.matrix.apply(true,true)}return item}Item.inject({importSVG:function(node,options){return this.addChild(importSVG(node,options,true))}});Project.inject({importSVG:function(node,options){this.activate();return importSVG(node,options,true)}})};Base.exports.PaperScript=function(){var exports,define,scope=this;!function(e,r){return"object"==typeof exports&&"object"==typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(r(e.acorn||(e.acorn={})),void 0)}(this,function(e){"use strict";function r(e){fr=e||{};for(var r in mr)Object.prototype.hasOwnProperty.call(fr,r)||(fr[r]=mr[r]);hr=fr.sourceFile||null}function t(e,r){var t=vr(dr,e);r+=" ("+t.line+":"+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=br,n}function n(e){function r(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var r=0;r<e.length;++r)t+="case "+JSON.stringify(e[r])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var a=0;a<e.length;++a){for(var o=0;o<n.length;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(n.length>3){n.sort(function(e,r){return r.length-e.length}),t+="switch(str.length){";for(var a=0;a<n.length;++a){var i=n[a];t+="case "+i[0].length+":",r(i)}t+="}"}else r(e);return new Function("str",t)}function a(){this.line=Ar,this.column=br-Sr}function o(){Ar=1,br=Sr=0,Er=!0,u()}function i(e,r){gr=br,fr.locations&&(kr=new a),wr=e,u(),Cr=r,Er=e.beforeExpr}function s(){var e=fr.onComment&&fr.locations&&new a,r=br,n=dr.indexOf("*/",br+=2);if(-1===n&&t(br-2,"Unterminated comment"),br=n+2,fr.locations){Kt.lastIndex=r;for(var o;(o=Kt.exec(dr))&&o.index<br;)++Ar,Sr=o.index+o[0].length}fr.onComment&&fr.onComment(!0,dr.slice(r+2,n),r,br,e,fr.locations&&new a)}function c(){for(var e=br,r=fr.onComment&&fr.locations&&new a,t=dr.charCodeAt(br+=2);pr>br&&10!==t&&13!==t&&8232!==t&&8233!==t;)++br,t=dr.charCodeAt(br);fr.onComment&&fr.onComment(!1,dr.slice(e+2,br),e,br,r,fr.locations&&new a)}function u(){for(;pr>br;){var e=dr.charCodeAt(br);if(32===e)++br;else if(13===e){++br;var r=dr.charCodeAt(br);10===r&&++br,fr.locations&&(++Ar,Sr=br)}else if(10===e||8232===e||8233===e)++br,fr.locations&&(++Ar,Sr=br);else if(e>8&&14>e)++br;else if(47===e){var r=dr.charCodeAt(br+1);if(42===r)s();else{if(47!==r)break;c()}}else if(160===e)++br;else{if(!(e>=5760&&Jt.test(String.fromCharCode(e))))break;++br}}}function l(){var e=dr.charCodeAt(br+1);return e>=48&&57>=e?E(!0):(++br,i(xt))}function f(){var e=dr.charCodeAt(br+1);return Er?(++br,k()):61===e?x(Et,2):x(wt,1)}function d(){var e=dr.charCodeAt(br+1);return 61===e?x(Et,2):x(Dt,1)}function p(e){var r=dr.charCodeAt(br+1);return r===e?x(124===e?Lt:Ut,2):61===r?x(Et,2):x(124===e?Rt:Tt,1)}function h(){var e=dr.charCodeAt(br+1);return 61===e?x(Et,2):x(Vt,1)}function m(e){var r=dr.charCodeAt(br+1);return r===e?45==r&&62==dr.charCodeAt(br+2)&&Gt.test(dr.slice(Lr,br))?(br+=3,c(),u(),g()):x(St,2):61===r?x(Et,2):x(At,1)}function v(e){var r=dr.charCodeAt(br+1),t=1;return r===e?(t=62===e&&62===dr.charCodeAt(br+2)?3:2,61===dr.charCodeAt(br+t)?x(Et,t+1):x(jt,t)):33==r&&60==e&&45==dr.charCodeAt(br+2)&&45==dr.charCodeAt(br+3)?(br+=4,c(),u(),g()):(61===r&&(t=61===dr.charCodeAt(br+2)?3:2),x(Ot,t))}function b(e){var r=dr.charCodeAt(br+1);return 61===r?x(qt,61===dr.charCodeAt(br+2)?3:2):x(61===e?Ct:It,1)}function y(e){switch(e){case 46:return l();case 40:return++br,i(mt);case 41:return++br,i(vt);case 59:return++br,i(yt);case 44:return++br,i(bt);case 91:return++br,i(ft);case 93:return++br,i(dt);case 123:return++br,i(pt);case 125:return++br,i(ht);case 58:return++br,i(gt);case 63:return++br,i(kt);case 48:var r=dr.charCodeAt(br+1);if(120===r||88===r)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:return A(e);case 47:return f(e);case 37:case 42:return d();case 124:case 38:return p(e);case 94:return h();case 43:case 45:return m(e);case 60:case 62:return v(e);case 61:case 33:return b(e);case 126:return x(It,1)}return!1}function g(e){if(e?br=yr+1:yr=br,fr.locations&&(xr=new a),e)return k();if(br>=pr)return i(Br);var r=dr.charCodeAt(br);if(Qt(r)||92===r)return L();var n=y(r);if(n===!1){var o=String.fromCharCode(r);if("\\"===o||$t.test(o))return L();t(br,"Unexpected character '"+o+"'")}return n}function x(e,r){var t=dr.slice(br,br+r);br+=r,i(e,t)}function k(){for(var e,r,n="",a=br;;){br>=pr&&t(a,"Unterminated regular expression");var o=dr.charAt(br);if(Gt.test(o)&&t(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++br}var n=dr.slice(a,br);++br;var s=I();return s&&!/^[gmsiy]*$/.test(s)&&t(a,"Invalid regexp flag"),i(jr,new RegExp(n,s))}function w(e,r){for(var t=br,n=0,a=0,o=null==r?1/0:r;o>a;++a){var i,s=dr.charCodeAt(br);if(i=s>=97?s-97+10:s>=65?s-65+10:s>=48&&57>=s?s-48:1/0,i>=e)break;++br,n=n*e+i}return br===t||null!=r&&br-t!==r?null:n}function C(){br+=2;var e=w(16);return null==e&&t(yr+2,"Expected hexadecimal number"),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number"),i(Or,e)}function E(e){var r=br,n=!1,a=48===dr.charCodeAt(br);e||null!==w(10)||t(r,"Invalid number"),46===dr.charCodeAt(br)&&(++br,w(10),n=!0);var o=dr.charCodeAt(br);(69===o||101===o)&&(o=dr.charCodeAt(++br),(43===o||45===o)&&++br,null===w(10)&&t(r,"Invalid number"),n=!0),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number");var s,c=dr.slice(r,br);return n?s=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||Tr?t(r,"Invalid number"):s=parseInt(c,8):s=parseInt(c,10),i(Or,s)}function A(e){br++;for(var r="";;){br>=pr&&t(yr,"Unterminated string constant");var n=dr.charCodeAt(br);if(n===e)return++br,i(Dr,r);if(92===n){n=dr.charCodeAt(++br);var a=/^[0-7]+/.exec(dr.slice(br,br+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,a.length-1);if("0"===a&&(a=null),++br,a)Tr&&t(br-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),br+=a.length-1;else switch(n){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(S(2));break;case 117:r+=String.fromCharCode(S(4));break;case 85:r+=String.fromCharCode(S(8));break;case 116:r+="	";break;case 98:r+="\b";break;case 118:r+="";break;case 102:r+="\f";break;case 48:r+="\x00";break;case 13:10===dr.charCodeAt(br)&&++br;case 10:fr.locations&&(Sr=br,++Ar);break;default:r+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8233===n)&&t(yr,"Unterminated string constant"),r+=String.fromCharCode(n),++br}}function S(e){var r=w(16,e);return null===r&&t(yr,"Bad character escape sequence"),r}function I(){Bt=!1;for(var e,r=!0,n=br;;){var a=dr.charCodeAt(br);if(Yt(a))Bt&&(e+=dr.charAt(br)),++br;else{if(92!==a)break;Bt||(e=dr.slice(n,br)),Bt=!0,117!=dr.charCodeAt(++br)&&t(br,"Expecting Unicode escape sequence \\uXXXX"),++br;var o=S(4),i=String.fromCharCode(o);i||t(br-1,"Invalid Unicode escape"),(r?Qt(o):Yt(o))||t(br-4,"Invalid Unicode escape"),e+=i}r=!1}return Bt?e:dr.slice(n,br)}function L(){var e=I(),r=Fr;return Bt||(Wt(e)?r=lt[e]:(fr.forbidReserved&&(3===fr.ecmaVersion?Mt:zt)(e)||Tr&&Xt(e))&&t(yr,"The keyword '"+e+"' is reserved")),i(r,e)}function U(){Ir=yr,Lr=gr,Ur=kr,g()}function R(e){if(Tr=e,br=Lr,fr.locations)for(;Sr>br;)Sr=dr.lastIndexOf("\n",Sr-2)+1,--Ar;u(),g()}function V(){this.type=null,this.start=yr,this.end=null}function T(){this.start=xr,this.end=null,null!==hr&&(this.source=hr)}function q(){var e=new V;return fr.locations&&(e.loc=new T),fr.ranges&&(e.range=[yr,0]),e}function O(e){var r=new V;return r.start=e.start,fr.locations&&(r.loc=new T,r.loc.start=e.loc.start),fr.ranges&&(r.range=[e.range[0],0]),r}function j(e,r){return e.type=r,e.end=Lr,fr.locations&&(e.loc.end=Ur),fr.ranges&&(e.range[1]=Lr),e}function D(e){return fr.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function F(e){return wr===e?(U(),!0):void 0}function B(){return!fr.strictSemicolons&&(wr===Br||wr===ht||Gt.test(dr.slice(Lr,yr)))}function M(){F(yt)||B()||X()}function z(e){wr===e?U():X()}function X(){t(yr,"Unexpected token")}function N(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&t(e.start,"Assigning to rvalue"),Tr&&"Identifier"===e.type&&Nt(e.name)&&t(e.start,"Assigning to "+e.name+" in strict mode")}function W(e){Ir=Lr=br,fr.locations&&(Ur=new a),Rr=Tr=null,Vr=[],g();var r=e||q(),t=!0;for(e||(r.body=[]);wr!==Br;){var n=J();r.body.push(n),t&&D(n)&&R(!0),t=!1}return j(r,"Program")}function J(){(wr===wt||wr===Et&&"/="==Cr)&&g(!0);var e=wr,r=q();switch(e){case Mr:case Nr:U();var n=e===Mr;F(yt)||B()?r.label=null:wr!==Fr?X():(r.label=lr(),M());for(var a=0;a<Vr.length;++a){var o=Vr[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}}return a===Vr.length&&t(r.start,"Unsyntactic "+e.keyword),j(r,n?"BreakStatement":"ContinueStatement");case Wr:return U(),M(),j(r,"DebuggerStatement");case Pr:return U(),Vr.push(Zt),r.body=J(),Vr.pop(),z(tt),r.test=P(),M(),j(r,"DoWhileStatement");case _r:if(U(),Vr.push(Zt),z(mt),wr===yt)return $(r,null);if(wr===rt){var i=q();return U(),G(i,!0),j(i,"VariableDeclaration"),1===i.declarations.length&&F(ut)?_(r,i):$(r,i)}var i=K(!1,!0);return F(ut)?(N(i),_(r,i)):$(r,i);case Gr:return U(),cr(r,!0);case Kr:return U(),r.test=P(),r.consequent=J(),r.alternate=F(Hr)?J():null,j(r,"IfStatement");case Qr:return Rr||t(yr,"'return' outside of function"),U(),F(yt)||B()?r.argument=null:(r.argument=K(),M()),j(r,"ReturnStatement");case Yr:U(),r.discriminant=P(),r.cases=[],z(pt),Vr.push(en);for(var s,c;wr!=ht;)if(wr===zr||wr===Jr){var u=wr===zr;s&&j(s,"SwitchCase"),r.cases.push(s=q()),s.consequent=[],U(),u?s.test=K():(c&&t(Ir,"Multiple default clauses"),c=!0,s.test=null),z(gt)}else s||X(),s.consequent.push(J());return s&&j(s,"SwitchCase"),U(),Vr.pop(),j(r,"SwitchStatement");case Zr:return U(),Gt.test(dr.slice(Lr,yr))&&t(Lr,"Illegal newline after throw"),r.argument=K(),M(),j(r,"ThrowStatement");case et:if(U(),r.block=H(),r.handler=null,wr===Xr){var l=q();U(),z(mt),l.param=lr(),Tr&&Nt(l.param.name)&&t(l.param.start,"Binding "+l.param.name+" in strict mode"),z(vt),l.guard=null,l.body=H(),r.handler=j(l,"CatchClause")}return r.guardedHandlers=qr,r.finalizer=F($r)?H():null,r.handler||r.finalizer||t(r.start,"Missing catch or finally clause"),j(r,"TryStatement");case rt:return U(),G(r),M(),j(r,"VariableDeclaration");case tt:return U(),r.test=P(),Vr.push(Zt),r.body=J(),Vr.pop(),j(r,"WhileStatement");case nt:return Tr&&t(yr,"'with' in strict mode"),U(),r.object=P(),r.body=J(),j(r,"WithStatement");case pt:return H();case yt:return U(),j(r,"EmptyStatement");default:var f=Cr,d=K();if(e===Fr&&"Identifier"===d.type&&F(gt)){for(var a=0;a<Vr.length;++a)Vr[a].name===f&&t(d.start,"Label '"+f+"' is already declared");var p=wr.isLoop?"loop":wr===Yr?"switch":null;return Vr.push({name:f,kind:p}),r.body=J(),Vr.pop(),r.label=d,j(r,"LabeledStatement")}return r.expression=d,M(),j(r,"ExpressionStatement")}}function P(){z(mt);var e=K();return z(vt),e}function H(e){var r,t=q(),n=!0,a=!1;for(t.body=[],z(pt);!F(ht);){var o=J();t.body.push(o),n&&e&&D(o)&&(r=a,R(a=!0)),n=!1}return a&&!r&&R(!1),j(t,"BlockStatement")}function $(e,r){return e.init=r,z(yt),e.test=wr===yt?null:K(),z(yt),e.update=wr===vt?null:K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForStatement")}function _(e,r){return e.left=r,e.right=K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForInStatement")}function G(e,r){for(e.declarations=[],e.kind="var";;){var n=q();if(n.id=lr(),Tr&&Nt(n.id.name)&&t(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=F(Ct)?K(!0,r):null,e.declarations.push(j(n,"VariableDeclarator")),!F(bt))break}return e}function K(e,r){var t=Q(r);if(!e&&wr===bt){var n=O(t);for(n.expressions=[t];F(bt);)n.expressions.push(Q(r));return j(n,"SequenceExpression")}return t}function Q(e){var r=Y(e);if(wr.isAssign){var t=O(r);return t.operator=Cr,t.left=r,U(),t.right=Q(e),N(r),j(t,"AssignmentExpression")}return r}function Y(e){var r=Z(e);if(F(kt)){var t=O(r);return t.test=r,t.consequent=K(!0),z(gt),t.alternate=K(!0,e),j(t,"ConditionalExpression")}return r}function Z(e){return er(rr(),-1,e)}function er(e,r,t){var n=wr.binop;if(null!=n&&(!t||wr!==ut)&&n>r){var a=O(e);a.left=e,a.operator=Cr,U(),a.right=er(rr(),n,t);var o=j(a,/&&|\|\|/.test(a.operator)?"LogicalExpression":"BinaryExpression");return er(o,r,t)}return e}function rr(){if(wr.prefix){var e=q(),r=wr.isUpdate;return e.operator=Cr,e.prefix=!0,Er=!0,U(),e.argument=rr(),r?N(e.argument):Tr&&"delete"===e.operator&&"Identifier"===e.argument.type&&t(e.start,"Deleting local variable in strict mode"),j(e,r?"UpdateExpression":"UnaryExpression")}for(var n=tr();wr.postfix&&!B();){var e=O(n);e.operator=Cr,e.prefix=!1,e.argument=n,N(n),U(),n=j(e,"UpdateExpression")}return n}function tr(){return nr(ar())}function nr(e,r){if(F(xt)){var t=O(e);return t.object=e,t.property=lr(!0),t.computed=!1,nr(j(t,"MemberExpression"),r)}if(F(ft)){var t=O(e);return t.object=e,t.property=K(),t.computed=!0,z(dt),nr(j(t,"MemberExpression"),r)}if(!r&&F(mt)){var t=O(e);return t.callee=e,t.arguments=ur(vt,!1),nr(j(t,"CallExpression"),r)}return e}function ar(){switch(wr){case ot:var e=q();return U(),j(e,"ThisExpression");case Fr:return lr();case Or:case Dr:case jr:var e=q();return e.value=Cr,e.raw=dr.slice(yr,gr),U(),j(e,"Literal");case it:case st:case ct:var e=q();return e.value=wr.atomValue,e.raw=wr.keyword,U(),j(e,"Literal");case mt:var r=xr,t=yr;U();var n=K();return n.start=t,n.end=gr,fr.locations&&(n.loc.start=r,n.loc.end=kr),fr.ranges&&(n.range=[t,gr]),z(vt),n;case ft:var e=q();return U(),e.elements=ur(dt,!0,!0),j(e,"ArrayExpression");case pt:return ir();case Gr:var e=q();return U(),cr(e,!1);case at:return or();default:X()}}function or(){var e=q();return U(),e.callee=nr(ar(),!0),e.arguments=F(mt)?ur(vt,!1):qr,j(e,"NewExpression")}function ir(){var e=q(),r=!0,n=!1;for(e.properties=[],U();!F(ht);){if(r)r=!1;else if(z(bt),fr.allowTrailingCommas&&F(ht))break;var a,o={key:sr()},i=!1;if(F(gt)?(o.value=K(!0),a=o.kind="init"):fr.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=sr(),wr!==mt&&X(),o.value=cr(q(),!1)):X(),"Identifier"===o.key.type&&(Tr||n))for(var s=0;s<e.properties.length;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!Tr&&"init"===a&&"init"===c.kind&&(u=!1),u&&t(o.key.start,"Redefinition of property")}}e.properties.push(o)}return j(e,"ObjectExpression")}function sr(){return wr===Or||wr===Dr?ar():lr(!0)}function cr(e,r){wr===Fr?e.id=lr():r?X():e.id=null,e.params=[];var n=!0;for(z(mt);!F(vt);)n?n=!1:z(bt),e.params.push(lr());var a=Rr,o=Vr;if(Rr=!0,Vr=[],e.body=H(!0),Rr=a,Vr=o,Tr||e.body.body.length&&D(e.body.body[0]))for(var i=e.id?-1:0;i<e.params.length;++i){var s=0>i?e.id:e.params[i];if((Xt(s.name)||Nt(s.name))&&t(s.start,"Defining '"+s.name+"' in strict mode"),i>=0)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,"Argument name clash in strict mode")}return j(e,r?"FunctionDeclaration":"FunctionExpression")}function ur(e,r,t){for(var n=[],a=!0;!F(e);){if(a)a=!1;else if(z(bt),r&&fr.allowTrailingCommas&&F(e))break;t&&wr===bt?n.push(null):n.push(K(!0))}return n}function lr(e){var r=q();return r.name=wr===Fr?Cr:e&&!fr.forbidReserved&&wr.keyword||X(),Er=!1,U(),j(r,"Identifier")}e.version="0.4.0";var fr,dr,pr,hr;e.parse=function(e,t){return dr=String(e),pr=dr.length,r(t),o(),W(fr.program)};var mr=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Kt.lastIndex=n;var a=Kt.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return g(e),a.start=yr,a.end=gr,a.startLoc=xr,a.endLoc=kr,a.type=wr,a.value=Cr,a}dr=String(e),pr=dr.length,r(t),o();var a={};return n.jumpTo=function(e,r){if(br=e,fr.locations){Ar=1,Sr=Kt.lastIndex=0;for(var t;(t=Kt.exec(dr))&&t.index<e;)++Ar,Sr=t.index+t[0].length}Er=r,u()},n};var br,yr,gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Vr,Tr,qr=[],Or={type:"num"},jr={type:"regexp"},Dr={type:"string"},Fr={type:"name"},Br={type:"eof"},Mr={keyword:"break"},zr={keyword:"case",beforeExpr:!0},Xr={keyword:"catch"},Nr={keyword:"continue"},Wr={keyword:"debugger"},Jr={keyword:"default"},Pr={keyword:"do",isLoop:!0},Hr={keyword:"else",beforeExpr:!0},$r={keyword:"finally"},_r={keyword:"for",isLoop:!0},Gr={keyword:"function"},Kr={keyword:"if"},Qr={keyword:"return",beforeExpr:!0},Yr={keyword:"switch"},Zr={keyword:"throw",beforeExpr:!0},et={keyword:"try"},rt={keyword:"var"},tt={keyword:"while",isLoop:!0},nt={keyword:"with"},at={keyword:"new",beforeExpr:!0},ot={keyword:"this"},it={keyword:"null",atomValue:null},st={keyword:"true",atomValue:!0},ct={keyword:"false",atomValue:!1},ut={keyword:"in",binop:7,beforeExpr:!0},lt={"break":Mr,"case":zr,"catch":Xr,"continue":Nr,"debugger":Wr,"default":Jr,"do":Pr,"else":Hr,"finally":$r,"for":_r,"function":Gr,"if":Kr,"return":Qr,"switch":Yr,"throw":Zr,"try":et,"var":rt,"while":tt,"with":nt,"null":it,"true":st,"false":ct,"new":at,"in":ut,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":ot,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},ft={type:"[",beforeExpr:!0},dt={type:"]"},pt={type:"{",beforeExpr:!0},ht={type:"}"},mt={type:"(",beforeExpr:!0},vt={type:")"},bt={type:",",beforeExpr:!0},yt={type:";",beforeExpr:!0},gt={type:":",beforeExpr:!0},xt={type:"."},kt={type:"?",beforeExpr:!0},wt={binop:10,beforeExpr:!0},Ct={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},St={postfix:!0,prefix:!0,isUpdate:!0},It={prefix:!0,beforeExpr:!0},Lt={binop:1,beforeExpr:!0},Ut={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},Vt={binop:4,beforeExpr:!0},Tt={binop:5,beforeExpr:!0},qt={binop:6,beforeExpr:!0},Ot={binop:7,beforeExpr:!0},jt={binop:8,beforeExpr:!0},Dt={binop:10,beforeExpr:!0};e.tokTypes={bracketL:ft,bracketR:dt,braceL:pt,braceR:ht,parenL:mt,parenR:vt,comma:bt,semi:yt,colon:gt,dot:xt,question:kt,slash:wt,eq:Ct,name:Fr,eof:Br,num:Or,regexp:jr,string:Dr};for(var Ft in lt)e.tokTypes["_"+Ft]=lt[Ft];var Bt,Mt=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=n("class enum extends super const export import"),Xt=n("implements interface let package private protected public static yield"),Nt=n("eval arguments"),Wt=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Jt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Pt="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",Ht="\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",$t=new RegExp("["+Pt+"]"),_t=new RegExp("["+Pt+Ht+"]"),Gt=/[\n\r\u2028\u2029]/,Kt=/\r\n|[\n\r\u2028\u2029]/g,Qt=e.isIdentifierStart=function(e){
return 65>e?36===e:91>e?!0:97>e?95===e:123>e?!0:e>=170&&$t.test(String.fromCharCode(e))},Yt=e.isIdentifierChar=function(e){return 48>e?36===e:58>e?!0:65>e?!1:91>e?!0:97>e?95===e:123>e?!0:e>=170&&_t.test(String.fromCharCode(e))},Zt={kind:"loop"},en={kind:"switch"}});var binaryOperators={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"equals","!=":"equals"};var unaryOperators={"-":"__negate","+":null};var fields=Base.each(["add","subtract","multiply","divide","modulo","negate"],function(name){this["__"+name]="#"+name},{});Point.inject(fields);Size.inject(fields);Color.inject(fields);function __$__(left,operator,right){var handler=binaryOperators[operator];if(left&&left[handler]){var res=left[handler](right);return operator==="!="?!res:res}switch(operator){case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right;case"==":return left==right;case"!=":return left!=right}}function $__(operator,value){var handler=unaryOperators[operator];if(handler&&value&&value[handler])return value[handler]();switch(operator){case"+":return+value;case"-":return-value}}function parse(code,options){return scope.acorn.parse(code,options)}function compile(code,url,options){if(!code)return"";options=options||{};url=url||"";var insertions=[];function getOffset(offset){for(var i=0,l=insertions.length;i<l;i++){var insertion=insertions[i];if(insertion[0]>=offset)break;offset+=insertion[1]}return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function getBetween(left,right){return code.substring(getOffset(left.range[1]),getOffset(right.range[0]))}function replaceCode(node,str){var start=getOffset(node.range[0]),end=getOffset(node.range[1]),insert=0;for(var i=insertions.length-1;i>=0;i--){if(start>insertions[i][0]){insert=i+1;break}}insertions.splice(insert,0,[start,str.length-end+start]);code=code.substring(0,start)+str+code.substring(end)}function walkAST(node,parent){if(!node)return;for(var key in node){if(key==="range"||key==="loc")continue;var value=node[key];if(Array.isArray(value)){for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node)}else if(value&&typeof value==="object"){walkAST(value,node)}}switch(node.type){case"UnaryExpression":if(node.operator in unaryOperators&&node.argument.type!=="Literal"){var arg=getCode(node.argument);replaceCode(node,'$__("'+node.operator+'", '+arg+")")}break;case"BinaryExpression":if(node.operator in binaryOperators&&node.left.type!=="Literal"){var left=getCode(node.left),right=getCode(node.right),between=getBetween(node.left,node.right),operator=node.operator;replaceCode(node,"__$__("+left+","+between.replace(new RegExp("\\"+operator),'"'+operator+'"')+", "+right+")")}break;case"UpdateExpression":case"AssignmentExpression":var parentType=parent&&parent.type;if(!(parentType==="ForStatement"||parentType==="BinaryExpression"&&/^[=!<>]/.test(parent.operator)||parentType==="MemberExpression"&&parent.computed)){if(node.type==="UpdateExpression"){var arg=getCode(node.argument),exp="__$__("+arg+', "'+node.operator[0]+'", 1)',str=arg+" = "+exp;if(!node.prefix&&(parentType==="AssignmentExpression"||parentType==="VariableDeclarator")){if(getCode(parent.left||parent.id)===arg)str=exp;str=arg+"; "+str}replaceCode(node,str)}else{if(/^.=$/.test(node.operator)&&node.left.type!=="Literal"){var left=getCode(node.left),right=getCode(node.right);replaceCode(node,left+" = __$__("+left+', "'+node.operator[0]+'", '+right+")")}}}break}}var sourceMap=null,browser=paper.browser,version=browser.versionNumber,lineBreaks=/\r\n|\n|\r/gm;if(browser.chrome&&version>=30||browser.webkit&&version>=537.76||browser.firefox&&version>=23){var offset=0;if(window.location.href.indexOf(url)===0){var html=document.getElementsByTagName("html")[0].innerHTML;offset=html.substr(0,html.indexOf(code)+1).match(lineBreaks).length+1}var mappings=["AAAA"];mappings.length=(code.match(lineBreaks)||[]).length+1+offset;sourceMap={version:3,file:url,names:[],mappings:mappings.join(";AACA"),sourceRoot:"",sources:[url]};var source=options.source||!url&&code;if(source)sourceMap.sourcesContent=[source]}walkAST(parse(code,{ranges:true}));if(sourceMap){code=new Array(offset+1).join("\n")+code+"\n//# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+"\n//# sourceURL="+(url||"paperscript")}return code}function execute(code,scope,url,options){paper=scope;var view=scope.getView(),tool=/\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(code)?new Tool:null,toolHandlers=tool?tool._events:[],handlers=["onFrame","onResize"].concat(toolHandlers),params=[],args=[],func;code=compile(code,url,options);function expose(scope,hidden){for(var key in scope){if((hidden||!/^_/.test(key))&&new RegExp("([\\b\\s\\W]|^)"+key.replace(/\$/g,"\\$")+"\\b").test(code)){params.push(key);args.push(scope[key])}}}expose({__$__:__$__,$__:$__,paper:scope,view:view,tool:tool},true);expose(scope);handlers=Base.each(handlers,function(key){if(new RegExp("\\s+"+key+"\\b").test(code)){params.push(key);this.push(key+": "+key)}},[]).join(", ");if(handlers)code+="\nreturn { "+handlers+" };";var browser=paper.browser;if(browser.chrome||browser.firefox){var script=document.createElement("script"),head=document.head||document.getElementsByTagName("head")[0];if(browser.firefox)code="\n"+code;script.appendChild(document.createTextNode("paper._execute = function("+params+") {"+code+"\n}"));head.appendChild(script);func=paper._execute;delete paper._execute;head.removeChild(script)}else{func=Function(params,code)}var res=func.apply(scope,args)||{};Base.each(toolHandlers,function(key){var value=res[key];if(value)tool[key]=value});if(view){if(res.onResize)view.setOnResize(res.onResize);view.emit("resize",{size:view.size,delta:new Point});if(res.onFrame)view.setOnFrame(res.onFrame);view.update()}}function loadScript(script){if(/^text\/(?:x-|)paperscript$/.test(script.type)&&PaperScope.getAttribute(script,"ignore")!=="true"){var canvasId=PaperScope.getAttribute(script,"canvas"),canvas=document.getElementById(canvasId),src=script.src||script.getAttribute("data-src"),async=PaperScope.hasAttribute(script,"async"),scopeAttribute="data-paper-scope";if(!canvas)throw new Error('Unable to find canvas with id "'+canvasId+'"');var scope=PaperScope.get(canvas.getAttribute(scopeAttribute))||(new PaperScope).setup(canvas);canvas.setAttribute(scopeAttribute,scope._id);if(src){Http.request("get",src,function(code){execute(code,scope,src)},async)}else{execute(script.innerHTML,scope,script.baseURI)}script.setAttribute("data-paper-ignore","true");return scope}}function loadAll(){Base.each(document.getElementsByTagName("script"),loadScript)}function load(script){return script?loadScript(script):loadAll()}if(document.readyState==="complete"){setTimeout(loadAll)}else{DomEvent.add(window,{load:loadAll})}return{compile:compile,execute:execute,load:load,parse:parse}}.call(this);paper=new(PaperScope.inject(Base.exports,{enumerable:true,Base:Base,Numerical:Numerical,Key:Key}));if(typeof define==="function"&&define.amd){define("paper",paper)}else if(typeof module==="object"&&module){module.exports=paper}return paper}},{}],3:[function(require,module,exports){(function(process){if(process.env.npm_package_name==="pseudomap"&&process.env.npm_lifecycle_script==="test")process.env.TEST_PSEUDOMAP="true";if(typeof Map==="function"&&!process.env.TEST_PSEUDOMAP){module.exports=Map}else{module.exports=require("./pseudomap")}}).call(this,require("_process"))},{"./pseudomap":4,_process:306}],4:[function(require,module,exports){var hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=PseudoMap;function PseudoMap(set){if(!(this instanceof PseudoMap))throw new TypeError("Constructor PseudoMap requires 'new'");this.clear();if(set){if(set instanceof PseudoMap||typeof Map==="function"&&set instanceof Map)set.forEach(function(value,key){this.set(key,value)},this);else if(Array.isArray(set))set.forEach(function(kv){this.set(kv[0],kv[1])},this);else throw new TypeError("invalid argument")}}PseudoMap.prototype.forEach=function(fn,thisp){thisp=thisp||this;Object.keys(this._data).forEach(function(k){if(k!=="size")fn.call(thisp,this._data[k].value,this._data[k].key)},this)};PseudoMap.prototype.has=function(k){return!!find(this._data,k)};PseudoMap.prototype.get=function(k){var res=find(this._data,k);return res&&res.value};PseudoMap.prototype.set=function(k,v){set(this._data,k,v)};PseudoMap.prototype.delete=function(k){var res=find(this._data,k);if(res){delete this._data[res._index];this._data.size--}};PseudoMap.prototype.clear=function(){var data=Object.create(null);data.size=0;Object.defineProperty(this,"_data",{value:data,enumerable:false,configurable:true,writable:false})};Object.defineProperty(PseudoMap.prototype,"size",{get:function(){return this._data.size},set:function(n){},enumerable:true,configurable:true});PseudoMap.prototype.values=PseudoMap.prototype.keys=PseudoMap.prototype.entries=function(){throw new Error("iterators are not implemented in this version")};function same(a,b){return a===b||a!==a&&b!==b}function Entry(k,v,i){this.key=k;this.value=v;this._index=i}function find(data,k){for(var i=0,s="_"+k,key=s;hasOwnProperty.call(data,key);key=s+i++){if(same(data[key].key,k))return data[key]}}function set(data,k,v){for(var i=0,s="_"+k,key=s;hasOwnProperty.call(data,key);key=s+i++){if(same(data[key].key,k)){data[key].value=v;return}}data.size++;data[key]=new Entry(k,v,key)}},{}],5:[function(require,module,exports){var paper=require("paper");function createCanvas(element,options){var canvas=document.createElement("canvas");canvas.width=options.width||100;canvas.height=options.height||100;canvas.style.border="1px solid black";element.appendChild(canvas);return canvas}function convertDraw(world,additional){var additional=additional||{};var xyf=_.flatten(_.map(world.features,function(val,y){return _.map(val,function(feat,x){return{feat:feat,pos:[x,y]}})}));var filterHasName=function(ar){return _.filter(ar,function(x){return x.feat.name})};var blocked=_.map(_.filter(xyf,function(x){return x.feat=="#"}),"pos");var terminal=_.map(filterHasName(xyf),"pos");var world2={blockedStates:blocked,terminals:terminal,xLim:world.xLim,yLim:world.yLim};var featureLabels=_.map(filterHasName(xyf),function(a){return{point:a.pos,content:a.feat.name}});var additionalLabels=additional.labels||[];var labels=additionalLabels.concat(featureLabels);var trajectory=additional.trajecotry;return draw(world2,_.extend(additional,{labels:labels}))}var pomConvert=function(world,additional){var trajectory=(additional||{}).trajectory;if(trajectory){var trajectory=_.isArray(trajectory[0])?_.map(trajectory,0):trajectory;var trajectory=_.has(trajectory[0],"manifestState")?_.map(trajectory,"manifestState"):trajectory}var additional=_.extend(additional,{trajectory:trajectory});return convertDraw(world.MDPWorld,additional)};function draw(world,additional){if(world.MDPWorld){return pomConvert(world,additional)}if(world.features){return convertDraw(world,additional)}if(typeof wpEditor==="undefined"){console.log("GridWorld.draw: no wpEditor, not drawing");return}var element=wpEditor.makeResultContainer();var canvas=createCanvas(element,{width:world.xLim*100,height:world.yLim*100});paper.setup(canvas);var color={blocked:"grey",terminal:new paper.Color(.7),agent:"blue"};var position=function(coords){return[coords[0],world.yLim-coords[1]]};var makeSquare=function(c){var rect=new paper.Rectangle([0,0],[1,1]);var path=new paper.Path.Rectangle(rect,0);path.fillColor=c;path.remove();return path};var label=new paper.PointText({fillColor:new paper.Color(.1,.8),fontSize:16,justification:"center"});label.scale(.02);var toHeat=function(v){var mag=Math.min(Math.abs(v)/20,1);if(v>0){return new paper.Color(0,1,0,mag)}else{return new paper.Color(1,0,0,mag)}};var addUtilities=function(v){var group=new paper.Group;group.addChild(new paper.Path.Rectangle([-.5,+.5],[world.xLim,world.yLim]));var lastCoord;for(var i=0;i<v.length;i++){var coord=v[i][0].loc;var LRUD=v[i][1];var LURD=[LRUD[0],LRUD[2],LRUD[1],LRUD[3]];if(!_.isEqual(lastCoord,coord)){for(var j=0;j<4;j++){var tri=triangleSquare(coord,j*90,toHeat(LURD[j]),new paper.Color(.5,.4));group.addChild(tri);var l=makeLabel({point:[coord[0]+.3*Math.cos(-j*Math.PI/2+Math.PI),coord[1]+.3*Math.sin(-j*Math.PI/2+Math.PI)],content:LURD[j].toFixed(1),fontSize:10});group.addChild(l)}}lastCoord=coord}return group};var triangleSquare=function(coord,orientation,color,borderColor){var a=new paper.Path([[-.5,-.5],[0,0],[-.5,+.5]]);var j=orientation;a.closed=true;a.fillColor=color;a.strokeColor=borderColor;a.rotate(orientation);var offsetx=Math.cos(-orientation/90*Math.PI/2+Math.PI);var offsety=Math.sin(-orientation/90*Math.PI/2+Math.PI);a.position=position([coord[0]+offsetx*.25,coord[1]+offsety*.25]);return a};var makeLabel=function(a){var copy=_.extend(label.clone(),a);copy.point=position(a.point);copy.point.y+=copy.bounds.height/3.5;return copy};var makeGrid=function(world){var group=new paper.Group;for(var i=0;i<world.xLim;i++){for(var j=0;j<world.yLim;j++){var grid=new paper.Path.Rectangle([i-.5,j+.5],[1,1]);grid.strokeColor=new paper.Color(.5,.2);grid.fillColor=new paper.Color(1,0);group.addChild(grid)}}return group};var addShapes=function(coords,shape,group){for(var i=0;i<coords.length;i++){var copy=shape.clone();copy.position=position(coords[i]);group.addChild(copy)}};var addAgentPath=function(trajectory,paths,group){var trajectory=_.has(trajectory[0],"loc")?trajectory:_.map(trajectory,0);var coords=_.map(trajectory,"loc");console.log(coords);var agentPath=new paper.Path;agentPath.strokeColor="black";agentPath.strokeWidth=2;agentPath.dashArray=[8,8];group.addChild(agentPath);var agent=new paper.Path.Circle(position(coords[0]),.3);agent.fillColor=color.agent;group.addChild(agent);var pathsGroup=new paper.Group;group.addChild(pathsGroup);var segPerSec=3;var extraAtEnd=1;var lastTime=0;var scale,offsetx,offsety;var active=true;var offsett=0;paper.view.onFrame=function(event){if(scale===undefined){scale=agent.bounds.width/2/.3;offsetx=agent.position.x-position(coords[0])[0]*scale;offsety=agent.position.y-position(coords[0])[1]*scale}var scalePosition=function(v){var x=position(v);return[x[0]*scale+offsetx,x[1]*scale+offsety]};if(active){if(event.time-lastTime>.1){offsett+=event.time-lastTime}lastTime=event.time;var segments=(event.time-offsett)*segPerSec;var frac=segments%1;var idx=Math.floor(Math.min(Math.floor(segments)%(trajectory.length+extraAtEnd),trajectory.length-1));agentPath.remove();var currentLocation;if(idx<trajectory.length-1){currentLocation=[(1-frac)*coords[idx][0]+frac*coords[idx+1][0],(1-frac)*coords[idx][1]+frac*coords[idx+1][1]]}else{currentLocation=coords[idx]}var lodashTake=function(ar,n){return ar.slice(0,n)};var currentPath=lodashTake(coords,idx+1);currentPath.push(currentLocation);if(paths){pathsGroup.remove();pathsGroup=addUtilities(paths[idx]);group.addChild(pathsGroup);pathsGroup.scale(scale);pathsGroup.translate(world.xLim/2*scale,world.yLim/2*scale);var fudgeFactor=33;pathsGroup.translate(-pathsGroup.bounds.topLeft.x+fudgeFactor,-pathsGroup.bounds.topLeft.y);console.log()}agentPath=new paper.Path;agentPath.strokeColor="black";agentPath.strokeWidth=2;agentPath.dashArray=[8,8];group.addChild(agentPath);agentPath.addSegments(_.map(currentPath,scalePosition));agent.position=scalePosition(currentLocation)}};paper.view.on("mousedown",function(event){active=!active})};var axisx=_.map(_.range(world.xLim),function(i){return{point:[i,-.75],content:i}});var axisy=_.map(_.range(world.yLim),function(i){return{point:[-.75,i],content:i}});var makeTerminal=function(coords){var group=new paper.Group;var tri=undefined;for(var i=0;i<4;i++){var gradient={gradient:{stops:[["white",.75],[color.terminal,1]],radial:false},origin:[0,0],destination:[-.5,0]};tri=triangleSquare(coords,i*90,gradient,new paper.Color(0,0));group.addChild(tri)}return group};var group=new paper.Group;addShapes(world.blockedStates,makeSquare(color.blocked),group);var f=_.map(world.terminals,makeTerminal);group.addChildren(f);group.addChild(makeGrid(world));group.addChildren(_.map(axisx,makeLabel));group.addChildren(_.map(axisy,makeLabel));group.addChildren(_.map(world.labels,makeLabel));if(world.labels){group.addChildren(_.map(world.labels,makeLabel))}if(additional){if(additional.actionExpectedUtilities){group.addChild(addUtilities(additional.actionExpectedUtilities))}if(additional.trajectory){addAgentPath(additional.trajectory,additional.dynamicActionExpectedUtilities,group)}if(additional.labels){group.addChildren(_.map(additional.labels,makeLabel))}}group.fitBounds(paper.view.bounds);paper.view.draw()}var printDist=function(x,k){var distValues=_.sortBy(x.support(),function(v){return-x.score(v)});var distValues=typeof k=="undefined"?distValues:distValues.slice(0,k);console.log("vegaPrint Dist:");distValues.map(function(v){var prob=Math.exp(x.score(v));if(prob>0){console.log(JSON.stringify(v)+": "+prob.toFixed(5))}});console.log(" \n")};module.exports={draw:draw,vegaPrint:printDist,print:printDist,bar:printDist,line:printDist}},{paper:2}],6:[function(require,module,exports){var serialize=require("./serialize");var LRU=require("lru-cache");function cache(f,maxSize){var c=LRU(maxSize);var cf=function(s,k,a){var args=Array.prototype.slice.call(arguments,3);var stringedArgs=serialize(args);if(c.has(stringedArgs)){return k(s,c.get(stringedArgs))}else{var newk=function(s,r){if(c.has(stringedArgs)){console.log("Already in cache:",stringedArgs);if(serialize(c.get(stringedArgs))!==serialize(r)){console.log("OLD AND NEW CACHE VALUE DIFFER!");console.log("Old value:",c.get(stringedArgs));console.log("New value:",r)}}c.set(stringedArgs,r);if(!maxSize&&c.length===1e4){console.log(c.length+" function calls have been cached.");console.log("The size of the cache can be limited by calling cache(f, maxSize).")}return k(s,r)};return f.apply(this,[s,newk,a].concat(args))}};return cf}module.exports={cache:cache}},{"./serialize":7,"lru-cache":1}],7:[function(require,module,exports){function InfToJSON(k,v){if(v===Infinity){return"Infinity"}else if(v===-Infinity){return"-Infinity"}else{return v}}function InfFromJSON(k,v){if(v==="Infinity"){return Infinity}else if(v==="-Infinity"){return-Infinity}else{return v}}function serialize(o){return JSON.stringify(o,InfToJSON)}module.exports=serialize},{}],8:[function(require,module,exports){var getLowResNow=function(){return(new Date).getTime()};var getNow=typeof window!=="undefined"&&window.performance?function(){return window.performance.now()}:getLowResNow;var sleep=function(ms){var now=getNow();while(getNow()<now+ms){}};module.exports={now:getNow,sleep:sleep}},{}],9:[function(require,module,exports){"use strict";var nop=function(){};function makeUnaryDerivatives(code){if(code===undefined){return{scalar:nop,tensor:nop}}else{return{scalar:new Function("_x",["var x = _x.x;","var out = this.x;","_x.dx += ("+code+") * this.dx;"].join("\n")),tensor:new Function("_x",["var n = _x.x.length;","while (n--) {","	var x = _x.x.data[n];","	var out = this.x.data[n];","   _x.dx.data[n] += ("+code+") * this.dx.data[n];","}"].join("\n"))}}}function makeBinaryDerivatives(code1,code2){if(code1===undefined&&code2===undefined){return{scalar:[nop,nop],tensor:[nop,nop]}}else{return{scalar:[new Function("_x","_y",["var x = _x.x;",'var y = (typeof _y === "number") ? _y : _y.x;',"var out = this.x;","_x.dx += ("+code1+") * this.dx;"].join("\n")),new Function("_x","_y",['var x = (typeof _x === "number") ? _x : _x.x;',"var y = _y.x;","var out = this.x;","_y.dx += ("+code2+") * this.dx;"].join("\n"))],tensor:[new Function("_x","_y",["var _xx = _x.x;","var _yx = _y.x || _y;","var n = _xx.length;",'if (typeof _yx === "number") {',"	while (n--) {","		var x = _xx.data[n];","		var y = _yx;","		var out = this.x.data[n];","	   _x.dx.data[n] += ("+code1+") * this.dx.data[n];","	}","} else {","	while (n--) {","		var x = _xx.data[n];","		var y = _yx.data[n];","		var out = this.x.data[n];","	   _x.dx.data[n] += ("+code1+") * this.dx.data[n];","	}","}"].join("\n")),new Function("_x","_y",["var _xx = _x.x || _x;","var _yx = _y.x;","var n = _xx.length;",'if (typeof _yx === "number") {',"	while (n--) {","		var x = _xx.data[n];","		var y = _yx;","		var out = this.x.data[n];","	   _y.dx += ("+code2+") * this.dx.data[n];","	}","} else {","	while (n--) {","		var x = _xx.data[n];","		var y = _yx.data[n];","		var out = this.x.data[n];","	   _y.dx.data[n] += ("+code2+") * this.dx.data[n];","	}","}"].join("\n"))]}}}var d={};d.neg=makeUnaryDerivatives("-1");d.add=makeBinaryDerivatives("1","1");d.sub=makeBinaryDerivatives("1","-1");d.mul=makeBinaryDerivatives("y","x");d.div=makeBinaryDerivatives("1/y","-x/(y*y)");d.sqrt=makeUnaryDerivatives("1/(2*out)");d.exp=makeUnaryDerivatives("out");d.log=makeUnaryDerivatives("1/x");d.pow=makeBinaryDerivatives("y*Math.pow(x,y-1)","Math.log(x)*out");d.sin=makeUnaryDerivatives("Math.cos(x)");d.cos=makeUnaryDerivatives("-Math.sin(x)");d.tan=makeUnaryDerivatives("1 + out*out");d.asin=makeUnaryDerivatives("1 / Math.sqrt(1 - x*x)");d.acos=makeUnaryDerivatives("-1 / Math.sqrt(1 - x*x)");d.atan=makeUnaryDerivatives("1 / (1 + x*x)");d.atan2=makeBinaryDerivatives("y/(x*x + y*y)","-x/(x*x + y*y)");d.sinh=makeUnaryDerivatives("Math.cosh(x)");d.cosh=makeUnaryDerivatives("Math.sinh(x)");d.tanh=makeUnaryDerivatives("1 - out*out");d.asinh=makeUnaryDerivatives("1 / Math.sqrt(x*x + 1)");d.acosh=makeUnaryDerivatives("1 / Math.sqrt(x*x - 1)");d.atanh=makeUnaryDerivatives("1 / (1 - x*x)");d.sigmoid=makeUnaryDerivatives("out * (1 - out)");d.floor=makeUnaryDerivatives();d.ceil=makeUnaryDerivatives();d.round=makeUnaryDerivatives();d.abs=makeUnaryDerivatives();d.min=makeBinaryDerivatives();d.max=makeBinaryDerivatives();module.exports=d},{}],10:[function(require,module,exports){"use strict";var assert=require("assert");var graph=require("./graph.js");var Node=graph.Node;var Tensor=require("../tensor.js");function checkOutputType(OutputType){assert(OutputType===Tensor||OutputType===Number,"Attempting to create AD function with invalid output type '"+OutputType+"'; valid options are 'Number' and 'Tensor'")}function newUnaryFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward=opts.backward;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function bw(){backward.call(this,this.inputs[0])}return function(x){if(x instanceof Node){var inputs=[x];return new NodeType(forward(x.x),inputs,inputs,bw,name)}else{return forward(x)}}}function newBinaryFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward1=opts.backward1;var backward2=opts.backward2;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function backward11(){backward1.call(this,this.inputs[0],this.inputs[1].x);backward2.call(this,this.inputs[0].x,this.inputs[1])}function backward10(){backward1.call(this,this.inputs[0],this.inputs[1])}function backward01(){backward2.call(this,this.inputs[0],this.inputs[1])}return function(x,y){var xIsNode=x instanceof Node;var yIsNode=y instanceof Node;if(xIsNode&&yIsNode){var inputs=[x,y];return new NodeType(forward(x.x,y.x),inputs,inputs,backward11,name)}else if(xIsNode){return new NodeType(forward(x.x,y),[x],[x,y],backward10,name)}else if(yIsNode){return new NodeType(forward(x,y.x),[y],[x,y],backward01,name)}else{return forward(x,y)}}}function newFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward=opts.backward;var getParents=opts.getParents;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function bw(){backward.apply(this,this.inputs)}return function(){var output=forward.apply(null,arguments);var parents=getParents.apply(null,arguments);var inputs=new Array(arguments.length);for(var i=0;i<inputs.length;++i){inputs[i]=arguments[i]}var n=parents.length;if(n===0){return output}else{return new NodeType(output,parents,inputs,bw,name)}}}function naryGetParents(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var p=[];var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){p.push(arg)}}return p}function liftUnaryFunction(f){return function(x){return f(x instanceof Node?x.x:x)}}function liftBinaryFunction(f){return function(x,y){var xprim=x instanceof Node?x.x:x;var yprim=y instanceof Node?y.x:y;return f(xprim,yprim)}}module.exports={newUnaryFunction:newUnaryFunction,newBinaryFunction:newBinaryFunction,newFunction:newFunction,naryGetParents:naryGetParents,liftUnaryFunction:liftUnaryFunction,liftBinaryFunction:liftBinaryFunction}},{"../tensor.js":30,"./graph.js":12,assert:216}],11:[function(require,module,exports){"use strict";var Tensor=require("../tensor.js");var graph=require("./graph.js");var Node=graph.Node;var func=require("./func.js");var derivs=require("./derivatives.js");var Scalar=Number;Math.sigmoid=function(x){return 1/(1+Math.exp(-x))};function makeFunctions(OutputType){var fns={};function backward(derivFns){return OutputType===Tensor?derivFns.tensor:derivFns.scalar}var namePrefix=OutputType===Scalar?"scalar.":"tensor.";var unops={neg:OutputType===Tensor?function(x){return x.neg()}:function(x){return-x}};for(var op in unops){fns[op]=func.newUnaryFunction({OutputType:OutputType,name:namePrefix+op,forward:unops[op],backward:backward(derivs[op])})}var binops={add:OutputType===Tensor?function(x,y){return x.add(y)}:function(x,y){return x+y},sub:OutputType===Tensor?function(x,y){return x.sub(y)}:function(x,y){return x-y},mul:OutputType===Tensor?function(x,y){return x.mul(y)}:function(x,y){return x*y},div:OutputType===Tensor?function(x,y){return x.div(y)}:function(x,y){return x/y}};for(var op in binops){fns[op]=func.newBinaryFunction({OutputType:OutputType,name:namePrefix+op,forward:binops[op],backward1:backward(derivs[op])[0],backward2:backward(derivs[op])[1]})}var unaryFns=["floor","ceil","round","sqrt","exp","log","abs","sin","cos","tan","asin","acos","atan","sinh","cosh","tanh","asinh","acosh","atanh","sigmoid"];var binaryFns=["pow","min","max","atan2"];for(var i=0;i<unaryFns.length;i++){var fnname=unaryFns[i];var forward=OutputType===Tensor?new Function("x","return x."+fnname+"();"):new Function("x","return Math."+fnname+"(x);");fns[fnname]=func.newUnaryFunction({OutputType:OutputType,name:namePrefix+fnname,forward:forward,backward:backward(derivs[fnname])})}for(var i=0;i<binaryFns.length;i++){var fnname=binaryFns[i];var forward=OutputType===Tensor?new Function("x","y","return x."+fnname+"(y);"):new Function("x","y","return Math."+fnname+"(x, y);");fns[fnname]=func.newBinaryFunction({OutputType:OutputType,name:namePrefix+fnname,forward:forward,backward1:backward(derivs[fnname])[0],backward2:backward(derivs[fnname])[1]})}fns.isNaN=OutputType===Scalar?func.liftUnaryFunction(isNaN):func.liftUnaryFunction(function(t){return t.isNaN()});fns.isFinite=OutputType===Scalar?func.liftUnaryFunction(isFinite):func.liftUnaryFunction(function(t){return t.isFinite()});return fns}var fns={scalar:makeFunctions(Scalar),tensor:makeFunctions(Tensor)};Object.getOwnPropertyNames(Math).forEach(function(p){if(!fns.scalar.hasOwnProperty(p)){fns.scalar[p]=Math[p]}});fns.scalar.eq=func.liftBinaryFunction(function(x,y){return x==y});fns.scalar.neq=func.liftBinaryFunction(function(x,y){return x!=y});fns.scalar.peq=func.liftBinaryFunction(function(x,y){return x===y});fns.scalar.pneq=func.liftBinaryFunction(function(x,y){return x!==y});fns.scalar.gt=func.liftBinaryFunction(function(x,y){return x>y});fns.scalar.lt=func.liftBinaryFunction(function(x,y){return x<y});fns.scalar.geq=func.liftBinaryFunction(function(x,y){return x>=y});fns.scalar.leq=func.liftBinaryFunction(function(x,y){return x<=y});fns.tensor.transpose=func.newUnaryFunction({OutputType:Tensor,name:"transpose",forward:function(a){return a.transpose()},backward:function(a){var h=this.x.dims[0];var w=this.x.dims[1];for(var i=0;i<h;i++){for(var j=0;j<w;j++){a.dx.data[j*h+i]+=this.dx.data[i*w+j]}}}});fns.tensor.diagonal=func.newUnaryFunction({OutputType:Tensor,name:"diagonal",forward:function(a){return a.diagonal()},backward:function(a){var n=a.dx.dims[0];for(var i=0;i<n;i++){a.dx.data[i]+=this.dx.data[i*(n+1)]}}});fns.tensor.inverse=func.newUnaryFunction({OutputType:Tensor,name:"inverse",forward:function(A){return A.inverse()},backward:function(A){var xT=this.x.T();A.dx=A.dx.add(xT.dot(this.dx).dot(xT).neg())}});fns.tensor.determinant=func.newUnaryFunction({OutputType:Number,name:"determinant",forward:function(A){return A.determinant()},backward:function(A){var n=A.x.dims[0];var invA=A.x.inv();for(var i=0;i<n;i++){for(var j=0;j<n;j++){A.dx.data[i*n+j]+=this.x*this.dx*invA.data[j*n+i]}}}});fns.tensor.dot=func.newBinaryFunction({OutputType:Tensor,name:"dot",forward:function(a,b){return a.dot(b)},backward1:function(A,B){var Ap=ad.value(A);var Bp=ad.value(B);var Ah=Ap.dims[0];var Aw=Ap.dims[1];var Bw=Bp.dims[1];var wout=Bw;for(var l=0;l<Ah;l++){for(var m=0;m<Aw;m++){var z=0;for(var j=0;j<wout;j++){z+=this.dx.data[l*wout+j]*Bp.data[m*Bw+j]}A.dx.data[l*Aw+m]+=z}}},backward2:function(A,B){var Ap=ad.value(A);var Bp=ad.value(B);var Ah=Ap.dims[0];var Aw=Ap.dims[1];var Bh=Bp.dims[0];var Bw=Bp.dims[1];var wout=Bw;for(var l=0;l<Bh;l++){for(var m=0;m<Bw;m++){var z=0;for(var i=0;i<Ah;i++){z+=this.dx.data[i*wout+m]*Ap.data[i*Aw+l]}B.dx.data[l*Bw+m]+=z}}}});fns.tensor.sumreduce=func.newUnaryFunction({OutputType:Scalar,name:"sumreduce",forward:function(t){return t.sumreduce()},backward:function(t){var n=t.dx.data.length;while(n--){t.dx.data[n]+=this.dx}}});fns.tensor.allreduce=func.liftUnaryFunction(function(t){return t.allreduce()});fns.tensor.anyreduce=func.liftUnaryFunction(function(t){return t.anyreduce()});fns.tensor.get=func.newFunction({OutputType:Scalar,name:"tensor.get",forward:function(t,i){return t instanceof Node?t.x.data[i]:t.data[i]},backward:function(t,i){if(t instanceof Node){t.dx.data[i]+=this.dx}},getParents:function(t,i){return t instanceof Node?[t]:[]}});fns.tensor.toScalars=function(t){var n=t instanceof Node?t.x.length:t.length;var s=new Array(n);while(n--){s[n]=fns.tensor.get(t,n)}return s};fns.tensor.range=func.newFunction({OutputType:Tensor,name:"tensor.range",forward:function(t,start,end){t=t instanceof Node?t.x:t;var n=end-start;var tn=new Tensor([n]);while(n--){var i=start+n;tn.data[n]=t.data[i]}return tn},backward:function(t,start,end){if(t instanceof Node){var n=end-start;while(n--){var i=start+n;t.dx.data[i]+=this.dx.data[n]}}},getParents:function(t,start,end){return t instanceof Node?[t]:[]}});fns.tensor.split=function(t,lengths){var ts=new Array(lengths.length);var start=0;for(var i=0;i<lengths.length;i++){var l=lengths[i];ts[i]=fns.tensor.range(t,start,start+l);start+=l}return ts};fns.tensor.fromScalars=func.newFunction({OutputType:Tensor,name:"tensor.fromScalars",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;var t=new Tensor([n]);while(n--){var arg=args[n];t.data[n]=arg instanceof Node?arg.x:arg}return t},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){arg.dx+=this.dx.data[n]}}},getParents:func.naryGetParents});fns.tensor.concat=func.newFunction({OutputType:Tensor,name:"tensor.concat",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;var size=0;while(n--){var arg=args[n];var tn=arg instanceof Node?arg.x:arg;size+=tn.length}var t=new Tensor([size]);n=args.length;var i=0;for(var j=0;j<n;j++){var arg=args[j];var tn=arg instanceof Node?arg.x:arg;t.copy(tn,i);i+=tn.length}return t},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;

var n=args.length;var i=0;for(var j=0;j<n;j++){var arg=args[j];if(arg instanceof Node){var tn=arg;var len=tn.dx.length;while(len--){tn.dx.data[len]+=this.dx.data[i+len]}i+=tn.dx.length}else i+=arg.length}},getParents:func.naryGetParents});fns.tensor.reshape=function(t,dims){if(t instanceof Node){var node=t.refClone();node.x.reshape(dims);node.dx.reshape(dims);return node}else{var ref=t.refClone();ref.reshape(dims);return ref}};fns.scalar.sum=func.newFunction({OutputType:Scalar,name:"scalar.sum",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var thesum=0;var n=args.length;while(n--){var arg=args[n];var x=arg instanceof Node?arg.x:arg;thesum+=x}return thesum},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){arg.dx+=this.dx}}},getParents:func.naryGetParents});fns.tensor.softmax=func.newUnaryFunction({OutputType:Tensor,name:"tensor.softmax",forward:function(t){return t.softmax()},backward:function(t){var n=t.dx.data.length;var s=0;for(var i=0;i<n;i++){s+=this.x.data[i]*this.dx.data[i]}for(var j=0;j<n;j++){t.dx.data[j]+=this.x.data[j]*(this.dx.data[j]-s)}}});module.exports=fns},{"../tensor.js":30,"./derivatives.js":9,"./func.js":10,"./graph.js":12}],12:[function(require,module,exports){"use strict";var Tensor=require("../tensor.js");function Node(x,parents,inputs,backward,name){this.x=x;this.parents=parents;this.inputs=inputs;if(backward!==undefined)this.backward=backward;this.outDegree=0;this.name=name||"node"}Node.prototype.copy=function(other){this.x=other.x;this.parents=other.parents;this.inputs=other.inputs;if(other.backward!==undefined)this.backward=other.backward;this.outDegree=other.outDegree;this.name=other.name};Node.prototype.clone=function(){var node=Object.create(Node.prototype);node.copy(this);return node};Node.prototype.computeOutDegree=function(){this.outDegree++;if(this.outDegree===1){var n=this.parents.length;while(n--)this.parents[n].computeOutDegree()}};Node.prototype.backpropRec=function(){this.outDegree--;if(this.outDegree===0){this.backward();var n=this.parents.length;while(n--)this.parents[n].backpropRec()}};Node.prototype.zeroDerivativesRec=function(){this.outDegree--;if(this.outDegree===0){this.zeroDerivativesImpl();var n=this.parents.length;while(n--)this.parents[n].zeroDerivativesRec()}};Node.prototype.zeroDerivatives=function(){this.computeOutDegree();this.zeroDerivativesRec()};Node.prototype.backward=function(){};function ScalarNode(x,parents,inputs,backward,name){Node.call(this,x,parents,inputs,backward,name||"scalarNode");this.dx=0}ScalarNode.prototype=Object.create(Node.prototype);ScalarNode.prototype.copy=function(other){Node.prototype.copy.call(this,other);this.dx=other.dx};ScalarNode.prototype.clone=function(){var node=Object.create(ScalarNode.prototype);node.copy(this);return node};ScalarNode.prototype.backprop=function(){this.dx=1;this.computeOutDegree();this.backpropRec()};ScalarNode.prototype.zeroDerivativesImpl=function(){this.dx=0};function TensorNode(x,parents,inputs,backward,name){Node.call(this,x,parents,inputs,backward,name||"tensorNode");this.dx=new Tensor(x.dims)}TensorNode.prototype=Object.create(Node.prototype);TensorNode.prototype.copy=function(other){Node.prototype.copy.call(this,other);this.x=other.x.clone();this.dx=other.dx.clone()};TensorNode.prototype.clone=function(){var node=Object.create(Tensor.prototype);node.copy(this);return node};TensorNode.prototype.refCopy=function(other){Node.prototype.copy.call(this,other);this.x=other.x.refClone();this.dx=other.dx.refClone()};TensorNode.prototype.refClone=function(){var node=Object.create(TensorNode.prototype);node.refCopy(this);return node};TensorNode.prototype.backprop=function(){this.dx.fill(1);this.computeOutDegree();this.backpropRec()};TensorNode.prototype.zeroDerivativesImpl=function(){this.dx.zero()};module.exports={Node:Node,ScalarNode:ScalarNode,TensorNode:TensorNode}},{"../tensor.js":30}],13:[function(require,module,exports){"use strict";var utils=require("../utils.js");var graph=require("./graph.js");var Tensor=require("../tensor.js");var Node=graph.Node;var ScalarNode=graph.ScalarNode;var TensorNode=graph.TensorNode;var emptylist=[];function liftScalar(x,name){return new ScalarNode(x,emptylist,emptylist,undefined,name)}function liftTensor(x,name){return new TensorNode(x,emptylist,emptylist,undefined,name)}function doLift(x,name){return x instanceof Tensor?liftTensor(x,name):liftScalar(x,name)}var ad={lift:function(x,name){return x instanceof Node?x:doLift(x,name)},isLifted:function(x){return x instanceof Node},value:function(x){return x instanceof Node?x.x:x},derivative:function(x){return x.dx}};ad.params=function(dims,name){return ad.lift(new Tensor(dims).fillRandom(),name)};var func=require("./func.js");var functions=require("./functions.js");ad=utils.mergeObjects(ad,func,functions);module.exports=ad},{"../tensor.js":30,"../utils.js":31,"./func.js":10,"./functions.js":11,"./graph.js":12}],14:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("../utils.js");var Network=require("./network.js");function compound(fn,subnets,optname){function CompoundNetwork(subnets){Network.call(this);this.name=optname||"compoundNetwork";this.networks=subnets.slice();for(var i=0;i<subnets.length;i++){this.paramGetters=this.paramGetters.concat(subnets[i].paramGetters);this.paramSetters=this.paramSetters.concat(subnets[i].paramSetters)}this.paramGetters=utils.deduplicate(this.paramGetters);this.paramSetters=utils.deduplicate(this.paramSetters)}CompoundNetwork.prototype=Object.create(Network.prototype);CompoundNetwork.prototype.eval=fn;CompoundNetwork.prototype.setTraining=function(flag){Network.prototype.setTraining.call(this,flag);for(var i=0;i<this.networks.length;i++){this.networks[i].setTraining(flag)}};if(optname){CompoundNetwork.prototype.serializeJSON=function(){return{type:optname,networks:this.networks.map(function(n){return n.serializeJSON()})}};Network.deserializers[optname]=function(json){return new CompoundNetwork(json.networks.map(function(jn){return Network.deserializeJSON(jn)}))}}else{CompoundNetwork.prototype.serializeJSON=function(){assert(false,"Cannot serialize unnamed compound network.")}}return new CompoundNetwork(subnets)}function ASTNode(type,parents){this.type=type;this.parents=parents||[]}function SelectNetwork(i){Network.call(this);this.name="select";this.i=i}SelectNetwork.prototype=Object.create(Network.prototype);SelectNetwork.prototype.eval=function(tensors){return tensors[this.i]};SelectNetwork.prototype.serializeJSON=function(){return{type:"select",i:this.i}};Network.deserializers.select=function(json){return new SelectNetwork(json.i)};ASTNode.prototype.split=function(n){var nodes=new Array(n);for(var i=0;i<n;i++){var net=new SelectNetwork(i);nodes[i]=net.compose(this)}return nodes};function input(){return new ASTNode("input")}Network.prototype.compose=function(){var node=new ASTNode("compose",Array.prototype.slice.call(arguments));node.network=this;return node};function compile(inputs,outputs,optname,optDebug){for(var i=0;i<inputs.length;i++){assert(inputs[i].type==="input","Inputs to composite neural network must be nn.ast.input()")}var visited=[];for(var i=0;i<outputs.length;i++){var fringe=[outputs[i]];while(fringe.length>0){var node=fringe.pop();if(!(node.type==="input")&&visited.indexOf(node)===-1){visited.push(node);for(var i=0;i<node.parents.length;i++){fringe.push(node.parents[i])}}}}visited.reverse();var body="var args = arguments;\n";var outs=[];for(var i=0;i<visited.length;i++){var node=visited[i];var ins=node.parents.map(function(p){var i=inputs.indexOf(p);if(i!==-1)return"args["+i+"]";i=visited.indexOf(p);if(i!==-1)return"r"+i;assert(false,"impossible")});body+="var r"+i+" = this.networks["+i+"].eval("+ins+");\n";if(optDebug){var ri="r"+i;var ri_val=ri+"_val";var neti="this.networks["+i+"]";body+=["var "+ri_val+" = "+ri+".x || "+ri+";","if (!"+ri_val+".isFinite().allreduce()) {",'	var err = "Non-finite value in output of network '+i+' ("+'+neti+'.name+")\\n";','   err += "Output:\\n";','	err += "["+'+ri_val+'.toString()+"]\\n";','   err += "Inputs:\\n";',ins.map(function(input){var inval="("+input+".x || "+input+")";return'	err += "["+'+inval+'.toString()+"]\\n";'}).join("\n"),"   throw new Error(err);","}"].join("\n")}if(outputs.indexOf(node)!==-1){outs.push("r"+i)}}body+="return "+(outs.length>1?"["+outs+"]":outs[0])+";";var fn=new Function(body);var networks=visited.map(function(n){return n.network});var net=compound(fn,networks);net.name=optname||"compiledNetwork";net.nodes=inputs.concat(visited);net.inputs=inputs.map(function(n){return net.nodes.indexOf(n)});net.outputs=outputs.map(function(n){return net.nodes.indexOf(n)});net.serializeJSON=function(){var jnodes=this.nodes.map(function(n){var jn={type:n.type,parents:n.parents.map(function(p){return this.nodes.indexOf(p)}.bind(this))};if(jn.type==="compose"){jn.network=n.network.serializeJSON()}return jn}.bind(this));return{type:"compiled",name:this.name,nodes:jnodes,inputs:this.inputs,outputs:this.outputs}};return net}Network.deserializers.compiled=function(json){var nodes=[];for(var i=0;i<json.nodes.length;i++){var jn=json.nodes[i];var n=new ASTNode(jn.type,jn.parents.map(function(pi){return nodes[pi]}));if(jn.type==="compose"){n.network=Network.deserializeJSON(jn.network)}nodes.push(n)}var inputs=json.inputs.map(function(i){return nodes[i]});var outputs=json.outputs.map(function(i){return nodes[i]});return compile(inputs,outputs,json.name)};function sequence(networks,optname,optDebug){var inputNode=input();var currNode=inputNode;for(var i=0;i<networks.length;i++){currNode=networks[i].compose(currNode)}var net=compile([inputNode],[currNode],undefined,optDebug);net.name=optname||"sequenceNetwork";net.serializeJSON=function(){return{type:"sequence",name:this.name,networks:this.networks.map(function(n){return n.serializeJSON()})}};return net}Network.deserializers.sequence=function(json){var networks=json.networks.map(function(jn){return Network.deserializeJSON(jn)});return sequence(networks,json.name)};module.exports={compound:compound,ast:{input:input,compile:compile},sequence:sequence}},{"../utils.js":31,"./network.js":17,assert:216}],15:[function(require,module,exports){"use strict";var utils=require("../utils.js");var Network=require("./network.js");module.exports={Network:Network,deserializeJSON:Network.deserializeJSON};var lifting=require("./lifting.js");var composition=require("./composition.js");var lifted=require("./networks/lifted.js");var linear=require("./networks/linear.js");var convolution=require("./networks/convolution.js");var pooling=require("./networks/pooling.js");var activation=require("./networks/activation.js");var perceptron=require("./networks/perceptron.js");var misc=require("./networks/misc.js");module.exports=utils.mergeObjects(module.exports,lifting,composition,lifted,linear,convolution,pooling,activation,perceptron,misc)},{"../utils.js":31,"./composition.js":14,"./lifting.js":16,"./network.js":17,"./networks/activation.js":18,"./networks/convolution.js":19,"./networks/lifted.js":20,"./networks/linear.js":21,"./networks/misc.js":22,"./networks/perceptron.js":23,"./networks/pooling.js":24}],16:[function(require,module,exports){"use strict";var Network=require("./network.js");function lift(adfn,optname){var net=new Network;net.eval=adfn;net.name=optname||"liftedNetwork";if(optname){net.serializeJSON=function(){return{type:optname}};Network.deserializers[optname]=function(json){return net}}else{net.serializeJSON=function(){assert(false,"Cannot serialize unnamed lifted network.")}}return net}function partialeval(adfn,name){var netCreateFn=function(){var partialargs=Array.prototype.slice.call(arguments);var fnToLift=function(t){var tensorargs=Array.prototype.slice.call(arguments);return adfn.apply(null,tensorargs.concat(partialargs))};var net=lift(fnToLift);net.name=name;if(name){net.serializeJSON=function(){var json={type:name};for(var i=0;i<partialargs.length;i++){json["arg"+i]=partialargs[i]}return json}}return net};if(name){Network.deserializers[name]=function(json){var args=[];for(var prop in json){if(prop.startsWith("arg")){var idx=parseInt(prop.slice(3));args[idx]=json[prop]}}return netCreateFn.apply(null,args)}}return netCreateFn}module.exports={lift:lift,partialeval:partialeval}},{"./network.js":17}],17:[function(require,module,exports){"use strict";var assert=require("assert");function Network(){this.name="";this.isTraining=false;this.paramGetters=[];this.paramSetters=[]}Network.prototype.eval=function(){assert(false,"Neural networks must implement the 'eval' method.")};Network.prototype.getParameters=function(){if(this.__parameters===undefined){this.__parameters=this.paramGetters.map(function(f){return f()})}return this.__parameters};Network.prototype.setParameters=function(params){if(params.length!==this.paramSetters.length){assert(false,"Network.setParameters: size mismatch (network has "+this.paramSetters.length+" parameters, not "+params.length)}for(var i=0;i<params.length;i++){this.paramSetters[i](params[i])}this.__parameters=params.slice()};Network.prototype.setTraining=function(boolflag){this.isTraining=boolflag};Network.prototype.serializeJSON=function(){assert(false,"Neural networks must implement the 'serializeJSON' method.")};Network.deserializers={};Network.deserializeJSON=function(json){assert(json.type!==undefined,"Network JSON blob has no 'type' field.");assert(Network.deserializers.hasOwnProperty(json.type),"Network JSON blob has unrecognized type '"+json.type+"'");return Network.deserializers[json.type](json)};module.exports=Network},{assert:216}],18:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var lift=require("../lifting.js").lift;var relu=lift(ad.newUnaryFunction({OutputType:Tensor,name:"relu",forward:function(x){x=ad.value(x);var y=x.clone();var n=x.length;while(n--){y.data[n]=y.data[n]<0?0:y.data[n]}return y},backward:function(x){var n=x.x.length;while(n--){x.dx.data[n]+=x.x.data[n]<=0?0:this.dx.data[n]}}}),"relu");var sigmoidCentered=lift(function(x){return ad.tensor.sub(ad.tensor.mul(ad.tensor.sigmoid(x),2),1)});module.exports={relu:relu,sigmoidCentered:sigmoidCentered}},{"../../ad":13,"../../tensor.js":30,"../lifting.js":16}],19:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");var assert=require("assert");function ConvolutionNetwork(nIn,nOut,fW,fH,sX,sY,pX,pY,optname){Network.call(this);this.name=optname||"convolution";this.inDepth=nIn;this.outDepth=nOut;this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.filters=ad.params([nOut,nIn,fH,fW],this.name+"_filters");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.filters}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(filters){this.filters=filters}.bind(this),function(biases){this.biases=biases}.bind(this)]}ConvolutionNetwork.prototype=Object.create(Network.prototype);ConvolutionNetwork.prototype.serializeJSON=function(){return{type:"convolution",name:this.name,inDepth:this.inDepth,outDepth:this.outDepth,filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY,filters:ad.value(this.filters).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.convolution=function(json){var net=new ConvolutionNetwork(json.inDepth,json.outDepth,json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY,json.name);ad.value(net.filters).fromFlatArray(json.filters);ad.value(net.biases).fromFlatArray(json.biases);return net};var convolve=ad.newFunction({OutputType:Tensor,name:"convolution",forward:function(inImg,filters,biases,strideX,strideY,padX,padY){inImg=ad.value(inImg);filters=ad.value(filters);biases=ad.value(biases);var fH=filters.dims[2];var fW=filters.dims[3];var iD=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oD=filters.dims[0];var oH=Math.floor((iH+2*padY-fH)/strideY+1);var oW=Math.floor((iW+2*padX-fW)/strideX+1);if(iD!==filters.dims[1]){assert(false,"Convolutional network: input depth is "+iD+" but should be "+filters.dims[1])}var outImg=new Tensor([oD,oH,oW]);for(var d=0;d<oD;d++){var x=-padX;var y=-padY;for(var ay=0;ay<oH;y+=strideY,ay++){x=-padX;for(var ax=0;ax<oW;x+=strideX,ax++){var a=biases.data[d];for(var fd=0;fd<iD;fd++){for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var iIdx=ix+iW*(iy+iH*fd);var fIdx=fx+fW*(fy+fH*(fd+iD*d));a+=filters.data[fIdx]*inImg.data[iIdx]}}}}outImg.data[ax+oW*(ay+oH*d)]=a}}}return outImg},backward:function(inImg,filters,biases,strideX,strideY,padX,padY){var inImgP=ad.value(inImg);var filtersP=ad.value(filters);var biasesP=ad.value(biases);var iIs=inImg!==inImgP;var fIs=filters!==filtersP;var bIs=biases!==biasesP;var fH=filtersP.dims[2];var fW=filtersP.dims[3];var iD=inImgP.dims[0];var iH=inImgP.dims[1];var iW=inImgP.dims[2];var oD=filtersP.dims[0];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<oD;d++){var x=-padX;var y=-padY;for(var ay=0;ay<oH;y+=strideY,ay++){x=-padX;for(var ax=0;ax<oW;x+=strideX,ax++){var thisGrad=this.dx.data[ax+oW*(ay+oH*d)];if(bIs)biases.dx.data[d]+=thisGrad;for(var fd=0;fd<iD;fd++){for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var iIdx=ix+iW*(iy+iH*fd);var fIdx=fx+fW*(fy+fH*(fd+iD*d));if(iIs){inImg.dx.data[iIdx]+=filtersP.data[fIdx]*thisGrad}if(fIs){filters.dx.data[fIdx]+=inImgP.data[iIdx]*thisGrad}}}}}}}}},getParents:function(inImg,filters,biases,strideX,strideY,padX,padY){var p=[];if(ad.isLifted(inImg))p.push(inImg);if(ad.isLifted(filters))p.push(filters);if(ad.isLifted(biases))p.push(biases);return p}});ConvolutionNetwork.prototype.eval=function(img){var filters=this.isTraining?this.filters:ad.value(this.filters);var biases=this.isTraining?this.biases:ad.value(this.biases);return convolve(img,filters,biases,this.strideX,this.strideY,this.padX,this.padY)};function convolution(opts,optname){var nIn=opts.inDepth||1;var nOut=opts.outDepth||1;var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||1;var sY=opts.strideY||opts.stride||1;var pX=opts.padX||opts.pad||"same";var pY=opts.padY||opts.pad||"same";if(pX==="same"){pX=Math.floor((fW-1)/2)}if(pY==="same"){pY=Math.floor((fH-1)/2)}return new ConvolutionNetwork(nIn,nOut,fW,fH,sX,sY,pX,pY,optname)}module.exports={convolution:convolution,convolve:convolve}},{"../../ad":13,"../../tensor.js":30,"../network.js":17,assert:216}],20:[function(require,module,exports){"use strict";var adfunctions=require("../../ad/functions.js");var lifting=require("../lifting.js");module.exports={};for(var fnname in adfunctions.tensor){module.exports[fnname]=lifting.lift(adfunctions.tensor[fnname],fnname)}module.exports.range=lifting.partialeval(adfunctions.tensor.range,"range");module.exports.split=lifting.partialeval(adfunctions.tensor.split,"split");module.exports.reshape=lifting.partialeval(adfunctions.tensor.reshape,"reshape")},{"../../ad/functions.js":11,"../lifting.js":16}],21:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");var assert=require("assert");function LinearNetwork(nIn,nOut,optname){Network.call(this);this.name=optname||"linear";this.inSize=nIn;this.outSize=nOut;this.weights=ad.params([nOut,nIn],this.name+"_weights");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.weights}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(weights){this.weights=weights}.bind(this),function(biases){this.biases=biases}.bind(this)]}LinearNetwork.prototype=Object.create(Network.prototype);LinearNetwork.prototype.serializeJSON=function(){return{type:"linear",name:this.name,inSize:this.inSize,outSize:this.outSize,weights:ad.value(this.weights).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.linear=function(json){var net=new LinearNetwork(json.inSize,json.outSize,json.name);ad.value(net.weights).fromFlatArray(json.weights);ad.value(net.biases).fromFlatArray(json.biases);return net};var mvmuladd=ad.newFunction({OutputType:Tensor,name:"mvmuladd",forward:function(A,x,b){A=ad.value(A);x=ad.value(x);b=ad.value(b);var w=x.length;var h=b.length;if(w!==A.dims[1]){assert(false,"Linear network: input size is "+w+" but should be "+A.dims[1])}var y=b.clone();for(var r=0;r<h;r++){var off=r*w;for(var c=0;c<w;c++){y.data[r]+=A.data[off+c]*x.data[c]}}return y},backward:function(A,x,b){var Ap=ad.value(A);var xp=ad.value(x);var bp=ad.value(b);var aIs=A!==Ap;var xIs=x!==xp;var bIs=b!==bp;var w=xp.length;var h=bp.length;for(var r=0;r<h;r++){var off=r*w;var thisdx=this.dx.data[r];if(bIs){b.dx.data[r]+=thisdx}for(var c=0;c<w;c++){if(xIs){x.dx.data[c]+=Ap.data[off+c]*thisdx}if(aIs){A.dx.data[off+c]+=xp.data[c]*thisdx}}}},getParents:ad.naryGetParents});LinearNetwork.prototype.eval=function(x){var A=this.isTraining?this.weights:ad.value(this.weights);var b=this.isTraining?this.biases:ad.value(this.biases);return mvmuladd(A,x,b)};function linear(nIn,nOut,optname){return new LinearNetwork(nIn,nOut,optname)}function LayerwiseLinearNetwork(nIn,nOut,optname){Network.call(this);this.name=optname||"layerwiseLinear";this.inSize=nIn;this.outSize=nOut;this.weights=ad.params([nOut,nIn],this.name+"_weights");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.weights}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(weights){this.weights=weights}.bind(this),function(biases){this.biases=biases}.bind(this)]}LayerwiseLinearNetwork.prototype=Object.create(Network.prototype);LayerwiseLinearNetwork.prototype.serializeJSON=function(){return{type:"layerwiseLinear",name:this.name,inSize:this.inSize,outSize:this.outSize,weights:ad.value(this.weights).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.layerwiseLinear=function(json){var net=new LayerwiseLinearNetwork(json.inSize,json.outSize,json.name);ad.value(net.weights).fromFlatArray(json.weights);ad.value(net.biases).fromFlatArray(json.biases);return net};var layerwiseMVMulAdd=ad.newFunction({OutputType:Tensor,name:"layerwiseMVMulAdd",forward:function(img,weights,biases){img=ad.value(img);weights=ad.value(weights);biases=ad.value(biases);var inD=img.dims[0];if(inD!==weights.dims[1]){assert(false,"LayerwiseLinear Network: input depth is "+inD+" but should be "+weights.dims[1])}var h=img.dims[1];var w=img.dims[2];var outD=weights.dims[0];var outImg=new Tensor([outD,h,w]);for(var y=0;y<h;y++){for(var x=0;x<w;x++){for(var od=0;od<outD;od++){var outIdx=x+w*(y+h*od);outImg.data[outIdx]=biases.data[od];for(var id=0;id<inD;id++){var wIdx=id+od*inD;var wt=weights.data[wIdx];var inIdx=x+w*(y+h*id);var imval=img.data[inIdx];outImg.data[outIdx]+=wt*imval}}}}return outImg},backward:function(img,weights,biases){var imgp=ad.value(img);var weightsp=ad.value(weights);var biasesp=ad.value(biases);var imgIs=img!==imgp;var weightsIs=weights!==weightsp;var biasesIs=biases!==biasesp;var h=imgp.dims[1];var w=imgp.dims[2];var outD=weightsp.dims[0];var inD=weightsp.dims[1];for(var y=0;y<h;y++){for(var x=0;x<w;x++){for(var od=0;od<outD;od++){var outIdx=x+w*(y+h*od);var thisdx=this.dx.data[outIdx];if(biasesIs){biases.dx.data[od]+=thisdx}for(var id=0;id<inD;id++){var wIdx=id+od*inD;var inIdx=x+w*(y+h*id);if(weightsIs){var imval=imgp.data[inIdx];weights.dx.data[wIdx]+=imval*thisdx}if(imgIs){var wt=weightsp.data[wIdx];img.dx.data[inIdx]+=wt*thisdx}}}}}},getParents:ad.naryGetParents});LayerwiseLinearNetwork.prototype.eval=function(img){var weights=this.isTraining?this.weights:ad.value(this.weights);var biases=this.isTraining?this.biases:ad.value(this.biases);return layerwiseMVMulAdd(img,weights,biases)};function layerwiseLinear(nIn,nOut,optname){return new LayerwiseLinearNetwork(nIn,nOut,optname)}module.exports={linear:linear,layerwiseLinear:layerwiseLinear}},{"../../ad":13,"../../tensor.js":30,"../network.js":17,assert:216}],22:[function(require,module,exports){"use strict";var ad=require("../../ad");var Network=require("../network.js");function ConstantParamNetwork(dims,optname){Network.call(this);this.name=optname||"constantparams";this.dims=dims;this.params=ad.params(dims,this.name);this.paramGetters=[function(){return this.params}.bind(this)];this.paramSetters=[function(params){this.params=params}.bind(this)]}ConstantParamNetwork.prototype=Object.create(Network.prototype);ConstantParamNetwork.prototype.eval=function(){return this.isTraining?this.params:ad.value(this.params)};ConstantParamNetwork.prototype.serializeJSON=function(){return{type:"constantparams",name:this.name,dims:this.dims,params:ad.value(this.params).toFlatArray()}};Network.deserializers.constantparams=function(json){var net=new ConstantParamNetwork(json.dims,json.name);ad.value(net.params).fromFlatArray(json.params);return net};function constantparams(dims,optname){return new ConstantParamNetwork(dims,optname)}module.exports={constantparams:constantparams}},{"../../ad":13,"../network.js":17}],23:[function(require,module,exports){"use strict";var sequence=require("../composition.js").sequence;var linear=require("./linear.js").linear;function mlp(nIn,layerdefs,optname,optDebug){optname=optname||"mlp";var nets=[];for(var i=0;i<layerdefs.length;i++){var ldef=layerdefs[i];nets.push(linear(nIn,ldef.nOut,optname+"_layer"+i));if(ldef.activation){nets.push(ldef.activation)}nIn=ldef.nOut}return sequence(nets,optname||"multiLayerPerceptron",optDebug)}module.exports={mlp:mlp}},{"../composition.js":14,"./linear.js":21}],24:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");function MaxPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="maxpool"}MaxPoolNetwork.prototype=Object.create(Network.prototype);MaxPoolNetwork.prototype.serializeJSON=function(){return{type:"maxpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.maxpool=function(json){return new MaxPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var maxIndices;var maxpoolingImpl=ad.newFunction({OutputType:Tensor,name:"maxpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var outImg=new Tensor([D,oH,oW]);maxIndices=new Int32Array(D*oH*oW);for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var maxval=-Infinity;var maxidx=-1;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];if(v>maxval){maxval=v;maxidx=idx}}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=maxval;maxIndices[outidx]=maxidx}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var inidx=this.maxIndices[outidx];inImg.dx.data[inidx]+=this.dx.data[outidx]}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});function maxpooling(inImg,fW,fH,sX,sY,pX,pY){var outImg=maxpoolingImpl(inImg,fW,fH,sX,sY,pX,pY);if(ad.isLifted(outImg)){outImg.maxIndices=maxIndices}return outImg}MaxPoolNetwork.prototype.eval=function(img){return maxpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function maxpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MaxPoolNetwork(fW,fH,sX,sY,pX,pY)}function MinPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="minpool"}MinPoolNetwork.prototype=Object.create(Network.prototype);MinPoolNetwork.prototype.serializeJSON=function(){return{type:"minpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.minpool=function(json){return new MinPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var minIndices;var minpoolingImpl=ad.newFunction({OutputType:Tensor,name:"maxpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var outImg=new Tensor([D,oH,oW]);minIndices=new Int32Array(D*oH*oW);for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var minval=Infinity;var minidx=-1;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];if(v<minval){minval=v;minidx=idx}}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=minval;minIndices[outidx]=minidx}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var inidx=this.minIndices[outidx];inImg.dx.data[inidx]+=this.dx.data[outidx]}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});function minpooling(inImg,fW,fH,sX,sY,pX,pY){var outImg=minpoolingImpl(inImg,fW,fH,sX,sY,pX,pY);if(ad.isLifted(outImg)){outImg.minIndices=minIndices}return outImg}MinPoolNetwork.prototype.eval=function(img){return minpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function minpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MinPoolNetwork(fW,fH,sX,sY,pX,pY)}function MeanPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="meanpool"}MeanPoolNetwork.prototype=Object.create(Network.prototype);MeanPoolNetwork.prototype.serializeJSON=function(){return{type:"meanpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.meanpool=function(json){return new MeanPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var meanpooling=ad.newFunction({OutputType:Tensor,name:"meanpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var fN=fW*fH;var outImg=new Tensor([D,oH,oW]);for(var d=0;d<D;d++){
var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var avgval=0;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];avgval+=v}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=avgval/fN}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];var fN=fW*fH;for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var outDx=this.dx.data[outidx]/fN;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var inidx=ix+iW*(iy+iH*d);inImg.dx.data[inidx]+=outDx}}}}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});MeanPoolNetwork.prototype.eval=function(img){return meanpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function meanpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MeanPoolNetwork(fW,fH,sX,sY,pX,pY)}module.exports={maxpool:maxpool,minpool:minpool,meanpool:meanpool}},{"../../ad":13,"../../tensor.js":30,"../network.js":17}],25:[function(require,module,exports){"use strict";var utils=require("../utils.js");var methods=require("./methods.js");var optimize=require("./optimize.js");var loss=require("./loss.js");module.exports=utils.mergeObjects({},methods,optimize,loss)},{"../utils.js":31,"./loss.js":26,"./methods.js":27,"./optimize.js":28}],26:[function(require,module,exports){"use strict";var assert=require("assert");var ad=require("../ad");function classificationLoss(outputProbs,trueClassIndex){var n=ad.value(outputProbs).length;assert(trueClassIndex<n,"Training datum has true class label "+trueClassIndex+", but network only outputs "+n+" class probabilities.");return ad.scalar.neg(ad.scalar.log(ad.tensor.get(outputProbs,trueClassIndex)))}function regressionLoss(output,trueOutput){var n=ad.value(output).length;var m=trueOutput.length;assert(n===m,"Network output has different dimensionality than training data ("+n+" vs. "+m+")");var diff=ad.tensor.sub(output,trueOutput);return ad.tensor.sumreduce(ad.tensor.mul(diff,diff))}module.exports={classificationLoss:classificationLoss,regressionLoss:regressionLoss}},{"../ad":13,assert:216}],27:[function(require,module,exports){"use strict";var utils=require("../utils.js");var tstruct=require("./tensorStruct.js");var EPS=1e-8;function sgd(options){options=utils.mergeDefaults(options,{stepSize:.1,stepSizeDecay:1,mu:0});var stepSize=options.stepSize;var decay=options.stepSizeDecay;var mu=options.mu;var vStruct;return function(grad,param,step){if(!vStruct)vStruct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:vStruct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,v){v.muleq(mu).subeq(g.mul(stepSize));p.addeq(v)});stepSize*=decay}}function adagrad(options){options=utils.mergeDefaults(options,{stepSize:.1});var stepSize=options.stepSize;var g2Struct;return function(grad,param,step){if(!g2Struct)g2Struct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:g2Struct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,g2){g2.addeq(g.mul(g));p.subeq(g.div(g2.sqrt().addeq(EPS)).muleq(stepSize))})}}function rmsprop(options){options=utils.mergeDefaults(options,{stepSize:.1,decayRate:.9});var stepSize=options.stepSize;var decayRate=options.decayRate;var g2Struct;return function(grad,param,step){if(!g2Struct)g2Struct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:g2Struct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,g2){g2.muleq(decayRate).addeq(g.mul(g).muleq(1-decayRate));p.subeq(g.div(g2.sqrt().addeq(EPS)).muleq(stepSize))})}}function adam(options){options=utils.mergeDefaults(options,{stepSize:.001,decayRate1:.9,decayRate2:.999});var stepSize=options.stepSize;var decayRate1=options.decayRate1;var decayRate2=options.decayRate2;var mStruct;var vStruct;return function(grad,param,step){var t=step+1;if(!mStruct)mStruct=tstruct.emptyLike(grad);if(!vStruct)vStruct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:mStruct,ifMissing:tstruct.ifMissing.zeros},{struct:vStruct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,m,v){m.muleq(decayRate1).addeq(g.mul(1-decayRate1));v.muleq(decayRate2).addeq(g.mul(g).muleq(1-decayRate2));var alpha_t=stepSize*Math.sqrt(1-Math.pow(decayRate2,t))/(1-Math.pow(decayRate1,t));p.subeq(m.div(v.sqrt().addeq(EPS)).muleq(alpha_t))})}}module.exports={sgd:sgd,adagrad:adagrad,rmsprop:rmsprop,adam:adam}},{"../utils.js":31,"./tensorStruct.js":29}],28:[function(require,module,exports){"use strict";var assert=require("assert");var ad=require("../ad");var utils=require("../utils.js");var methods=require("./methods.js");var tstruct=require("./tensorStruct.js");function optimize(fn,options){options=utils.mergeDefaults(options,{iterations:100,method:methods.sgd(),verbose:false});var iters=options.iterations;var method=options.method;var verbose=options.verbose;for(var i=0;i<iters;i++){var rets=fn();assert(rets.gradients!==undefined);assert(rets.parameters!==undefined);method(rets.gradients,rets.parameters,i);if(verbose){console.log("[optimize] done iteration "+(i+1)+"/"+iters)}}}function makeOptimizable(fn){return function(){var rets=fn();assert(rets.parameters!==undefined);assert(rets.loss!==undefined);tstruct.foreach(rets.parameters,[],function(p){p.zeroDerivatives()});rets.loss.backprop();var newrets={gradients:tstruct.map(rets.parameters,ad.derivative),parameters:tstruct.map(rets.parameters,ad.value)};return newrets}}function adOptimize(fn,options){optimize(makeOptimizable(fn),options)}function adTrain(fn,trainingData,lossFn,options){options=utils.mergeDefaults(options,{batchSize:1});var batchSize=options.batchSize;var idx;var singleFn=makeOptimizable(function(){var trainingDatum=trainingData[idx];var rets=fn(trainingDatum.input);var loss=lossFn(rets.output,trainingDatum.output);return{parameters:rets.parameters,loss:loss}});var batchFn=function(){var gradients;var parameters;for(var i=0;i<batchSize;i++){idx=Math.floor(Math.random()*trainingData.length);var rets=singleFn();if(gradients===undefined){gradients=rets.gradients;parameters=rets.parameters}else{tstruct.foreach(rets.gradients,[{struct:gradients,ifMissing:tstruct.ifMissing.zeros},{struct:rets.parameters,ifMissing:tstruct.ifMissing.impossible},{struct:parameters,ifMissing:tstruct.ifMissing.copyFromCoStruct(1)}],function(newg,g){g.addeq(newg)})}}if(batchSize>1){tstruct.foreach(gradients,[],function(g){g.diveq(batchSize)})}return{parameters:parameters,gradients:gradients}};optimize(batchFn,options)}function nnTrain(nn,trainingData,lossFn,options){var fn=function(input){return{output:nn.eval(input),parameters:nn.getParameters()}};nn.setTraining(true);adTrain(fn,trainingData,lossFn,options);nn.setTraining(false)}module.exports={optimize:optimize,adOptimize:adOptimize,adTrain:adTrain,nnTrain:nnTrain}},{"../ad":13,"../utils.js":31,"./methods.js":27,"./tensorStruct.js":29,assert:216}],29:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("../utils.js");var Tensor=require("../tensor.js");var ad=require("../ad");function type(struct){if(struct instanceof Tensor||ad.isLifted(struct)&&ad.value(struct)instanceof Tensor){return"tensor"}else if(Array.isArray(struct)){return"array"}else if(typeof struct==="object"){return"object"}else{throw new Error("Malformed Tensor structure; expected Tensor, Array, or object, got "+typeof x)}}function emptyLike(struct){var t=type(struct);if(t==="tensor"){return new Tensor(struct.dims)}else if(t==="array"){return[]}else if(t==="object"){return{}}}function map(struct,fn){var t=type(struct);if(t==="tensor"){return fn(struct)}else if(t==="array"){var ret=[];for(var i=0;i<struct.length;i++){ret[i]=map(struct[i],fn)}return ret}else if(t==="object"){var ret={};for(var prop in struct){ret[prop]=map(struct[prop],fn)}return ret}}function foreach(struct,coIteratees,fn){var _foreach;if(coIteratees.length===0){_foreach=function(struct){var t=type(struct);if(t==="tensor"){fn(struct)}else if(t==="array"){for(var i=0;i<struct.length;i++){_foreach(struct[i])}}else if(t==="object"){for(var prop in struct){_foreach(struct[prop])}}};_foreach(struct)}else{var missingFns=coIteratees.map(function(c){return c.ifMissing});_foreach=function(struct,coStructs){var t=type(struct);if(t==="tensor"){fn.apply(null,[struct].concat(coStructs))}else if(t==="array"){var subCoStructLists=[];for(var j=0;j<struct.length;j++){var subCoStructList=[];for(var i=0;i<coStructs.length;i++)subCoStructList.push(coStructs[i][j]);subCoStructLists.push(subCoStructList)}for(var i=0;i<coStructs.length;i++){var coStruct=coStructs[i];var missing=missingFns[i];var n=struct.length;var m=coStruct.length;for(var j=m;j<n;j++){var toAdd=missing(struct[j],subCoStructLists[j]);coStruct.push(toAdd);subCoStructLists[j][i]=toAdd}}for(var j=0;j<struct.length;j++){_foreach(struct[j],subCoStructLists[j])}}else if(t==="object"){var subCoStructLists={};for(var prop in struct){var subCoStructList=[];for(var i=0;i<coStructs.length;i++)subCoStructList.push(coStructs[i][prop]);subCoStructLists[prop]=subCoStructList}for(var i=0;i<coStructs.length;i++){var coStruct=coStructs[i];var missing=missingFns[i];for(var prop in struct){if(!coStruct.hasOwnProperty(prop)){var toAdd=missing(struct[prop],subCoStructLists[prop]);coStruct[prop]=toAdd;subCoStructLists[prop][i]=toAdd}}}for(var prop in struct){_foreach(struct[prop],subCoStructLists[prop])}}};var coStructs=coIteratees.map(function(c){return c.struct});_foreach(struct,coStructs,fn)}}var ifMissing={impossible:function(struct,coStructs){throw new Error("impossible for this struct to have missing elements")},zeros:function(struct,coStructs){return map(struct,function(x){return new Tensor(x.dims)})},copyFromStruct:function(struct,coStructs){return map(struct,function(x){return x})},copyFromCoStruct:function(index){return function(struct,coStructs){return map(coStructs[index],function(x){return x})}}};module.exports={emptyLike:emptyLike,map:map,foreach:foreach,ifMissing:ifMissing}},{"../ad":13,"../tensor.js":30,"../utils.js":31,assert:216}],30:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("./utils.js");function TypedArrayBackingStore(ArrayType){return{"new":function(n){return new ArrayType(n)},set:function(tgt,src,offset){tgt.set(src,offset)}}}var ArrayBackingStore={ArrayType:Array,"new":function(n){var a=new Array(n);while(n--){a[n]=0}return a},set:function(tgt,src,offset){for(var i=0;i<src.length;i++){tgt[i+offset]=src[i]}}};var BackingStore=TypedArrayBackingStore(Float64Array);function Tensor(dims){this.dims=dims;var size=1;var n=dims.length;while(n--)size*=dims[n];this.length=size;this.data=BackingStore.new(size)}Object.defineProperties(Tensor.prototype,{rank:{get:function(){return this.dims.length}}});Tensor.prototype.reshape=function(dims){var size=1;var n=dims.length;while(n--)size*=dims[n];assert(size===this.length,"Tensor reshape invalid size");this.dims=dims;return this};Tensor.prototype.fill=function(val){var n=this.length;while(n--)this.data[n]=val;return this};Tensor.prototype.zero=function(){return this.fill(0)};Tensor.prototype.fillRandom=function(){var scale=1/this.length;var n=this.length;while(n--)this.data[n]=utils.gaussianSample(0,scale);return this};Tensor.prototype.copy=function(other,offset){offset=offset||0;BackingStore.set(this.data,other.data,offset);return this};Tensor.prototype.clone=function(){var copy=new Tensor(this.dims);return copy.copy(this)};Tensor.prototype.refCopy=function(other){this.dims=other.dims;this.length=other.length;this.data=other.data;return this};Tensor.prototype.refClone=function(){var t=Object.create(Tensor.prototype);return t.refCopy(this)};Tensor.prototype.get=function(coords){var idx=0;var n=this.dims.length;for(var i=0;i<n;i++){idx=idx*this.dims[i]+coords[i]}return this.data[idx]};Tensor.prototype.set=function(coords,val){var idx=0;var n=this.dims.length;for(var i=0;i<n;i++){idx=idx*this.dims[i]+coords[i]}this.data[idx]=val};function toArrayRec(tensor,coords){if(coords.length===tensor.rank){return tensor.get(coords)}else{var dim=coords.length;var arr=[];for(var i=0;i<tensor.dims[dim];i++){arr.push(toArrayRec(tensor,coords.concat([i])))}return arr}}Tensor.prototype.toArray=function(){return toArrayRec(this,[])};function fromArrayRec(tensor,coords,x){if(!(x instanceof Array)){tensor.set(coords,x)}else{var dim=coords.length;for(var i=0;i<tensor.dims[dim];i++){fromArrayRec(tensor,coords.concat([i]),x[i])}}}Tensor.prototype.fromArray=function(arr){fromArrayRec(this,[],arr);return this};Tensor.prototype.toString=function(){return this.toArray().toString()};Tensor.prototype.toFlatArray=function(){return Array.prototype.slice.call(this.data)};Tensor.prototype.fromFlatArray=function(arr){BackingStore.set(this.data,arr,0);return this};function addUnaryMethod(name,fncode){var fneq=new Function(["var n = this.data.length;","while (n--) {","	var x = this.data[n];","	this.data[n] = "+fncode+";","}","return this;"].join("\n"));Tensor.prototype[name+"eq"]=fneq;Tensor.prototype[name]=function(){var nt=this.clone();return fneq.call(nt)}}function addBinaryMethod(name,fncode){var fneqS=new Function("s",["var n = this.data.length;","var b = s;","while (n--) {","	var a = this.data[n];","	this.data[n] = "+fncode+";","}","return this;"].join("\n"));var fneqT=new Function("t",["var n = this.data.length;","while (n--) {","	var a = this.data[n];","	var b = t.data[n];","	this.data[n] = "+fncode+";","}","return this;"].join("\n"));var fneq=function(x){if(x.constructor===Tensor)return fneqT.call(this,x);else return fneqS.call(this,x)};Tensor.prototype[name+"eq"]=fneq;Tensor.prototype[name]=function(x){var nt=this.clone();return fneq.call(nt,x)}}function addReduction(name,initcode,fncode){Tensor.prototype[name+"reduce"]=new Function(["var accum = "+initcode+";","var n = this.data.length;","while (n--) {","	var x = this.data[n];","	accum = "+fncode+";","}","return accum;"].join("\n"))}addUnaryMethod("neg","-x");addUnaryMethod("round","Math.round(x)");addUnaryMethod("log","Math.log(x)");addUnaryMethod("exp","Math.exp(x)");addUnaryMethod("sqrt","Math.sqrt(x)");addUnaryMethod("abs","Math.abs(x)");addUnaryMethod("ceil","Math.ceil(x)");addUnaryMethod("floor","Math.floor(x)");addUnaryMethod("cos","Math.cos(x)");addUnaryMethod("sin","Math.sin(x)");addUnaryMethod("tan","Math.tan(x)");addUnaryMethod("acos","Math.acos(x)");addUnaryMethod("asin","Math.asin(x)");addUnaryMethod("atan","Math.atan(x)");addUnaryMethod("cosh","Math.cosh(x)");addUnaryMethod("sinh","Math.sinh(x)");addUnaryMethod("tanh","Math.tanh(x)");addUnaryMethod("acosh","Math.acosh(x)");addUnaryMethod("asinh","Math.asinh(x)");addUnaryMethod("atanh","Math.atanh(x)");addUnaryMethod("sigmoid","1 / (1 + Math.exp(-x))");addUnaryMethod("isFinite","isFinite(x)");addUnaryMethod("isNaN","isNaN(x)");addUnaryMethod("invert","1/x");addUnaryMethod("pseudoinvert","x === 0 ? 0 : 1/x");addBinaryMethod("add","a + b");addBinaryMethod("sub","a - b");addBinaryMethod("mul","a * b");addBinaryMethod("div","a / b");addBinaryMethod("mod","a % b");addBinaryMethod("min","Math.min(a, b)");addBinaryMethod("max","Math.max(a, b)");addBinaryMethod("pow","Math.pow(a, b)");addBinaryMethod("atan2","Math.atan2(a, b)");addBinaryMethod("eq","a === b");addBinaryMethod("neq","a !== b");addBinaryMethod("gt","a > b");addBinaryMethod("ge","a >= b");addBinaryMethod("lt","a < b");addBinaryMethod("le","a <= b");addReduction("sum","0","accum + x");addReduction("min","Infinity","Math.min(accum, x)");addReduction("max","-Infinity","Math.max(accum, x)");addReduction("all","true","accum && (x !== 0)");addReduction("any","false","accum || (x !== 0)");Tensor.prototype.softmax=function(){var max=-Infinity;var n=this.data.length;while(n--){max=Math.max(max,this.data[n])}var t=new Tensor(this.dims);n=this.data.length;var sum=0;while(n--){t.data[n]=Math.exp(this.data[n]-max);sum+=t.data[n]}n=this.data.length;while(n--){t.data[n]/=sum}return t};Tensor.prototype.transpose=function(){assert.ok(this.rank===2);var h=this.dims[0];var w=this.dims[1];var y=new Tensor([w,h]);for(var i=0;i<h;i++){for(var j=0;j<w;j++){y.data[j*h+i]=this.data[i*w+j]}}return y};Tensor.prototype.diagonal=function(){assert.ok(this.rank===2);assert.ok(this.dims[1]===1);var n=this.dims[0];var y=new Tensor([n,n]);for(var i=0;i<n;i++){y.data[i*(n+1)]=this.data[i]}return y};Tensor.prototype.inverse=function(){assert.ok(this.rank===2);assert.ok(this.dims[0]===this.dims[1]);var n=this.dims[0];var Ai,Aj;var Ii,Ij;var i,j,k,x;var A=[];for(i=0;i<n;i++){Ai=new Float64Array(n);A.push(Ai);for(j=0;j<n;j++){Ai[j]=this.data[i*n+j]}}var I=[];for(i=0;i<n;i++){Ii=new Array(n);I.push(Ii);for(j=0;j<n;j++){Ii[j]=i===j?1:0}}for(j=0;j<n;++j){var i0=-1;var v0=-1;for(i=j;i!==n;++i){k=Math.abs(A[i][j]);if(k>v0){i0=i;v0=k}}Aj=A[i0];A[i0]=A[j];A[j]=Aj;Ij=I[i0];I[i0]=I[j];I[j]=Ij;x=Aj[j];for(k=j;k!==n;++k){Aj[k]/=x}for(k=n-1;k!==-1;--k){Ij[k]/=x}for(i=n-1;i!==-1;--i){if(i!==j){Ai=A[i];Ii=I[i];x=Ai[j];for(k=j+1;k!==n;++k){Ai[k]-=Aj[k]*x}for(k=n-1;k>0;--k){Ii[k]-=Ij[k]*x;--k;Ii[k]-=Ij[k]*x}if(k===0){Ii[0]-=Ij[0]*x}}}}return new Tensor([n,n]).fromArray(I)};Tensor.prototype.determinant=function(){assert.ok(this.rank===2);assert.ok(this.dims[0]===this.dims[1]);var n=this.dims[0];var ret=1;var i,j,k;var Aj,Ai,alpha,temp,k1,k2,k3;var A=[];for(i=0;i<n;i++){Ai=new Float64Array(n);A.push(Ai);for(j=0;j<n;j++){Ai[j]=this.data[i*n+j]}}for(j=0;j<n-1;j++){k=j;for(i=j+1;i<n;i++){if(Math.abs(A[i][j])>Math.abs(A[k][j])){k=i}}if(k!==j){temp=A[k];A[k]=A[j];A[j]=temp;ret*=-1}Aj=A[j];for(i=j+1;i<n;i++){Ai=A[i];alpha=Ai[j]/Aj[j];for(k=j+1;k<n-1;k+=2){k1=k+1;Ai[k]-=Aj[k]*alpha;Ai[k1]-=Aj[k1]*alpha}if(k!==n){Ai[k]-=Aj[k]*alpha}}if(Aj[j]===0){return 0}ret*=Aj[j]}return ret*A[j][j]};Tensor.prototype.dot=function(t){var a=this,b=t;if(a.rank!==2||b.rank!==2){throw new Error("Inputs to dot should have rank = 2.")}if(a.dims[1]!==b.dims[0]){throw new Error("Dimension mismatch in dot. Inputs have dimension "+a.dims+" and "+b.dims+".")}var l=a.dims[1];var h=a.dims[0],w=b.dims[1];var y=new Tensor([h,w]);for(var r=0;r<h;r++){for(var c=0;c<w;c++){var z=0;for(var i=0;i<l;i++){z+=a.data[r*l+i]*b.data[w*i+c]}y.data[r*w+c]=z}}return y};Tensor.prototype.cholesky=function(){var a=this;assert.ok(a.rank===2&&a.dims[0]===a.dims[1],"cholesky is only defined for square matrices.");var s;var n=a.dims[0];var L=new Tensor([n,n]);for(var i=0;i<n;i++){for(var j=0;j<=i;j++){s=0;for(var k=0;k<j;k++){s+=L.data[i*n+k]*L.data[j*n+k]}L.data[i*n+j]=i===j?Math.sqrt(a.data[i*n+i]-s):1/L.data[j*n+j]*(a.data[i*n+j]-s)}}return L};module.exports=Tensor},{"./utils.js":31,assert:216}],31:[function(require,module,exports){"use strict";function gaussianSample(mu,sigma){var u,v,x,y,q;do{u=1-Math.random();v=1.7156*(Math.random()-.5);x=u-.449871;y=Math.abs(v)+.386595;q=x*x+y*(.196*y-.25472*x)}while(q>=.27597&&(q>.27846||v*v>-4*u*u*Math.log(u)));return mu+sigma*v/u}function deduplicate(list){var retlist=[];for(var i=0;i<list.length;i++){var item=list[i];if(retlist.indexOf(item)===-1){retlist.push(item)}}return retlist}function mergeObjects(tgt){tgt=tgt||{};for(var i=1;i<arguments.length;i++){var src=arguments[i];for(var prop in src){tgt[prop]=src[prop]}}return tgt}function cloneObject(obj){return mergeObjects({},obj)}function mergeDefaults(obj,defaults){return mergeObjects({},defaults,obj)}module.exports={gaussianSample:gaussianSample,deduplicate:deduplicate,mergeObjects:mergeObjects,cloneObject:cloneObject,mergeDefaults:mergeDefaults}},{}],32:[function(require,module,exports){(function(process,__filename){"use strict";function amdefine(module,requireFn){"use strict";var defineCache={},loaderCache={},alreadyCalled=false,path=require("path"),makeRequire,stringRequire;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName){var baseParts;if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseName.split("/");baseParts=baseParts.slice(0,baseParts.length-1);baseParts=baseParts.concat(name.split("/"));trimDots(baseParts);name=baseParts.join("/")}}return name}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(id){function load(value){loaderCache[id]=value}load.fromText=function(id,text){throw new Error("amdefine does not implement load.fromText")};return load}makeRequire=function(systemRequire,exports,module,relId){function amdRequire(deps,callback){if(typeof deps==="string"){return stringRequire(systemRequire,exports,module,deps,relId)}else{deps=deps.map(function(depName){return stringRequire(systemRequire,exports,module,depName,relId)});if(callback){process.nextTick(function(){callback.apply(null,deps)})}}}amdRequire.toUrl=function(filePath){if(filePath.indexOf(".")===0){return normalize(filePath,path.dirname(module.filename))}else{return filePath}};return amdRequire};requireFn=requireFn||function req(){return module.require.apply(module,arguments)};function runFactory(id,deps,factory){var r,e,m,result;if(id){e=loaderCache[id]={};m={id:id,uri:__filename,exports:e};r=makeRequire(requireFn,e,m,id)}else{if(alreadyCalled){throw new Error("amdefine with no module ID cannot be called more than once per file.")}alreadyCalled=true;e=module.exports;m=module;r=makeRequire(requireFn,e,m,module.id)}if(deps){deps=deps.map(function(depName){return r(depName)})}if(typeof factory==="function"){result=factory.apply(m.exports,deps)}else{result=factory}if(result!==undefined){m.exports=result;if(id){loaderCache[id]=m.exports}}}stringRequire=function(systemRequire,exports,module,id,relId){var index=id.indexOf("!"),originalId=id,prefix,plugin;if(index===-1){id=normalize(id,relId);if(id==="require"){return makeRequire(systemRequire,exports,module,relId)}else if(id==="exports"){return exports}else if(id==="module"){return module}else if(loaderCache.hasOwnProperty(id)){return loaderCache[id]}else if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}else{if(systemRequire){return systemRequire(originalId)}else{throw new Error("No module with ID: "+id)}}}else{prefix=id.substring(0,index);id=id.substring(index+1,id.length);plugin=stringRequire(systemRequire,exports,module,prefix,relId);if(plugin.normalize){id=plugin.normalize(id,makeNormalize(relId))}else{id=normalize(id,relId)}if(loaderCache[id]){return loaderCache[id]}else{plugin.load(id,makeRequire(systemRequire,exports,module,relId),makeLoad(id),{});return loaderCache[id]}}};function define(id,deps,factory){if(Array.isArray(id)){factory=deps;deps=id;id=undefined}else if(typeof id!=="string"){factory=id;id=deps=undefined}if(deps&&!Array.isArray(deps)){factory=deps;deps=undefined}if(!deps){deps=["require","exports","module"]}if(id){defineCache[id]=[id,deps,factory]}else{runFactory(id,deps,factory)}}define.require=function(id){if(loaderCache[id]){return loaderCache[id]}if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}};define.amd={};return define}module.exports=amdefine}).call(this,require("_process"),"/node_modules/amdefine/amdefine.js")},{_process:306,path:302}],33:[function(require,module,exports){require("./es7");var types=require("../lib/types");var defaults=require("../lib/shared").defaults;var def=types.Type.def;var or=types.Type.or;def("Noop").bases("Node").build();def("DoExpression").bases("Expression").build("body").field("body",[def("Statement")]);def("Super").bases("Expression").build();def("BindExpression").bases("Expression").build("object","callee").field("object",or(def("Expression"),null)).field("callee",def("Expression"));def("Decorator").bases("Node").build("expression").field("expression",def("Expression"));def("Property").field("decorators",or([def("Decorator")],null),defaults["null"]);def("MethodDefinition").field("decorators",or([def("Decorator")],null),defaults["null"]);def("MetaProperty").bases("Expression").build("meta","property").field("meta",def("Identifier")).field("property",def("Identifier"));def("ParenthesizedExpression").bases("Expression").build("expression").field("expression",def("Expression"));def("ImportSpecifier").bases("ModuleSpecifier").build("imported","local").field("imported",def("Identifier"));def("ImportDefaultSpecifier").bases("ModuleSpecifier").build("local");def("ImportNamespaceSpecifier").bases("ModuleSpecifier").build("local");def("ExportDefaultDeclaration").bases("Declaration").build("declaration").field("declaration",or(def("Declaration"),def("Expression")));def("ExportNamedDeclaration").bases("Declaration").build("declaration","specifiers","source").field("declaration",or(def("Declaration"),null)).field("specifiers",[def("ExportSpecifier")],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"]);def("ExportSpecifier").bases("ModuleSpecifier").build("local","exported").field("exported",def("Identifier"));def("ExportNamespaceSpecifier").bases("Specifier").build("exported").field("exported",def("Identifier"));def("ExportDefaultSpecifier").bases("Specifier").build("exported").field("exported",def("Identifier"));def("ExportAllDeclaration").bases("Declaration").build("exported","source").field("exported",or(def("Identifier"),null)).field("source",def("Literal"));def("CommentBlock").bases("Comment").build("value","leading","trailing");def("CommentLine").bases("Comment").build("value","leading","trailing")},{"../lib/shared":47,"../lib/types":48,"./es7":37}],34:[function(require,module,exports){var types=require("../lib/types");var Type=types.Type;var def=Type.def;var or=Type.or;var shared=require("../lib/shared");var defaults=shared.defaults;var geq=shared.geq;def("Printable").field("loc",or(def("SourceLocation"),null),defaults["null"],true);def("Node").bases("Printable").field("type",String).field("comments",or([def("Comment")],null),defaults["null"],true);def("SourceLocation").build("start","end","source").field("start",def("Position")).field("end",def("Position")).field("source",or(String,null),defaults["null"]);def("Position").build("line","column").field("line",geq(1)).field("column",geq(0));def("File").bases("Node").build("program").field("program",def("Program"));def("Program").bases("Node").build("body").field("body",[def("Statement")]);def("Function").bases("Node").field("id",or(def("Identifier"),null),defaults["null"]).field("params",[def("Pattern")]).field("body",def("BlockStatement"));def("Statement").bases("Node");def("EmptyStatement").bases("Statement").build();def("BlockStatement").bases("Statement").build("body").field("body",[def("Statement")]);def("ExpressionStatement").bases("Statement").build("expression").field("expression",def("Expression"));def("IfStatement").bases("Statement").build("test","consequent","alternate").field("test",def("Expression")).field("consequent",def("Statement")).field("alternate",or(def("Statement"),null),defaults["null"]);def("LabeledStatement").bases("Statement").build("label","body").field("label",def("Identifier")).field("body",def("Statement"));def("BreakStatement").bases("Statement").build("label").field("label",or(def("Identifier"),null),defaults["null"]);def("ContinueStatement").bases("Statement").build("label").field("label",or(def("Identifier"),null),defaults["null"]);def("WithStatement").bases("Statement").build("object","body").field("object",def("Expression")).field("body",def("Statement"));def("SwitchStatement").bases("Statement").build("discriminant","cases","lexical").field("discriminant",def("Expression")).field("cases",[def("SwitchCase")]).field("lexical",Boolean,defaults["false"]);def("ReturnStatement").bases("Statement").build("argument").field("argument",or(def("Expression"),null));def("ThrowStatement").bases("Statement").build("argument").field("argument",def("Expression"));def("TryStatement").bases("Statement").build("block","handler","finalizer").field("block",def("BlockStatement")).field("handler",or(def("CatchClause"),null),function(){return this.handlers&&this.handlers[0]||null}).field("handlers",[def("CatchClause")],function(){return this.handler?[this.handler]:[]},true).field("guardedHandlers",[def("CatchClause")],defaults.emptyArray).field("finalizer",or(def("BlockStatement"),null),defaults["null"]);def("CatchClause").bases("Node").build("param","guard","body").field("param",def("Pattern")).field("guard",or(def("Expression"),null),defaults["null"]).field("body",def("BlockStatement"));def("WhileStatement").bases("Statement").build("test","body").field("test",def("Expression")).field("body",def("Statement"));def("DoWhileStatement").bases("Statement").build("body","test").field("body",def("Statement")).field("test",def("Expression"));def("ForStatement").bases("Statement").build("init","test","update","body").field("init",or(def("VariableDeclaration"),def("Expression"),null)).field("test",or(def("Expression"),null)).field("update",or(def("Expression"),null)).field("body",def("Statement"));def("ForInStatement").bases("Statement").build("left","right","body").field("left",or(def("VariableDeclaration"),def("Expression"))).field("right",def("Expression")).field("body",def("Statement"));def("DebuggerStatement").bases("Statement").build();def("Declaration").bases("Statement");def("FunctionDeclaration").bases("Function","Declaration").build("id","params","body").field("id",def("Identifier"));def("FunctionExpression").bases("Function","Expression").build("id","params","body");def("VariableDeclaration").bases("Declaration").build("kind","declarations").field("kind",or("var","let","const")).field("declarations",[def("VariableDeclarator")]);def("VariableDeclarator").bases("Node").build("id","init").field("id",def("Pattern")).field("init",or(def("Expression"),null));def("Expression").bases("Node","Pattern");def("ThisExpression").bases("Expression").build();def("ArrayExpression").bases("Expression").build("elements").field("elements",[or(def("Expression"),null)]);def("ObjectExpression").bases("Expression").build("properties").field("properties",[def("Property")]);def("Property").bases("Node").build("kind","key","value").field("kind",or("init","get","set")).field("key",or(def("Literal"),def("Identifier"))).field("value",def("Expression"));def("SequenceExpression").bases("Expression").build("expressions").field("expressions",[def("Expression")]);var UnaryOperator=or("-","+","!","~","typeof","void","delete");def("UnaryExpression").bases("Expression").build("operator","argument","prefix").field("operator",UnaryOperator).field("argument",def("Expression")).field("prefix",Boolean,defaults["true"]);var BinaryOperator=or("==","!=","===","!==","<","<=",">",">=","<<",">>",">>>","+","-","*","/","%","&","|","^","in","instanceof","..");def("BinaryExpression").bases("Expression").build("operator","left","right").field("operator",BinaryOperator).field("left",def("Expression")).field("right",def("Expression"));var AssignmentOperator=or("=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","|=","^=","&=");def("AssignmentExpression").bases("Expression").build("operator","left","right").field("operator",AssignmentOperator).field("left",def("Pattern")).field("right",def("Expression"));var UpdateOperator=or("++","--");def("UpdateExpression").bases("Expression").build("operator","argument","prefix").field("operator",UpdateOperator).field("argument",def("Expression")).field("prefix",Boolean);var LogicalOperator=or("||","&&");def("LogicalExpression").bases("Expression").build("operator","left","right").field("operator",LogicalOperator).field("left",def("Expression")).field("right",def("Expression"));

def("ConditionalExpression").bases("Expression").build("test","consequent","alternate").field("test",def("Expression")).field("consequent",def("Expression")).field("alternate",def("Expression"));def("NewExpression").bases("Expression").build("callee","arguments").field("callee",def("Expression")).field("arguments",[def("Expression")]);def("CallExpression").bases("Expression").build("callee","arguments").field("callee",def("Expression")).field("arguments",[def("Expression")]);def("MemberExpression").bases("Expression").build("object","property","computed").field("object",def("Expression")).field("property",or(def("Identifier"),def("Expression"))).field("computed",Boolean,function(){var type=this.property.type;if(type==="Literal"||type==="MemberExpression"||type==="BinaryExpression"){return true}return false});def("Pattern").bases("Node");def("SwitchCase").bases("Node").build("test","consequent").field("test",or(def("Expression"),null)).field("consequent",[def("Statement")]);def("Identifier").bases("Node","Expression","Pattern").build("name").field("name",String);def("Literal").bases("Node","Expression").build("value").field("value",or(String,Boolean,null,Number,RegExp)).field("regex",or({pattern:String,flags:String},null),function(){if(this.value instanceof RegExp){var flags="";if(this.value.ignoreCase)flags+="i";if(this.value.multiline)flags+="m";if(this.value.global)flags+="g";return{pattern:this.value.source,flags:flags}}return null});def("Comment").bases("Printable").field("value",String).field("leading",Boolean,defaults["true"]).field("trailing",Boolean,defaults["false"])},{"../lib/shared":47,"../lib/types":48}],35:[function(require,module,exports){require("./core");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;def("XMLDefaultDeclaration").bases("Declaration").field("namespace",def("Expression"));def("XMLAnyName").bases("Expression");def("XMLQualifiedIdentifier").bases("Expression").field("left",or(def("Identifier"),def("XMLAnyName"))).field("right",or(def("Identifier"),def("Expression"))).field("computed",Boolean);def("XMLFunctionQualifiedIdentifier").bases("Expression").field("right",or(def("Identifier"),def("Expression"))).field("computed",Boolean);def("XMLAttributeSelector").bases("Expression").field("attribute",def("Expression"));def("XMLFilterExpression").bases("Expression").field("left",def("Expression")).field("right",def("Expression"));def("XMLElement").bases("XML","Expression").field("contents",[def("XML")]);def("XMLList").bases("XML","Expression").field("contents",[def("XML")]);def("XML").bases("Node");def("XMLEscape").bases("XML").field("expression",def("Expression"));def("XMLText").bases("XML").field("text",String);def("XMLStartTag").bases("XML").field("contents",[def("XML")]);def("XMLEndTag").bases("XML").field("contents",[def("XML")]);def("XMLPointTag").bases("XML").field("contents",[def("XML")]);def("XMLName").bases("XML").field("contents",or(String,[def("XML")]));def("XMLAttribute").bases("XML").field("value",String);def("XMLCdata").bases("XML").field("contents",String);def("XMLComment").bases("XML").field("contents",String);def("XMLProcessingInstruction").bases("XML").field("target",String).field("contents",or(String,null))},{"../lib/types":48,"./core":34}],36:[function(require,module,exports){require("./core");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;var defaults=require("../lib/shared").defaults;def("Function").field("generator",Boolean,defaults["false"]).field("expression",Boolean,defaults["false"]).field("defaults",[or(def("Expression"),null)],defaults.emptyArray).field("rest",or(def("Identifier"),null),defaults["null"]);def("RestElement").bases("Pattern").build("argument").field("argument",def("Pattern"));def("SpreadElementPattern").bases("Pattern").build("argument").field("argument",def("Pattern"));def("FunctionDeclaration").build("id","params","body","generator","expression");def("FunctionExpression").build("id","params","body","generator","expression");def("ArrowFunctionExpression").bases("Function","Expression").build("params","body","expression").field("id",null,defaults["null"]).field("body",or(def("BlockStatement"),def("Expression"))).field("generator",false,defaults["false"]);def("YieldExpression").bases("Expression").build("argument","delegate").field("argument",or(def("Expression"),null)).field("delegate",Boolean,defaults["false"]);def("GeneratorExpression").bases("Expression").build("body","blocks","filter").field("body",def("Expression")).field("blocks",[def("ComprehensionBlock")]).field("filter",or(def("Expression"),null));def("ComprehensionExpression").bases("Expression").build("body","blocks","filter").field("body",def("Expression")).field("blocks",[def("ComprehensionBlock")]).field("filter",or(def("Expression"),null));def("ComprehensionBlock").bases("Node").build("left","right","each").field("left",def("Pattern")).field("right",def("Expression")).field("each",Boolean);def("Property").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("value",or(def("Expression"),def("Pattern"))).field("method",Boolean,defaults["false"]).field("shorthand",Boolean,defaults["false"]).field("computed",Boolean,defaults["false"]);def("PropertyPattern").bases("Pattern").build("key","pattern").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("pattern",def("Pattern")).field("computed",Boolean,defaults["false"]);def("ObjectPattern").bases("Pattern").build("properties").field("properties",[or(def("PropertyPattern"),def("Property"))]);def("ArrayPattern").bases("Pattern").build("elements").field("elements",[or(def("Pattern"),null)]);def("MethodDefinition").bases("Declaration").build("kind","key","value","static").field("kind",or("constructor","method","get","set")).field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("value",def("Function")).field("computed",Boolean,defaults["false"]).field("static",Boolean,defaults["false"]);def("SpreadElement").bases("Node").build("argument").field("argument",def("Expression"));def("ArrayExpression").field("elements",[or(def("Expression"),def("SpreadElement"),def("RestElement"),null)]);def("NewExpression").field("arguments",[or(def("Expression"),def("SpreadElement"))]);def("CallExpression").field("arguments",[or(def("Expression"),def("SpreadElement"))]);def("AssignmentPattern").bases("Pattern").build("left","right").field("left",def("Pattern")).field("right",def("Expression"));var ClassBodyElement=or(def("MethodDefinition"),def("VariableDeclarator"),def("ClassPropertyDefinition"),def("ClassProperty"));def("ClassProperty").bases("Declaration").build("key").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("computed",Boolean,defaults["false"]);def("ClassPropertyDefinition").bases("Declaration").build("definition").field("definition",ClassBodyElement);def("ClassBody").bases("Declaration").build("body").field("body",[ClassBodyElement]);def("ClassDeclaration").bases("Declaration").build("id","body","superClass").field("id",or(def("Identifier"),null)).field("body",def("ClassBody")).field("superClass",or(def("Expression"),null),defaults["null"]);def("ClassExpression").bases("Expression").build("id","body","superClass").field("id",or(def("Identifier"),null),defaults["null"]).field("body",def("ClassBody")).field("superClass",or(def("Expression"),null),defaults["null"]).field("implements",[def("ClassImplements")],defaults.emptyArray);def("ClassImplements").bases("Node").build("id").field("id",def("Identifier")).field("superClass",or(def("Expression"),null),defaults["null"]);def("Specifier").bases("Node");def("ModuleSpecifier").bases("Specifier").field("local",or(def("Identifier"),null),defaults["null"]).field("id",or(def("Identifier"),null),defaults["null"]).field("name",or(def("Identifier"),null),defaults["null"]);def("TaggedTemplateExpression").bases("Expression").build("tag","quasi").field("tag",def("Expression")).field("quasi",def("TemplateLiteral"));def("TemplateLiteral").bases("Expression").build("quasis","expressions").field("quasis",[def("TemplateElement")]).field("expressions",[def("Expression")]);def("TemplateElement").bases("Node").build("value","tail").field("value",{cooked:String,raw:String}).field("tail",Boolean)},{"../lib/shared":47,"../lib/types":48,"./core":34}],37:[function(require,module,exports){require("./es6");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;var builtin=types.builtInTypes;var defaults=require("../lib/shared").defaults;def("Function").field("async",Boolean,defaults["false"]);def("SpreadProperty").bases("Node").build("argument").field("argument",def("Expression"));def("ObjectExpression").field("properties",[or(def("Property"),def("SpreadProperty"))]);def("SpreadPropertyPattern").bases("Pattern").build("argument").field("argument",def("Pattern"));def("ObjectPattern").field("properties",[or(def("Property"),def("PropertyPattern"),def("SpreadPropertyPattern"))]);def("AwaitExpression").bases("Expression").build("argument","all").field("argument",or(def("Expression"),null)).field("all",Boolean,defaults["false"])},{"../lib/shared":47,"../lib/types":48,"./es6":36}],38:[function(require,module,exports){require("./es7");var types=require("../lib/types");var defaults=require("../lib/shared").defaults;var def=types.Type.def;var or=types.Type.or;def("VariableDeclaration").field("declarations",[or(def("VariableDeclarator"),def("Identifier"))]);def("Property").field("value",or(def("Expression"),def("Pattern")));def("ArrayPattern").field("elements",[or(def("Pattern"),def("SpreadElement"),null)]);def("ObjectPattern").field("properties",[or(def("Property"),def("PropertyPattern"),def("SpreadPropertyPattern"),def("SpreadProperty"))]);def("ExportSpecifier").bases("ModuleSpecifier").build("id","name");def("ExportBatchSpecifier").bases("Specifier").build();def("ImportSpecifier").bases("ModuleSpecifier").build("id","name");def("ImportNamespaceSpecifier").bases("ModuleSpecifier").build("id");def("ImportDefaultSpecifier").bases("ModuleSpecifier").build("id");def("ExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",or(def("Declaration"),def("Expression"),null)).field("specifiers",[or(def("ExportSpecifier"),def("ExportBatchSpecifier"))],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"]);def("ImportDeclaration").bases("Declaration").build("specifiers","source").field("specifiers",[or(def("ImportSpecifier"),def("ImportNamespaceSpecifier"),def("ImportDefaultSpecifier"))],defaults.emptyArray).field("source",def("Literal"));def("Block").bases("Comment").build("value","leading","trailing");def("Line").bases("Comment").build("value","leading","trailing")},{"../lib/shared":47,"../lib/types":48,"./es7":37}],39:[function(require,module,exports){require("./es7");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;var defaults=require("../lib/shared").defaults;def("Type").bases("Node");def("AnyTypeAnnotation").bases("Type").build();def("MixedTypeAnnotation").bases("Type").build();def("VoidTypeAnnotation").bases("Type").build();def("NumberTypeAnnotation").bases("Type").build();def("NumberLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",Number).field("raw",String);def("StringTypeAnnotation").bases("Type").build();def("StringLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",String).field("raw",String);def("BooleanTypeAnnotation").bases("Type").build();def("BooleanLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",Boolean).field("raw",String);def("TypeAnnotation").bases("Node").build("typeAnnotation").field("typeAnnotation",def("Type"));def("NullableTypeAnnotation").bases("Type").build("typeAnnotation").field("typeAnnotation",def("Type"));def("NullLiteralTypeAnnotation").bases("Type").build();def("NullTypeAnnotation").bases("Type").build();def("ThisTypeAnnotation").bases("Type").build();def("ExistsTypeAnnotation").bases("Type").build();def("FunctionTypeAnnotation").bases("Type").build("params","returnType","rest","typeParameters").field("params",[def("FunctionTypeParam")]).field("returnType",def("Type")).field("rest",or(def("FunctionTypeParam"),null)).field("typeParameters",or(def("TypeParameterDeclaration"),null));def("FunctionTypeParam").bases("Node").build("name","typeAnnotation","optional").field("name",def("Identifier")).field("typeAnnotation",def("Type")).field("optional",Boolean);def("ArrayTypeAnnotation").bases("Type").build("elementType").field("elementType",def("Type"));def("ObjectTypeAnnotation").bases("Type").build("properties","indexers","callProperties").field("properties",[def("ObjectTypeProperty")]).field("indexers",[def("ObjectTypeIndexer")],defaults.emptyArray).field("callProperties",[def("ObjectTypeCallProperty")],defaults.emptyArray);def("ObjectTypeProperty").bases("Node").build("key","value","optional").field("key",or(def("Literal"),def("Identifier"))).field("value",def("Type")).field("optional",Boolean);def("ObjectTypeIndexer").bases("Node").build("id","key","value").field("id",def("Identifier")).field("key",def("Type")).field("value",def("Type"));def("ObjectTypeCallProperty").bases("Node").build("value").field("value",def("FunctionTypeAnnotation")).field("static",Boolean,defaults["false"]);def("QualifiedTypeIdentifier").bases("Node").build("qualification","id").field("qualification",or(def("Identifier"),def("QualifiedTypeIdentifier"))).field("id",def("Identifier"));def("GenericTypeAnnotation").bases("Type").build("id","typeParameters").field("id",or(def("Identifier"),def("QualifiedTypeIdentifier"))).field("typeParameters",or(def("TypeParameterInstantiation"),null));def("MemberTypeAnnotation").bases("Type").build("object","property").field("object",def("Identifier")).field("property",or(def("MemberTypeAnnotation"),def("GenericTypeAnnotation")));def("UnionTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("IntersectionTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("TypeofTypeAnnotation").bases("Type").build("argument").field("argument",def("Type"));def("Identifier").field("typeAnnotation",or(def("TypeAnnotation"),null),defaults["null"]);def("TypeParameterDeclaration").bases("Node").build("params").field("params",[def("TypeParameter")]);def("TypeParameterInstantiation").bases("Node").build("params").field("params",[def("Type")]);def("TypeParameter").bases("Type").build("name","variance","bound").field("name",String).field("variance",or("plus","minus",null),defaults["null"]).field("bound",or(def("TypeAnnotation"),null),defaults["null"]);def("Function").field("returnType",or(def("TypeAnnotation"),null),defaults["null"]).field("typeParameters",or(def("TypeParameterDeclaration"),null),defaults["null"]);def("ClassProperty").build("key","value","typeAnnotation","static").field("value",or(def("Expression"),null)).field("typeAnnotation",or(def("TypeAnnotation"),null)).field("static",Boolean,defaults["false"]);def("ClassImplements").field("typeParameters",or(def("TypeParameterInstantiation"),null),defaults["null"]);def("InterfaceDeclaration").bases("Declaration").build("id","body","extends").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterDeclaration"),null),defaults["null"]).field("body",def("ObjectTypeAnnotation")).field("extends",[def("InterfaceExtends")]);def("DeclareInterface").bases("InterfaceDeclaration").build("id","body","extends");def("InterfaceExtends").bases("Node").build("id").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterInstantiation"),null));def("TypeAlias").bases("Declaration").build("id","typeParameters","right").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterDeclaration"),null)).field("right",def("Type"));def("DeclareTypeAlias").bases("TypeAlias").build("id","typeParameters","right");def("TypeCastExpression").bases("Expression").build("expression","typeAnnotation").field("expression",def("Expression")).field("typeAnnotation",def("TypeAnnotation"));def("TupleTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("DeclareVariable").bases("Statement").build("id").field("id",def("Identifier"));def("DeclareFunction").bases("Statement").build("id").field("id",def("Identifier"));def("DeclareClass").bases("InterfaceDeclaration").build("id");def("DeclareModule").bases("Statement").build("id","body").field("id",or(def("Identifier"),def("Literal"))).field("body",def("BlockStatement"));def("DeclareExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",or(def("DeclareVariable"),def("DeclareFunction"),def("DeclareClass"),def("Type"),null)).field("specifiers",[or(def("ExportSpecifier"),def("ExportBatchSpecifier"))],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"])},{"../lib/shared":47,"../lib/types":48,"./es7":37}],40:[function(require,module,exports){require("./es7");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;var defaults=require("../lib/shared").defaults;def("JSXAttribute").bases("Node").build("name","value").field("name",or(def("JSXIdentifier"),def("JSXNamespacedName"))).field("value",or(def("Literal"),def("JSXExpressionContainer"),null),defaults["null"]);def("JSXIdentifier").bases("Identifier").build("name").field("name",String);def("JSXNamespacedName").bases("Node").build("namespace","name").field("namespace",def("JSXIdentifier")).field("name",def("JSXIdentifier"));def("JSXMemberExpression").bases("MemberExpression").build("object","property").field("object",or(def("JSXIdentifier"),def("JSXMemberExpression"))).field("property",def("JSXIdentifier")).field("computed",Boolean,defaults.false);var JSXElementName=or(def("JSXIdentifier"),def("JSXNamespacedName"),def("JSXMemberExpression"));def("JSXSpreadAttribute").bases("Node").build("argument").field("argument",def("Expression"));var JSXAttributes=[or(def("JSXAttribute"),def("JSXSpreadAttribute"))];def("JSXExpressionContainer").bases("Expression").build("expression").field("expression",def("Expression"));def("JSXElement").bases("Expression").build("openingElement","closingElement","children").field("openingElement",def("JSXOpeningElement")).field("closingElement",or(def("JSXClosingElement"),null),defaults["null"]).field("children",[or(def("JSXElement"),def("JSXExpressionContainer"),def("JSXText"),def("Literal"))],defaults.emptyArray).field("name",JSXElementName,function(){return this.openingElement.name},true).field("selfClosing",Boolean,function(){return this.openingElement.selfClosing},true).field("attributes",JSXAttributes,function(){return this.openingElement.attributes},true);def("JSXOpeningElement").bases("Node").build("name","attributes","selfClosing").field("name",JSXElementName).field("attributes",JSXAttributes,defaults.emptyArray).field("selfClosing",Boolean,defaults["false"]);def("JSXClosingElement").bases("Node").build("name").field("name",JSXElementName);def("JSXText").bases("Literal").build("value").field("value",String);def("JSXEmptyExpression").bases("Expression").build()},{"../lib/shared":47,"../lib/types":48,"./es7":37}],41:[function(require,module,exports){require("./core");var types=require("../lib/types");var def=types.Type.def;var or=types.Type.or;var shared=require("../lib/shared");var geq=shared.geq;var defaults=shared.defaults;def("Function").field("body",or(def("BlockStatement"),def("Expression")));def("ForInStatement").build("left","right","body","each").field("each",Boolean,defaults["false"]);def("ForOfStatement").bases("Statement").build("left","right","body").field("left",or(def("VariableDeclaration"),def("Expression"))).field("right",def("Expression")).field("body",def("Statement"));def("LetStatement").bases("Statement").build("head","body").field("head",[def("VariableDeclarator")]).field("body",def("Statement"));def("LetExpression").bases("Expression").build("head","body").field("head",[def("VariableDeclarator")]).field("body",def("Expression"));def("GraphExpression").bases("Expression").build("index","expression").field("index",geq(0)).field("expression",def("Literal"));def("GraphIndexExpression").bases("Expression").build("index").field("index",geq(0))},{"../lib/shared":47,"../lib/types":48,"./core":34}],42:[function(require,module,exports){var types=require("../main");var getFieldNames=types.getFieldNames;var getFieldValue=types.getFieldValue;var isArray=types.builtInTypes.array;var isObject=types.builtInTypes.object;var isDate=types.builtInTypes.Date;var isRegExp=types.builtInTypes.RegExp;var hasOwn=Object.prototype.hasOwnProperty;function astNodesAreEquivalent(a,b,problemPath){if(isArray.check(problemPath)){problemPath.length=0}else{problemPath=null}return areEquivalent(a,b,problemPath)}astNodesAreEquivalent.assert=function(a,b){var problemPath=[];if(!astNodesAreEquivalent(a,b,problemPath)){if(problemPath.length===0){if(a!==b){throw new Error("Nodes must be equal")}}else{throw new Error("Nodes differ in the following path: "+problemPath.map(subscriptForProperty).join(""))}}};function subscriptForProperty(property){if(/[_$a-z][_$a-z0-9]*/i.test(property)){return"."+property}return"["+JSON.stringify(property)+"]"}function areEquivalent(a,b,problemPath){if(a===b){return true}if(isArray.check(a)){return arraysAreEquivalent(a,b,problemPath)}if(isObject.check(a)){return objectsAreEquivalent(a,b,problemPath)}if(isDate.check(a)){return isDate.check(b)&&+a===+b}if(isRegExp.check(a)){return isRegExp.check(b)&&(a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.ignoreCase===b.ignoreCase)}return a==b}function arraysAreEquivalent(a,b,problemPath){isArray.assert(a);var aLength=a.length;if(!isArray.check(b)||b.length!==aLength){if(problemPath){problemPath.push("length")}return false}for(var i=0;i<aLength;++i){if(problemPath){problemPath.push(i)}if(i in a!==i in b){return false}if(!areEquivalent(a[i],b[i],problemPath)){return false}if(problemPath){var problemPathTail=problemPath.pop();if(problemPathTail!==i){throw new Error(""+problemPathTail)}}}return true}function objectsAreEquivalent(a,b,problemPath){isObject.assert(a);if(!isObject.check(b)){return false}if(a.type!==b.type){if(problemPath){problemPath.push("type")}return false}var aNames=getFieldNames(a);var aNameCount=aNames.length;var bNames=getFieldNames(b);var bNameCount=bNames.length;if(aNameCount===bNameCount){for(var i=0;i<aNameCount;++i){var name=aNames[i];var aChild=getFieldValue(a,name);var bChild=getFieldValue(b,name);if(problemPath){problemPath.push(name)}if(!areEquivalent(aChild,bChild,problemPath)){return false}if(problemPath){var problemPathTail=problemPath.pop();if(problemPathTail!==name){throw new Error(""+problemPathTail)}}}return true}if(!problemPath){return false}var seenNames=Object.create(null);for(i=0;i<aNameCount;++i){seenNames[aNames[i]]=true}for(i=0;i<bNameCount;++i){name=bNames[i];if(!hasOwn.call(seenNames,name)){problemPath.push(name);return false}delete seenNames[name]}for(name in seenNames){problemPath.push(name);break}return false}module.exports=astNodesAreEquivalent},{"../main":49}],43:[function(require,module,exports){var types=require("./types");var n=types.namedTypes;var b=types.builders;var isNumber=types.builtInTypes.number;var isArray=types.builtInTypes.array;var Path=require("./path");var Scope=require("./scope");function NodePath(value,parentPath,name){if(!(this instanceof NodePath)){throw new Error("NodePath constructor cannot be invoked without 'new'")}Path.call(this,value,parentPath,name)}var NPp=NodePath.prototype=Object.create(Path.prototype,{constructor:{value:NodePath,enumerable:false,writable:true,configurable:true}});Object.defineProperties(NPp,{node:{get:function(){Object.defineProperty(this,"node",{configurable:true,value:this._computeNode()});return this.node}},parent:{get:function(){Object.defineProperty(this,"parent",{configurable:true,value:this._computeParent()});return this.parent}},scope:{get:function(){Object.defineProperty(this,"scope",{configurable:true,value:this._computeScope()});return this.scope}}});NPp.replace=function(){delete this.node;delete this.parent;delete this.scope;return Path.prototype.replace.apply(this,arguments)};NPp.prune=function(){var remainingNodePath=this.parent;this.replace();return cleanUpNodesAfterPrune(remainingNodePath)};NPp._computeNode=function(){var value=this.value;if(n.Node.check(value)){return value}var pp=this.parentPath;return pp&&pp.node||null};NPp._computeParent=function(){var value=this.value;var pp=this.parentPath;if(!n.Node.check(value)){while(pp&&!n.Node.check(pp.value)){pp=pp.parentPath}if(pp){pp=pp.parentPath}}while(pp&&!n.Node.check(pp.value)){pp=pp.parentPath}return pp||null};NPp._computeScope=function(){var value=this.value;var pp=this.parentPath;var scope=pp&&pp.scope;if(n.Node.check(value)&&Scope.isEstablishedBy(value)){scope=new Scope(this,scope)}return scope||null};NPp.getValueProperty=function(name){return types.getFieldValue(this.value,name)};NPp.needsParens=function(assumeExpressionContext){var pp=this.parentPath;if(!pp){return false}var node=this.value;if(!n.Expression.check(node)){return false}if(node.type==="Identifier"){return false}while(!n.Node.check(pp.value)){pp=pp.parentPath;if(!pp){return false}}var parent=pp.value;switch(node.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return parent.type==="MemberExpression"&&this.name==="object"&&parent.object===node;case"BinaryExpression":case"LogicalExpression":switch(parent.type){case"CallExpression":return this.name==="callee"&&parent.callee===node;case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return true;case"MemberExpression":return this.name==="object"&&parent.object===node;case"BinaryExpression":case"LogicalExpression":var po=parent.operator;var pp=PRECEDENCE[po];var no=node.operator;var np=PRECEDENCE[no];if(pp>np){return true}if(pp===np&&this.name==="right"){if(parent.right!==node){throw new Error("Nodes must be equal")}return true}default:return false}case"SequenceExpression":switch(parent.type){case"ForStatement":return false;case"ExpressionStatement":return this.name!=="expression";default:return true}case"YieldExpression":switch(parent.type){case"BinaryExpression":case"LogicalExpression":case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"CallExpression":case"MemberExpression":case"NewExpression":case"ConditionalExpression":case"YieldExpression":return true;default:return false}case"Literal":return parent.type==="MemberExpression"&&isNumber.check(node.value)&&this.name==="object"&&parent.object===node;case"AssignmentExpression":case"ConditionalExpression":switch(parent.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"BinaryExpression":case"LogicalExpression":return true;case"CallExpression":return this.name==="callee"&&parent.callee===node;case"ConditionalExpression":return this.name==="test"&&parent.test===node;case"MemberExpression":return this.name==="object"&&parent.object===node;default:return false}default:if(parent.type==="NewExpression"&&this.name==="callee"&&parent.callee===node){return containsCallExpression(node)}}if(assumeExpressionContext!==true&&!this.canBeFirstInStatement()&&this.firstInStatement())return true;return false};function isBinary(node){return n.BinaryExpression.check(node)||n.LogicalExpression.check(node)}function isUnaryLike(node){return n.UnaryExpression.check(node)||n.SpreadElement&&n.SpreadElement.check(node)||n.SpreadProperty&&n.SpreadProperty.check(node)}var PRECEDENCE={};[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]].forEach(function(tier,i){tier.forEach(function(op){PRECEDENCE[op]=i})});function containsCallExpression(node){if(n.CallExpression.check(node)){return true}if(isArray.check(node)){return node.some(containsCallExpression)}if(n.Node.check(node)){return types.someField(node,function(name,child){return containsCallExpression(child)})}return false}NPp.canBeFirstInStatement=function(){var node=this.node;return!n.FunctionExpression.check(node)&&!n.ObjectExpression.check(node)};NPp.firstInStatement=function(){return firstInStatement(this)};function firstInStatement(path){for(var node,parent;path.parent;path=path.parent){node=path.node;parent=path.parent.node;if(n.BlockStatement.check(parent)&&path.parent.name==="body"&&path.name===0){if(parent.body[0]!==node){throw new Error("Nodes must be equal")}return true}if(n.ExpressionStatement.check(parent)&&path.name==="expression"){if(parent.expression!==node){throw new Error("Nodes must be equal")}return true}if(n.SequenceExpression.check(parent)&&path.parent.name==="expressions"&&path.name===0){if(parent.expressions[0]!==node){throw new Error("Nodes must be equal")}continue}if(n.CallExpression.check(parent)&&path.name==="callee"){if(parent.callee!==node){throw new Error("Nodes must be equal")}continue}if(n.MemberExpression.check(parent)&&path.name==="object"){if(parent.object!==node){throw new Error("Nodes must be equal")}continue}if(n.ConditionalExpression.check(parent)&&path.name==="test"){if(parent.test!==node){throw new Error("Nodes must be equal")}continue}if(isBinary(parent)&&path.name==="left"){if(parent.left!==node){throw new Error("Nodes must be equal")}continue}if(n.UnaryExpression.check(parent)&&!parent.prefix&&path.name==="argument"){if(parent.argument!==node){throw new Error("Nodes must be equal")}continue}return false}return true}function cleanUpNodesAfterPrune(remainingNodePath){if(n.VariableDeclaration.check(remainingNodePath.node)){var declarations=remainingNodePath.get("declarations").value;if(!declarations||declarations.length===0){return remainingNodePath.prune()}}else if(n.ExpressionStatement.check(remainingNodePath.node)){if(!remainingNodePath.get("expression").value){return remainingNodePath.prune()}}else if(n.IfStatement.check(remainingNodePath.node)){cleanUpIfStatementAfterPrune(remainingNodePath)}return remainingNodePath}function cleanUpIfStatementAfterPrune(ifStatement){var testExpression=ifStatement.get("test").value;var alternate=ifStatement.get("alternate").value;var consequent=ifStatement.get("consequent").value;if(!consequent&&!alternate){var testExpressionStatement=b.expressionStatement(testExpression);ifStatement.replace(testExpressionStatement)}else if(!consequent&&alternate){var negatedTestExpression=b.unaryExpression("!",testExpression,true);if(n.UnaryExpression.check(testExpression)&&testExpression.operator==="!"){negatedTestExpression=testExpression.argument}ifStatement.get("test").replace(negatedTestExpression);ifStatement.get("consequent").replace(alternate);ifStatement.get("alternate").replace()}}module.exports=NodePath},{"./path":45,"./scope":46,"./types":48}],44:[function(require,module,exports){var types=require("./types");var NodePath=require("./node-path");var Printable=types.namedTypes.Printable;var isArray=types.builtInTypes.array;var isObject=types.builtInTypes.object;var isFunction=types.builtInTypes.function;var hasOwn=Object.prototype.hasOwnProperty;var undefined;function PathVisitor(){if(!(this instanceof PathVisitor)){throw new Error("PathVisitor constructor cannot be invoked without 'new'")}this._reusableContextStack=[];this._methodNameTable=computeMethodNameTable(this);this._shouldVisitComments=hasOwn.call(this._methodNameTable,"Block")||hasOwn.call(this._methodNameTable,"Line");this.Context=makeContextConstructor(this);this._visiting=false;this._changeReported=false}function computeMethodNameTable(visitor){var typeNames=Object.create(null);for(var methodName in visitor){if(/^visit[A-Z]/.test(methodName)){typeNames[methodName.slice("visit".length)]=true}}var supertypeTable=types.computeSupertypeLookupTable(typeNames);var methodNameTable=Object.create(null);var typeNames=Object.keys(supertypeTable);var typeNameCount=typeNames.length;

for(var i=0;i<typeNameCount;++i){var typeName=typeNames[i];methodName="visit"+supertypeTable[typeName];if(isFunction.check(visitor[methodName])){methodNameTable[typeName]=methodName}}return methodNameTable}PathVisitor.fromMethodsObject=function fromMethodsObject(methods){if(methods instanceof PathVisitor){return methods}if(!isObject.check(methods)){return new PathVisitor}function Visitor(){if(!(this instanceof Visitor)){throw new Error("Visitor constructor cannot be invoked without 'new'")}PathVisitor.call(this)}var Vp=Visitor.prototype=Object.create(PVp);Vp.constructor=Visitor;extend(Vp,methods);extend(Visitor,PathVisitor);isFunction.assert(Visitor.fromMethodsObject);isFunction.assert(Visitor.visit);return new Visitor};function extend(target,source){for(var property in source){if(hasOwn.call(source,property)){target[property]=source[property]}}return target}PathVisitor.visit=function visit(node,methods){return PathVisitor.fromMethodsObject(methods).visit(node)};var PVp=PathVisitor.prototype;PVp.visit=function(){if(this._visiting){throw new Error("Recursively calling visitor.visit(path) resets visitor state. "+"Try this.visit(path) or this.traverse(path) instead.")}this._visiting=true;this._changeReported=false;this._abortRequested=false;var argc=arguments.length;var args=new Array(argc);for(var i=0;i<argc;++i){args[i]=arguments[i]}if(!(args[0]instanceof NodePath)){args[0]=new NodePath({root:args[0]}).get("root")}this.reset.apply(this,args);try{var root=this.visitWithoutReset(args[0]);var didNotThrow=true}finally{this._visiting=false;if(!didNotThrow&&this._abortRequested){return args[0].value}}return root};PVp.AbortRequest=function AbortRequest(){};PVp.abort=function(){var visitor=this;visitor._abortRequested=true;var request=new visitor.AbortRequest;request.cancel=function(){visitor._abortRequested=false};throw request};PVp.reset=function(path){};PVp.visitWithoutReset=function(path){if(this instanceof this.Context){return this.visitor.visitWithoutReset(path)}if(!(path instanceof NodePath)){throw new Error("")}var value=path.value;var methodName=value&&typeof value==="object"&&typeof value.type==="string"&&this._methodNameTable[value.type];if(methodName){var context=this.acquireContext(path);try{return context.invokeVisitorMethod(methodName)}finally{this.releaseContext(context)}}else{return visitChildren(path,this)}};function visitChildren(path,visitor){if(!(path instanceof NodePath)){throw new Error("")}if(!(visitor instanceof PathVisitor)){throw new Error("")}var value=path.value;if(isArray.check(value)){path.each(visitor.visitWithoutReset,visitor)}else if(!isObject.check(value)){}else{var childNames=types.getFieldNames(value);if(visitor._shouldVisitComments&&value.comments&&childNames.indexOf("comments")<0){childNames.push("comments")}var childCount=childNames.length;var childPaths=[];for(var i=0;i<childCount;++i){var childName=childNames[i];if(!hasOwn.call(value,childName)){value[childName]=types.getFieldValue(value,childName)}childPaths.push(path.get(childName))}for(var i=0;i<childCount;++i){visitor.visitWithoutReset(childPaths[i])}}return path.value}PVp.acquireContext=function(path){if(this._reusableContextStack.length===0){return new this.Context(path)}return this._reusableContextStack.pop().reset(path)};PVp.releaseContext=function(context){if(!(context instanceof this.Context)){throw new Error("")}this._reusableContextStack.push(context);context.currentPath=null};PVp.reportChanged=function(){this._changeReported=true};PVp.wasChangeReported=function(){return this._changeReported};function makeContextConstructor(visitor){function Context(path){if(!(this instanceof Context)){throw new Error("")}if(!(this instanceof PathVisitor)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}Object.defineProperty(this,"visitor",{value:visitor,writable:false,enumerable:true,configurable:false});this.currentPath=path;this.needToCallTraverse=true;Object.seal(this)}if(!(visitor instanceof PathVisitor)){throw new Error("")}var Cp=Context.prototype=Object.create(visitor);Cp.constructor=Context;extend(Cp,sharedContextProtoMethods);return Context}var sharedContextProtoMethods=Object.create(null);sharedContextProtoMethods.reset=function reset(path){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}this.currentPath=path;this.needToCallTraverse=true;return this};sharedContextProtoMethods.invokeVisitorMethod=function invokeVisitorMethod(methodName){if(!(this instanceof this.Context)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}var result=this.visitor[methodName].call(this,this.currentPath);if(result===false){this.needToCallTraverse=false}else if(result!==undefined){this.currentPath=this.currentPath.replace(result)[0];if(this.needToCallTraverse){this.traverse(this.currentPath)}}if(this.needToCallTraverse!==false){throw new Error("Must either call this.traverse or return false in "+methodName)}var path=this.currentPath;return path&&path.value};sharedContextProtoMethods.traverse=function traverse(path,newVisitor){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}this.needToCallTraverse=false;return visitChildren(path,PathVisitor.fromMethodsObject(newVisitor||this.visitor))};sharedContextProtoMethods.visit=function visit(path,newVisitor){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}this.needToCallTraverse=false;return PathVisitor.fromMethodsObject(newVisitor||this.visitor).visitWithoutReset(path)};sharedContextProtoMethods.reportChanged=function reportChanged(){this.visitor.reportChanged()};sharedContextProtoMethods.abort=function abort(){this.needToCallTraverse=false;this.visitor.abort()};module.exports=PathVisitor},{"./node-path":43,"./types":48}],45:[function(require,module,exports){var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var types=require("./types");var isArray=types.builtInTypes.array;var isNumber=types.builtInTypes.number;var Ap=Array.prototype;var slice=Ap.slice;var map=Ap.map;function Path(value,parentPath,name){if(!(this instanceof Path)){throw new Error("Path constructor cannot be invoked without 'new'")}if(parentPath){if(!(parentPath instanceof Path)){throw new Error("")}}else{parentPath=null;name=null}this.value=value;this.parentPath=parentPath;this.name=name;this.__childCache=null}var Pp=Path.prototype;function getChildCache(path){return path.__childCache||(path.__childCache=Object.create(null))}function getChildPath(path,name){var cache=getChildCache(path);var actualChildValue=path.getValueProperty(name);var childPath=cache[name];if(!hasOwn.call(cache,name)||childPath.value!==actualChildValue){childPath=cache[name]=new path.constructor(actualChildValue,path,name)}return childPath}Pp.getValueProperty=function getValueProperty(name){return this.value[name]};Pp.get=function get(name){var path=this;var names=arguments;var count=names.length;for(var i=0;i<count;++i){path=getChildPath(path,names[i])}return path};Pp.each=function each(callback,context){var childPaths=[];var len=this.value.length;var i=0;for(var i=0;i<len;++i){if(hasOwn.call(this.value,i)){childPaths[i]=this.get(i)}}context=context||this;for(i=0;i<len;++i){if(hasOwn.call(childPaths,i)){callback.call(context,childPaths[i])}}};Pp.map=function map(callback,context){var result=[];this.each(function(childPath){result.push(callback.call(this,childPath))},context);return result};Pp.filter=function filter(callback,context){var result=[];this.each(function(childPath){if(callback.call(this,childPath)){result.push(childPath)}},context);return result};function emptyMoves(){}function getMoves(path,offset,start,end){isArray.assert(path.value);if(offset===0){return emptyMoves}var length=path.value.length;if(length<1){return emptyMoves}var argc=arguments.length;if(argc===2){start=0;end=length}else if(argc===3){start=Math.max(start,0);end=length}else{start=Math.max(start,0);end=Math.min(end,length)}isNumber.assert(start);isNumber.assert(end);var moves=Object.create(null);var cache=getChildCache(path);for(var i=start;i<end;++i){if(hasOwn.call(path.value,i)){var childPath=path.get(i);if(childPath.name!==i){throw new Error("")}var newIndex=i+offset;childPath.name=newIndex;moves[newIndex]=childPath;delete cache[i]}}delete cache.length;return function(){for(var newIndex in moves){var childPath=moves[newIndex];if(childPath.name!==+newIndex){throw new Error("")}cache[newIndex]=childPath;path.value[newIndex]=childPath.value}}}Pp.shift=function shift(){var move=getMoves(this,-1);var result=this.value.shift();move();return result};Pp.unshift=function unshift(node){var move=getMoves(this,arguments.length);var result=this.value.unshift.apply(this.value,arguments);move();return result};Pp.push=function push(node){isArray.assert(this.value);delete getChildCache(this).length;return this.value.push.apply(this.value,arguments)};Pp.pop=function pop(){isArray.assert(this.value);var cache=getChildCache(this);delete cache[this.value.length-1];delete cache.length;return this.value.pop()};Pp.insertAt=function insertAt(index,node){var argc=arguments.length;var move=getMoves(this,argc-1,index);if(move===emptyMoves){return this}index=Math.max(index,0);for(var i=1;i<argc;++i){this.value[index+i-1]=arguments[i]}move();return this};Pp.insertBefore=function insertBefore(node){var pp=this.parentPath;var argc=arguments.length;var insertAtArgs=[this.name];for(var i=0;i<argc;++i){insertAtArgs.push(arguments[i])}return pp.insertAt.apply(pp,insertAtArgs)};Pp.insertAfter=function insertAfter(node){var pp=this.parentPath;var argc=arguments.length;var insertAtArgs=[this.name+1];for(var i=0;i<argc;++i){insertAtArgs.push(arguments[i])}return pp.insertAt.apply(pp,insertAtArgs)};function repairRelationshipWithParent(path){if(!(path instanceof Path)){throw new Error("")}var pp=path.parentPath;if(!pp){return path}var parentValue=pp.value;var parentCache=getChildCache(pp);if(parentValue[path.name]===path.value){parentCache[path.name]=path}else if(isArray.check(parentValue)){var i=parentValue.indexOf(path.value);if(i>=0){parentCache[path.name=i]=path}}else{parentValue[path.name]=path.value;parentCache[path.name]=path}if(parentValue[path.name]!==path.value){throw new Error("")}if(path.parentPath.get(path.name)!==path){throw new Error("")}return path}Pp.replace=function replace(replacement){var results=[];var parentValue=this.parentPath.value;var parentCache=getChildCache(this.parentPath);var count=arguments.length;repairRelationshipWithParent(this);if(isArray.check(parentValue)){var originalLength=parentValue.length;var move=getMoves(this.parentPath,count-1,this.name+1);var spliceArgs=[this.name,1];for(var i=0;i<count;++i){spliceArgs.push(arguments[i])}var splicedOut=parentValue.splice.apply(parentValue,spliceArgs);if(splicedOut[0]!==this.value){throw new Error("")}if(parentValue.length!==originalLength-1+count){throw new Error("")}move();if(count===0){delete this.value;delete parentCache[this.name];this.__childCache=null}else{if(parentValue[this.name]!==replacement){throw new Error("")}if(this.value!==replacement){this.value=replacement;this.__childCache=null}for(i=0;i<count;++i){results.push(this.parentPath.get(this.name+i))}if(results[0]!==this){throw new Error("")}}}else if(count===1){if(this.value!==replacement){this.__childCache=null}this.value=parentValue[this.name]=replacement;results.push(this)}else if(count===0){delete parentValue[this.name];delete this.value;this.__childCache=null}else{throw new Error("Could not replace path")}return results};module.exports=Path},{"./types":48}],46:[function(require,module,exports){var types=require("./types");var Type=types.Type;var namedTypes=types.namedTypes;var Node=namedTypes.Node;var Expression=namedTypes.Expression;var isArray=types.builtInTypes.array;var hasOwn=Object.prototype.hasOwnProperty;var b=types.builders;function Scope(path,parentScope){if(!(this instanceof Scope)){throw new Error("Scope constructor cannot be invoked without 'new'")}if(!(path instanceof require("./node-path"))){throw new Error("")}ScopeType.assert(path.value);var depth;if(parentScope){if(!(parentScope instanceof Scope)){throw new Error("")}depth=parentScope.depth+1}else{parentScope=null;depth=0}Object.defineProperties(this,{path:{value:path},node:{value:path.value},isGlobal:{value:!parentScope,enumerable:true},depth:{value:depth},parent:{value:parentScope},bindings:{value:{}},types:{value:{}}})}var scopeTypes=[namedTypes.Program,namedTypes.Function,namedTypes.CatchClause];var ScopeType=Type.or.apply(Type,scopeTypes);Scope.isEstablishedBy=function(node){return ScopeType.check(node)};var Sp=Scope.prototype;Sp.didScan=false;Sp.declares=function(name){this.scan();return hasOwn.call(this.bindings,name)};Sp.declaresType=function(name){this.scan();return hasOwn.call(this.types,name)};Sp.declareTemporary=function(prefix){if(prefix){if(!/^[a-z$_]/i.test(prefix)){throw new Error("")}}else{prefix="t$"}prefix+=this.depth.toString(36)+"$";this.scan();var index=0;while(this.declares(prefix+index)){++index}var name=prefix+index;return this.bindings[name]=types.builders.identifier(name)};Sp.injectTemporary=function(identifier,init){identifier||(identifier=this.declareTemporary());var bodyPath=this.path.get("body");if(namedTypes.BlockStatement.check(bodyPath.value)){bodyPath=bodyPath.get("body")}bodyPath.unshift(b.variableDeclaration("var",[b.variableDeclarator(identifier,init||null)]));return identifier};Sp.scan=function(force){if(force||!this.didScan){for(var name in this.bindings){delete this.bindings[name]}scanScope(this.path,this.bindings,this.types);this.didScan=true}};Sp.getBindings=function(){this.scan();return this.bindings};Sp.getTypes=function(){this.scan();return this.types};function scanScope(path,bindings,scopeTypes){var node=path.value;ScopeType.assert(node);if(namedTypes.CatchClause.check(node)){addPattern(path.get("param"),bindings)}else{recursiveScanScope(path,bindings,scopeTypes)}}function recursiveScanScope(path,bindings,scopeTypes){var node=path.value;if(path.parent&&namedTypes.FunctionExpression.check(path.parent.node)&&path.parent.node.id){addPattern(path.parent.get("id"),bindings)}if(!node){}else if(isArray.check(node)){path.each(function(childPath){recursiveScanChild(childPath,bindings,scopeTypes)})}else if(namedTypes.Function.check(node)){path.get("params").each(function(paramPath){addPattern(paramPath,bindings)});recursiveScanChild(path.get("body"),bindings,scopeTypes)}else if(namedTypes.TypeAlias&&namedTypes.TypeAlias.check(node)){addTypePattern(path.get("id"),scopeTypes)}else if(namedTypes.VariableDeclarator.check(node)){addPattern(path.get("id"),bindings);recursiveScanChild(path.get("init"),bindings,scopeTypes)}else if(node.type==="ImportSpecifier"||node.type==="ImportNamespaceSpecifier"||node.type==="ImportDefaultSpecifier"){addPattern(path.get(node.local?"local":node.name?"name":"id"),bindings)}else if(Node.check(node)&&!Expression.check(node)){types.eachField(node,function(name,child){var childPath=path.get(name);if(!pathHasValue(childPath,child)){throw new Error("")}recursiveScanChild(childPath,bindings,scopeTypes)})}}function pathHasValue(path,value){if(path.value===value){return true}if(Array.isArray(path.value)&&path.value.length===0&&Array.isArray(value)&&value.length===0){return true}return false}function recursiveScanChild(path,bindings,scopeTypes){var node=path.value;if(!node||Expression.check(node)){}else if(namedTypes.FunctionDeclaration.check(node)){addPattern(path.get("id"),bindings)}else if(namedTypes.ClassDeclaration&&namedTypes.ClassDeclaration.check(node)){addPattern(path.get("id"),bindings)}else if(ScopeType.check(node)){if(namedTypes.CatchClause.check(node)){var catchParamName=node.param.name;var hadBinding=hasOwn.call(bindings,catchParamName);recursiveScanScope(path.get("body"),bindings,scopeTypes);if(!hadBinding){delete bindings[catchParamName]}}}else{recursiveScanScope(path,bindings,scopeTypes)}}function addPattern(patternPath,bindings){var pattern=patternPath.value;namedTypes.Pattern.assert(pattern);if(namedTypes.Identifier.check(pattern)){if(hasOwn.call(bindings,pattern.name)){bindings[pattern.name].push(patternPath)}else{bindings[pattern.name]=[patternPath]}}else if(namedTypes.ObjectPattern&&namedTypes.ObjectPattern.check(pattern)){patternPath.get("properties").each(function(propertyPath){var property=propertyPath.value;if(namedTypes.Pattern.check(property)){addPattern(propertyPath,bindings)}else if(namedTypes.Property.check(property)){addPattern(propertyPath.get("value"),bindings)}else if(namedTypes.SpreadProperty&&namedTypes.SpreadProperty.check(property)){addPattern(propertyPath.get("argument"),bindings)}})}else if(namedTypes.ArrayPattern&&namedTypes.ArrayPattern.check(pattern)){patternPath.get("elements").each(function(elementPath){var element=elementPath.value;if(namedTypes.Pattern.check(element)){addPattern(elementPath,bindings)}else if(namedTypes.SpreadElement&&namedTypes.SpreadElement.check(element)){addPattern(elementPath.get("argument"),bindings)}})}else if(namedTypes.PropertyPattern&&namedTypes.PropertyPattern.check(pattern)){addPattern(patternPath.get("pattern"),bindings)}else if(namedTypes.SpreadElementPattern&&namedTypes.SpreadElementPattern.check(pattern)||namedTypes.SpreadPropertyPattern&&namedTypes.SpreadPropertyPattern.check(pattern)){addPattern(patternPath.get("argument"),bindings)}}function addTypePattern(patternPath,types){var pattern=patternPath.value;namedTypes.Pattern.assert(pattern);if(namedTypes.Identifier.check(pattern)){if(hasOwn.call(types,pattern.name)){types[pattern.name].push(patternPath)}else{types[pattern.name]=[patternPath]}}}Sp.lookup=function(name){for(var scope=this;scope;scope=scope.parent)if(scope.declares(name))break;return scope};Sp.lookupType=function(name){for(var scope=this;scope;scope=scope.parent)if(scope.declaresType(name))break;return scope};Sp.getGlobalScope=function(){var scope=this;while(!scope.isGlobal)scope=scope.parent;return scope};module.exports=Scope},{"./node-path":43,"./types":48}],47:[function(require,module,exports){var types=require("../lib/types");var Type=types.Type;var builtin=types.builtInTypes;var isNumber=builtin.number;exports.geq=function(than){return new Type(function(value){return isNumber.check(value)&&value>=than},isNumber+" >= "+than)};exports.defaults={"null":function(){return null},emptyArray:function(){return[]},"false":function(){return false},"true":function(){return true},undefined:function(){}};var naiveIsPrimitive=Type.or(builtin.string,builtin.number,builtin.boolean,builtin.null,builtin.undefined);exports.isPrimitive=new Type(function(value){if(value===null)return true;var type=typeof value;return!(type==="object"||type==="function")},naiveIsPrimitive.toString())},{"../lib/types":48}],48:[function(require,module,exports){var Ap=Array.prototype;var slice=Ap.slice;var map=Ap.map;var each=Ap.forEach;var Op=Object.prototype;var objToStr=Op.toString;var funObjStr=objToStr.call(function(){});var strObjStr=objToStr.call("");var hasOwn=Op.hasOwnProperty;function Type(check,name){var self=this;if(!(self instanceof Type)){throw new Error("Type constructor cannot be invoked without 'new'")}if(objToStr.call(check)!==funObjStr){throw new Error(check+" is not a function")}var nameObjStr=objToStr.call(name);if(!(nameObjStr===funObjStr||nameObjStr===strObjStr)){throw new Error(name+" is neither a function nor a string")}Object.defineProperties(self,{name:{value:name},check:{value:function(value,deep){var result=check.call(self,value,deep);if(!result&&deep&&objToStr.call(deep)===funObjStr)deep(self,value);return result}}})}var Tp=Type.prototype;exports.Type=Type;Tp.assert=function(value,deep){if(!this.check(value,deep)){var str=shallowStringify(value);throw new Error(str+" does not match type "+this)}return true};function shallowStringify(value){if(isObject.check(value))return"{"+Object.keys(value).map(function(key){return key+": "+value[key]}).join(", ")+"}";if(isArray.check(value))return"["+value.map(shallowStringify).join(", ")+"]";return JSON.stringify(value)}Tp.toString=function(){var name=this.name;if(isString.check(name))return name;if(isFunction.check(name))return name.call(this)+"";return name+" type"};var builtInCtorFns=[];var builtInCtorTypes=[];var builtInTypes={};exports.builtInTypes=builtInTypes;function defBuiltInType(example,name){var objStr=objToStr.call(example);var type=new Type(function(value){return objToStr.call(value)===objStr},name);builtInTypes[name]=type;if(example&&typeof example.constructor==="function"){builtInCtorFns.push(example.constructor);builtInCtorTypes.push(type)}return type}var isString=defBuiltInType("truthy","string");var isFunction=defBuiltInType(function(){},"function");var isArray=defBuiltInType([],"array");var isObject=defBuiltInType({},"object");var isRegExp=defBuiltInType(/./,"RegExp");var isDate=defBuiltInType(new Date,"Date");var isNumber=defBuiltInType(3,"number");var isBoolean=defBuiltInType(true,"boolean");var isNull=defBuiltInType(null,"null");var isUndefined=defBuiltInType(void 0,"undefined");function toType(from,name){if(from instanceof Type)return from;if(from instanceof Def)return from.type;if(isArray.check(from))return Type.fromArray(from);if(isObject.check(from))return Type.fromObject(from);if(isFunction.check(from)){var bicfIndex=builtInCtorFns.indexOf(from);if(bicfIndex>=0){return builtInCtorTypes[bicfIndex]}return new Type(from,name)}return new Type(function(value){return value===from},isUndefined.check(name)?function(){return from+""}:name)}Type.or=function(){var types=[];var len=arguments.length;for(var i=0;i<len;++i)types.push(toType(arguments[i]));return new Type(function(value,deep){for(var i=0;i<len;++i)if(types[i].check(value,deep))return true;return false},function(){return types.join(" | ")})};Type.fromArray=function(arr){if(!isArray.check(arr)){throw new Error("")}if(arr.length!==1){throw new Error("only one element type is permitted for typed arrays")}return toType(arr[0]).arrayOf()};Tp.arrayOf=function(){var elemType=this;return new Type(function(value,deep){return isArray.check(value)&&value.every(function(elem){return elemType.check(elem,deep)})},function(){return"["+elemType+"]"})};Type.fromObject=function(obj){var fields=Object.keys(obj).map(function(name){return new Field(name,obj[name])});return new Type(function(value,deep){return isObject.check(value)&&fields.every(function(field){return field.type.check(value[field.name],deep)})},function(){return"{ "+fields.join(", ")+" }"})};function Field(name,type,defaultFn,hidden){var self=this;if(!(self instanceof Field)){throw new Error("Field constructor cannot be invoked without 'new'")}isString.assert(name);type=toType(type);var properties={name:{value:name},type:{value:type},hidden:{value:!!hidden}};if(isFunction.check(defaultFn)){properties.defaultFn={value:defaultFn}}Object.defineProperties(self,properties)}var Fp=Field.prototype;Fp.toString=function(){return JSON.stringify(this.name)+": "+this.type};Fp.getValue=function(obj){var value=obj[this.name];if(!isUndefined.check(value))return value;if(this.defaultFn)value=this.defaultFn.call(obj);return value};Type.def=function(typeName){isString.assert(typeName);return hasOwn.call(defCache,typeName)?defCache[typeName]:defCache[typeName]=new Def(typeName)};var defCache=Object.create(null);function Def(typeName){var self=this;if(!(self instanceof Def)){throw new Error("Def constructor cannot be invoked without 'new'")}Object.defineProperties(self,{typeName:{value:typeName},baseNames:{value:[]},ownFields:{value:Object.create(null)},allSupertypes:{value:Object.create(null)},supertypeList:{value:[]},allFields:{value:Object.create(null)},fieldNames:{value:[]},type:{value:new Type(function(value,deep){return self.check(value,deep)},typeName)}})}Def.fromValue=function(value){if(value&&typeof value==="object"){var type=value.type;if(typeof type==="string"&&hasOwn.call(defCache,type)){var d=defCache[type];if(d.finalized){return d}}}return null};var Dp=Def.prototype;Dp.isSupertypeOf=function(that){if(that instanceof Def){if(this.finalized!==true||that.finalized!==true){throw new Error("")}return hasOwn.call(that.allSupertypes,this.typeName)}else{throw new Error(that+" is not a Def")}};exports.getSupertypeNames=function(typeName){if(!hasOwn.call(defCache,typeName)){throw new Error("")}var d=defCache[typeName];if(d.finalized!==true){throw new Error("")}return d.supertypeList.slice(1)};exports.computeSupertypeLookupTable=function(candidates){var table={};var typeNames=Object.keys(defCache);var typeNameCount=typeNames.length;for(var i=0;i<typeNameCount;++i){var typeName=typeNames[i];var d=defCache[typeName];if(d.finalized!==true){throw new Error(""+typeName)}for(var j=0;j<d.supertypeList.length;++j){var superTypeName=d.supertypeList[j];if(hasOwn.call(candidates,superTypeName)){table[typeName]=superTypeName;break}}}return table};Dp.checkAllFields=function(value,deep){var allFields=this.allFields;if(this.finalized!==true){throw new Error(""+this.typeName)}function checkFieldByName(name){var field=allFields[name];var type=field.type;var child=field.getValue(value);return type.check(child,deep)}return isObject.check(value)&&Object.keys(allFields).every(checkFieldByName)};Dp.check=function(value,deep){if(this.finalized!==true){throw new Error("prematurely checking unfinalized type "+this.typeName)}if(!isObject.check(value))return false;var vDef=Def.fromValue(value);if(!vDef){if(this.typeName==="SourceLocation"||this.typeName==="Position"){return this.checkAllFields(value,deep)}return false}if(deep&&vDef===this)return this.checkAllFields(value,deep);if(!this.isSupertypeOf(vDef))return false;if(!deep)return true;return vDef.checkAllFields(value,deep)&&this.checkAllFields(value,false)};Dp.bases=function(){var args=slice.call(arguments);var bases=this.baseNames;if(this.finalized){if(args.length!==bases.length){throw new Error("")}for(var i=0;i<args.length;i++){if(args[i]!==bases[i]){throw new Error("")}}return this}args.forEach(function(baseName){isString.assert(baseName);if(bases.indexOf(baseName)<0)bases.push(baseName)});return this};Object.defineProperty(Dp,"buildable",{value:false});var builders={};exports.builders=builders;var nodePrototype={};exports.defineMethod=function(name,func){var old=nodePrototype[name];if(isUndefined.check(func)){delete nodePrototype[name]}else{isFunction.assert(func);Object.defineProperty(nodePrototype,name,{enumerable:true,configurable:true,value:func})}return old};var isArrayOfString=isString.arrayOf();Dp.build=function(){var self=this;var newBuildParams=slice.call(arguments);isArrayOfString.assert(newBuildParams);Object.defineProperty(self,"buildParams",{value:newBuildParams,writable:false,enumerable:false,configurable:true});if(self.buildable){return self}self.field("type",String,function(){return self.typeName});Object.defineProperty(self,"buildable",{value:true});Object.defineProperty(builders,getBuilderName(self.typeName),{enumerable:true,value:function(){var args=arguments;var argc=args.length;var built=Object.create(nodePrototype);if(!self.finalized){throw new Error("attempting to instantiate unfinalized type "+self.typeName)}function add(param,i){if(hasOwn.call(built,param))return;var all=self.allFields;if(!hasOwn.call(all,param)){throw new Error(""+param)}var field=all[param];var type=field.type;var value;if(isNumber.check(i)&&i<argc){value=args[i]}else if(field.defaultFn){value=field.defaultFn.call(built)}else{var message="no value or default function given for field "+JSON.stringify(param)+" of "+self.typeName+"("+self.buildParams.map(function(name){return all[name]}).join(", ")+")";throw new Error(message)}if(!type.check(value)){throw new Error(shallowStringify(value)+" does not match field "+field+" of type "+self.typeName)}built[param]=value}self.buildParams.forEach(function(param,i){add(param,i)});Object.keys(self.allFields).forEach(function(param){add(param)});if(built.type!==self.typeName){throw new Error("")}return built}});return self};function getBuilderName(typeName){return typeName.replace(/^[A-Z]+/,function(upperCasePrefix){var len=upperCasePrefix.length;switch(len){case 0:return"";case 1:return upperCasePrefix.toLowerCase();default:return upperCasePrefix.slice(0,len-1).toLowerCase()+upperCasePrefix.charAt(len-1)}})}exports.getBuilderName=getBuilderName;function getStatementBuilderName(typeName){typeName=getBuilderName(typeName);return typeName.replace(/(Expression)?$/,"Statement")}exports.getStatementBuilderName=getStatementBuilderName;Dp.field=function(name,type,defaultFn,hidden){if(this.finalized){console.error("Ignoring attempt to redefine field "+JSON.stringify(name)+" of finalized type "+JSON.stringify(this.typeName));return this}this.ownFields[name]=new Field(name,type,defaultFn,hidden);return this};var namedTypes={};exports.namedTypes=namedTypes;function getFieldNames(object){var d=Def.fromValue(object);if(d){return d.fieldNames.slice(0)}if("type"in object){throw new Error("did not recognize object of type "+JSON.stringify(object.type))}return Object.keys(object)}exports.getFieldNames=getFieldNames;function getFieldValue(object,fieldName){var d=Def.fromValue(object);if(d){var field=d.allFields[fieldName];if(field){return field.getValue(object)}}return object[fieldName]}exports.getFieldValue=getFieldValue;exports.eachField=function(object,callback,context){getFieldNames(object).forEach(function(name){callback.call(this,name,getFieldValue(object,name))},context)};exports.someField=function(object,callback,context){return getFieldNames(object).some(function(name){return callback.call(this,name,getFieldValue(object,name))},context)};Object.defineProperty(Dp,"finalized",{value:false});Dp.finalize=function(){var self=this;if(!self.finalized){var allFields=self.allFields;var allSupertypes=self.allSupertypes;self.baseNames.forEach(function(name){var def=defCache[name];if(def instanceof Def){def.finalize();extend(allFields,def.allFields);extend(allSupertypes,def.allSupertypes)}else{var message="unknown supertype name "+JSON.stringify(name)+" for subtype "+JSON.stringify(self.typeName);throw new Error(message)}});extend(allFields,self.ownFields);allSupertypes[self.typeName]=self;self.fieldNames.length=0;for(var fieldName in allFields){if(hasOwn.call(allFields,fieldName)&&!allFields[fieldName].hidden){self.fieldNames.push(fieldName)}}Object.defineProperty(namedTypes,self.typeName,{enumerable:true,value:self.type});Object.defineProperty(self,"finalized",{value:true});populateSupertypeList(self.typeName,self.supertypeList);if(self.buildable&&self.supertypeList.lastIndexOf("Expression")>=0){wrapExpressionBuilderWithStatement(self.typeName)}}};function wrapExpressionBuilderWithStatement(typeName){var wrapperName=getStatementBuilderName(typeName);if(builders[wrapperName])return;var wrapped=builders[getBuilderName(typeName)];if(!wrapped)return;builders[wrapperName]=function(){return builders.expressionStatement(wrapped.apply(builders,arguments))}}function populateSupertypeList(typeName,list){list.length=0;list.push(typeName);var lastSeen=Object.create(null);for(var pos=0;pos<list.length;++pos){typeName=list[pos];var d=defCache[typeName];if(d.finalized!==true){throw new Error("")}if(hasOwn.call(lastSeen,typeName)){delete list[lastSeen[typeName]]}lastSeen[typeName]=pos;list.push.apply(list,d.baseNames)}for(var to=0,from=to,len=list.length;from<len;++from){if(hasOwn.call(list,from)){list[to++]=list[from]}}list.length=to}function extend(into,from){Object.keys(from).forEach(function(name){into[name]=from[name]});return into}exports.finalize=function(){Object.keys(defCache).forEach(function(name){defCache[name].finalize()})}},{}],49:[function(require,module,exports){var types=require("./lib/types");require("./def/core");require("./def/es6");require("./def/es7");require("./def/mozilla");require("./def/e4x");

require("./def/jsx");require("./def/flow");require("./def/esprima");require("./def/babel");types.finalize();exports.Type=types.Type;exports.builtInTypes=types.builtInTypes;exports.namedTypes=types.namedTypes;exports.builders=types.builders;exports.defineMethod=types.defineMethod;exports.getFieldNames=types.getFieldNames;exports.getFieldValue=types.getFieldValue;exports.eachField=types.eachField;exports.someField=types.someField;exports.getSupertypeNames=types.getSupertypeNames;exports.astNodesAreEquivalent=require("./lib/equiv");exports.finalize=types.finalize;exports.NodePath=require("./lib/node-path");exports.PathVisitor=require("./lib/path-visitor");exports.visit=exports.PathVisitor.visit},{"./def/babel":33,"./def/core":34,"./def/e4x":35,"./def/es6":36,"./def/es7":37,"./def/esprima":38,"./def/flow":39,"./def/jsx":40,"./def/mozilla":41,"./lib/equiv":42,"./lib/node-path":43,"./lib/path-visitor":44,"./lib/types":48}],50:[function(require,module,exports){(function(global){(function(){"use strict";var Syntax,Precedence,BinaryPrecedence,SourceNode,estraverse,esutils,isArray,base,indent,json,renumber,hexadecimal,quotes,escapeless,newline,space,parentheses,semicolons,safeConcatenation,directive,extra,parse,sourceMap,sourceCode,preserveBlankLines,FORMAT_MINIFY,FORMAT_DEFAULTS;estraverse=require("estraverse");esutils=require("esutils");Syntax=estraverse.Syntax;function isExpression(node){return CodeGenerator.Expression.hasOwnProperty(node.type)}function isStatement(node){return CodeGenerator.Statement.hasOwnProperty(node.type)}Precedence={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19};BinaryPrecedence={"||":Precedence.LogicalOR,"&&":Precedence.LogicalAND,"|":Precedence.BitwiseOR,"^":Precedence.BitwiseXOR,"&":Precedence.BitwiseAND,"==":Precedence.Equality,"!=":Precedence.Equality,"===":Precedence.Equality,"!==":Precedence.Equality,is:Precedence.Equality,isnt:Precedence.Equality,"<":Precedence.Relational,">":Precedence.Relational,"<=":Precedence.Relational,">=":Precedence.Relational,"in":Precedence.Relational,"instanceof":Precedence.Relational,"<<":Precedence.BitwiseSHIFT,">>":Precedence.BitwiseSHIFT,">>>":Precedence.BitwiseSHIFT,"+":Precedence.Additive,"-":Precedence.Additive,"*":Precedence.Multiplicative,"%":Precedence.Multiplicative,"/":Precedence.Multiplicative};var F_ALLOW_IN=1,F_ALLOW_CALL=1<<1,F_ALLOW_UNPARATH_NEW=1<<2,F_FUNC_BODY=1<<3,F_DIRECTIVE_CTX=1<<4,F_SEMICOLON_OPT=1<<5;var E_FTT=F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TTF=F_ALLOW_IN|F_ALLOW_CALL,E_TTT=F_ALLOW_IN|F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TFF=F_ALLOW_IN,E_FFT=F_ALLOW_UNPARATH_NEW,E_TFT=F_ALLOW_IN|F_ALLOW_UNPARATH_NEW;var S_TFFF=F_ALLOW_IN,S_TFFT=F_ALLOW_IN|F_SEMICOLON_OPT,S_FFFF=0,S_TFTF=F_ALLOW_IN|F_DIRECTIVE_CTX,S_TTFF=F_ALLOW_IN|F_FUNC_BODY;function getDefaultOptions(){return{indent:null,base:null,parse:null,comment:false,format:{indent:{style:"    ",base:0,adjustMultilineComment:false},newline:"\n",space:" ",json:false,renumber:false,hexadecimal:false,quotes:"single",escapeless:false,compact:false,parentheses:true,semicolons:true,safeConcatenation:false,preserveBlankLines:false},moz:{comprehensionExpressionStartsWithAssignment:false,starlessGenerator:false},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:false,directive:false,raw:true,verbatim:null,sourceCode:null}}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function hasLineTerminator(str){return/[\r\n]/g.test(str)}function endsWithLineTerminator(str){var len=str.length;return len&&esutils.code.isLineTerminator(str.charCodeAt(len-1))}function merge(target,override){var key;for(key in override){if(override.hasOwnProperty(key)){target[key]=override[key]}}return target}function updateDeeply(target,override){var key,val;function isHashObject(target){return typeof target==="object"&&target instanceof Object&&!(target instanceof RegExp)}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val)}else{target[key]=updateDeeply({},val)}}else{target[key]=val}}}return target}function generateNumber(value){var result,point,temp,exponent,pos;if(value!==value){throw new Error("Numeric literal whose value is NaN")}if(value<0||value===0&&1/value<0){throw new Error("Numeric literal whose value is negative")}if(value===1/0){return json?"null":renumber?"1e400":"1e+400"}result=""+value;if(!renumber||result.length<3){return result}point=result.indexOf(".");if(!json&&result.charCodeAt(0)===48&&point===1){point=0;result=result.slice(1)}temp=result;result=result.replace("e+","e");exponent=0;if((pos=temp.indexOf("e"))>0){exponent=+temp.slice(pos+1);temp=temp.slice(0,pos)}if(point>=0){exponent-=temp.length-point-1;temp=+(temp.slice(0,point)+temp.slice(point+1))+""}pos=0;while(temp.charCodeAt(temp.length+pos-1)===48){--pos}if(pos!==0){exponent-=pos;temp=temp.slice(0,pos)}if(exponent!==0){temp+="e"+exponent}if((temp.length<result.length||hexadecimal&&value>1e12&&Math.floor(value)===value&&(temp="0x"+value.toString(16)).length<result.length)&&+temp===value){result=temp}return result}function escapeRegExpCharacter(ch,previousIsBackslash){if((ch&~1)===8232){return(previousIsBackslash?"u":"\\u")+(ch===8232?"2028":"2029")}else if(ch===10||ch===13){return(previousIsBackslash?"":"\\")+(ch===10?"n":"r")}return String.fromCharCode(ch)}function generateRegExp(reg){var match,result,flags,i,iz,ch,characterInBrack,previousIsBackslash;result=reg.toString();if(reg.source){match=result.match(/\/([^\/]*)$/);if(!match){return result}flags=match[1];result="";characterInBrack=false;previousIsBackslash=false;for(i=0,iz=reg.source.length;i<iz;++i){ch=reg.source.charCodeAt(i);if(!previousIsBackslash){if(characterInBrack){if(ch===93){characterInBrack=false}}else{if(ch===47){result+="\\"}else if(ch===91){characterInBrack=true}}result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=ch===92}else{result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=false}}return"/"+result+"/"+flags}return result}function escapeAllowedCharacter(code,next){var hex;if(code===8){return"\\b"}if(code===12){return"\\f"}if(code===9){return"\\t"}hex=code.toString(16).toUpperCase();if(json||code>255){return"\\u"+"0000".slice(hex.length)+hex}else if(code===0&&!esutils.code.isDecimalDigit(next)){return"\\0"}else if(code===11){return"\\x0B"}else{return"\\x"+"00".slice(hex.length)+hex}}function escapeDisallowedCharacter(code){if(code===92){return"\\\\"}if(code===10){return"\\n"}if(code===13){return"\\r"}if(code===8232){return"\\u2028"}if(code===8233){return"\\u2029"}throw new Error("Incorrectly classified character")}function escapeDirective(str){var i,iz,code,quote;quote=quotes==="double"?'"':"'";for(i=0,iz=str.length;i<iz;++i){code=str.charCodeAt(i);if(code===39){quote='"';break}else if(code===34){quote="'";break}else if(code===92){++i}}return quote+str+quote}function escapeString(str){var result="",i,len,code,singleQuotes=0,doubleQuotes=0,single,quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39){++singleQuotes}else if(code===34){++doubleQuotes}else if(code===47&&json){result+="\\"}else if(esutils.code.isLineTerminator(code)||code===92){result+=escapeDisallowedCharacter(code);continue}else if(!esutils.code.isIdentifierPartES5(code)&&(json&&code<32||!json&&!escapeless&&(code<32||code>126))){result+=escapeAllowedCharacter(code,str.charCodeAt(i+1));continue}result+=String.fromCharCode(code)}single=!(quotes==="double"||quotes==="auto"&&doubleQuotes<singleQuotes);quote=single?"'":'"';if(!(single?singleQuotes:doubleQuotes)){return quote+result+quote}str=result;result=quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39&&single||code===34&&!single){result+="\\"}result+=String.fromCharCode(code)}return result+quote}function flattenToString(arr){var i,iz,elem,result="";for(i=0,iz=arr.length;i<iz;++i){elem=arr[i];result+=isArray(elem)?flattenToString(elem):elem}return result}function toSourceNodeWhenNeeded(generated,node){if(!sourceMap){if(isArray(generated)){return flattenToString(generated)}else{return generated}}if(node==null){if(generated instanceof SourceNode){return generated}else{node={}}}if(node.loc==null){return new SourceNode(null,null,sourceMap,generated,node.name||null)}return new SourceNode(node.loc.start.line,node.loc.start.column,sourceMap===true?node.loc.source||null:sourceMap,generated,node.name||null)}function noEmptySpace(){return space?space:" "}function join(left,right){var leftSource,rightSource,leftCharCode,rightCharCode;leftSource=toSourceNodeWhenNeeded(left).toString();if(leftSource.length===0){return[right]}rightSource=toSourceNodeWhenNeeded(right).toString();if(rightSource.length===0){return[left]}leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=rightSource.charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)||leftCharCode===47&&rightCharCode===105){return[left,noEmptySpace(),right]}else if(esutils.code.isWhiteSpace(leftCharCode)||esutils.code.isLineTerminator(leftCharCode)||esutils.code.isWhiteSpace(rightCharCode)||esutils.code.isLineTerminator(rightCharCode)){return[left,right]}return[left,space,right]}function addIndent(stmt){return[base,stmt]}function withIndent(fn){var previousBase;previousBase=base;base+=indent;fn(base);base=previousBase}function calculateSpaces(str){var i;for(i=str.length-1;i>=0;--i){if(esutils.code.isLineTerminator(str.charCodeAt(i))){break}}return str.length-1-i}function adjustMultilineComment(value,specialBase){var array,i,len,line,j,spaces,previousBase,sn;array=value.split(/\r\n|[\r\n]/);spaces=Number.MAX_VALUE;for(i=1,len=array.length;i<len;++i){line=array[i];j=0;while(j<line.length&&esutils.code.isWhiteSpace(line.charCodeAt(j))){++j}if(spaces>j){spaces=j}}if(typeof specialBase!=="undefined"){previousBase=base;if(array[1][spaces]==="*"){specialBase+=" "}base=specialBase}else{if(spaces&1){--spaces}previousBase=base}for(i=1,len=array.length;i<len;++i){sn=toSourceNodeWhenNeeded(addIndent(array[i].slice(spaces)));array[i]=sourceMap?sn.join(""):sn}base=previousBase;return array.join("\n")}function generateComment(comment,specialBase){if(comment.type==="Line"){if(endsWithLineTerminator(comment.value)){return"//"+comment.value}else{var result="//"+comment.value;if(!preserveBlankLines){result+="\n"}return result}}if(extra.format.indent.adjustMultilineComment&&/[\n\r]/.test(comment.value)){return adjustMultilineComment("/*"+comment.value+"*/",specialBase)}return"/*"+comment.value+"*/"}function addComments(stmt,result){var i,len,comment,save,tailingToStatement,specialBase,fragment,extRange,range,prevRange,prefix,infix,suffix,count;if(stmt.leadingComments&&stmt.leadingComments.length>0){save=result;if(preserveBlankLines){comment=stmt.leadingComments[0];result=[];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)))}else{result.push(prefix);result.push(generateComment(comment))}prevRange=range;for(i=1,len=stmt.leadingComments.length;i<len;i++){comment=stmt.leadingComments[i];range=comment.range;infix=sourceCode.substring(prevRange[1],range[0]);count=(infix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)));prevRange=range}suffix=sourceCode.substring(range[1],extRange[1]);count=(suffix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count))}else{comment=stmt.leadingComments[0];result=[];if(safeConcatenation&&stmt.type===Syntax.Program&&stmt.body.length===0){result.push("\n")}result.push(generateComment(comment));if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push("\n")}for(i=1,len=stmt.leadingComments.length;i<len;++i){comment=stmt.leadingComments[i];fragment=[generateComment(comment)];if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){fragment.push("\n")}result.push(addIndent(fragment))}}result.push(addIndent(save))}if(stmt.trailingComments){if(preserveBlankLines){comment=stmt.trailingComments[0];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)))}else{result.push(prefix);result.push(generateComment(comment))}}else{tailingToStatement=!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());specialBase=stringRepeat(" ",calculateSpaces(toSourceNodeWhenNeeded([base,result,indent]).toString()));for(i=0,len=stmt.trailingComments.length;i<len;++i){comment=stmt.trailingComments[i];if(tailingToStatement){if(i===0){result=[result,indent]}else{result=[result,specialBase]}result.push(generateComment(comment,specialBase))}else{result=[result,addIndent(generateComment(comment))]}if(i!==len-1&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result=[result,"\n"]}}}}return result}function generateBlankLines(start,end,result){var j,newlineCount=0;for(j=start;j<end;j++){if(sourceCode[j]==="\n"){newlineCount++}}for(j=1;j<newlineCount;j++){result.push(newline)}}function parenthesize(text,current,should){if(current<should){return["(",text,")"]}return text}function generateVerbatimString(string){var i,iz,result;result=string.split(/\r\n|\n/);for(i=1,iz=result.length;i<iz;i++){result[i]=newline+base+result[i]}return result}function generateVerbatim(expr,precedence){var verbatim,result,prec;verbatim=expr[extra.verbatim];if(typeof verbatim==="string"){result=parenthesize(generateVerbatimString(verbatim),Precedence.Sequence,precedence)}else{result=generateVerbatimString(verbatim.content);prec=verbatim.precedence!=null?verbatim.precedence:Precedence.Sequence;result=parenthesize(result,prec,precedence)}return toSourceNodeWhenNeeded(result,expr)}function CodeGenerator(){}CodeGenerator.prototype.maybeBlock=function(stmt,flags){var result,noLeadingComment,that=this;noLeadingComment=!extra.comment||!stmt.leadingComments;if(stmt.type===Syntax.BlockStatement&&noLeadingComment){return[space,this.generateStatement(stmt,flags)]}if(stmt.type===Syntax.EmptyStatement&&noLeadingComment){return";"}withIndent(function(){result=[newline,addIndent(that.generateStatement(stmt,flags))]});return result};CodeGenerator.prototype.maybeBlockSuffix=function(stmt,result){var ends=endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());if(stmt.type===Syntax.BlockStatement&&(!extra.comment||!stmt.leadingComments)&&!ends){return[result,space]}if(ends){return[result,base]}return[result,newline,base]};function generateIdentifier(node){return toSourceNodeWhenNeeded(node.name,node)}function generateAsyncPrefix(node,spaceRequired){return node.async?"async"+(spaceRequired?noEmptySpace():space):""}function generateStarSuffix(node){var isGenerator=node.generator&&!extra.moz.starlessGenerator;return isGenerator?"*"+space:""}function generateMethodPrefix(prop){var func=prop.value;if(func.async){return generateAsyncPrefix(func,!prop.computed)}else{return generateStarSuffix(func)?"*":""}}CodeGenerator.prototype.generatePattern=function(node,precedence,flags){if(node.type===Syntax.Identifier){return generateIdentifier(node)}return this.generateExpression(node,precedence,flags)};CodeGenerator.prototype.generateFunctionParams=function(node){var i,iz,result,hasDefault;hasDefault=false;if(node.type===Syntax.ArrowFunctionExpression&&!node.rest&&(!node.defaults||node.defaults.length===0)&&node.params.length===1&&node.params[0].type===Syntax.Identifier){result=[generateAsyncPrefix(node,true),generateIdentifier(node.params[0])]}else{result=node.type===Syntax.ArrowFunctionExpression?[generateAsyncPrefix(node,false)]:[];result.push("(");if(node.defaults){hasDefault=true}for(i=0,iz=node.params.length;i<iz;++i){if(hasDefault&&node.defaults[i]){result.push(this.generateAssignment(node.params[i],node.defaults[i],"=",Precedence.Assignment,E_TTT))}else{result.push(this.generatePattern(node.params[i],Precedence.Assignment,E_TTT))}if(i+1<iz){result.push(","+space)}}if(node.rest){if(node.params.length){result.push(","+space)}result.push("...");result.push(generateIdentifier(node.rest))}result.push(")")}return result};CodeGenerator.prototype.generateFunctionBody=function(node){var result,expr;result=this.generateFunctionParams(node);if(node.type===Syntax.ArrowFunctionExpression){result.push(space);result.push("=>")}if(node.expression){result.push(space);expr=this.generateExpression(node.body,Precedence.Assignment,E_TTT);if(expr.toString().charAt(0)==="{"){expr=["(",expr,")"]}result.push(expr)}else{result.push(this.maybeBlock(node.body,S_TTFF))}return result};CodeGenerator.prototype.generateIterationForStatement=function(operator,stmt,flags){var result=["for"+space+"("],that=this;withIndent(function(){if(stmt.left.type===Syntax.VariableDeclaration){withIndent(function(){result.push(stmt.left.kind+noEmptySpace());result.push(that.generateStatement(stmt.left.declarations[0],S_FFFF))})}else{result.push(that.generateExpression(stmt.left,Precedence.Call,E_TTT))}result=join(result,operator);result=[join(result,that.generateExpression(stmt.right,Precedence.Sequence,E_TTT)),")"]});result.push(this.maybeBlock(stmt.body,flags));return result};CodeGenerator.prototype.generatePropertyKey=function(expr,computed,value){var result=[];if(computed){result.push("[")}if(value.type==="AssignmentPattern"){result.push(this.AssignmentPattern(value,Precedence.Sequence,E_TTT))}else{result.push(this.generateExpression(expr,Precedence.Sequence,E_TTT))}if(computed){result.push("]")}return result};CodeGenerator.prototype.generateAssignment=function(left,right,operator,precedence,flags){if(Precedence.Assignment<precedence){flags|=F_ALLOW_IN}return parenthesize([this.generateExpression(left,Precedence.Call,flags),space+operator+space,this.generateExpression(right,Precedence.Assignment,flags)],Precedence.Assignment,precedence)};CodeGenerator.prototype.semicolon=function(flags){if(!semicolons&&flags&F_SEMICOLON_OPT){return""}return";"};CodeGenerator.Statement={BlockStatement:function(stmt,flags){var range,content,result=["{",newline],that=this;withIndent(function(){if(stmt.body.length===0&&preserveBlankLines){range=stmt.range;if(range[1]-range[0]>2){content=sourceCode.substring(range[0]+1,range[1]-1);if(content[0]==="\n"){result=["{"]}result.push(content)}}var i,iz,fragment,bodyFlags;bodyFlags=S_TFFF;if(flags&F_FUNC_BODY){bodyFlags|=F_DIRECTIVE_CTX}for(i=0,iz=stmt.body.length;i<iz;++i){if(preserveBlankLines){if(i===0){if(stmt.body[0].leadingComments){range=stmt.body[0].leadingComments[0].extendedRange;content=sourceCode.substring(range[0],range[1]);if(content[0]==="\n"){result=["{"]}}if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[0].range[0],result)}}if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result)}}}if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT}if(stmt.body[i].leadingComments&&preserveBlankLines){fragment=that.generateStatement(stmt.body[i],bodyFlags)}else{fragment=addIndent(that.generateStatement(stmt.body[i],bodyFlags))}result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines&&i<iz-1){if(!stmt.body[i+1].leadingComments){result.push(newline)}}else{result.push(newline)}}if(preserveBlankLines){if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result)}}}}});result.push(addIndent("}"));return result},BreakStatement:function(stmt,flags){if(stmt.label){return"break "+stmt.label.name+this.semicolon(flags)}return"break"+this.semicolon(flags)},ContinueStatement:function(stmt,flags){if(stmt.label){return"continue "+stmt.label.name+this.semicolon(flags)}return"continue"+this.semicolon(flags)},ClassBody:function(stmt,flags){var result=["{",newline],that=this;withIndent(function(indent){var i,iz;for(i=0,iz=stmt.body.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.body[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");return result},ClassDeclaration:function(stmt,flags){var result,fragment;result=["class"];if(stmt.id){result=join(result,this.generateExpression(stmt.id,Precedence.Sequence,E_TTT))}if(stmt.superClass){fragment=join("extends",this.generateExpression(stmt.superClass,Precedence.Assignment,E_TTT));result=join(result,fragment)}result.push(space);result.push(this.generateStatement(stmt.body,S_TFFT));return result},DirectiveStatement:function(stmt,flags){if(extra.raw&&stmt.raw){return stmt.raw+this.semicolon(flags)}return escapeDirective(stmt.directive)+this.semicolon(flags)},DoWhileStatement:function(stmt,flags){var result=join("do",this.maybeBlock(stmt.body,S_TFFF));result=this.maybeBlockSuffix(stmt.body,result);return join(result,["while"+space+"(",this.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"+this.semicolon(flags)])},CatchClause:function(stmt,flags){var result,that=this;withIndent(function(){var guard;result=["catch"+space+"(",that.generateExpression(stmt.param,Precedence.Sequence,E_TTT),")"];if(stmt.guard){guard=that.generateExpression(stmt.guard,Precedence.Sequence,E_TTT);result.splice(2,0," if ",guard)}});result.push(this.maybeBlock(stmt.body,S_TFFF));return result},DebuggerStatement:function(stmt,flags){return"debugger"+this.semicolon(flags)},EmptyStatement:function(stmt,flags){return";"},ExportDefaultDeclaration:function(stmt,flags){var result=["export"],bodyFlags;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;result=join(result,"default");if(isStatement(stmt.declaration)){result=join(result,this.generateStatement(stmt.declaration,bodyFlags))}else{result=join(result,this.generateExpression(stmt.declaration,Precedence.Assignment,E_TTT)+this.semicolon(flags))}return result},ExportNamedDeclaration:function(stmt,flags){var result=["export"],bodyFlags,that=this;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;if(stmt.declaration){return join(result,this.generateStatement(stmt.declaration,bodyFlags))}if(stmt.specifiers){if(stmt.specifiers.length===0){result=join(result,"{"+space+"}")}else if(stmt.specifiers[0].type===Syntax.ExportBatchSpecifier){result=join(result,this.generateExpression(stmt.specifiers[0],Precedence.Sequence,E_TTT))}else{result=join(result,"{");withIndent(function(indent){var i,iz;result.push(newline);for(i=0,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}")}if(stmt.source){result=join(result,["from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)])}else{result.push(this.semicolon(flags))}}return result},ExportAllDeclaration:function(stmt,flags){return["export"+space,"*"+space,"from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]},ExpressionStatement:function(stmt,flags){var result,fragment;function isClassPrefixed(fragment){var code;if(fragment.slice(0,5)!=="class"){return false}code=fragment.charCodeAt(5);return code===123||esutils.code.isWhiteSpace(code)||esutils.code.isLineTerminator(code)}function isFunctionPrefixed(fragment){var code;if(fragment.slice(0,8)!=="function"){return false}code=fragment.charCodeAt(8);return code===40||esutils.code.isWhiteSpace(code)||code===42||esutils.code.isLineTerminator(code)}function isAsyncPrefixed(fragment){var code,i,iz;if(fragment.slice(0,5)!=="async"){return false}if(!esutils.code.isWhiteSpace(fragment.charCodeAt(5))){return false}for(i=6,iz=fragment.length;i<iz;++i){if(!esutils.code.isWhiteSpace(fragment.charCodeAt(i))){break}}if(i===iz){return false}if(fragment.slice(i,i+8)!=="function"){return false}code=fragment.charCodeAt(i+8);return code===40||esutils.code.isWhiteSpace(code)||code===42||esutils.code.isLineTerminator(code)}result=[this.generateExpression(stmt.expression,Precedence.Sequence,E_TTT)];fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.charCodeAt(0)===123||isClassPrefixed(fragment)||isFunctionPrefixed(fragment)||isAsyncPrefixed(fragment)||directive&&flags&F_DIRECTIVE_CTX&&stmt.expression.type===Syntax.Literal&&typeof stmt.expression.value==="string"){result=["(",result,")"+this.semicolon(flags)]}else{result.push(this.semicolon(flags))}return result},ImportDeclaration:function(stmt,flags){var result,cursor,that=this;if(stmt.specifiers.length===0){return["import",space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]}result=["import"];cursor=0;if(stmt.specifiers[cursor].type===Syntax.ImportDefaultSpecifier){result=join(result,[this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)]);++cursor}if(stmt.specifiers[cursor]){if(cursor!==0){result.push(",")}if(stmt.specifiers[cursor].type===Syntax.ImportNamespaceSpecifier){result=join(result,[space,this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)])}else{result.push(space+"{");if(stmt.specifiers.length-cursor===1){result.push(space);result.push(this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT));result.push(space+"}"+space)}else{withIndent(function(indent){var i,iz;result.push(newline);for(i=cursor,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}"+space)}}}result=join(result,["from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]);return result},VariableDeclarator:function(stmt,flags){var itemFlags=flags&F_ALLOW_IN?E_TTT:E_FTT;if(stmt.init){return[this.generateExpression(stmt.id,Precedence.Assignment,itemFlags),space,"=",space,this.generateExpression(stmt.init,Precedence.Assignment,itemFlags)]}return this.generatePattern(stmt.id,Precedence.Assignment,itemFlags)},VariableDeclaration:function(stmt,flags){var result,i,iz,node,bodyFlags,that=this;result=[stmt.kind];bodyFlags=flags&F_ALLOW_IN?S_TFFF:S_FFFF;function block(){node=stmt.declarations[0];if(extra.comment&&node.leadingComments){result.push("\n");result.push(addIndent(that.generateStatement(node,bodyFlags)))}else{result.push(noEmptySpace());result.push(that.generateStatement(node,bodyFlags))}for(i=1,iz=stmt.declarations.length;i<iz;++i){node=stmt.declarations[i];if(extra.comment&&node.leadingComments){result.push(","+newline);result.push(addIndent(that.generateStatement(node,bodyFlags)))}else{result.push(","+space);result.push(that.generateStatement(node,bodyFlags))}}}if(stmt.declarations.length>1){withIndent(block)}else{block()}result.push(this.semicolon(flags));return result},ThrowStatement:function(stmt,flags){return[join("throw",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)]},TryStatement:function(stmt,flags){var result,i,iz,guardedHandlers;result=["try",this.maybeBlock(stmt.block,S_TFFF)];result=this.maybeBlockSuffix(stmt.block,result);if(stmt.handlers){for(i=0,iz=stmt.handlers.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handlers[i].body,result)}}}else{guardedHandlers=stmt.guardedHandlers||[];for(i=0,iz=guardedHandlers.length;i<iz;++i){result=join(result,this.generateStatement(guardedHandlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(guardedHandlers[i].body,result)}}if(stmt.handler){if(isArray(stmt.handler)){for(i=0,iz=stmt.handler.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handler[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handler[i].body,result)}}}else{result=join(result,this.generateStatement(stmt.handler,S_TFFF));if(stmt.finalizer){result=this.maybeBlockSuffix(stmt.handler.body,result)}}}}if(stmt.finalizer){result=join(result,["finally",this.maybeBlock(stmt.finalizer,S_TFFF)])}return result},SwitchStatement:function(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this;withIndent(function(){result=["switch"+space+"(",that.generateExpression(stmt.discriminant,Precedence.Sequence,E_TTT),")"+space+"{"+newline]});if(stmt.cases){bodyFlags=S_TFFF;for(i=0,iz=stmt.cases.length;i<iz;++i){if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT}fragment=addIndent(this.generateStatement(stmt.cases[i],bodyFlags));result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}}result.push(addIndent("}"));return result},SwitchCase:function(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this;withIndent(function(){if(stmt.test){result=[join("case",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT)),":"]}else{result=["default:"]}i=0;iz=stmt.consequent.length;if(iz&&stmt.consequent[0].type===Syntax.BlockStatement){fragment=that.maybeBlock(stmt.consequent[0],S_TFFF);result.push(fragment);i=1}if(i!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}bodyFlags=S_TFFF;for(;i<iz;++i){if(i===iz-1&&flags&F_SEMICOLON_OPT){bodyFlags|=F_SEMICOLON_OPT}fragment=addIndent(that.generateStatement(stmt.consequent[i],bodyFlags));result.push(fragment);if(i+1!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}});return result},IfStatement:function(stmt,flags){var result,bodyFlags,semicolonOptional,that=this;withIndent(function(){result=["if"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"]});semicolonOptional=flags&F_SEMICOLON_OPT;bodyFlags=S_TFFF;if(semicolonOptional){bodyFlags|=F_SEMICOLON_OPT}if(stmt.alternate){result.push(this.maybeBlock(stmt.consequent,S_TFFF));result=this.maybeBlockSuffix(stmt.consequent,result);if(stmt.alternate.type===Syntax.IfStatement){result=join(result,["else ",this.generateStatement(stmt.alternate,bodyFlags)])}else{result=join(result,join("else",this.maybeBlock(stmt.alternate,bodyFlags)))}}else{result.push(this.maybeBlock(stmt.consequent,bodyFlags))}return result},ForStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["for"+space+"("];if(stmt.init){if(stmt.init.type===Syntax.VariableDeclaration){result.push(that.generateStatement(stmt.init,S_FFFF))}else{result.push(that.generateExpression(stmt.init,Precedence.Sequence,E_FTT));result.push(";")}}else{result.push(";")}if(stmt.test){result.push(space);result.push(that.generateExpression(stmt.test,Precedence.Sequence,E_TTT));result.push(";")}else{result.push(";")}if(stmt.update){result.push(space);result.push(that.generateExpression(stmt.update,Precedence.Sequence,E_TTT));result.push(")")}else{result.push(")")}});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result},ForInStatement:function(stmt,flags){return this.generateIterationForStatement("in",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)},ForOfStatement:function(stmt,flags){return this.generateIterationForStatement("of",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)},LabeledStatement:function(stmt,flags){
return[stmt.label.name+":",this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)]},Program:function(stmt,flags){var result,fragment,i,iz,bodyFlags;iz=stmt.body.length;result=[safeConcatenation&&iz>0?"\n":""];bodyFlags=S_TFTF;for(i=0;i<iz;++i){if(!safeConcatenation&&i===iz-1){bodyFlags|=F_SEMICOLON_OPT}if(preserveBlankLines){if(i===0){if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[i].range[0],result)}}if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result)}}}fragment=addIndent(this.generateStatement(stmt.body[i],bodyFlags));result.push(fragment);if(i+1<iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines){if(!stmt.body[i+1].leadingComments){result.push(newline)}}else{result.push(newline)}}if(preserveBlankLines){if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result)}}}}return result},FunctionDeclaration:function(stmt,flags){return[generateAsyncPrefix(stmt,true),"function",generateStarSuffix(stmt)||noEmptySpace(),stmt.id?generateIdentifier(stmt.id):"",this.generateFunctionBody(stmt)]},ReturnStatement:function(stmt,flags){if(stmt.argument){return[join("return",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)]}return["return"+this.semicolon(flags)]},WhileStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["while"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"]});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result},WithStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["with"+space+"(",that.generateExpression(stmt.object,Precedence.Sequence,E_TTT),")"]});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result}};merge(CodeGenerator.prototype,CodeGenerator.Statement);CodeGenerator.Expression={SequenceExpression:function(expr,precedence,flags){var result,i,iz;if(Precedence.Sequence<precedence){flags|=F_ALLOW_IN}result=[];for(i=0,iz=expr.expressions.length;i<iz;++i){result.push(this.generateExpression(expr.expressions[i],Precedence.Assignment,flags));if(i+1<iz){result.push(","+space)}}return parenthesize(result,Precedence.Sequence,precedence)},AssignmentExpression:function(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,expr.operator,precedence,flags)},ArrowFunctionExpression:function(expr,precedence,flags){return parenthesize(this.generateFunctionBody(expr),Precedence.ArrowFunction,precedence)},ConditionalExpression:function(expr,precedence,flags){if(Precedence.Conditional<precedence){flags|=F_ALLOW_IN}return parenthesize([this.generateExpression(expr.test,Precedence.LogicalOR,flags),space+"?"+space,this.generateExpression(expr.consequent,Precedence.Assignment,flags),space+":"+space,this.generateExpression(expr.alternate,Precedence.Assignment,flags)],Precedence.Conditional,precedence)},LogicalExpression:function(expr,precedence,flags){return this.BinaryExpression(expr,precedence,flags)},BinaryExpression:function(expr,precedence,flags){var result,currentPrecedence,fragment,leftSource;currentPrecedence=BinaryPrecedence[expr.operator];if(currentPrecedence<precedence){flags|=F_ALLOW_IN}fragment=this.generateExpression(expr.left,currentPrecedence,flags);leftSource=fragment.toString();if(leftSource.charCodeAt(leftSource.length-1)===47&&esutils.code.isIdentifierPartES5(expr.operator.charCodeAt(0))){result=[fragment,noEmptySpace(),expr.operator]}else{result=join(fragment,expr.operator)}fragment=this.generateExpression(expr.right,currentPrecedence+1,flags);if(expr.operator==="/"&&fragment.toString().charAt(0)==="/"||expr.operator.slice(-1)==="<"&&fragment.toString().slice(0,3)==="!--"){result.push(noEmptySpace());result.push(fragment)}else{result=join(result,fragment)}if(expr.operator==="in"&&!(flags&F_ALLOW_IN)){return["(",result,")"]}return parenthesize(result,currentPrecedence,precedence)},CallExpression:function(expr,precedence,flags){var result,i,iz;result=[this.generateExpression(expr.callee,Precedence.Call,E_TTF)];result.push("(");for(i=0,iz=expr["arguments"].length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space)}}result.push(")");if(!(flags&F_ALLOW_CALL)){return["(",result,")"]}return parenthesize(result,Precedence.Call,precedence)},NewExpression:function(expr,precedence,flags){var result,length,i,iz,itemFlags;length=expr["arguments"].length;itemFlags=flags&F_ALLOW_UNPARATH_NEW&&!parentheses&&length===0?E_TFT:E_TFF;result=join("new",this.generateExpression(expr.callee,Precedence.New,itemFlags));if(!(flags&F_ALLOW_UNPARATH_NEW)||parentheses||length>0){result.push("(");for(i=0,iz=length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space)}}result.push(")")}return parenthesize(result,Precedence.New,precedence)},MemberExpression:function(expr,precedence,flags){var result,fragment;result=[this.generateExpression(expr.object,Precedence.Call,flags&F_ALLOW_CALL?E_TTF:E_TFF)];if(expr.computed){result.push("[");result.push(this.generateExpression(expr.property,Precedence.Sequence,flags&F_ALLOW_CALL?E_TTT:E_TFT));result.push("]")}else{if(expr.object.type===Syntax.Literal&&typeof expr.object.value==="number"){fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.indexOf(".")<0&&!/[eExX]/.test(fragment)&&esutils.code.isDecimalDigit(fragment.charCodeAt(fragment.length-1))&&!(fragment.length>=2&&fragment.charCodeAt(0)===48)){result.push(".")}}result.push(".");result.push(generateIdentifier(expr.property))}return parenthesize(result,Precedence.Member,precedence)},MetaProperty:function(expr,precedence,flags){var result;result=[];result.push(expr.meta);result.push(".");result.push(expr.property);return parenthesize(result,Precedence.Member,precedence)},UnaryExpression:function(expr,precedence,flags){var result,fragment,rightCharCode,leftSource,leftCharCode;fragment=this.generateExpression(expr.argument,Precedence.Unary,E_TTT);if(space===""){result=join(expr.operator,fragment)}else{result=[expr.operator];if(expr.operator.length>2){result=join(result,fragment)}else{leftSource=toSourceNodeWhenNeeded(result).toString();leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=fragment.toString().charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)){result.push(noEmptySpace());result.push(fragment)}else{result.push(fragment)}}}return parenthesize(result,Precedence.Unary,precedence)},YieldExpression:function(expr,precedence,flags){var result;if(expr.delegate){result="yield*"}else{result="yield"}if(expr.argument){result=join(result,this.generateExpression(expr.argument,Precedence.Yield,E_TTT))}return parenthesize(result,Precedence.Yield,precedence)},AwaitExpression:function(expr,precedence,flags){var result=join(expr.all?"await*":"await",this.generateExpression(expr.argument,Precedence.Await,E_TTT));return parenthesize(result,Precedence.Await,precedence)},UpdateExpression:function(expr,precedence,flags){if(expr.prefix){return parenthesize([expr.operator,this.generateExpression(expr.argument,Precedence.Unary,E_TTT)],Precedence.Unary,precedence)}return parenthesize([this.generateExpression(expr.argument,Precedence.Postfix,E_TTT),expr.operator],Precedence.Postfix,precedence)},FunctionExpression:function(expr,precedence,flags){var result=[generateAsyncPrefix(expr,true),"function"];if(expr.id){result.push(generateStarSuffix(expr)||noEmptySpace());result.push(generateIdentifier(expr.id))}else{result.push(generateStarSuffix(expr)||space)}result.push(this.generateFunctionBody(expr));return result},ArrayPattern:function(expr,precedence,flags){return this.ArrayExpression(expr,precedence,flags,true)},ArrayExpression:function(expr,precedence,flags,isPattern){var result,multiline,that=this;if(!expr.elements.length){return"[]"}multiline=isPattern?false:expr.elements.length>1;result=["[",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.elements.length;i<iz;++i){if(!expr.elements[i]){if(multiline){result.push(indent)}if(i+1===iz){result.push(",")}}else{result.push(multiline?indent:"");result.push(that.generateExpression(expr.elements[i],Precedence.Assignment,E_TTT))}if(i+1<iz){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("]");return result},RestElement:function(expr,precedence,flags){return"..."+this.generatePattern(expr.argument)},ClassExpression:function(expr,precedence,flags){var result,fragment;result=["class"];if(expr.id){result=join(result,this.generateExpression(expr.id,Precedence.Sequence,E_TTT))}if(expr.superClass){fragment=join("extends",this.generateExpression(expr.superClass,Precedence.Assignment,E_TTT));result=join(result,fragment)}result.push(space);result.push(this.generateStatement(expr.body,S_TFFT));return result},MethodDefinition:function(expr,precedence,flags){var result,fragment;if(expr["static"]){result=["static"+space]}else{result=[]}if(expr.kind==="get"||expr.kind==="set"){fragment=[join(expr.kind,this.generatePropertyKey(expr.key,expr.computed,expr.value)),this.generateFunctionBody(expr.value)]}else{fragment=[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed,expr.value),this.generateFunctionBody(expr.value)]}return join(result,fragment)},Property:function(expr,precedence,flags){if(expr.kind==="get"||expr.kind==="set"){return[expr.kind,noEmptySpace(),this.generatePropertyKey(expr.key,expr.computed,expr.value),this.generateFunctionBody(expr.value)]}if(expr.shorthand){return this.generatePropertyKey(expr.key,expr.computed,expr.value)}if(expr.method){return[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed,expr.value),this.generateFunctionBody(expr.value)]}return[this.generatePropertyKey(expr.key,expr.computed,expr.value),":"+space,this.generateExpression(expr.value,Precedence.Assignment,E_TTT)]},ObjectExpression:function(expr,precedence,flags){var multiline,result,fragment,that=this;if(!expr.properties.length){return"{}"}multiline=expr.properties.length>1;withIndent(function(){fragment=that.generateExpression(expr.properties[0],Precedence.Sequence,E_TTT)});if(!multiline){if(!hasLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){return["{",space,fragment,space,"}"]}}withIndent(function(indent){var i,iz;result=["{",newline,indent,fragment];if(multiline){result.push(","+newline);for(i=1,iz=expr.properties.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");return result},AssignmentPattern:function(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,"=",precedence,flags)},ObjectPattern:function(expr,precedence,flags){var result,i,iz,multiline,property,that=this;if(!expr.properties.length){return"{}"}multiline=false;if(expr.properties.length===1){property=expr.properties[0];if(property.value.type!==Syntax.Identifier){multiline=true}}else{for(i=0,iz=expr.properties.length;i<iz;++i){property=expr.properties[i];if(!property.shorthand){multiline=true;break}}}result=["{",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.properties.length;i<iz;++i){result.push(multiline?indent:"");result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("}");return result},ThisExpression:function(expr,precedence,flags){return"this"},Super:function(expr,precedence,flags){return"super"},Identifier:function(expr,precedence,flags){return generateIdentifier(expr)},ImportDefaultSpecifier:function(expr,precedence,flags){return generateIdentifier(expr.id||expr.local)},ImportNamespaceSpecifier:function(expr,precedence,flags){var result=["*"];var id=expr.id||expr.local;if(id){result.push(space+"as"+noEmptySpace()+generateIdentifier(id))}return result},ImportSpecifier:function(expr,precedence,flags){var imported=expr.imported;var result=[imported.name];var local=expr.local;if(local&&local.name!==imported.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(local))}return result},ExportSpecifier:function(expr,precedence,flags){var local=expr.local;var result=[local.name];var exported=expr.exported;if(exported&&exported.name!==local.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(exported))}return result},Literal:function(expr,precedence,flags){var raw;if(expr.hasOwnProperty("raw")&&parse&&extra.raw){try{raw=parse(expr.raw).body[0].expression;if(raw.type===Syntax.Literal){if(raw.value===expr.value){return expr.raw}}}catch(e){}}if(expr.value===null){return"null"}if(typeof expr.value==="string"){return escapeString(expr.value)}if(typeof expr.value==="number"){return generateNumber(expr.value)}if(typeof expr.value==="boolean"){return expr.value?"true":"false"}return generateRegExp(expr.value)},GeneratorExpression:function(expr,precedence,flags){return this.ComprehensionExpression(expr,precedence,flags)},ComprehensionExpression:function(expr,precedence,flags){var result,i,iz,fragment,that=this;result=expr.type===Syntax.GeneratorExpression?["("]:["["];if(extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result.push(fragment)}if(expr.blocks){withIndent(function(){for(i=0,iz=expr.blocks.length;i<iz;++i){fragment=that.generateExpression(expr.blocks[i],Precedence.Sequence,E_TTT);if(i>0||extra.moz.comprehensionExpressionStartsWithAssignment){result=join(result,fragment)}else{result.push(fragment)}}})}if(expr.filter){result=join(result,"if"+space);fragment=this.generateExpression(expr.filter,Precedence.Sequence,E_TTT);result=join(result,["(",fragment,")"])}if(!extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result=join(result,fragment)}result.push(expr.type===Syntax.GeneratorExpression?")":"]");return result},ComprehensionBlock:function(expr,precedence,flags){var fragment;if(expr.left.type===Syntax.VariableDeclaration){fragment=[expr.left.kind,noEmptySpace(),this.generateStatement(expr.left.declarations[0],S_FFFF)]}else{fragment=this.generateExpression(expr.left,Precedence.Call,E_TTT)}fragment=join(fragment,expr.of?"of":"in");fragment=join(fragment,this.generateExpression(expr.right,Precedence.Sequence,E_TTT));return["for"+space+"(",fragment,")"]},SpreadElement:function(expr,precedence,flags){return["...",this.generateExpression(expr.argument,Precedence.Assignment,E_TTT)]},TaggedTemplateExpression:function(expr,precedence,flags){var itemFlags=E_TTF;if(!(flags&F_ALLOW_CALL)){itemFlags=E_TFF}var result=[this.generateExpression(expr.tag,Precedence.Call,itemFlags),this.generateExpression(expr.quasi,Precedence.Primary,E_FFT)];return parenthesize(result,Precedence.TaggedTemplate,precedence)},TemplateElement:function(expr,precedence,flags){return expr.value.raw},TemplateLiteral:function(expr,precedence,flags){var result,i,iz;result=["`"];for(i=0,iz=expr.quasis.length;i<iz;++i){result.push(this.generateExpression(expr.quasis[i],Precedence.Primary,E_TTT));if(i+1<iz){result.push("${"+space);result.push(this.generateExpression(expr.expressions[i],Precedence.Sequence,E_TTT));result.push(space+"}")}}result.push("`");return result},ModuleSpecifier:function(expr,precedence,flags){return this.Literal(expr,precedence,flags)}};merge(CodeGenerator.prototype,CodeGenerator.Expression);CodeGenerator.prototype.generateExpression=function(expr,precedence,flags){var result,type;type=expr.type||Syntax.Property;if(extra.verbatim&&expr.hasOwnProperty(extra.verbatim)){return generateVerbatim(expr,precedence)}result=this[type](expr,precedence,flags);if(extra.comment){result=addComments(expr,result)}return toSourceNodeWhenNeeded(result,expr)};CodeGenerator.prototype.generateStatement=function(stmt,flags){var result,fragment;result=this[stmt.type](stmt,flags);if(extra.comment){result=addComments(stmt,result)}fragment=toSourceNodeWhenNeeded(result).toString();if(stmt.type===Syntax.Program&&!safeConcatenation&&newline===""&&fragment.charAt(fragment.length-1)==="\n"){result=sourceMap?toSourceNodeWhenNeeded(result).replaceRight(/\s+$/,""):fragment.replace(/\s+$/,"")}return toSourceNodeWhenNeeded(result,stmt)};function generateInternal(node){var codegen;codegen=new CodeGenerator;if(isStatement(node)){return codegen.generateStatement(node,S_TFFF)}if(isExpression(node)){return codegen.generateExpression(node,Precedence.Sequence,E_TTT)}throw new Error("Unknown node type: "+node.type)}function generate(node,options){var defaultOptions=getDefaultOptions(),result,pair;if(options!=null){if(typeof options.indent==="string"){defaultOptions.format.indent.style=options.indent}if(typeof options.base==="number"){defaultOptions.format.indent.base=options.base}options=updateDeeply(defaultOptions,options);indent=options.format.indent.style;if(typeof options.base==="string"){base=options.base}else{base=stringRepeat(indent,options.format.indent.base)}}else{options=defaultOptions;indent=options.format.indent.style;base=stringRepeat(indent,options.format.indent.base)}json=options.format.json;renumber=options.format.renumber;hexadecimal=json?false:options.format.hexadecimal;quotes=json?"double":options.format.quotes;escapeless=options.format.escapeless;newline=options.format.newline;space=options.format.space;if(options.format.compact){newline=space=indent=base=""}parentheses=options.format.parentheses;semicolons=options.format.semicolons;safeConcatenation=options.format.safeConcatenation;directive=options.directive;parse=json?null:options.parse;sourceMap=options.sourceMap;sourceCode=options.sourceCode;preserveBlankLines=options.format.preserveBlankLines&&sourceCode!==null;extra=options;if(sourceMap){if(!exports.browser){SourceNode=require("source-map").SourceNode}else{SourceNode=global.sourceMap.SourceNode}}result=generateInternal(node);if(!sourceMap){pair={code:result.toString(),map:null};return options.sourceMapWithCode?pair:pair.code}pair=result.toStringWithSourceMap({file:options.file,sourceRoot:options.sourceMapRoot});if(options.sourceContent){pair.map.setSourceContent(options.sourceMap,options.sourceContent)}if(options.sourceMapWithCode){return pair}return pair.map.toString()}FORMAT_MINIFY={indent:{style:"",base:0},renumber:true,hexadecimal:true,quotes:"auto",escapeless:true,compact:true,parentheses:false,semicolons:false};FORMAT_DEFAULTS=getDefaultOptions().format;exports.version=require("./package.json").version;exports.generate=generate;exports.attachComments=estraverse.attachComments;exports.Precedence=updateDeeply({},Precedence);exports.browser=false;exports.FORMAT_MINIFY=FORMAT_MINIFY;exports.FORMAT_DEFAULTS=FORMAT_DEFAULTS})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./package.json":64,estraverse:51,esutils:122,"source-map":52}],51:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.estraverse={})}})(this,function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)));

}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version="1.8.1-dev";exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})},{}],52:[function(require,module,exports){exports.SourceMapGenerator=require("./source-map/source-map-generator").SourceMapGenerator;exports.SourceMapConsumer=require("./source-map/source-map-consumer").SourceMapConsumer;exports.SourceNode=require("./source-map/source-node").SourceNode},{"./source-map/source-map-consumer":60,"./source-map/source-map-generator":61,"./source-map/source-node":62}],53:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");function ArraySet(){this._array=[];this._set={}}ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet;for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates)}return set};ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var isDuplicate=this.has(aStr);var idx=this._array.length;if(!isDuplicate||aAllowDuplicates){this._array.push(aStr)}if(!isDuplicate){this._set[util.toSetString(aStr)]=idx}};ArraySet.prototype.has=function ArraySet_has(aStr){return Object.prototype.hasOwnProperty.call(this._set,util.toSetString(aStr))};ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){if(this.has(aStr)){return this._set[util.toSetString(aStr)]}throw new Error('"'+aStr+'" is not in the set.')};ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<this._array.length){return this._array[aIdx]}throw new Error("No element indexed by "+aIdx)};ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()};exports.ArraySet=ArraySet})},{"./util":63,amdefine:32}],54:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64=require("./base64");var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr,aOutParam){var i=0;var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(i>=strLen){throw new Error("Expected more digits in base 64 VLQ value.")}digit=base64.decode(aStr.charAt(i++));continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aStr.slice(i)}})},{"./base64":55,amdefine:32}],55:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var charToIntMap={};var intToCharMap={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(ch,index){charToIntMap[ch]=index;intToCharMap[index]=ch});exports.encode=function base64_encode(aNumber){if(aNumber in intToCharMap){return intToCharMap[aNumber]}throw new TypeError("Must be between 0 and 63: "+aNumber)};exports.decode=function base64_decode(aChar){if(aChar in charToIntMap){return charToIntMap[aChar]}throw new TypeError("Not a valid base 64 digit: "+aChar)}})},{amdefine:32}],56:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");var SourceMapConsumer=require("./source-map-consumer").SourceMapConsumer;function BasicSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}sources=sources.map(util.normalize);this._names=ArraySet.fromArray(names,true);this._sources=ArraySet.fromArray(sources,true);this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(BasicSourceMapConsumer.prototype);smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc.__generatedMappings=aSourceMap._mappings.toArray().slice();smc.__originalMappings=aSourceMap._mappings.toArray().slice().sort(util.compareByOriginalPositions);return smc};BasicSourceMapConsumer.prototype._version=3;Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot!=null?util.join(this.sourceRoot,s):s},this)}});BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var str=aStr;var temp={};var mapping;while(str.length>0){if(str.charAt(0)===";"){generatedLine++;str=str.slice(1);previousGeneratedColumn=0}else if(str.charAt(0)===","){str=str.slice(1)}else{mapping={};mapping.generatedLine=generatedLine;base64VLQ.decode(str,temp);mapping.generatedColumn=previousGeneratedColumn+temp.value;previousGeneratedColumn=mapping.generatedColumn;str=temp.rest;if(str.length>0&&!this._nextCharIsMappingSeparator(str)){base64VLQ.decode(str,temp);mapping.source=this._sources.at(previousSource+temp.value);previousSource+=temp.value;str=temp.rest;if(str.length===0||this._nextCharIsMappingSeparator(str)){throw new Error("Found a source, but no line and column")}base64VLQ.decode(str,temp);mapping.originalLine=previousOriginalLine+temp.value;previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;str=temp.rest;if(str.length===0||this._nextCharIsMappingSeparator(str)){throw new Error("Found a source and line, but no column")}base64VLQ.decode(str,temp);mapping.originalColumn=previousOriginalColumn+temp.value;previousOriginalColumn=mapping.originalColumn;str=temp.rest;if(str.length>0&&!this._nextCharIsMappingSeparator(str)){base64VLQ.decode(str,temp);mapping.name=this._names.at(previousName+temp.value);previousName+=temp.value;str=temp.rest}}this.__generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){this.__originalMappings.push(mapping)}}}this.__generatedMappings.sort(util.compareByGeneratedPositions);this.__originalMappings.sort(util.compareByOriginalPositions)};BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator)};BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=Infinity}};BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositions);if(index>=0){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);if(source!=null&&this.sourceRoot!=null){source=util.join(this.sourceRoot,source)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:util.getArg(mapping,"name",null)}}}return{source:null,line:null,column:null,name:null}};BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!this.sourcesContent){return null}if(this.sourceRoot!=null){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+aSource)){return this.sourcesContent[this._sources.indexOf("/"+aSource)]}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var needle={source:util.getArg(aArgs,"source"),originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions);if(index>=0){var mapping=this._originalMappings[index];return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}};exports.BasicSourceMapConsumer=BasicSourceMapConsumer})},{"./array-set":53,"./base64-vlq":54,"./binary-search":57,"./source-map-consumer":60,"./util":63,amdefine:32}],57:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare){var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){return mid}else if(cmp>0){if(aHigh-mid>1){return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare)}return mid}else{if(mid-aLow>1){return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare)}return aLow<0?-1:aLow}}exports.search=function search(aNeedle,aHaystack,aCompare){if(aHaystack.length===0){return-1}return recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare)}})},{amdefine:32}],58:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");var binarySearch=require("./binary-search");var SourceMapConsumer=require("./source-map-consumer").SourceMapConsumer;var BasicSourceMapConsumer=require("./basic-source-map-consumer").BasicSourceMapConsumer;function IndexedSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sections=util.getArg(sourceMap,"sections");if(version!=this._version){throw new Error("Unsupported version: "+version)}var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url){throw new Error("Support for url field in sections not implemented.")}var offset=util.getArg(s,"offset");var offsetLine=util.getArg(offset,"line");var offsetColumn=util.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.")}lastOffset=offset;return{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,"map"))}})}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;IndexedSourceMapConsumer.prototype._version=3;Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){var sources=[];for(var i=0;i<this._sections.length;i++){for(var j=0;j<this._sections[i].consumer.sources.length;j++){sources.push(this._sections[i].consumer.sources[j])}}return sources}});IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp}return needle.generatedColumn-section.generatedOffset.generatedColumn});var section=this._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null}}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0)})};IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(section.consumer.sources.indexOf(util.getArg(aArgs,"source"))===-1){continue}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret}}return{line:null,column:null}};IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){this.__generatedMappings=[];this.__originalMappings=[];for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[i];var source=mapping.source;var sourceRoot=section.consumer.sourceRoot;if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.column+(section.generatedOffset.generatedLine===mapping.generatedLine)?section.generatedOffset.generatedColumn-1:0,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name};this.__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){this.__originalMappings.push(adjustedMapping)}}}this.__generatedMappings.sort(util.compareByGeneratedPositions);this.__originalMappings.sort(util.compareByOriginalPositions)};exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer})},{"./basic-source-map-consumer":56,"./binary-search":57,"./source-map-consumer":60,"./util":63,amdefine:32}],59:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");function generatedPositionAfter(mappingA,mappingB){var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util.compareByGeneratedPositions(mappingA,mappingB)<=0}function MappingList(){this._array=[];this._sorted=true;this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){this._array.forEach(aCallback,aThisArg)};MappingList.prototype.add=function MappingList_add(aMapping){var mapping;if(generatedPositionAfter(this._last,aMapping)){this._last=aMapping;this._array.push(aMapping)}else{this._sorted=false;this._array.push(aMapping)}};MappingList.prototype.toArray=function MappingList_toArray(){if(!this._sorted){this._array.sort(util.compareByGeneratedPositions);this._sorted=true}return this._array};exports.MappingList=MappingList})},{"./util":63,amdefine:32}],60:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}if(sourceMap.sections!=null){var indexedSourceMapConsumer=require("./indexed-source-map-consumer");return new indexedSourceMapConsumer.IndexedSourceMapConsumer(sourceMap)}else{var basicSourceMapConsumer=require("./basic-source-map-consumer");return new basicSourceMapConsumer.BasicSourceMapConsumer(sourceMap)}}SourceMapConsumer.fromSourceMap=function(aSourceMap){var basicSourceMapConsumer=require("./basic-source-map-consumer");return basicSourceMapConsumer.BasicSourceMapConsumer.fromSourceMap(aSourceMap)};SourceMapConsumer.prototype._version=3;SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{get:function(){if(!this.__generatedMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{get:function(){if(!this.__originalMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._nextCharIsMappingSeparator=function SourceMapConsumer_nextCharIsMappingSeparator(aStr){var c=aStr.charAt(0);return c===";"||c===","};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings")};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source;if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name}}).forEach(aCallback,context)};SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var needle={source:util.getArg(aArgs,"source"),originalLine:util.getArg(aArgs,"line"),originalColumn:Infinity};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}var mappings=[];var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions);if(index>=0){var mapping=this._originalMappings[index];while(mapping&&mapping.originalLine===needle.originalLine){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[--index]}}return mappings.reverse()};exports.SourceMapConsumer=SourceMapConsumer})},{"./basic-source-map-consumer":56,"./indexed-source-map-consumer":58,"./util":63,amdefine:32}],61:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;var MappingList=require("./mapping-list").MappingList;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,"file",null);this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._skipValidation=util.getArg(aArgs,"skipValidation",false);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=new MappingList;this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);if(!this._skipValidation){this._validateMapping(generated,original,source,name)}if(source!=null&&!this._sources.has(source)){this._sources.add(source)}if(name!=null&&!this._names.has(name)){this._names.add(name)}this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents={}}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var mapping;var mappings=this._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){result+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositions(mapping,mappings[i-1])){continue}result+=","}}result+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){result+=base64VLQ.encode(this._sources.indexOf(mapping.source)-previousSource);previousSource=this._sources.indexOf(mapping.source);result+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;result+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){result+=base64VLQ.encode(this._names.indexOf(mapping.name)-previousName);previousName=this._names.indexOf(mapping.name)}}}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this)};exports.SourceMapGenerator=SourceMapGenerator})},{"./array-set":53,"./base64-vlq":54,"./mapping-list":59,"./util":63,amdefine:32}],62:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");var REGEX_NEWLINE=/(\r?\n)/;var NEWLINE_CODE=10;var isSourceNode="$$$isSourceNode$$$";function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;this[isSourceNode]=true;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var shiftNextLine=function(){var lineContents=remainingLines.shift();var newLine=remainingLines.shift()||"";

return lineContents+newLine};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){var code="";addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[0];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLines.length>0){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.join(""))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk[isSourceNode]){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i][isSourceNode]){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column++}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode})},{"./source-map-generator":61,"./util":63,amdefine:32}],63:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":"}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=path.charAt(0)==="/";var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1)}else if(part===".."){up++}else if(up>0){if(part===""){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":"."}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===""){aRoot="."}if(aPath===""){aPath="."}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/"}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;function relative(aRoot,aPath){if(aRoot===""){aRoot="."}aRoot=aRoot.replace(/\/$/,"");var url=urlParse(aRoot);if(aPath.charAt(0)=="/"&&url&&url.path=="/"){return aPath.slice(1)}return aPath.indexOf(aRoot+"/")===0?aPath.substr(aRoot.length+1):aPath}exports.relative=relative;function toSetString(aStr){return"$"+aStr}exports.toSetString=toSetString;function fromSetString(aStr){return aStr.substr(1)}exports.fromSetString=fromSetString;function strcmp(aStr1,aStr2){var s1=aStr1||"";var s2=aStr2||"";return(s1>s2)-(s1<s2)}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp;cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp||onlyCompareOriginal){return cmp}cmp=strcmp(mappingA.name,mappingB.name);if(cmp){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}return mappingA.generatedColumn-mappingB.generatedColumn}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositions(mappingA,mappingB,onlyCompareGenerated){var cmp;cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp||onlyCompareGenerated){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositions=compareByGeneratedPositions})},{amdefine:32}],64:[function(require,module,exports){module.exports={_args:[[{raw:"escodegen@^1.7.0",scope:null,escapedName:"escodegen",name:"escodegen",rawSpec:"^1.7.0",spec:">=1.7.0 <2.0.0",type:"range"},"/agents/node_modules/webppl"]],_from:"escodegen@>=1.7.0 <2.0.0",_id:"escodegen@1.8.1",_inCache:true,_location:"/escodegen",_nodeVersion:"6.3.0",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/escodegen-1.8.1.tgz_1470506723009_0.12818681285716593"},_npmUser:{name:"michaelficarra",email:"npm@michael.ficarra.me"},_npmVersion:"3.10.3",_phantomChildren:{amdefine:"1.0.1"},_requested:{raw:"escodegen@^1.7.0",scope:null,escapedName:"escodegen",name:"escodegen",rawSpec:"^1.7.0",spec:">=1.7.0 <2.0.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/escodegen/-/escodegen-1.8.1.tgz",_shasum:"5a5b53af4693110bebb0867aa3430dd3b70a1018",_shrinkwrap:null,_spec:"escodegen@^1.7.0",_where:"/agents/node_modules/webppl",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},bugs:{url:"https://github.com/estools/escodegen/issues"},dependencies:{esprima:"^2.7.1",estraverse:"^1.9.1",esutils:"^2.0.2",optionator:"^0.8.1","source-map":"~0.2.0"},description:"ECMAScript code generator",devDependencies:{acorn:"^2.7.0",bluebird:"^2.3.11","bower-registry-client":"^0.2.1",chai:"^1.10.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^0.2.0","gulp-mocha":"^2.0.0",semver:"^5.1.0"},directories:{},dist:{shasum:"5a5b53af4693110bebb0867aa3430dd3b70a1018",tarball:"https://registry.npmjs.org/escodegen/-/escodegen-1.8.1.tgz"},engines:{node:">=0.12.0"},files:["LICENSE.BSD","LICENSE.source-map","README.md","bin","escodegen.js","package.json"],gitHead:"ba4faabb224b2d5e0080c8e4f964702b699c7d1f",homepage:"http://github.com/estools/escodegen",license:"BSD-2-Clause",main:"escodegen.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"},{name:"michaelficarra",email:"npm@michael.ficarra.me"}],name:"escodegen",optionalDependencies:{"source-map":"~0.2.0"},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/estools/escodegen.git"},scripts:{build:"cjsify -a path: tools/entry-point.js > escodegen.browser.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",lint:"gulp lint",release:"node tools/release.js",test:"gulp travis","unit-test":"gulp test"},version:"1.8.1"}},{}],65:[function(require,module,exports){(function(factory,global){"use strict";function namespace(str,obj){var i,iz,names,name;names=str.split(".");for(i=0,iz=names.length;i<iz;++i){name=names[i];if(obj.hasOwnProperty(name)){obj=obj[name]}else{obj=obj[name]={}}}return obj}if(typeof define==="function"&&define.amd){define("escope",["exports","estraverse"],function(exports,estraverse){factory(exports,global,estraverse)})}else if(typeof exports!=="undefined"){factory(exports,global,require("estraverse"))}else{factory(namespace("escope",global),global,global.estraverse)}})(function(exports,global,estraverse){"use strict";var Syntax,Map,currentScope,globalScope,scopes,options;Syntax=estraverse.Syntax;if(typeof global.Map!=="undefined"){Map=global.Map}else{Map=function Map(){this.__data={}};Map.prototype.get=function MapGet(key){key="$"+key;if(this.__data.hasOwnProperty(key)){return this.__data[key]}return undefined};Map.prototype.has=function MapHas(key){key="$"+key;return this.__data.hasOwnProperty(key)};Map.prototype.set=function MapSet(key,val){key="$"+key;this.__data[key]=val};Map.prototype["delete"]=function MapDelete(key){key="$"+key;return delete this.__data[key]}}function assert(cond,text){if(!cond){throw new Error(text)}}function defaultOptions(){return{optimistic:false,directive:false,ecmaVersion:5}}function updateDeeply(target,override){var key,val;function isHashObject(target){return typeof target==="object"&&target instanceof Object&&!(target instanceof RegExp)}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val)}else{target[key]=updateDeeply({},val)}}else{target[key]=val}}}return target}function Reference(ident,scope,flag,writeExpr,maybeImplicitGlobal){this.identifier=ident;this.from=scope;this.tainted=false;this.resolved=null;this.flag=flag;if(this.isWrite()){this.writeExpr=writeExpr}this.__maybeImplicitGlobal=maybeImplicitGlobal}Reference.READ=1;Reference.WRITE=2;Reference.RW=3;Reference.prototype.isStatic=function isStatic(){return!this.tainted&&this.resolved&&this.resolved.scope.isStatic()};Reference.prototype.isWrite=function isWrite(){return this.flag&Reference.WRITE};Reference.prototype.isRead=function isRead(){return this.flag&Reference.READ};Reference.prototype.isReadOnly=function isReadOnly(){return this.flag===Reference.READ};Reference.prototype.isWriteOnly=function isWriteOnly(){return this.flag===Reference.WRITE};Reference.prototype.isReadWrite=function isReadWrite(){return this.flag===Reference.RW};function Variable(name,scope){this.name=name;this.identifiers=[];this.references=[];this.defs=[];this.tainted=false;this.stack=true;this.scope=scope}Variable.CatchClause="CatchClause";Variable.Parameter="Parameter";Variable.FunctionName="FunctionName";Variable.Variable="Variable";Variable.ImplicitGlobalVariable="ImplicitGlobalVariable";function isStrictScope(scope,block){var body,i,iz,stmt,expr;if(scope.upper&&scope.upper.isStrict){return true}if(scope.type==="function"){body=block.body}else if(scope.type==="global"){body=block}else{return false}if(options.directive){for(i=0,iz=body.body.length;i<iz;++i){stmt=body.body[i];if(stmt.type!=="DirectiveStatement"){break}if(stmt.raw==='"use strict"'||stmt.raw==="'use strict'"){return true}}}else{for(i=0,iz=body.body.length;i<iz;++i){stmt=body.body[i];if(stmt.type!==Syntax.ExpressionStatement){break}expr=stmt.expression;if(expr.type!==Syntax.Literal||typeof expr.value!=="string"){break}if(expr.raw!=null){if(expr.raw==='"use strict"'||expr.raw==="'use strict'"){return true}}else{if(expr.value==="use strict"){return true}}}}return false}function Scope(block,opt){var variable,body;this.type=block.type===Syntax.CatchClause?"catch":block.type===Syntax.WithStatement?"with":block.type===Syntax.Program?"global":"function";this.set=new Map;this.taints=new Map;this.dynamic=this.type==="global"||this.type==="with";this.block=block;this.through=[];this.variables=[];this.references=[];this.left=[];this.variableScope=this.type==="global"||this.type==="function"?this:currentScope.variableScope;this.functionExpressionScope=false;this.directCallToEvalScope=false;this.thisFound=false;body=this.type==="function"?block.body:block;if(opt.naming){this.__define(block.id,{type:Variable.FunctionName,name:block.id,node:block});this.functionExpressionScope=true}else{if(this.type==="function"){variable=new Variable("arguments",this);this.taints.set("arguments",true);this.set.set("arguments",variable);this.variables.push(variable)}if(block.type===Syntax.FunctionExpression&&block.id){new Scope(block,{naming:true})}}this.upper=currentScope;this.isStrict=isStrictScope(this,block);this.childScopes=[];if(currentScope){currentScope.childScopes.push(this)}currentScope=this;if(this.type==="global"){globalScope=this;globalScope.implicit={set:new Map,variables:[]}}scopes.push(this)}Scope.prototype.__close=function __close(){var i,iz,ref,current,node,implicit;if(!this.dynamic||options.optimistic){for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];if(!this.__resolve(ref)){this.__delegateToUpperScope(ref)}}}else{if(this.type==="with"){for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];ref.tainted=true;this.__delegateToUpperScope(ref)}}else{for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];current=this;do{current.through.push(ref);current=current.upper}while(current)}}}if(this.type==="global"){implicit=[];for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];if(ref.__maybeImplicitGlobal&&!this.set.has(ref.identifier.name)){implicit.push(ref.__maybeImplicitGlobal)}}for(i=0,iz=implicit.length;i<iz;++i){node=implicit[i];this.__defineImplicit(node.left,{type:Variable.ImplicitGlobalVariable,name:node.left,node:node})}}this.left=null;currentScope=this.upper};Scope.prototype.__resolve=function __resolve(ref){var variable,name;name=ref.identifier.name;if(this.set.has(name)){variable=this.set.get(name);variable.references.push(ref);variable.stack=variable.stack&&ref.from.variableScope===this.variableScope;if(ref.tainted){variable.tainted=true;this.taints.set(variable.name,true)}ref.resolved=variable;return true}return false};Scope.prototype.__delegateToUpperScope=function __delegateToUpperScope(ref){if(this.upper){this.upper.left.push(ref)}this.through.push(ref)};Scope.prototype.__defineImplicit=function __defineImplicit(node,info){var name,variable;if(node&&node.type===Syntax.Identifier){name=node.name;if(!this.implicit.set.has(name)){variable=new Variable(name,this);variable.identifiers.push(node);variable.defs.push(info);this.implicit.set.set(name,variable);this.implicit.variables.push(variable)}else{variable=this.implicit.set.get(name);variable.identifiers.push(node);variable.defs.push(info)}}};Scope.prototype.__define=function __define(node,info){var name,variable;if(node&&node.type===Syntax.Identifier){name=node.name;if(!this.set.has(name)){variable=new Variable(name,this);variable.identifiers.push(node);variable.defs.push(info);this.set.set(name,variable);this.variables.push(variable)}else{variable=this.set.get(name);variable.identifiers.push(node);variable.defs.push(info)}}};Scope.prototype.__referencing=function __referencing(node,assign,writeExpr,maybeImplicitGlobal){var ref;if(node&&node.type===Syntax.Identifier){ref=new Reference(node,this,assign||Reference.READ,writeExpr,maybeImplicitGlobal);this.references.push(ref);this.left.push(ref)}};Scope.prototype.__detectEval=function __detectEval(){var current;current=this;this.directCallToEvalScope=true;do{current.dynamic=true;current=current.upper}while(current)};Scope.prototype.__detectThis=function __detectThis(){this.thisFound=true};Scope.prototype.__isClosed=function isClosed(){return this.left===null};Scope.prototype.resolve=function resolve(ident){var ref,i,iz;assert(this.__isClosed(),"scope should be closed");assert(ident.type===Syntax.Identifier,"target should be identifier");for(i=0,iz=this.references.length;i<iz;++i){ref=this.references[i];if(ref.identifier===ident){return ref}}return null};Scope.prototype.isStatic=function isStatic(){return!this.dynamic};Scope.prototype.isArgumentsMaterialized=function isArgumentsMaterialized(){var variable;if(this.type!=="function"){return true}if(!this.isStatic()){return true}variable=this.set.get("arguments");assert(variable,"always have arguments variable");return variable.tainted||variable.references.length!==0};Scope.prototype.isThisMaterialized=function isThisMaterialized(){if(this.type!=="function"){return true}if(!this.isStatic()){return true}return this.thisFound};Scope.mangledName="__$escope$__";Scope.prototype.attach=function attach(){if(!this.functionExpressionScope){this.block[Scope.mangledName]=this}};Scope.prototype.detach=function detach(){if(!this.functionExpressionScope){delete this.block[Scope.mangledName]}};Scope.prototype.isUsedName=function(name){if(this.set.has(name)){return true}for(var i=0,iz=this.through.length;i<iz;++i){if(this.through[i].identifier.name===name){return true}}return false};function ScopeManager(scopes){this.scopes=scopes;this.attached=false}ScopeManager.prototype.__get=function __get(node){var i,iz,scope;if(this.attached){return node[Scope.mangledName]||null}if(Scope.isScopeRequired(node)){for(i=0,iz=this.scopes.length;i<iz;++i){scope=this.scopes[i];if(!scope.functionExpressionScope){if(scope.block===node){return scope}}}}return null};ScopeManager.prototype.acquire=function acquire(node){return this.__get(node)};ScopeManager.prototype.release=function release(node){var scope=this.__get(node);if(scope){scope=scope.upper;while(scope){if(!scope.functionExpressionScope){return scope}scope=scope.upper}}return null};ScopeManager.prototype.attach=function attach(){var i,iz;for(i=0,iz=this.scopes.length;i<iz;++i){this.scopes[i].attach()}this.attached=true};ScopeManager.prototype.detach=function detach(){var i,iz;for(i=0,iz=this.scopes.length;i<iz;++i){this.scopes[i].detach()}this.attached=false};Scope.isScopeRequired=function isScopeRequired(node){return Scope.isVariableScopeRequired(node)||node.type===Syntax.WithStatement||node.type===Syntax.CatchClause};Scope.isVariableScopeRequired=function isVariableScopeRequired(node){return node.type===Syntax.Program||node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration};function analyze(tree,providedOptions){var resultScopes;options=updateDeeply(defaultOptions(),providedOptions);resultScopes=scopes=[];currentScope=null;globalScope=null;estraverse.traverse(tree,{enter:function enter(node){var i,iz,decl;if(Scope.isScopeRequired(node)){new Scope(node,{})}switch(node.type){case Syntax.AssignmentExpression:if(node.operator==="="){currentScope.__referencing(node.left,Reference.WRITE,node.right,!currentScope.isStrict&&node.left.name!=null&&node)}else{currentScope.__referencing(node.left,Reference.RW,node.right)}currentScope.__referencing(node.right);break;case Syntax.ArrayExpression:for(i=0,iz=node.elements.length;i<iz;++i){currentScope.__referencing(node.elements[i])}break;case Syntax.BlockStatement:break;case Syntax.BinaryExpression:currentScope.__referencing(node.left);currentScope.__referencing(node.right);break;case Syntax.BreakStatement:break;case Syntax.CallExpression:currentScope.__referencing(node.callee);for(i=0,iz=node["arguments"].length;i<iz;++i){currentScope.__referencing(node["arguments"][i])}if(!options.ignoreEval&&node.callee.type===Syntax.Identifier&&node.callee.name==="eval"){currentScope.variableScope.__detectEval()}break;case Syntax.CatchClause:currentScope.__define(node.param,{type:Variable.CatchClause,name:node.param,node:node});break;case Syntax.ConditionalExpression:currentScope.__referencing(node.test);currentScope.__referencing(node.consequent);currentScope.__referencing(node.alternate);break;case Syntax.ContinueStatement:break;case Syntax.DirectiveStatement:break;case Syntax.DoWhileStatement:currentScope.__referencing(node.test);break;case Syntax.DebuggerStatement:break;case Syntax.EmptyStatement:break;case Syntax.ExpressionStatement:currentScope.__referencing(node.expression);break;case Syntax.ForStatement:currentScope.__referencing(node.init);currentScope.__referencing(node.test);currentScope.__referencing(node.update);break;case Syntax.ForInStatement:if(node.left.type===Syntax.VariableDeclaration){currentScope.__referencing(node.left.declarations[0].id,Reference.WRITE,null,false)}else{currentScope.__referencing(node.left,Reference.WRITE,null,!currentScope.isStrict&&node.left.name!=null&&node)}currentScope.__referencing(node.right);break;case Syntax.FunctionDeclaration:currentScope.upper.__define(node.id,{type:Variable.FunctionName,name:node.id,node:node});for(i=0,iz=node.params.length;i<iz;++i){currentScope.__define(node.params[i],{type:Variable.Parameter,name:node.params[i],node:node,index:i})}break;case Syntax.FunctionExpression:for(i=0,iz=node.params.length;i<iz;++i){currentScope.__define(node.params[i],{type:Variable.Parameter,name:node.params[i],node:node,index:i})}break;case Syntax.Identifier:break;case Syntax.IfStatement:currentScope.__referencing(node.test);break;case Syntax.Literal:break;case Syntax.LabeledStatement:break;case Syntax.LogicalExpression:currentScope.__referencing(node.left);currentScope.__referencing(node.right);break;case Syntax.MemberExpression:currentScope.__referencing(node.object);if(node.computed){currentScope.__referencing(node.property)}break;case Syntax.NewExpression:currentScope.__referencing(node.callee);for(i=0,iz=node["arguments"].length;i<iz;++i){currentScope.__referencing(node["arguments"][i])}break;case Syntax.ObjectExpression:for(i=0;i<node.properties.length;i++){if(node.properties[i].kind==="init"){currentScope.__referencing(node.properties[i].value)}}break;case Syntax.Program:break;case Syntax.Property:break;case Syntax.ReturnStatement:currentScope.__referencing(node.argument);break;case Syntax.SequenceExpression:for(i=0,iz=node.expressions.length;i<iz;++i){currentScope.__referencing(node.expressions[i])}break;case Syntax.SwitchStatement:currentScope.__referencing(node.discriminant);break;case Syntax.SwitchCase:currentScope.__referencing(node.test);break;case Syntax.ThisExpression:currentScope.variableScope.__detectThis();break;case Syntax.ThrowStatement:currentScope.__referencing(node.argument);break;case Syntax.TryStatement:break;case Syntax.UnaryExpression:currentScope.__referencing(node.argument);break;case Syntax.UpdateExpression:currentScope.__referencing(node.argument,Reference.RW,null);break;case Syntax.VariableDeclaration:for(i=0,iz=node.declarations.length;i<iz;++i){decl=node.declarations[i];currentScope.variableScope.__define(decl.id,{type:Variable.Variable,name:decl.id,node:decl,index:i,parent:node});if(decl.init){currentScope.__referencing(decl.id,Reference.WRITE,decl.init,false);currentScope.__referencing(decl.init)}}break;case Syntax.VariableDeclarator:break;case Syntax.WhileStatement:currentScope.__referencing(node.test);break;case Syntax.WithStatement:currentScope.upper.__referencing(node.object);break}},leave:function leave(node){while(currentScope&&node===currentScope.block){currentScope.__close()}}});assert(currentScope===null);globalScope=null;scopes=null;options=null;return new ScopeManager(resultScopes)}exports.version="1.0.3";exports.Reference=Reference;exports.Variable=Variable;exports.Scope=Scope;exports.ScopeManager=ScopeManager;exports.analyze=analyze},this)},{estraverse:66}],66:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],
ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":67}],67:[function(require,module,exports){module.exports={_args:[[{raw:"estraverse@^2.0.0",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"^2.0.0",spec:">=2.0.0 <3.0.0",type:"range"},"/agents/node_modules/webppl/node_modules/escope"]],_from:"estraverse@>=2.0.0 <3.0.0",_id:"estraverse@2.0.0",_inCache:true,_location:"/escope/estraverse",_npmUser:{name:"constellation",email:"utatane.tea@gmail.com"},_npmVersion:"2.0.0-alpha-5",_phantomChildren:{},_requested:{raw:"estraverse@^2.0.0",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"^2.0.0",spec:">=2.0.0 <3.0.0",type:"range"},_requiredBy:["/escope"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-2.0.0.tgz",_shasum:"5ae46963243600206674ccb24a09e16674fcdca1",_shrinkwrap:null,_spec:"estraverse@^2.0.0",_where:"/agents/node_modules/webppl/node_modules/escope",bugs:{url:"https://github.com/estools/estraverse/issues"},dependencies:{},description:"ECMAScript JS AST traversal functions",devDependencies:{chai:"^2.1.1","coffee-script":"^1.8.0",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},directories:{},dist:{shasum:"5ae46963243600206674ccb24a09e16674fcdca1",tarball:"https://registry.npmjs.org/estraverse/-/estraverse-2.0.0.tgz"},engines:{node:">=0.10.0"},gitHead:"d8bc726f126817cc03c7a4e751528edb19db0ffb",homepage:"https://github.com/estools/estraverse",licenses:[{type:"BSD",url:"http://github.com/estools/estraverse/raw/master/LICENSE.BSD"}],main:"estraverse.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"}],name:"estraverse",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers coffee:coffee-script/register"},version:"2.0.0"}},{}],68:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="annotate-directive";common=require("./common");Syntax=common.Syntax;function isDirective(stmt){var expr;if(stmt.type===Syntax.ExpressionStatement){expr=stmt.expression;if(expr.type===Syntax.Literal&&typeof expr.value==="string"){return true}}return false}function escapeAllowedCharacter(ch,next){var code=ch.charCodeAt(0),hex=code.toString(16),result="\\";switch(ch){case"\b":result+="b";break;case"\f":result+="f";break;case"	":result+="t";break;default:if(code>255){result+="u"+"0000".slice(hex.length)+hex}else if(ch==="\x00"&&"0123456789".indexOf(next)<0){result+="0"}else if(ch===""){result+="v"}else{result+="x"+"00".slice(hex.length)+hex}break}return result}function escapeDisallowedCharacter(ch){var result="\\";switch(ch){case"\\":result+="\\";break;case"\n":result+="n";break;case"\r":result+="r";break;case"\u2028":result+="u2028";break;case"\u2029":result+="u2029";break;default:throw new Error("Incorrectly classified character")}return result}function escapeString(str){var result="",i,len,ch;if(typeof str[0]==="undefined"){str=common.stringToArray(str)}for(i=0,len=str.length;i<len;i+=1){ch=str[i];if(ch==="'"){result+="\\'";continue}else if("\\\n\r\u2028\u2029".indexOf(ch)>=0){result+=escapeDisallowedCharacter(ch);continue}else if(!(ch>=" "&&ch<="~")){result+=escapeAllowedCharacter(ch,str[i+1]);continue}result+=ch}return result}function annotateDirective(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node,parent){var stmt,i,iz;if(!(node.type===Syntax.Program||node.type===Syntax.BlockStatement&&(parent.type===Syntax.FunctionExpression||parent.type===Syntax.FunctionDeclaration))){return}for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(isDirective(stmt)){stmt.type=Syntax.DirectiveStatement;if(stmt.expression.raw){stmt.directive=stmt.expression.raw.substring(1,stmt.expression.raw.length-1);stmt.value=stmt.expression.value;stmt.raw=stmt.expression.raw}else{stmt.directive=escapeString(stmt.expression.value);stmt.value=stmt.expression.value;stmt.raw="'"+stmt.directive+"'"}delete stmt.expression}else{return}}}});return result}annotateDirective.passName=Name;module.exports=annotateDirective})()},{"./common":69}],69:[function(require,module,exports){(function(){"use strict";var Syntax,isArray,arrayFrom,arrayOf,has,sameValue,estraverse,escope,esutils;estraverse=require("estraverse");escope=require("escope");esutils=require("esutils");Syntax=estraverse.Syntax;isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function isObject(obj){return typeof obj==="object"&&obj!==null}has=function(){var method={}.hasOwnProperty;return function has(obj,prop){return method.call(obj,prop)}}();arrayFrom=function(){var slice=Array.prototype.slice;return function arrayFrom(array){return slice.call(array)}}();arrayOf=function(){var slice=Array.prototype.slice;return function arrayOf(){return slice.call(arguments)}}();function arrayLast(array){return array[array.length-1]}function arrayEmpty(array){return array.length===0}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}if(Object.is){sameValue=Object.is}else{sameValue=function sameValue(x,y){if(x===y){return x!==0||1/x===1/y}return x!==x&&y!==y}}function deepCopy(obj){function deepCopyInternal(obj,result){var key,val;for(key in obj){if(key.lastIndexOf("__",0)===0){continue}if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){if(val instanceof RegExp){val=new RegExp(val)}else{val=deepCopyInternal(val,isArray(val)?[]:{})}}result[key]=val}}return result}return deepCopyInternal(obj,isArray(obj)?[]:{})}function assert(cond,text){if(!cond){throw new Error(text)}}function unreachable(){throw new Error("Unreachable point. logically broken.")}function isIdentifier(name){if(esutils.keyword.isKeywordES5(name,true)||esutils.keyword.isRestrictedWord(name)){return false}return esutils.keyword.isIdentifierName(name)}function mayBeCompletionValue(node,ancestors){var i,ancestor;if(node.type!==Syntax.ExpressionStatement){return true}for(i=ancestors.length-1;i>=0;--i,node=ancestor){ancestor=ancestors[i];switch(ancestor.type){case Syntax.FunctionExpression:case Syntax.FunctionDeclaration:return false;case Syntax.BlockStatement:case Syntax.Program:if(arrayLast(ancestor.body)!==node){return false}break;case Syntax.SwitchCase:if(arrayLast(ancestor.consequent)!==node){return false}break}}return true}function moveLocation(from,to){if(from.loc==null){return to}to.loc=deepCopy(from.loc);return to}function deleteLocation(node){if(node.hasOwnProperty("loc")){return delete node.loc}return false}function convertToEmptyStatement(node){var i,iz,keys;keys=estraverse.VisitorKeys[node.type];for(i=0,iz=keys.length;i<iz;++i){delete node[keys[i]]}node.type=Syntax.EmptyStatement;return node}function isNegative(value){return value===value&&(value<0||value===0&&1/value<0)}function isFunctionBody(node,parent){return node.type===Syntax.BlockStatement&&(parent.type===Syntax.FunctionDeclaration||parent.type===Syntax.FunctionExpression)}function isNumberLiteral(node){return node.type===Syntax.Literal&&typeof node.value==="number"}function isOptimizedArgument(argument){return isNumberLiteral(argument)&&String(argument.value).length===1}function generateNegativeNode(value,node){var result;result={type:Syntax.UnaryExpression,operator:"-",argument:{type:Syntax.Literal,value:-value}};return node?moveLocation(node,result):result}function isNegativeNode(node){return node.type===Syntax.UnaryExpression&&node.operator==="-"&&isNumberLiteral(node.argument)}function generateUndefined(node){var result={type:Syntax.UnaryExpression,operator:"void",argument:{type:Syntax.Literal,value:0}};return node?moveLocation(node,result):result}function isUndefined(node){return node.type===Syntax.UnaryExpression&&node.operator==="void"&&isOptimizedArgument(node.argument)}function generateNaN(node){var result={type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:0},right:{type:Syntax.Literal,value:0}};return node?moveLocation(node,result):result}function isNaNNode(node){if(node.type===Syntax.BinaryExpression){if(isOptimizedArgument(node.left)&&isOptimizedArgument(node.right)){return node.left.value===0&&node.right.value===0}}return false}function generateFromValue(value){if(typeof value==="number"){if(isNaN(value)){return generateNaN()}if(isNegative(value)){return generateNegativeNode(value)}}if(value===undefined){return generateUndefined()}return{type:Syntax.Literal,value:value}}function isReference(node){var type=node.type;return type===Syntax.Identifier||type===Syntax.MemberExpression}function canExtractSequence(last,parent,scope){var ref;if(parent.type===Syntax.CallExpression){if(last.type===Syntax.Identifier){if(last.name==="eval"){return false}ref=scope.resolve(last);return ref&&ref.isStatic()}return last.type!==Syntax.MemberExpression}else if(parent.type===Syntax.UnaryExpression){if(parent.operator==="delete"){return!isReference(last)}else if(parent.operator==="typeof"){if(last.type===Syntax.Identifier){ref=scope.resolve(last);return ref&&ref.isStatic()}}}else if(parent.type===Syntax.UpdateExpression){return!isReference(last)}return true}function delegateVariableDeclarations(stmt,func){var decls,target;decls=[];estraverse.traverse(stmt,{enter:function(node){var i,iz,decl;if(node.type===Syntax.VariableDeclaration){if(node.kind==="let"||node.kind==="const"){return}for(i=0,iz=node.declarations.length;i<iz;++i){decl=node.declarations[i];delete decl.init;decls.push(decl)}return estraverse.VisitorOption.Skip}else if(escope.Scope.isVariableScopeRequired(node)){return estraverse.VisitorOption.Skip}}});if(!decls.length){return null}target=null;estraverse.traverse(func.body,{enter:function(node,parent){if(node===stmt){return estraverse.VisitorOption.Skip}else if(escope.Scope.isVariableScopeRequired(node)){return estraverse.VisitorOption.Skip}else if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){if(parent.type!==Syntax.ForInStatement){target=node;return estraverse.VisitorOption.Break}}}});if(target){target.declarations=target.declarations.concat(decls);return null}else{return{type:Syntax.VariableDeclaration,kind:"var",declarations:decls}}}function isScopedDeclaration(node){if(node.type===Syntax.VariableDeclaration&&(node.kind==="let"||node.kind==="const")){return true}else if(node.type===Syntax.FunctionDeclaration){return true}return false}exports.deepCopy=deepCopy;exports.stringRepeat=stringRepeat;exports.sameValue=sameValue;exports.Array={isArray:isArray,from:arrayFrom,of:arrayOf,last:arrayLast,empty:arrayEmpty};exports.Object={isObject:isObject,has:has};exports.Syntax=Syntax;exports.traverse=estraverse.traverse;exports.replace=estraverse.replace;exports.VisitorKeys=estraverse.VisitorKeys;exports.VisitorOption=estraverse.VisitorOption;exports.assert=assert;exports.unreachable=unreachable;exports.isIdentifier=isIdentifier;exports.moveLocation=moveLocation;exports.deleteLocation=deleteLocation;exports.convertToEmptyStatement=convertToEmptyStatement;exports.mayBeCompletionValue=mayBeCompletionValue;exports.isNegative=isNegative;exports.isFunctionBody=isFunctionBody;exports.SpecialNode={generateNegative:generateNegativeNode,isNegative:isNegativeNode,generateUndefined:generateUndefined,isUndefined:isUndefined,generateNaN:generateNaN,isNaN:isNaNNode,isReference:isReference,canExtractSequence:canExtractSequence,generateFromValue:generateFromValue};exports.delegateVariableDeclarations=delegateVariableDeclarations;exports.isScopedDeclaration=isScopedDeclaration})()},{escope:65,estraverse:105,esutils:108}],70:[function(require,module,exports){(function(){"use strict";var esshorten,common,Options,Syntax,Pass,annotateDirective;esshorten=require("esshorten");common=require("./common");Options=require("./options");Pass=require("./pass");annotateDirective=require("./annotate-directive");Syntax=common.Syntax;function recover(tree,useDirectiveStatement){function trailingIf(node){while(true){switch(node.type){case Syntax.IfStatement:if(!node.alternate){return true}node=node.alternate;continue;case Syntax.LabeledStatement:case Syntax.ForStatement:case Syntax.ForInStatement:case Syntax.WhileStatement:case Syntax.WithStatement:node=node.body;continue}return false}}common.traverse(tree,{leave:function leave(node){if(node.type===Syntax.IfStatement&&node.alternate){if(node.consequent.type!==Syntax.BlockStatement){if(trailingIf(node.consequent)){node.consequent={type:Syntax.BlockStatement,body:[node.consequent]}}}}if(!useDirectiveStatement&&node.type===Syntax.DirectiveStatement){node.type=Syntax.ExpressionStatement;node.expression=common.moveLocation(node,{type:Syntax.Literal,value:node.value,raw:node.raw});delete node.directive;delete node.value;delete node.raw}}});return tree}function iteration(tree,p,options){var i,iz,pass,res,changed,statuses,passes,result;function addPass(pass){var name;if(typeof pass!=="function"){name=Object.keys(pass)[0];pass=pass[name]}if(pass.hasOwnProperty("passName")){name=pass.passName}else{name=pass.name}passes.push(pass);statuses.push(true)}function fillStatuses(bool){var i,iz;for(i=0,iz=statuses.length;i<iz;++i){statuses[i]=bool}}result=options.get("destructive")?tree:common.deepCopy(tree);statuses=[];passes=[];for(i=0,iz=p.length;i<iz;++i){addPass(p[i])}do{changed=false;for(i=0,iz=passes.length;i<iz;++i){pass=passes[i];if(statuses[i]){res=pass(result,options);if(res.modified){changed=true;fillStatuses(true)}else{statuses[i]=false}result=res.result}}}while(changed);return result}function optimize(tree,pipeline,options){var i,iz,j,jz,section,pass;tree=annotateDirective(tree,new Options({destructive:false}));if(null==pipeline){pipeline=Pass.__defaultPipeline}options=new Options(options);for(i=0,iz=pipeline.length;i<iz;++i){section=pipeline[i];if(common.Array.isArray(section)){tree=iteration(tree,section,options)}else if(section.once){pass=section.pass;for(j=0,jz=pass.length;j<jz;++j){tree=pass[j](tree,options).result}}}return recover(tree,options.get("directive"))}exports.version=require("../package.json").version;exports.mangle=esshorten.mangle;exports.optimize=optimize;exports.pass=Pass})()},{"../package.json":109,"./annotate-directive":68,"./common":69,"./options":73,"./pass":74,esshorten:111}],71:[function(require,module,exports){(function(){"use strict";var Syntax,common;common=require("./common");Syntax=common.Syntax;function isConstant(node,allowRegExp){if(node.type===Syntax.Literal){if(typeof node.value==="object"&&node.value!==null){return allowRegExp}return true}if(node.type===Syntax.UnaryExpression){if(node.operator==="void"||node.operator==="delete"||node.operator==="!"){return isConstant(node.argument,true)}return isConstant(node.argument,false)}if(node.type===Syntax.BinaryExpression){if(node.operator==="in"||node.operator==="instanceof"){return false}return isConstant(node.left,false)&&isConstant(node.right,false)}if(node.type===Syntax.LogicalExpression){return isConstant(node.left,true)&&isConstant(node.right,true)}return false}function getConstant(node){if(node.type===Syntax.Literal){return node.value}if(node.type===Syntax.UnaryExpression){return doUnary(node.operator,getConstant(node.argument))}if(node.type===Syntax.BinaryExpression){return doBinary(node.operator,getConstant(node.left),getConstant(node.right))}if(node.type===Syntax.LogicalExpression){return doLogical(node.operator,getConstant(node.left),getConstant(node.right))}common.unreachable()}function doLogical(operator,left,right){if(operator==="||"){return left||right}if(operator==="&&"){return left&&right}common.unreachable()}function doUnary(operator,argument){switch(operator){case"+":return+argument;case"-":return-argument;case"~":return~argument;case"!":return!argument;case"delete":return true;case"void":return undefined;case"typeof":return typeof argument}common.unreachable()}function doBinary(operator,left,right){switch(operator){case"|":return left|right;case"^":return left^right;case"&":return left&right;case"==":return left==right;case"!=":return left!=right;case"===":return left===right;case"!==":return left!==right;case"<":return left<right;case">":return left>right;case"<=":return left<=right;case">=":return left>=right;case"<<":return left<<right;case">>":return left>>right;case">>>":return left>>>right;case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right}common.unreachable()}exports.constant={doBinary:doBinary,doUnary:doUnary,doLogical:doLogical,evaluate:getConstant,isConstant:isConstant};function hasSideEffect(expr,scope){function visit(expr){var i,iz,ref;switch(expr.type){case Syntax.AssignmentExpression:return true;case Syntax.ArrayExpression:for(i=0,iz=expr.elements.length;i<iz;++i){if(expr.elements[i]!==null&&visit(expr.elements[i])){return true}}return false;case Syntax.BinaryExpression:return!isConstant(expr);case Syntax.CallExpression:return true;case Syntax.ConditionalExpression:return visit(expr.test)||visit(expr.consequent)||visit(expr.alternate);case Syntax.FunctionExpression:return false;case Syntax.Identifier:ref=scope.resolve(expr);if(ref&&ref.isStatic()){return false}return true;case Syntax.Literal:return false;case Syntax.LogicalExpression:return visit(expr.left)||visit(expr.right);case Syntax.MemberExpression:return true;case Syntax.NewExpression:return true;case Syntax.ObjectExpression:for(i=0,iz=expr.properties.length;i<iz;++i){if(visit(expr.properties[i])){return true}}return false;case Syntax.Property:return visit(expr.value);case Syntax.SequenceExpression:for(i=0,iz=expr.expressions.length;i<iz;++i){if(visit(expr.expressions[i])){return true}}return false;case Syntax.ThisExpression:return false;case Syntax.UnaryExpression:if(expr.operator==="void"||expr.operator==="delete"||expr.operator==="typeof"||expr.operator==="!"){return visit(expr.argument)}return!isConstant(expr);case Syntax.UpdateExpression:return true}return true}return visit(expr)}exports.hasSideEffect=hasSideEffect;function booleanCondition(expr){var ret;switch(expr.type){case Syntax.AssignmentExpression:return booleanCondition(expr.right);case Syntax.ArrayExpression:return true;case Syntax.BinaryExpression:if(isConstant(expr)){return!!getConstant(expr)}return null;case Syntax.CallExpression:return null;case Syntax.ConditionalExpression:ret=booleanCondition(expr.test);if(ret===true){return booleanCondition(expr.consequent)}if(ret===false){return booleanCondition(expr.alternate)}ret=booleanCondition(expr.consequent);if(ret===booleanCondition(expr.alternate)){return ret}return null;case Syntax.FunctionExpression:return true;case Syntax.Identifier:return null;case Syntax.Literal:return!!getConstant(expr);case Syntax.LogicalExpression:if(expr.operator==="&&"){ret=booleanCondition(expr.left);if(ret===null){return null}if(!ret){return false}return booleanCondition(expr.right)}else{ret=booleanCondition(expr.left);if(ret===null){return null}if(ret){return true}return booleanCondition(expr.right)}return null;case Syntax.MemberExpression:return null;case Syntax.NewExpression:return true;case Syntax.ObjectExpression:return true;case Syntax.Property:common.unreachable();return null;case Syntax.SequenceExpression:return booleanCondition(common.Array.last(expr.expressions));case Syntax.ThisExpression:return null;case Syntax.UnaryExpression:if(expr.operator==="void"){return false}if(expr.operator==="typeof"){return true}if(expr.operator==="!"){ret=booleanCondition(expr.argument);if(ret===null){return null}return!ret}if(isConstant(expr)){return!!getConstant(expr)}return null;case Syntax.UpdateExpression:return null}return null}exports.booleanCondition=booleanCondition})()},{"./common":69}],72:[function(require,module,exports){(function(global){(function(){"use strict";var Map;if(typeof global.Map!=="undefined"){Map=global.Map}else{Map=function Map(){this.__data={}};Map.prototype.get=function MapGet(key){key="$"+key;if(this.__data.hasOwnProperty(key)){return this.__data[key]}};Map.prototype.has=function MapHas(key){key="$"+key;return this.__data.hasOwnProperty(key)};Map.prototype.set=function MapSet(key,val){key="$"+key;this.__data[key]=val};Map.prototype["delete"]=function MapDelete(key){key="$"+key;return delete this.__data[key]};Map.prototype.clear=function MapClear(){this.__data={}};Map.prototype.forEach=function MapForEach(callback,thisArg){var real,key;for(real in this.__data){if(this.__data.hasOwnProperty(real)){key=real.substring(1);callback.call(thisArg,this.__data[real],key,this)}}};Map.prototype.keys=function MapKeys(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push(real.substring(1))}}return result};Map.prototype.values=function MapValues(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push(this.__data[real])}}return result};Map.prototype.items=function MapItems(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push([real.substring(1),this.__data[real]])}}return result}}module.exports=Map})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],73:[function(require,module,exports){(function(){"use strict";var common;common=require("./common");function extend(result,update){var prop,lhs,rhs;for(prop in update){if(!common.Object.has(update,prop)){continue}if(prop in result){lhs=result[prop];rhs=update[prop];if(common.Object.isObject(rhs)&&common.Object.isObject(lhs)){result[prop]=extend(lhs,rhs)}else{result[prop]=update[prop]}}else{result[prop]=update[prop]}}return result}function Options(override){var defaults={destructive:true,preserveCompletionValue:false};if(override==null){
this.data=defaults;return}this.data=extend(defaults,override)}Options.prototype.get=function get(name,details){var local;if(details!=null){if(common.Object.has(details,"pathName")){local=this.data[details.pathName];if(local!=null&&common.Object.has(local,name)){return local[name]}}}return this.data[name]};module.exports=Options})()},{"./common":69}],74:[function(require,module,exports){(function(){"use strict";var query,Registry,pass,post,common;common=require("./common");query=require("./query");Registry={};Registry.__direct={};function initialize(kind,passes){var i,iz,pass;Registry[kind]={};for(i=0,iz=passes.length;i<iz;++i){pass=passes[i];common.assert(Registry[kind][pass.passName]==null,"don't create duplicate pass names");Registry[kind][pass.passName]=pass}common.assert(Registry.__direct[pass.passName]==null,"don't create duplicate pass names");Registry.__direct[pass.passName]=pass}pass=[require("./pass/hoist-variable-to-arguments"),require("./pass/transform-dynamic-to-static-property-access"),require("./pass/transform-dynamic-to-static-property-definition"),require("./pass/transform-immediate-function-call"),require("./pass/transform-logical-association"),require("./pass/reordering-function-declarations"),require("./pass/remove-unused-label"),require("./pass/remove-empty-statement"),require("./pass/remove-wasted-blocks"),require("./pass/transform-to-compound-assignment"),require("./pass/transform-to-sequence-expression"),require("./pass/transform-branch-to-expression"),require("./pass/transform-typeof-undefined"),require("./pass/reduce-sequence-expression"),require("./pass/reduce-branch-jump"),require("./pass/reduce-multiple-if-statements"),require("./pass/dead-code-elimination"),require("./pass/remove-side-effect-free-expressions"),require("./pass/remove-context-sensitive-expressions"),require("./pass/tree-based-constant-folding"),require("./pass/concatenate-variable-definition"),require("./pass/drop-variable-definition"),require("./pass/remove-unreachable-branch"),require("./pass/eliminate-duplicate-function-declarations")];post=[require("./post/transform-static-to-dynamic-property-access"),require("./post/transform-infinity"),require("./post/rewrite-boolean"),require("./post/rewrite-conditional-expression"),require("./post/omit-parens-in-void-context-iife")];initialize("pass",pass);initialize("post",post);function passRequire(name){if(common.Object.has(Registry.__direct,name)){return Registry.__direct[name]}return query.get(Registry,name.split("/"))}exports.require=passRequire;exports.Registry=Registry;exports.__defaultPipeline=[pass,{once:true,pass:post}]})()},{"./common":69,"./pass/concatenate-variable-definition":75,"./pass/dead-code-elimination":76,"./pass/drop-variable-definition":77,"./pass/eliminate-duplicate-function-declarations":78,"./pass/hoist-variable-to-arguments":79,"./pass/reduce-branch-jump":80,"./pass/reduce-multiple-if-statements":81,"./pass/reduce-sequence-expression":82,"./pass/remove-context-sensitive-expressions":83,"./pass/remove-empty-statement":84,"./pass/remove-side-effect-free-expressions":85,"./pass/remove-unreachable-branch":86,"./pass/remove-unused-label":87,"./pass/remove-wasted-blocks":88,"./pass/reordering-function-declarations":89,"./pass/transform-branch-to-expression":90,"./pass/transform-dynamic-to-static-property-access":91,"./pass/transform-dynamic-to-static-property-definition":92,"./pass/transform-immediate-function-call":93,"./pass/transform-logical-association":94,"./pass/transform-to-compound-assignment":95,"./pass/transform-to-sequence-expression":96,"./pass/transform-typeof-undefined":97,"./pass/tree-based-constant-folding":98,"./post/omit-parens-in-void-context-iife":99,"./post/rewrite-boolean":100,"./post/rewrite-conditional-expression":101,"./post/transform-infinity":102,"./post/transform-static-to-dynamic-property-access":103,"./query":104}],75:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="concatenate-variable-definition";common=require("../common");Syntax=common.Syntax;function concatenateVariableDefinition(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){var i,iz,j,jz,stmt,decl,target,body;if(node.type!==Syntax.BlockStatement&&node.type!==Syntax.Program){return}target=null;body=[];for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(stmt.type===Syntax.VariableDeclaration&&stmt.kind==="var"){if(!target){target=stmt;body.push(stmt);continue}modified=true;for(j=0,jz=stmt.declarations.length;j<jz;++j){decl=stmt.declarations[j];target.declarations.push(decl)}}else{target=null;body.push(stmt)}}node.body=body}});return{result:result,modified:modified}}concatenateVariableDefinition.passName=Name;module.exports=concatenateVariableDefinition})()},{"../common":69}],76:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,status,modified;Name="dead-code-elimination";common=require("../common");Syntax=common.Syntax;function JumpTarget(node,status,type){this.node=node;this.type=type;this.labels=status.labels||[];status.labels=null}JumpTarget.NAMED_ONLY=0;JumpTarget.ITERATION=2;JumpTarget.SWITCH=3;JumpTarget.prototype.isIteration=function isIteration(){return this.type===JumpTarget.ITERATION};JumpTarget.prototype.isAnonymous=function isAnonymous(){return this.type&2};JumpTarget.prototype.contains=function contains(label){return this.labels.indexOf(label)!==-1};function Jumps(){this.targets=[]}Jumps.prototype.lookupContinuableTarget=function lookupContinuableTarget(label){var i,target;for(i=this.targets.length-1;i>=0;--i){target=this.targets[i];if(target.isIteration()&&(!label||target.contains(label.name))){return target.node}}common.unreachable()};Jumps.prototype.lookupBreakableTarget=function lookupBreakableTarget(label){var i,target;for(i=this.targets.length-1;i>=0;--i){target=this.targets[i];if(label){if(target.contains(label.name)){return target.node}}else{if(target.isAnonymous()){return target.node}}}common.unreachable()};Jumps.prototype.push=function push(target){this.targets.push(target)};Jumps.prototype.pop=function pop(){this.targets.pop()};function Status(upper){this.current=[];this.upper=upper;this.jumps=new Jumps;this.labels=null;this.next()}Status.NEXT={};Status.prototype.insert=function insert(stmt){this.current.push(stmt)};Status.prototype.erase=function erase(stmt){var index=this.current.indexOf(stmt);if(index===-1){return false}this.current.splice(index,1);return true};Status.prototype.kill=function kill(){return this.erase(Status.NEXT)};Status.prototype.has=function has(stmt){return this.current.indexOf(stmt)!==-1};Status.prototype.jumpTo=function jumpTo(stmt){this.kill();this.insert(stmt)};Status.prototype.resolveJump=function resolveJump(stmt){var index=this.current.indexOf(stmt);if(index!==-1){this.current.splice(index,1);this.insert(Status.NEXT)}};Status.prototype.clear=function clear(){this.current.length=0};Status.prototype.next=function next(){this.insert(Status.NEXT)};Status.prototype.isDead=function isDead(){return!this.has(Status.NEXT)};Status.prototype.revive=function revive(){if(this.isDead()){this.next();return true}return false};Status.prototype.register=function register(node){if(!this.labels){this.labels=[]}this.labels.push(node.label.name)};Status.prototype.unregister=function unregister(){this.labels=null};Status.isRequired=function isRequired(node){var type=node.type;common.assert(node,"should be node");return type===Syntax.Program||type===Syntax.FunctionExpression||type===Syntax.FunctionDeclaration};function Context(node){node.__$context=this;this.node=node}Context.prototype.detach=function detach(){delete this.node.__$context};Context.lookup=function lookup(node){return node.__$context};function getForwardLastNode(node){while(true){switch(node.type){case Syntax.IfStatement:if(node.alternate){return null}node=node.consequent;continue;case Syntax.WithStatement:case Syntax.LabeledStatement:node=node.body;continue;case Syntax.BlockStatement:if(node.body.length){node=common.Array.last(node.body);continue}break}return node}}function visitLoopBody(loop,body){var jump,last;last=getForwardLastNode(body);if(last){if(last.type===Syntax.ContinueStatement){jump=status.jumps.lookupContinuableTarget(last.label);if(jump===loop){modified=true;common.convertToEmptyStatement(last)}}}return visit(body)}function visit(target){var live=false;if(!target){return!status.isDead()}function eliminate(node,array){var i,iz,stmt,ret,info,result;result=[];for(i=0,iz=array.length;i<iz;++i){stmt=array[i];if(stmt.type===Syntax.IfStatement){info=new Context(stmt);ret=visit(stmt);info.detach()}else{ret=visit(stmt)}if(ret){live|=1;result.push(stmt);if(stmt.type===Syntax.IfStatement&&stmt.alternate){if((!info.consequent||!info.alternate)&&info.consequent!==info.alternate){modified=true;if(info.consequent){stmt.test=common.moveLocation(stmt.test,{type:Syntax.UnaryExpression,operator:"!",argument:stmt.test});result.push(stmt.consequent);stmt.consequent=stmt.alternate;stmt.alternate=null}else{result.push(stmt.alternate);stmt.alternate=null}}}}else{modified=true}}return result}common.traverse(target,{enter:function enter(node){var i,iz,stmt,consequent,alternate,ctx,hasDefaultClause;if(Status.isRequired(node)){status=new Status(status)}live|=!status.isDead();switch(node.type){case Syntax.Program:node.body=eliminate(node,node.body);return common.VisitorOption.Skip;case Syntax.BlockStatement:status.jumps.push(new JumpTarget(node,status,JumpTarget.NAMED_ONLY));node.body=eliminate(node,node.body);status.jumps.pop();status.resolveJump(node);return common.VisitorOption.Skip;case Syntax.BreakStatement:if(node.label&&status.labels&&status.labels.indexOf(node.label)){modified=true;common.convertToEmptyStatement(node)}else{status.jumpTo(status.jumps.lookupBreakableTarget(node.label))}return common.VisitorOption.Skip;case Syntax.CatchClause:live|=visit(node.body);return common.VisitorOption.Skip;case Syntax.ContinueStatement:status.jumpTo(status.jumps.lookupContinuableTarget(node.label));return common.VisitorOption.Skip;case Syntax.DoWhileStatement:status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();live|=visit(node.test);status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.DebuggerStatement:return common.VisitorOption.Skip;case Syntax.EmptyStatement:return common.VisitorOption.Skip;case Syntax.ExpressionStatement:break;case Syntax.ForStatement:live|=visit(node.init);live|=visit(node.test);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();live|=visit(node.update);status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.ForInStatement:live|=visit(node.left);live|=visit(node.right);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.IfStatement:live|=visit(node.test);live|=visit(node.consequent);if(!node.alternate){status.revive();return common.VisitorOption.Skip}consequent=!status.isDead();if(!status.revive()){status.insert(node)}live|=visit(node.alternate);alternate=!status.isDead();if(status.erase(node)){status.revive()}if(ctx=Context.lookup(node)){ctx.consequent=consequent;ctx.alternate=alternate}return common.VisitorOption.Skip;case Syntax.LabeledStatement:status.register(node);break;case Syntax.ReturnStatement:live|=visit(node.argument);status.kill();return common.VisitorOption.Skip;case Syntax.SwitchStatement:visit(node.discriminant);status.jumps.push(new JumpTarget(node,status,JumpTarget.SWITCH));for(i=0,iz=node.cases.length;i<iz;++i){stmt=node.cases[i];live|=visit(stmt);if(!stmt.test){hasDefaultClause=true}if(status.isDead()&&i+1<iz){status.next()}}status.jumps.pop();status.resolveJump(node);if(status.isDead()&&!hasDefaultClause){status.next()}return common.VisitorOption.Skip;case Syntax.SwitchCase:if(node.test){live|=visit(node.test)}node.consequent=eliminate(node,node.consequent);return common.VisitorOption.Skip;case Syntax.ThrowStatement:live|=visit(node.argument);status.kill();return common.VisitorOption.Skip;case Syntax.TryStatement:live|=visit(node.block);if(node.handlers&&node.handlers.length){if(!status.revive()){status.insert(node)}node.handlers=eliminate(node,node.handlers);if(status.erase(node)){status.revive()}}if(node.finalizer){if(!status.revive()){status.insert(node)}live|=visit(node.finalizer);if(!status.erase(node)){status.kill()}}return common.VisitorOption.Skip;case Syntax.WhileStatement:live|=visit(node.test);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.WithStatement:break;case Syntax.VariableDeclaration:case Syntax.FunctionDeclaration:live=true;break}},leave:function leave(node){if(Status.isRequired(node)){status=status.upper;return}if(node.type===Syntax.LabeledStatement){status.unregister()}}});return live}function deadCodeElimination(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);status=null;modified=false;visit(result);common.assert(status===null,"status should be null");return{result:result,modified:modified}}deadCodeElimination.passName=Name;module.exports=deadCodeElimination})()},{"../common":69}],77:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified,escope,evaluator;Name="drop-variable-definition";common=require("../common");escope=require("escope");evaluator=require("../evaluator");Syntax=common.Syntax;function getCandidates(scope){var i,iz,j,jz,identifiers,slots,v;if(!scope.candidates){slots=[];identifiers=[];for(i=0,iz=scope.variables.length;i<iz;++i){v=scope.variables[i];for(j=0,jz=v.identifiers.length;j<jz;++j){identifiers.push(v.identifiers[j]);slots.push(v)}}scope.candidates={slots:slots,identifiers:identifiers}}return scope.candidates}function isRemovableDefinition(slot){var i,iz,ref,parent;if(slot.identifiers.length!==1){return false}if(slot.references.length===0){return true}for(i=0,iz=slot.references.length;i<iz;++i){ref=slot.references[i];if(ref.isRead()){return false}if(ref.isWrite()){if(!ref.writeExpr){return false}parent=ref.writeExpr.__$parent$__;if(!parent){return false}if(parent.type!==Syntax.AssignmentExpression&&parent.type!==Syntax.VariableDeclarator){return false}if(evaluator.hasSideEffect(ref.writeExpr,ref.from)){return false}}}return true}function overrideExpression(from,to){var key;for(key in from){delete from[key]}for(key in to){from[key]=to[key]}return from}function removeDefinition(node,index,slot){var i,iz,ref,parent;node.declarations.splice(index,1);for(i=0,iz=slot.references.length;i<iz;++i){ref=slot.references[i];common.assert(!ref.isRead());if(ref.isWrite()){parent=ref.writeExpr.__$parent$__;if(parent.type===Syntax.AssignmentExpression){overrideExpression(ref.writeExpr.__$parent$__,ref.writeExpr)}}}}function attachParent(tree){return common.traverse(tree,{enter:function(node,parent){node.__$parent$__=parent}})}function removeParent(tree){return common.traverse(tree,{enter:function(node){delete node.__$parent$__;delete node.__$escope$__}})}function dropVariableDefinition(tree,options){var result,manager,scope;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();attachParent(result);result=common.replace(result,{enter:function enter(node,parent){var i,decl,cand,index,slot,ret;ret=node;if(scope){if(scope.variableScope.isStatic()){cand=getCandidates(scope.variableScope);if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){i=node.declarations.length;while(i--){decl=node.declarations[i];index=cand.identifiers.indexOf(decl.id);if(index!==-1){slot=cand.slots[index];if(isRemovableDefinition(slot)){modified=true;removeDefinition(node,i,slot);continue}}}if(node.declarations.length===0){if(parent.type===Syntax.ForStatement){ret=null}else{ret=common.moveLocation(node,{type:Syntax.EmptyStatement})}}}if(node.type===Syntax.FunctionDeclaration){index=cand.identifiers.indexOf(node.id);if(index!==-1){slot=cand.slots[index];if(slot.identifiers.length===1&&slot.references.length===0){modified=true;ret=common.moveLocation(node,{type:Syntax.EmptyStatement});return ret}}}}}scope=manager.acquire(node)||scope;return ret},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();removeParent(result);return{result:result,modified:modified}}dropVariableDefinition.passName=Name;module.exports=dropVariableDefinition})()},{"../common":69,"../evaluator":71,escope:65}],78:[function(require,module,exports){(function(){"use strict";var Name,Syntax,Map,common,modified;Name="eliminate-duplicate-function-declarations";common=require("../common");Map=require("../map");Syntax=common.Syntax;function unique(map,root){return common.replace(root,{enter:function(node){var name,info;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;info=map.get(name);--info.count;if(info.count!==0){modified=true;return common.moveLocation(node,{type:Syntax.EmptyStatement})}}if(node!==root&&node.type===Syntax.BlockStatement){return this.skip()}}})}function uniqueInGlobal(map,root){return common.replace(root,{enter:function(node){var name,info,first;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;info=map.get(name);first=info.count===info.declarations.length;--info.count;if(info.declarations.length>1){if(first){modified=true;return common.Array.last(info.declarations)}else{modified=true;return common.moveLocation(node,{type:Syntax.EmptyStatement})}}}if(node!==root&&node.type===Syntax.BlockStatement){return this.skip()}}})}function main(tree,options){var result,stack,functionDepth,globalBlockFound;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;functionDepth=0;globalBlockFound=false;stack=[new Map];result=common.replace(result,{enter:function enter(node){var map,name,info;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;map=common.Array.last(stack);if(map.has(name)){info=map.get(name);info.declarations.push(node);++info.count}else{info={declarations:[node],count:1};map.set(name,info)}}if(node.type===Syntax.BlockStatement){stack.push(new Map)}if(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){++functionDepth}},leave:function leave(node){var map,ret;if(node.type===Syntax.BlockStatement){map=stack.pop();if(functionDepth===0){if(map.keys().length!==0){globalBlockFound=true}}else{ret=unique(map,node)}}if(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){--functionDepth}return ret}});common.assert(stack.length===1,"global map remains");if(!globalBlockFound){result=uniqueInGlobal(stack[0],result)}return{result:result,modified:modified}}main.passName=Name;module.exports=main})()},{"../common":69,"../map":72}],79:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="hoist-variable-to-arguments";escope=require("escope");common=require("../common");Syntax=common.Syntax;function hoist(callee){function hoisting(ident){var hoisted,i,iz;hoisted=false;for(i=0,iz=callee.params.length;i<iz;++i){if(ident.name===callee.params[i].name){hoisted=true;break}}if(!hoisted){callee.params.push(ident)}}callee.body=common.replace(callee.body,{enter:function(node,parent){var i,iz,expressions,declaration,forstmt,expr;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){this.skip();return}if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){if(parent.type===Syntax.ForInStatement){common.assert(node.declarations.length===1,"for-in declaration length should be 1");declaration=node.declarations[0];if(declaration.init){return}if(declaration.id.type!==Syntax.Identifier){return}hoisting(declaration.id);modified=true;return declaration.id}forstmt=parent.type===Syntax.ForStatement;expressions=[];for(i=0,iz=node.declarations.length;i<iz;++i){declaration=node.declarations[i];if(declaration.id.type!==Syntax.Identifier){return}hoisting(declaration.id);if(declaration.init){expressions.push(common.moveLocation(declaration,{type:Syntax.AssignmentExpression,operator:"=",left:declaration.id,right:declaration.init}))}}modified=true;if(expressions.length===0){if(forstmt){return null}return common.moveLocation(node,{type:Syntax.EmptyStatement})}if(expressions.length===1){expr=expressions[0]}else{expr=common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:expressions})}if(forstmt){return expr}return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:expr})}}})}function hoistVariableToArguments(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var callee;if(node.type===Syntax.CallExpression||node.type===Syntax.NewExpression){callee=node.callee;if(callee.type===Syntax.FunctionExpression&&!callee.id){if(callee.params.length===node["arguments"].length){scope=manager.acquire(callee);if(!scope.isArgumentsMaterialized()&&(node.type!==Syntax.NewExpression||!scope.isThisMaterialized())){hoist(callee)}}}}}});manager.detach();return{result:result,modified:modified}}hoistVariableToArguments.passName=Name;module.exports=hoistVariableToArguments})()},{"../common":69,escope:65}],80:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reduce-branch-jump";common=require("../common");Syntax=common.Syntax;function reduceLast(ary,index){var node,left;node=ary[index];if(node.type===Syntax.IfStatement){if(!node.alternate){if(node.consequent.type===Syntax.ReturnStatement){modified=true;left=node.consequent.argument;if(!left){ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]}});return true}ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.ConditionalExpression,test:node.test,consequent:left,alternate:common.SpecialNode.generateUndefined()}});return true}}}}function reduce(ary,index){var node,sibling,left,right;node=ary[index];sibling=ary[index+1];if(node.type===Syntax.IfStatement){if(!node.alternate){if(node.consequent.type===Syntax.ReturnStatement&&sibling.type===Syntax.ReturnStatement){modified=true;ary.splice(index,1);left=node.consequent.argument;right=sibling.argument;if(!left&&!right){ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]}});return true}if(!left){left=common.SpecialNode.generateUndefined()}if(!right){right=common.SpecialNode.generateUndefined()}ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.ConditionalExpression,test:node.test,consequent:left,alternate:right}});return true}}}return false}function reduceBranchJump(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node,parent){var i;switch(node.type){case Syntax.BlockStatement:case Syntax.Program:i=0;while(i<node.body.length-1){if(!reduce(node.body,i)){++i}}if(common.isFunctionBody(node,parent)){if(node.body.length>0){i=node.body.length-1;reduceLast(node.body,i)}}break;case Syntax.SwitchCase:i=0;while(i<node.consequent.length-1){if(!reduce(node.consequent,i)){++i}}break}}});return{result:result,modified:modified}}reduceBranchJump.passName=Name;module.exports=reduceBranchJump})()},{"../common":69}],81:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reduce-multiple-if-statements";common=require("../common");Syntax=common.Syntax;function reduceMultipleIfStatements(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){if(node.type===Syntax.IfStatement&&!node.alternate&&node.consequent.type===Syntax.IfStatement&&!node.consequent.alternate){modified=true;node.test={type:Syntax.LogicalExpression,operator:"&&",left:node.test,right:node.consequent.test};node.consequent=node.consequent.consequent}}});return{result:result,modified:modified}}reduceMultipleIfStatements.passName=Name;module.exports=reduceMultipleIfStatements})()},{"../common":69}],82:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,escope,modified;Name="reduce-sequence-expression";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function reduce(node){var i,iz,j,jz,expr,result;result=[];for(i=0,iz=node.expressions.length;i<iz;++i){expr=node.expressions[i];if(expr.type===Syntax.SequenceExpression){modified=true;common.deleteLocation(node);for(j=0,jz=expr.expressions.length;j<jz;++j){result.push(expr.expressions[j])}}else{result.push(expr)}}node.expressions=result}function isLoadSideEffectFree(node,scope){var ref,value;if(evaluator.constant.isConstant(node)){value=evaluator.constant.evaluate(node);if(value===null||typeof value!=="object"){return true}}if(node.type===Syntax.Identifier){ref=scope.resolve(node);return ref&&ref.isStatic()}return false}function isStoreSideEffectFree(node,scope){if(!evaluator.hasSideEffect(node,scope)){return true}if(node.type===Syntax.Identifier){return true}if(node.type===Syntax.MemberExpression){if(!evaluator.hasSideEffect(node.object,scope)){if(!node.computed||isLoadSideEffectFree(node.property,scope)){return true}}return false}return false}function reduceSequenceExpression(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node){scope=manager.acquire(node)||scope},leave:function leave(node){var result,last;switch(node.type){case Syntax.SequenceExpression:reduce(node);break;case Syntax.ConditionalExpression:if(node.test.type===Syntax.SequenceExpression){modified=true;result=node.test;node.test=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.LogicalExpression:if(node.left.type===Syntax.SequenceExpression){modified=true;result=node.left;node.left=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.BinaryExpression:if(node.left.type===Syntax.SequenceExpression){modified=true;result=node.left;node.left=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}else if(node.right.type===Syntax.SequenceExpression&&!evaluator.hasSideEffect(node.left,scope)){modified=true;result=node.right;node.right=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.UpdateExpression:case Syntax.UnaryExpression:if(node.argument.type===Syntax.SequenceExpression){last=common.Array.last(node.argument.expressions);if(!common.SpecialNode.canExtractSequence(last,node,scope)){break}modified=true;result=node.argument;node.argument=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.AssignmentExpression:if(node.operator==="="&&node.right.type===Syntax.SequenceExpression&&isStoreSideEffectFree(node.left,scope)){modified=true;result=node.right;node.right=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break}scope=manager.release(node)||scope;return result}});manager.detach();return{result:result,modified:modified}}reduceSequenceExpression.passName=Name;module.exports=reduceSequenceExpression})()},{"../common":69,"../evaluator":71,escope:65}],83:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,escope,modified;Name="remove-context-sensitive-expressions";common=require("../common");evaluator=require("../evaluator");escope=require("escope");Syntax=common.Syntax;function Transformer(trans,booleanFunction,voidFunction,scope){this.transform=trans;this.booleanFunction=booleanFunction;this.voidFunction=voidFunction;this.scope=scope}Transformer.prototype.booleanTransformation=function(expr){var consequent;do{if(expr.type===Syntax.UnaryExpression){if(expr.operator==="!"&&expr.argument.type===Syntax.UnaryExpression&&expr.argument.operator==="!"){modified=true;expr=expr.argument.argument;continue}}else if(expr.type===Syntax.LogicalExpression){if(expr.left.type===Syntax.UnaryExpression&&expr.left.operator==="!"&&expr.right.type===Syntax.UnaryExpression&&expr.right.operator==="!"){modified=true;expr.left=expr.left.argument;expr.right=expr.right.argument;expr.operator=expr.operator==="||"?"&&":"||";expr=common.moveLocation(expr,{type:Syntax.UnaryExpression,operator:"!",argument:expr});continue}}else if(expr.type===Syntax.ConditionalExpression){if(expr.test.type===Syntax.UnaryExpression&&expr.test.operator==="!"){modified=true;expr.test=expr.test.argument;consequent=expr.consequent;expr.consequent=expr.alternate;expr.alternate=consequent}}break}while(true);return expr};Transformer.prototype.voidTransformation=function(expr){var leftHasSideEffect,rightHasSideEffect;do{expr=this.booleanTransformation(expr);if(expr.type===Syntax.UnaryExpression){if(expr.operator==="!"||expr.operator==="void"){modified=true;expr=expr.argument;continue}}else if(expr.type===Syntax.LogicalExpression){if(expr.left.type===Syntax.UnaryExpression&&expr.left.operator==="!"){modified=true;expr.left=expr.left.argument;expr.operator=expr.operator==="||"?"&&":"||"}}else if(expr.type===Syntax.ConditionalExpression){leftHasSideEffect=evaluator.hasSideEffect(expr.consequent,this.scope);rightHasSideEffect=evaluator.hasSideEffect(expr.alternate,this.scope);if(!leftHasSideEffect&&!rightHasSideEffect){modified=true;expr=expr.test}else if(!leftHasSideEffect){modified=true;expr=common.moveLocation(expr,{type:Syntax.LogicalExpression,operator:"||",left:expr.test,right:expr.alternate})}else if(!rightHasSideEffect){modified=true;expr=common.moveLocation(expr,{type:Syntax.LogicalExpression,operator:"&&",left:expr.test,right:expr.consequent})}}break}while(true);return expr};Transformer.prototype.apply=function(expr){var prev;do{prev=expr;expr=this.transform(expr);if(prev!==expr){continue}if(expr.type===Syntax.LogicalExpression){expr.left=this.booleanFunction(expr.left,this.scope);expr.right=this.voidFunction(expr.right,this.scope)}else if(expr.type===Syntax.ConditionalExpression){expr.consequent=this.voidFunction(expr.consequent,this.scope);expr.alternate=this.voidFunction(expr.alternate,this.scope)}else if(expr.type===Syntax.SequenceExpression){expr.expressions[expr.expressions.length-1]=this.voidFunction(common.Array.last(expr.expressions),this.scope)}break}while(true);return expr};function voidContext(expr,scope){var trans=new Transformer(Transformer.prototype.voidTransformation,booleanContext,voidContext,scope);return trans.apply(expr)}function booleanContext(expr,scope){var trans=new Transformer(Transformer.prototype.booleanTransformation,booleanContext,booleanContext,scope);return trans.apply(expr)}function removeContextSensitiveExpressions(tree,options){var result,stackCount,preserveCompletionValue,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;stackCount=0;preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name
});scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node){var i,iz;scope=manager.acquire(node)||scope;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){++stackCount}switch(node.type){case Syntax.AssignmentExpression:break;case Syntax.ArrayExpression:break;case Syntax.BlockStatement:break;case Syntax.BinaryExpression:break;case Syntax.BreakStatement:break;case Syntax.CallExpression:break;case Syntax.CatchClause:break;case Syntax.ConditionalExpression:node.test=booleanContext(node.test,scope);break;case Syntax.ContinueStatement:break;case Syntax.DoWhileStatement:node.test=booleanContext(node.test,scope);break;case Syntax.DebuggerStatement:break;case Syntax.EmptyStatement:break;case Syntax.ExpressionStatement:if(!preserveCompletionValue||stackCount!==0){node.expression=voidContext(node.expression,scope)}break;case Syntax.FunctionExpression:break;case Syntax.ForInStatement:break;case Syntax.FunctionDeclaration:break;case Syntax.ForStatement:if(node.init&&node.init.type!==Syntax.VariableDeclaration){node.init=voidContext(node.init,scope)}if(node.test){node.test=booleanContext(node.test,scope)}if(node.update){node.update=voidContext(node.update,scope)}break;case Syntax.Identifier:break;case Syntax.IfStatement:node.test=booleanContext(node.test,scope);break;case Syntax.Literal:break;case Syntax.LabeledStatement:break;case Syntax.LogicalExpression:break;case Syntax.MemberExpression:break;case Syntax.NewExpression:break;case Syntax.ObjectExpression:break;case Syntax.Program:break;case Syntax.Property:break;case Syntax.ReturnStatement:break;case Syntax.SequenceExpression:for(i=0,iz=node.expressions.length-1;i<iz;++i){node.expressions[i]=voidContext(node.expressions[i],scope)}break;case Syntax.SwitchStatement:break;case Syntax.SwitchCase:break;case Syntax.ThisExpression:break;case Syntax.ThrowStatement:break;case Syntax.TryStatement:break;case Syntax.UnaryExpression:if(node.operator==="!"){node.argument=booleanContext(node.argument,scope)}else if(node.operator==="void"){node.argument=voidContext(node.argument,scope)}break;case Syntax.UpdateExpression:break;case Syntax.VariableDeclaration:break;case Syntax.VariableDeclarator:break;case Syntax.WhileStatement:node.test=booleanContext(node.test,scope);break;case Syntax.WithStatement:break}},leave:function leave(node){scope=manager.release(node)||scope;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){--stackCount}}});manager.detach();return{result:result,modified:modified}}removeContextSensitiveExpressions.passName=Name;module.exports=removeContextSensitiveExpressions})()},{"../common":69,"../evaluator":71,escope:65}],84:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="remove-empty-statement";common=require("../common");Syntax=common.Syntax;function remove(array){var i,iz,node,result;result=[];for(i=0,iz=array.length;i<iz;++i){node=array[i];if(node.type===Syntax.EmptyStatement){modified=true}else{result.push(node)}}return result}function removeAlternate(node){if(node.alternate){if(node.alternate.type===Syntax.EmptyStatement){modified=true;node.alternate=null}else if(node.consequent.type===Syntax.EmptyStatement){modified=true;node.consequent=node.alternate;node.alternate=null;node.test=common.moveLocation(node.test,{type:Syntax.UnaryExpression,operator:"!",argument:node.test})}}}function removeEmptyStatement(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){var clause;switch(node.type){case Syntax.BlockStatement:case Syntax.Program:node.body=remove(node.body);break;case Syntax.SwitchCase:node.consequent=remove(node.consequent);break;case Syntax.IfStatement:removeAlternate(node);break;case Syntax.SwitchStatement:if(node.cases.length){clause=common.Array.last(node.cases);if(!clause.test&&common.Array.empty(clause.consequent)){modified=true;node.cases.pop()}}}}});return{result:result,modified:modified}}removeEmptyStatement.passName=Name;module.exports=removeEmptyStatement})()},{"../common":69}],85:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,evaluator,modified;Name="remove-side-effect-free-expressions";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function reduce(node,scope,parent,isResultNeeded){var i,iz,expr,result,prev;common.assert(node.expressions.length>1,"expressions should be more than one");result=[];for(i=0,iz=node.expressions.length;i<iz;++i){prev=expr;expr=node.expressions[i];if(i+1!==iz||!isResultNeeded){if(!evaluator.hasSideEffect(expr,scope)){continue}}result.push(expr)}if(!isResultNeeded&&result.length===0){modified=true;return expr}common.assert(result.length>0,"result should be more than zero");do{if(iz===result.length){return node}if(result.length===1){if(!common.SpecialNode.canExtractSequence(result[0],parent,scope)){result.unshift(prev);continue}modified=true;return result[0]}modified=true;node.expressions=result;return node}while(true)}function removeSideEffectFreeExpressions(tree,options){var result,scope,manager,preserveCompletionValue;function isResultNeeded(parent,scope){if(parent.type===Syntax.ExpressionStatement&&(!preserveCompletionValue||scope.type!=="global")){return false}return true}result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node,parent){var res,unary,trans;res=node;scope=manager.acquire(node)||scope;if(res.type===Syntax.SequenceExpression){res=reduce(res,scope,parent,isResultNeeded(parent,scope))}if(res.type===Syntax.SequenceExpression){common.assert(res.expressions.length>1,"sequences' length should be more than 1");unary=common.Array.last(res.expressions);if(unary.type===Syntax.UnaryExpression&&unary.operator==="void"&&!evaluator.hasSideEffect(unary.argument,scope)){modified=true;res.expressions.pop();trans=common.moveLocation(unary,{type:Syntax.UnaryExpression,operator:"void",argument:common.Array.last(res.expressions)});if(res.expressions.length===1){res=trans}else{res.expressions[res.expressions.length-1]=trans}}}if(!isResultNeeded(res,scope)){if(!evaluator.hasSideEffect(res.expression,scope)){modified=true;res=common.moveLocation(res,{type:Syntax.EmptyStatement})}}return res},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}removeSideEffectFreeExpressions.passName=Name;module.exports=removeSideEffectFreeExpressions})()},{"../common":69,"../evaluator":71,escope:65}],86:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,evaluator,modified;Name="remove-unreachable-branch";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function handleIfStatement(func,node){var test,body,decl;test=evaluator.booleanCondition(node.test);if(!node.alternate){if(typeof test==="boolean"){modified=true;body=[];if(test){body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.consequent);return{type:Syntax.BlockStatement,body:body}}else{decl=common.delegateVariableDeclarations(node.consequent,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}));return{type:Syntax.BlockStatement,body:body}}}}else{if(typeof test==="boolean"){modified=true;body=[];if(test){decl=common.delegateVariableDeclarations(node.alternate,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.consequent);return{type:Syntax.BlockStatement,body:body}}else{decl=common.delegateVariableDeclarations(node.consequent,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.alternate);return{type:Syntax.BlockStatement,body:body}}}}}function handleLogicalExpression(func,node){var test;test=evaluator.booleanCondition(node.left);if(typeof test==="boolean"){modified=true;if(test){if(node.operator==="&&"){return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.left,node.right]})}else{return node.left}}else{if(node.operator==="&&"){return node.left}else{return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.left,node.right]})}}}}function handleConditionalExpression(func,node){var test;test=evaluator.booleanCondition(node.test);if(typeof test==="boolean"){modified=true;if(test){return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,node.consequent]})}else{return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,node.alternate]})}}}function removeUnreachableBranch(tree,options){var result,stack;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;stack=[];result=common.replace(result,{enter:function enter(node){var func;if(escope.Scope.isVariableScopeRequired(node)){stack.push(node);return}func=common.Array.last(stack);switch(node.type){case Syntax.IfStatement:return handleIfStatement(func,node);case Syntax.LogicalExpression:return handleLogicalExpression(func,node);case Syntax.ConditionalExpression:return handleConditionalExpression(func,node)}},leave:function leave(node){if(escope.Scope.isVariableScopeRequired(node)){stack.pop()}}});return{result:result,modified:modified}}removeUnreachableBranch.passName=Name;module.exports=removeUnreachableBranch})()},{"../common":69,"../evaluator":71,escope:65}],87:[function(require,module,exports){(function(){"use strict";var Name,Syntax,Map,common,scope,modified;Name="remove-unused-label";common=require("../common");Map=require("../map");Syntax=common.Syntax;function Scope(upper){this.set=new Map;this.unused=[];this.upper=upper}Scope.prototype.register=function register(node){var name;common.assert(node.type===Syntax.LabeledStatement);name=node.label.name;common.assert(!this.set.has(name),"duplicate label is found");this.set.set(name,{used:false,stmt:node})};Scope.prototype.unregister=function unregister(node){var name,ref;if(node.type===Syntax.LabeledStatement){name=node.label.name;ref=this.set.get(name);this.set["delete"](name);if(!ref.used){modified=true;return node.body}}return node};Scope.prototype.resolve=function resolve(node){var name;if(node.label){name=node.label.name;common.assert(this.set.has(name),"unresolved label");this.set.get(name).used=true}};Scope.prototype.close=function close(){return this.upper};function removeUnusedLabel(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);scope=null;modified=false;result=common.replace(result,{enter:function enter(node){switch(node.type){case Syntax.Program:case Syntax.FunctionDeclaration:case Syntax.FunctionExpression:scope=new Scope(scope);break;case Syntax.LabeledStatement:scope.register(node);break;case Syntax.BreakStatement:case Syntax.ContinueStatement:scope.resolve(node);break}},leave:function leave(node){var ret;ret=scope.unregister(node);if(node.type===Syntax.Program||node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){scope=scope.close()}return ret}});return{result:result,modified:modified}}removeUnusedLabel.passName=Name;module.exports=removeUnusedLabel})()},{"../common":69,"../map":72}],88:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="remove-wasted-blocks";common=require("../common");Syntax=common.Syntax;function flattenBlockStatement(body){var i,iz,j,jz,result,stmt,inner,ok;result=[];for(i=0,iz=body.length;i<iz;++i){stmt=body[i];if(stmt.type===Syntax.BlockStatement){ok=true;for(j=0,jz=stmt.body.length;j<jz;++j){inner=stmt.body[j];if(common.isScopedDeclaration(inner)){ok=false}}if(ok){modified=true;result=result.concat(stmt.body)}else{result.push(stmt)}}else{result.push(stmt)}}return result}function removeWastedBlocks(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node,parent){var i,iz,stmt;if(node.type===Syntax.BlockStatement||node.type===Syntax.Program){for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(stmt.type===Syntax.BlockStatement){node.body=flattenBlockStatement(node.body);break}}}if(parent.type===Syntax.FunctionDeclaration||parent.type===Syntax.FunctionExpression||parent.type===Syntax.TryStatement||parent.type===Syntax.CatchClause){return}while(node.type===Syntax.BlockStatement&&node.body.length===1&&!common.isScopedDeclaration(node.body[0])){modified=true;node=node.body[0]}if(node.type===Syntax.BlockStatement&&node.body.length===0){modified=true;return{type:Syntax.EmptyStatement}}return node}});return{result:result,modified:modified}}removeWastedBlocks.passName=Name;module.exports=removeWastedBlocks})()},{"../common":69}],89:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reordering-function-declarations";common=require("../common");Syntax=common.Syntax;function reordering(array){var i,iz,node,directives,declarations,others;directives=[];declarations=[];others=[];for(i=0,iz=array.length;i<iz;++i){node=array[i];if(node.type===Syntax.FunctionDeclaration){if(declarations.length+directives.length!==i){modified=true}declarations.push(node)}else if(node.type===Syntax.DirectiveStatement){directives.push(node)}else{others.push(node)}}return directives.concat(declarations,others)}function reorderingFunctionDeclarations(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){switch(node.type){case Syntax.Program:node.body=reordering(node.body);break;case Syntax.FunctionDeclaration:case Syntax.FunctionExpression:node.body.body=reordering(node.body.body);break}}});return{result:result,modified:modified}}reorderingFunctionDeclarations.passName=Name;module.exports=reorderingFunctionDeclarations})()},{"../common":69}],90:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-branch-to-expression";common=require("../common");Syntax=common.Syntax;function transformBranchToExpression(tree,options){var result,preserveCompletionValue;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;result=common.replace(result,{leave:function leave(node){var consequent,alternate,ancestors;if(node.type===Syntax.IfStatement){ancestors=this.parents();if(preserveCompletionValue&&common.mayBeCompletionValue(node,ancestors)){return}if(node.alternate){if(node.consequent.type===Syntax.ExpressionStatement&&node.alternate.type===Syntax.ExpressionStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:node.consequent.expression,alternate:node.alternate.expression})})}if(node.consequent.type===Syntax.ReturnStatement&&node.alternate.type===Syntax.ReturnStatement){modified=true;if(!node.consequent.argument&&!node.alternate.argument){return common.moveLocation(node,{type:Syntax.ReturnStatement,argument:common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]})})}consequent=node.consequent.argument||common.SpecialNode.generateUndefined();alternate=node.alternate.argument||common.SpecialNode.generateUndefined();return common.moveLocation(node,{type:Syntax.ReturnStatement,argument:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:consequent,alternate:alternate})})}if(node.consequent.type===Syntax.ThrowStatement&&node.alternate.type===Syntax.ThrowStatement){modified=true;return common.moveLocation(node,{type:Syntax.ThrowStatement,argument:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:node.consequent.argument,alternate:node.alternate.argument})})}}else{if(node.consequent.type===Syntax.ExpressionStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:common.moveLocation(node,{type:Syntax.LogicalExpression,operator:"&&",left:node.test,right:node.consequent.expression})})}else if(node.consequent.type===Syntax.EmptyStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:node.test})}}}}});return{result:result,modified:modified}}transformBranchToExpression.passName=Name;module.exports=transformBranchToExpression})()},{"../common":69}],91:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-dynamic-to-static-property-access";common=require("../common");Syntax=common.Syntax;function transformDynamicToStaticPropertyAccess(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){var property;if(node.type===Syntax.MemberExpression&&node.computed){property=node.property;if(property.type===Syntax.Literal&&typeof property.value==="string"){if(common.isIdentifier(property.value)){modified=true;node.computed=false;node.property=common.moveLocation(property,{type:Syntax.Identifier,name:property.value})}else if(property.value===Number(property.value).toString()){modified=true;node.computed=true;node.property=common.moveLocation(node.property,common.SpecialNode.generateFromValue(Number(node.property.value)))}}}}});return{result:result,modified:modified}}transformDynamicToStaticPropertyAccess.passName=Name;module.exports=transformDynamicToStaticPropertyAccess})()},{"../common":69}],92:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-dynamic-to-static-property-definition";common=require("../common");Syntax=common.Syntax;function transformDynamicToStaticPropertyDefinition(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){var generated;if(node.type===Syntax.Property){if(node.key.type===Syntax.Literal&&typeof node.key.value==="string"){if(common.isIdentifier(node.key.value)){modified=true;node.key=common.moveLocation(node.key,{type:Syntax.Identifier,name:node.key.value})}else if(node.key.value===Number(node.key.value).toString()){generated=common.SpecialNode.generateFromValue(Number(node.key.value));if(generated.type===Syntax.Literal){modified=true;node.key=common.moveLocation(node.key,generated)}}}}}});return{result:result,modified:modified}}transformDynamicToStaticPropertyDefinition.passName=Name;module.exports=transformDynamicToStaticPropertyDefinition})()},{"../common":69}],93:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-immediate-function-call";common=require("../common");Syntax=common.Syntax;function isEmptyFunctionCall(call){var callee,i,iz,stmt;if(call.type!==Syntax.CallExpression){return false}callee=call.callee;if(callee.type!==Syntax.FunctionExpression){return false}if(callee.body.type!==Syntax.BlockStatement){return false}if(callee.body.body.length===0){return true}for(i=0,iz=callee.body.body.length;i<iz;++i){stmt=callee.body.body[i];if(stmt.type!==Syntax.FunctionDeclaration){return false}}return true}function callToSequence(call){var expressions;expressions=common.Array.from(call["arguments"]);if(expressions.length===0){return common.SpecialNode.generateUndefined(call)}expressions.push(common.SpecialNode.generateUndefined());return common.moveLocation(call,{type:Syntax.SequenceExpression,expressions:expressions})}function transformImmediateFunctionCall(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node){if(isEmptyFunctionCall(node)){modified=true;return callToSequence(node)}}});return{result:result,modified:modified}}transformImmediateFunctionCall.passName=Name;module.exports=transformImmediateFunctionCall})()},{"../common":69}],94:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-logical-association";common=require("../common");Syntax=common.Syntax;function transformLogicalAssociation(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){if(node.type===Syntax.LogicalExpression){if(node.right.type===Syntax.LogicalExpression&&node.operator===node.right.operator){modified=true;node.left={type:Syntax.LogicalExpression,operator:node.operator,left:node.left,right:node.right.left};node.right=node.right.right}}}});return{result:result,modified:modified}}transformLogicalAssociation.passName=Name;module.exports=transformLogicalAssociation})()},{"../common":69}],95:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="transform-to-compound-assignment";escope=require("escope");common=require("../common");Syntax=common.Syntax;function equals(lhs,rhs){if(lhs.type!==rhs.type){return false}if(lhs.type===Syntax.Identifier){return lhs.name===rhs.name}return false}function compound(operator){switch(operator){case"*":case"/":case"%":case"+":case"-":case"<<":case">>":case">>>":case"&":case"^":case"|":return operator+"="}return null}function observableCompound(operator){switch(operator){case"*=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":return operator}return null}function transformToCompoundAssignment(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var left,right,operator,ref;scope=manager.acquire(node)||scope;if(node.type===Syntax.AssignmentExpression&&node.operator==="="){left=node.left;right=node.right;if(right.type===Syntax.BinaryExpression&&equals(right.left,left)){operator=compound(right.operator);if(operator){modified=true;node.operator=operator;node.right=right.right}}else if(right.type===Syntax.AssignmentExpression&&equals(right.left,left)){if(observableCompound(right.operator)){ref=scope.resolve(node.left);if(ref.isStatic()){modified=true;node.operator=right.operator;node.right=right.right}}}}},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}transformToCompoundAssignment.passName=Name;module.exports=transformToCompoundAssignment})()},{"../common":69,escope:65}],96:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-to-sequence-expression";common=require("../common");Syntax=common.Syntax;function transform(node){var i,iz,expressions,stmt,prev,body;function constructSeq(expressions,stmt){var seq;if(expressions.length!==1){modified=true;seq={type:Syntax.SequenceExpression,expressions:expressions};if(stmt.type===Syntax.ExpressionStatement){stmt.expression=seq}else{stmt.argument=seq}}return stmt}body=[];expressions=[];for(i=0,iz=node.body.length;i<iz;++i){prev=stmt;stmt=node.body[i];if(stmt.type===Syntax.ExpressionStatement){expressions.push(stmt.expression)}else if(stmt.type===Syntax.ReturnStatement&&stmt.argument!=null||stmt.type===Syntax.ThrowStatement){expressions.push(stmt.argument);body.push(constructSeq(expressions,stmt));expressions=[]}else if(stmt.type===Syntax.ForStatement&&(!stmt.init||stmt.init.type!==Syntax.VariableDeclaration)){if(expressions.length){modified=true;if(stmt.init){expressions.push(stmt.init)}if(expressions.length===1){stmt.init=expressions[0]}else{stmt.init={type:Syntax.SequenceExpression,expressions:expressions}}expressions=[]}body.push(stmt)}else if(stmt.type===Syntax.IfStatement){if(expressions.length){modified=true;expressions.push(stmt.test);stmt.test={type:Syntax.SequenceExpression,expressions:expressions};expressions=[]}body.push(stmt)}else{if(expressions.length){body.push(constructSeq(expressions,prev));expressions=[]}body.push(stmt)}}if(expressions.length){body.push(constructSeq(expressions,stmt))}node.body=body}function transformToSequenceExpression(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){switch(node.type){case Syntax.BlockStatement:case Syntax.Program:transform(node);break}}});return{result:result,modified:modified}}transformToSequenceExpression.passName=Name;module.exports=transformToSequenceExpression})()},{"../common":69}],97:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="transform-typeof-undefined";escope=require("escope");common=require("../common");Syntax=common.Syntax;function isUndefinedStringLiteral(node){return node.type===Syntax.Literal&&node.value==="undefined"}function transformTypeofUndefined(tree,options){var result,manager,scope;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var target,undef,argument,ref;scope=manager.acquire(node)||scope;if(node.type===Syntax.BinaryExpression&&(node.operator==="==="||node.operator==="!=="||node.operator==="=="||node.operator==="!=")){if(isUndefinedStringLiteral(node.left)){undef="left";target="right"}else if(isUndefinedStringLiteral(node.right)){undef="right";target="left"}else{return}if(node[target].type===Syntax.UnaryExpression&&node[target].operator==="typeof"){argument=node[target].argument;if(argument.type===Syntax.Identifier){ref=scope.resolve(argument);if(!ref||!ref.isStatic()||!ref.resolved){return}}modified=true;node[undef]=common.SpecialNode.generateUndefined();node[target]=argument;node.operator=node.operator.charAt(0)==="!"?"!==":"==="}}},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}transformTypeofUndefined.passName=Name;module.exports=transformTypeofUndefined})()},{"../common":69,escope:65}],98:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,modified;Name="tree-based-constant-folding";common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function isModifiedConstant(node){if(common.SpecialNode.isUndefined(node)){return false}if(common.SpecialNode.isNegative(node)){return false}if(common.SpecialNode.isNaN(node)){return false}return evaluator.constant.isConstant(node,false)}function isFoldableConditional(node){if(node.type!==Syntax.ConditionalExpression){return false}return evaluator.constant.isConstant(node.consequent)||evaluator.constant.isConstant(node.alternate)}function foldConditional(node){var binary,unary,operator,left,right;switch(node.type){case Syntax.BinaryExpression:if(node.operator==="in"||node.operator==="instanceof"){return node}if(evaluator.constant.isConstant(node.left)&&isFoldableConditional(node.right)){modified=true;binary=node;operator=binary.operator;left=evaluator.constant.evaluate(binary.left);node=node.right;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,left,evaluator.constant.evaluate(node.consequent)))}else{binary.right=node.consequent;node.consequent=binary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,left,evaluator.constant.evaluate(node.alternate)))}else{binary.right=node.alternate;node.alternate=binary}}else if(evaluator.constant.isConstant(node.right)&&isFoldableConditional(node.left)){modified=true;binary=node;operator=binary.operator;right=evaluator.constant.evaluate(binary.right);node=node.left;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,evaluator.constant.evaluate(node.consequent),right))}else{binary.left=node.consequent;node.consequent=binary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,evaluator.constant.evaluate(node.alternate),right))}else{binary.left=node.alternate;node.alternate=binary}}break;case Syntax.LogicalExpression:break;case Syntax.UnaryExpression:if(isFoldableConditional(node.argument)){modified=true;unary=node;operator=unary.operator;node=unary.argument;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doUnary(operator,evaluator.constant.evaluate(node.consequent)))}else{unary.argument=node.consequent;node.consequent=unary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doUnary(operator,evaluator.constant.evaluate(node.alternate)))}else{unary.argument=node.alternate;node.alternate=unary}}break}return node}function treeBasedConstantFolding(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node){var con,alt;switch(node.type){case Syntax.BinaryExpression:case Syntax.LogicalExpression:case Syntax.UnaryExpression:if(isModifiedConstant(node)){modified=true;return common.moveLocation(node,common.SpecialNode.generateFromValue(evaluator.constant.evaluate(node)))}return foldConditional(node);case Syntax.ConditionalExpression:if(evaluator.constant.isConstant(node.consequent)&&evaluator.constant.isConstant(node.alternate)){con=evaluator.constant.evaluate(node.consequent);alt=evaluator.constant.evaluate(node.alternate);if(common.sameValue(con,alt)){modified=true;return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateFromValue(con)]})}}break}}});return{result:result,modified:modified}}treeBasedConstantFolding.passName=Name;module.exports=treeBasedConstantFolding})()},{"../common":69,"../evaluator":71}],99:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="omit-parens-in-void-context-iife";common=require("../common");Syntax=common.Syntax;function isIIFE(node){var callee;if(node.type!==Syntax.CallExpression){return false}callee=node.callee;return callee.type===Syntax.FunctionExpression}function main(tree,options){var result,stackCount,preserveCompletionValue;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;result=common.replace(result,{enter:function enter(node,parent){var ancestors,target;if(!isIIFE(node)){return}target=parent;if(target.type===Syntax.ExpressionStatement){ancestors=this.parents();ancestors.pop();if(preserveCompletionValue&&common.mayBeCompletionValue(target,ancestors)){return}}else if(target.type===Syntax.SequenceExpression&&target.expressions.length>=2&&target.expressions[0]===node){ancestors=this.parents();ancestors.pop();target=ancestors.pop();if(target.type!==Syntax.ExpressionStatement){return}}else{return}modified=true;return{type:Syntax.UnaryExpression,
operator:"!",argument:node}},leave:function leave(node){if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){--stackCount}}});return{result:result,modified:modified}}main.passName=Name;module.exports=main})()},{"../common":69}],100:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="rewrite-boolean";common=require("../common");Syntax=common.Syntax;function isBooleanLiteral(node){return node.type===Syntax.Literal&&typeof node.value==="boolean"}function rewrite(node){if(isBooleanLiteral(node)){modified=true;return common.moveLocation(node,{type:Syntax.UnaryExpression,operator:"!",argument:common.moveLocation(node,{type:Syntax.Literal,value:+!node.value})})}if(node.type===Syntax.BinaryExpression&&node.operator==="=="||node.operator==="!="){if(isBooleanLiteral(node.left)){modified=true;node.left=common.moveLocation(node.left,{type:Syntax.Literal,value:+node.left.value});return node}if(isBooleanLiteral(node.right)){modified=true;node.right=common.moveLocation(node.right,{type:Syntax.Literal,value:+node.right.value});return node}}return node}function rewriteBoolean(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);result=common.replace(result,{enter:rewrite});return{result:result,modified:modified}}rewriteBoolean.passName=Name;module.exports=rewriteBoolean})()},{"../common":69}],101:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="rewrite-conditional-expression";common=require("../common");Syntax=common.Syntax;function rewrite(node){var test,consequent,alternate;test=node.test;consequent=node.consequent;alternate=node.alternate;if(test.type===Syntax.UnaryExpression&&test.operator==="!"){modified=true;node.consequent=alternate;node.alternate=consequent;node.test=test.argument}}function rewriteConditionalExpression(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){if(node.type===Syntax.ConditionalExpression){rewrite(node)}}});return{result:result,modified:modified}}rewriteConditionalExpression.passName=Name;module.exports=rewriteConditionalExpression})()},{"../common":69}],102:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="transform-infinity";common=require("../common");Syntax=common.Syntax;function transformInfinity(tree,options){var result,modified;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{enter:function enter(node){if(node.type===Syntax.Literal&&typeof node.value==="number"){if(node.value===Infinity){modified=true;return common.moveLocation(node,{type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:1},right:{type:Syntax.Literal,value:0}})}}}});return{result:result,modified:modified}}transformInfinity.passName=Name;module.exports=transformInfinity})()},{"../common":69}],103:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="transform-static-to-dynamic-property-access";common=require("../common");Syntax=common.Syntax;function transformStaticToDynamicPropertyAccess(tree,options){var result,modified;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){var property;if(node.type!==Syntax.MemberExpression||node.computed||node.property.type!==Syntax.Identifier){return}property=node.property;switch(property.name){case"undefined":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.UnaryExpression,operator:"void",argument:{type:Syntax.Literal,value:0}});break;case"true":case"false":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.Literal,value:property.name==="true"});break;case"Infinity":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:1},right:{type:Syntax.Literal,value:0}});break}}});return{result:result,modified:modified}}transformStaticToDynamicPropertyAccess.passName=Name;module.exports=transformStaticToDynamicPropertyAccess})()},{"../common":69}],104:[function(require,module,exports){(function(){"use strict";var common;common=require("./common");exports.get=function get(root,query){var i,iz,name,node;node=root;for(i=0,iz=query.length;i<iz;++i){name=query[i];node=node[name]}return node};exports.set=function set(root,query,value){var i,iz,name,node;common.assert(query.length>0);node=root;for(i=0,iz=query.length-1;i<iz;++i){name=query[i];node=node[name]}name=query[i];node[name]=value}})()},{"./common":69}],105:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.estraverse={})}})(this,function(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,BREAK,SKIP;Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);VisitorKeys={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],Identifier:[],IfStatement:["test","consequent","alternate"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};VisitorOption={Break:BREAK,Skip:SKIP};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null};Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=VisitorKeys[nodeType];current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(!isArray(candidate)){worklist.push(new Element(candidate,key,null,null));continue}current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if((nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===candidates[current]){element=new Element(candidate[current2],[key,current2],"Property",null)}else{element=new Element(candidate[current2],[key,current2],null,null)}worklist.push(element)}}}}};Controller.prototype.replace=function replace(root,visitor){var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP){element.ref.replace(target)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP){element.ref.replace(target);element.node=target}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=VisitorKeys[nodeType];current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(!isArray(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)));continue}current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(nodeType===Syntax.ObjectExpression&&"properties"===candidates[current]){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else{element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}worklist.push(element)}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version="1.5.1-dev";exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller})},{}],106:[function(require,module,exports){(function(){"use strict";var Regex;Regex={NonAsciiIdentifierStart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),NonAsciiIdentifierPart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0\u08a2-\u08ac\u08e4-\u08fe\u0900-\u0963\u0966-\u096f\u0971-\u0977\u0979-\u097f\u0981-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d02\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191c\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1d00-\u1de6\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua697\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a\uaa7b\uaa80-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]")};function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return isDecimalDigit(ch)||97<=ch&&ch<=102||65<=ch&&ch<=70}function isOctalDigit(ch){return ch>=48&&ch<=55}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}module.exports={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStart:isIdentifierStart,isIdentifierPart:isIdentifierPart}})()},{}],107:[function(require,module,exports){(function(){"use strict";var code=require("./code");function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false}}function isKeywordES5(id,strict){if(!strict&&id==="yield"){return false}return isKeywordES6(id,strict)}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isIdentifierName(id){var i,iz,ch;if(id.length===0){return false}ch=id.charCodeAt(0);if(!code.isIdentifierStart(ch)||ch===92){return false}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPart(ch)||ch===92){return false}}return true}module.exports={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isRestrictedWord:isRestrictedWord,isIdentifierName:isIdentifierName}})()},{"./code":106}],108:[function(require,module,exports){(function(){"use strict";exports.code=require("./code");exports.keyword=require("./keyword")})()},{"./code":106,"./keyword":107}],109:[function(require,module,exports){module.exports={_args:[[{raw:"esmangle@^1.0.1",scope:null,escapedName:"esmangle",name:"esmangle",rawSpec:"^1.0.1",spec:">=1.0.1 <2.0.0",type:"range"},"/agents/node_modules/webppl"]],_from:"esmangle@>=1.0.1 <2.0.0",_id:"esmangle@1.0.1",_inCache:true,_location:"/esmangle",_npmUser:{name:"constellation",email:"utatane.tea@gmail.com"},_npmVersion:"1.3.11",_phantomChildren:{amdefine:"1.0.1","deep-is":"0.1.3","prelude-ls":"1.1.2","type-check":"0.3.2"},_requested:{raw:"esmangle@^1.0.1",scope:null,escapedName:"esmangle",name:"esmangle",rawSpec:"^1.0.1",spec:">=1.0.1 <2.0.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/esmangle/-/esmangle-1.0.1.tgz",_shasum:"d9bb37b8f8eafbf4e6d4ed6b7aa2956abbd3c4c2",_shrinkwrap:null,_spec:"esmangle@^1.0.1",_where:"/agents/node_modules/webppl",bin:{esmangle:"./bin/esmangle.js"},bugs:{url:"https://github.com/Constellation/esmangle/issues"},dependencies:{escodegen:"~1.3.2",escope:"~1.0.1",esprima:"~1.1.1",esshorten:"~1.1.0",estraverse:"~1.5.0",esutils:"~ 1.0.0",optionator:"~0.3.0","source-map":"~0.1.33"},description:"ECMAScript code mangler / minifier",devDependencies:{async:"~0.2.9",chai:"*",clone:"~0.1.11","commonjs-everywhere":"~0.9.4",grunt:"~0.4.2","grunt-cli":"~0.1.11","grunt-contrib-clean":"~0.5.0","grunt-contrib-copy":"~0.5.0","grunt-contrib-jshint":"~0.8.0","grunt-mocha-test":"~0.8.1","grunt-shell":"~0.6.1","grunt-update-submodules":"~0.2.1",q:"~0.9.7"},directories:{lib:"./lib"},dist:{shasum:"d9bb37b8f8eafbf4e6d4ed6b7aa2956abbd3c4c2",tarball:"https://registry.npmjs.org/esmangle/-/esmangle-1.0.1.tgz"},engines:{node:">=0.6.0"},homepage:"http://github.com/Constellation/esmangle.html",licenses:[{type:"BSD",url:"http://github.com/Constellation/esmangle/raw/master/LICENSE.BSD"}],main:"lib/esmangle.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"}],name:"esmangle",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/Constellation/esmangle.git"},scripts:{build:"grunt build",lint:"grunt lint","regression-test":"grunt test:regression",test:"grunt travis","unit-test":"grunt test"},version:"1.0.1"}},{}],110:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PlaceHolders,Messages,Regex,source,strict,index,lineNumber,lineStart,hasLineTerminator,lastIndex,lastLineNumber,lastLineStart,startIndex,startLineNumber,startLineStart,scanning,length,lookahead,state,extra,isBindingElement,isAssignmentTarget,firstCoverInitializedNameError;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.RegularExpression]="RegularExpression";TokenName[Token.Template]="Template";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];

Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};PlaceHolders={ArrowParameterPlaceHolder:"ArrowParameterPlaceHolder"};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",DefaultRestParameter:"Unexpected token =",ObjectPatternAsRestParameter:"Unexpected token {",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ConstructorSpecialMethod:"Class constructor may not be an accessor",DuplicateConstructor:"A class may only have one constructor",StaticPrototype:"Classes may not have static property named prototype",MissingFromClause:"Unexpected token",NoAsAfterImportNamespace:"Unexpected token",InvalidModuleSpecifier:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalExportDeclaration:"Unexpected token",DuplicateBinding:"Duplicate binding %0"};Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function octalToDecimal(ch){var octal=ch!=="0",code="01234567".indexOf(ch);if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}return{code:code,octal:octal}}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function fromCodePoint(cp){return cp<65536?String.fromCharCode(cp):String.fromCharCode(55296+(cp-65536>>10))+String.fromCharCode(56320+(cp-65536&1023))}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}function isFutureReservedWord(id){switch(id){case"enum":case"export":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function addComment(type,value,start,end,loc){var comment;assert(typeof start==="number","Comment must have valid position");state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}if(extra.tokenize){comment.type=comment.type+"Comment";if(extra.delegate){comment=extra.delegate(comment)}extra.tokens.push(comment)}}function skipSingleLineComment(offset){var start,loc,ch,comment;start=index-offset;loc={start:{line:lineNumber,column:index-lineStart-offset}};while(index<length){ch=source.charCodeAt(index);++index;if(isLineTerminator(ch)){hasLineTerminator=true;if(extra.comments){comment=source.slice(start+offset,index-1);loc.end={line:lineNumber,column:index-lineStart-1};addComment("Line",comment,start,index-1,loc)}if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;return}}if(extra.comments){comment=source.slice(start+offset,index);loc.end={line:lineNumber,column:index-lineStart};addComment("Line",comment,start,index,loc)}}function skipMultiLineComment(){var start,loc,ch,comment;if(extra.comments){start=index-2;loc={start:{line:lineNumber,column:index-lineStart-2}}}while(index<length){ch=source.charCodeAt(index);if(isLineTerminator(ch)){if(ch===13&&source.charCodeAt(index+1)===10){++index}hasLineTerminator=true;++lineNumber;++index;lineStart=index}else if(ch===42){if(source.charCodeAt(index+1)===47){++index;++index;if(extra.comments){comment=source.slice(start+2,index-2);loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc)}return}++index}else{++index}}if(extra.comments){loc.end={line:lineNumber,column:index-lineStart};comment=source.slice(start+2,index);addComment("Block",comment,start,index,loc)}tolerateUnexpectedToken()}function skipComment(){var ch,start;hasLineTerminator=false;start=index===0;while(index<length){ch=source.charCodeAt(index);if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){hasLineTerminator=true;++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;start=true}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){++index;++index;skipSingleLineComment(2);start=true}else if(ch===42){++index;++index;skipMultiLineComment()}else{break}}else if(start&&ch===45){if(source.charCodeAt(index+1)===45&&source.charCodeAt(index+2)===62){index+=3;skipSingleLineComment(3)}else{break}}else if(ch===60){if(source.slice(index+1,index+4)==="!--"){++index;++index;++index;++index;skipSingleLineComment(4)}else{break}}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code;ch=source[index];code=0;if(ch==="}"){throwUnexpectedToken()}while(index<length){ch=source[index++];if(!isHexDigit(ch)){break}code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}if(code>1114111||ch!=="}"){throwUnexpectedToken()}return fromCodePoint(code)}function codePointAt(i){var cp,first,second;cp=source.charCodeAt(i);if(cp>=55296&&cp<=56319){second=source.charCodeAt(i+1);if(second>=56320&&second<=57343){first=cp;cp=(first-55296)*1024+second-56320+65536}}return cp}function getComplexIdentifier(){var cp,ch,id;cp=codePointAt(index);id=fromCodePoint(cp);index+=id.length;if(cp===92){if(source.charCodeAt(index)!==117){throwUnexpectedToken()}++index;if(source[index]==="{"){++index;ch=scanUnicodeCodePointEscape()}else{ch=scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!isIdentifierStart(cp)){throwUnexpectedToken()}}id=ch}while(index<length){cp=codePointAt(index);if(!isIdentifierPart(cp)){break}ch=fromCodePoint(cp);id+=ch;index+=ch.length;if(cp===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwUnexpectedToken()}++index;if(source[index]==="{"){++index;ch=scanUnicodeCodePointEscape()}else{ch=scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!isIdentifierPart(cp)){throwUnexpectedToken()}}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getComplexIdentifier()}else if(ch>=55296&&ch<57343){index=start;return getComplexIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getComplexIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var token,str;token={type:Token.Punctuator,value:"",lineNumber:lineNumber,lineStart:lineStart,start:index,end:index};str=source[index];switch(str){case"(":if(extra.tokenize){extra.openParenToken=extra.tokenValues.length}++index;break;case"{":if(extra.tokenize){extra.openCurlyToken=extra.tokenValues.length}state.curlyStack.push("{");++index;break;case".":++index;if(source[index]==="."&&source[index+1]==="."){index+=2;str="..."}break;case"}":++index;state.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++index;break;default:str=source.substr(index,4);if(str===">>>="){index+=4}else{str=str.substr(0,3);if(str==="==="||str==="!=="||str===">>>"||str==="<<="||str===">>="){index+=3}else{str=str.substr(0,2);if(str==="&&"||str==="||"||str==="=="||str==="!="||str==="+="||str==="-="||str==="*="||str==="/="||str==="++"||str==="--"||str==="<<"||str===">>"||str==="&="||str==="|="||str==="^="||str==="%="||str==="<="||str===">="||str==="=>"){index+=2}else{str=source[index];if("<>=!+-*%&|^/".indexOf(str)>=0){++index}}}}}if(index===token.start){throwUnexpectedToken()}token.end=index;token.value=str;return token}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwUnexpectedToken()}if(isIdentifierStart(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanBinaryLiteral(start){var ch,number;number="";while(index<length){ch=source[index];if(ch!=="0"&&ch!=="1"){break}number+=source[index++]}if(number.length===0){throwUnexpectedToken()}if(index<length){ch=source.charCodeAt(index);if(isIdentifierStart(ch)||isDecimalDigit(ch)){throwUnexpectedToken()}}return{type:Token.NumericLiteral,value:parseInt(number,2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(prefix,start){var number,octal;if(isOctalDigit(prefix)){octal=true;number="0"+source[index++]}else{octal=false;++index;number=""}while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(!octal&&number.length===0){throwUnexpectedToken()}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function isImplicitOctalLiteral(){var i,ch;for(i=index+1;i<length;++i){ch=source[i];if(ch==="8"||ch==="9"){return false}if(!isOctalDigit(ch)){return true}}return true}function scanNumericLiteral(){var number,start,ch;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(ch==="b"||ch==="B"){++index;return scanBinaryLiteral(start)}if(ch==="o"||ch==="O"){return scanOctalLiteral(ch,start)}if(isOctalDigit(ch)){if(isImplicitOctalLiteral()){return scanOctalLiteral(ch,start)}}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwUnexpectedToken()}}if(isIdentifierStart(source.charCodeAt(index))){throwUnexpectedToken()}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var str="",quote,start,ch,unescaped,octToDec,octal=false;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":if(source[index]==="{"){++index;str+=scanUnicodeCodePointEscape()}else{unescaped=scanHexEscape(ch);if(!unescaped){throw throwUnexpectedToken()}str+=unescaped}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;case"8":case"9":str+=ch;tolerateUnexpectedToken();break;default:if(isOctalDigit(ch)){octToDec=octalToDecimal(ch);octal=octToDec.octal||octal;str+=String.fromCharCode(octToDec.code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){index=start;throwUnexpectedToken()}return{type:Token.StringLiteral,value:str,octal:octal,lineNumber:startLineNumber,lineStart:startLineStart,start:start,end:index}}function scanTemplate(){var cooked="",ch,start,rawOffset,terminated,head,tail,restore,unescaped;terminated=false;tail=false;start=index;head=source[index]==="`";rawOffset=2;++index;while(index<length){ch=source[index++];if(ch==="`"){rawOffset=1;tail=true;terminated=true;break}else if(ch==="$"){if(source[index]==="{"){state.curlyStack.push("${");++index;terminated=true;break}cooked+=ch;

}else if(ch==="\\"){ch=source[index++];if(!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="	";break;case"u":case"x":if(source[index]==="{"){++index;cooked+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){cooked+=unescaped}else{index=restore;cooked+=ch}}break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="";break;default:if(ch==="0"){if(isDecimalDigit(source.charCodeAt(index))){throwError(Messages.TemplateOctalLiteral)}cooked+="\x00"}else if(isOctalDigit(ch)){throwError(Messages.TemplateOctalLiteral)}else{cooked+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index;cooked+="\n"}else{cooked+=ch}}if(!terminated){throwUnexpectedToken()}if(!head){state.curlyStack.pop()}return{type:Token.Template,value:{cooked:cooked,raw:source.slice(start+1,index-rawOffset)},head:head,tail:tail,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var astralSubstitute="\uffff",tmp=pattern;if(flags.indexOf("u")>=0){tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function($0,$1,$2){var codePoint=parseInt($1||$2,16);if(codePoint>1114111){throwUnexpectedToken(null,Messages.InvalidRegExp)}if(codePoint<=65535){return String.fromCharCode(codePoint)}return astralSubstitute}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,astralSubstitute)}try{RegExp(tmp)}catch(e){throwUnexpectedToken(null,Messages.InvalidRegExp)}try{return new RegExp(pattern,flags)}catch(exception){return null}}function scanRegExpBody(){var ch,str,classMarker,terminated,body;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];classMarker=false;terminated=false;while(index<length){ch=source[index++];str+=ch;if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}str+=ch}else if(isLineTerminator(ch.charCodeAt(0))){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){throwUnexpectedToken(null,Messages.UnterminatedRegExp)}body=str.substr(1,str.length-2);return{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;str="";flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}tolerateUnexpectedToken()}else{str+="\\";tolerateUnexpectedToken()}}else{flags+=ch;str+=ch}}return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,value;scanning=true;lookahead=null;skipComment();start=index;body=scanRegExpBody();flags=scanRegExpFlags();value=testRegExp(body.value,flags.value);scanning=false;if(extra.tokenize){return{type:Token.RegularExpression,value:value,regex:{pattern:body.value,flags:flags.value},lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}return{literal:body.literal+flags.literal,value:value,regex:{pattern:body.value,flags:flags.value},start:start,end:index}}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,regex:regex.regex,range:[pos,index],loc:loc})}return regex}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var regex,previous,check;function testKeyword(value){return value&&value.length>1&&value[0]>="a"&&value[0]<="z"}previous=extra.tokenValues[extra.tokenValues.length-1];regex=previous!==null;switch(previous){case"this":case"]":regex=false;break;case")":check=extra.tokenValues[extra.openParenToken-1];regex=check==="if"||check==="while"||check==="for"||check==="with";break;case"}":regex=false;if(testKeyword(extra.tokenValues[extra.openCurlyToken-3])){check=extra.tokenValues[extra.openCurlyToken-4];regex=check?FnExprTokens.indexOf(check)<0:false}else if(testKeyword(extra.tokenValues[extra.openCurlyToken-4])){check=extra.tokenValues[extra.openCurlyToken-5];regex=check?FnExprTokens.indexOf(check)<0:true}}return regex?collectRegex():scanPunctuator()}function advance(){var cp,token;if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}}cp=source.charCodeAt(index);if(isIdentifierStart(cp)){token=scanIdentifier();if(strict&&isStrictModeReservedWord(token.value)){token.type=Token.Keyword}return token}if(cp===40||cp===41||cp===59){return scanPunctuator()}if(cp===39||cp===34){return scanStringLiteral()}if(cp===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(cp)){return scanNumericLiteral()}if(extra.tokenize&&cp===47){return advanceSlash()}if(cp===96||cp===125&&state.curlyStack[state.curlyStack.length-1]==="${"){return scanTemplate()}if(cp>=55296&&cp<57343){cp=codePointAt(index);if(isIdentifierStart(cp)){return scanIdentifier()}}return scanPunctuator()}function collectToken(){var loc,token,value,entry;loc={start:{line:lineNumber,column:index-lineStart}};token=advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){value=source.slice(token.start,token.end);entry={type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc};if(token.regex){entry.regex={pattern:token.regex.pattern,flags:token.regex.flags}}if(extra.tokenValues){extra.tokenValues.push(entry.type==="Punctuator"||entry.type==="Keyword"?entry.value:null)}if(extra.tokenize){if(!extra.range){delete entry.range}if(!extra.loc){delete entry.loc}if(extra.delegate){entry=extra.delegate(entry)}}extra.tokens.push(entry)}return token}function lex(){var token;scanning=true;lastIndex=index;lastLineNumber=lineNumber;lastLineStart=lineStart;skipComment();token=lookahead;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();scanning=false;return token}function peek(){scanning=true;skipComment();lastIndex=index;lastLineNumber=lineNumber;lastLineStart=lineStart;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();scanning=false}function Position(){this.line=startLineNumber;this.column=startIndex-startLineStart}function SourceLocation(){this.start=new Position;this.end=null}function WrappingSourceLocation(startToken){this.start={line:startToken.lineNumber,column:startToken.start-startToken.lineStart};this.end=null}function Node(){if(extra.range){this.range=[startIndex,0]}if(extra.loc){this.loc=new SourceLocation}}function WrappingNode(startToken){if(extra.range){this.range=[startToken.start,0]}if(extra.loc){this.loc=new WrappingSourceLocation(startToken)}}WrappingNode.prototype=Node.prototype={processComment:function(){var lastChild,innerComments,leadingComments,trailingComments,bottomRight=extra.bottomRightStack,i,comment,last=bottomRight[bottomRight.length-1];if(this.type===Syntax.Program){if(this.body.length>0){return}}if(this.type===Syntax.BlockStatement&&this.body.length===0){innerComments=[];for(i=extra.leadingComments.length-1;i>=0;--i){comment=extra.leadingComments[i];if(this.range[1]>=comment.range[1]){innerComments.unshift(comment);extra.leadingComments.splice(i,1);extra.trailingComments.splice(i,1)}}if(innerComments.length){this.innerComments=innerComments;return}}if(extra.trailingComments.length>0){trailingComments=[];for(i=extra.trailingComments.length-1;i>=0;--i){comment=extra.trailingComments[i];if(comment.range[0]>=this.range[1]){trailingComments.unshift(comment);extra.trailingComments.splice(i,1)}}extra.trailingComments=[]}else{if(last&&last.trailingComments&&last.trailingComments[0].range[0]>=this.range[1]){trailingComments=last.trailingComments;delete last.trailingComments}}while(last&&last.range[0]>=this.range[0]){lastChild=bottomRight.pop();last=bottomRight[bottomRight.length-1]}if(lastChild){if(lastChild.leadingComments){leadingComments=[];for(i=lastChild.leadingComments.length-1;i>=0;--i){comment=lastChild.leadingComments[i];if(comment.range[1]<=this.range[0]){leadingComments.unshift(comment);lastChild.leadingComments.splice(i,1)}}if(!lastChild.leadingComments.length){lastChild.leadingComments=undefined}}}else if(extra.leadingComments.length>0){leadingComments=[];for(i=extra.leadingComments.length-1;i>=0;--i){comment=extra.leadingComments[i];if(comment.range[1]<=this.range[0]){leadingComments.unshift(comment);extra.leadingComments.splice(i,1)}}}if(leadingComments&&leadingComments.length>0){this.leadingComments=leadingComments}if(trailingComments&&trailingComments.length>0){this.trailingComments=trailingComments}bottomRight.push(this)},finish:function(){if(extra.range){this.range[1]=lastIndex}if(extra.loc){this.loc.end={line:lastLineNumber,column:lastIndex-lastLineStart};if(extra.source){this.loc.source=extra.source}}if(extra.attachComment){this.processComment()}},finishArrayExpression:function(elements){this.type=Syntax.ArrayExpression;this.elements=elements;this.finish();return this},finishArrayPattern:function(elements){this.type=Syntax.ArrayPattern;this.elements=elements;this.finish();return this},finishArrowFunctionExpression:function(params,defaults,body,expression){this.type=Syntax.ArrowFunctionExpression;this.id=null;this.params=params;this.defaults=defaults;this.body=body;this.generator=false;this.expression=expression;this.finish();return this},finishAssignmentExpression:function(operator,left,right){this.type=Syntax.AssignmentExpression;this.operator=operator;this.left=left;this.right=right;this.finish();return this},finishAssignmentPattern:function(left,right){this.type=Syntax.AssignmentPattern;this.left=left;this.right=right;this.finish();return this},finishBinaryExpression:function(operator,left,right){this.type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;this.operator=operator;this.left=left;this.right=right;this.finish();return this},finishBlockStatement:function(body){this.type=Syntax.BlockStatement;this.body=body;this.finish();return this},finishBreakStatement:function(label){this.type=Syntax.BreakStatement;this.label=label;this.finish();return this},finishCallExpression:function(callee,args){this.type=Syntax.CallExpression;this.callee=callee;this.arguments=args;this.finish();return this},finishCatchClause:function(param,body){this.type=Syntax.CatchClause;this.param=param;this.body=body;this.finish();return this},finishClassBody:function(body){this.type=Syntax.ClassBody;this.body=body;this.finish();return this},finishClassDeclaration:function(id,superClass,body){this.type=Syntax.ClassDeclaration;this.id=id;this.superClass=superClass;this.body=body;this.finish();return this},finishClassExpression:function(id,superClass,body){this.type=Syntax.ClassExpression;this.id=id;this.superClass=superClass;this.body=body;this.finish();return this},finishConditionalExpression:function(test,consequent,alternate){this.type=Syntax.ConditionalExpression;this.test=test;this.consequent=consequent;this.alternate=alternate;this.finish();return this},finishContinueStatement:function(label){this.type=Syntax.ContinueStatement;this.label=label;this.finish();return this},finishDebuggerStatement:function(){this.type=Syntax.DebuggerStatement;this.finish();return this},finishDoWhileStatement:function(body,test){this.type=Syntax.DoWhileStatement;this.body=body;this.test=test;this.finish();return this},finishEmptyStatement:function(){this.type=Syntax.EmptyStatement;this.finish();return this},finishExpressionStatement:function(expression){this.type=Syntax.ExpressionStatement;this.expression=expression;this.finish();return this},finishForStatement:function(init,test,update,body){this.type=Syntax.ForStatement;this.init=init;this.test=test;this.update=update;this.body=body;this.finish();return this},finishForOfStatement:function(left,right,body){this.type=Syntax.ForOfStatement;this.left=left;this.right=right;this.body=body;this.finish();return this},finishForInStatement:function(left,right,body){this.type=Syntax.ForInStatement;this.left=left;this.right=right;this.body=body;this.each=false;this.finish();return this},finishFunctionDeclaration:function(id,params,defaults,body,generator){this.type=Syntax.FunctionDeclaration;this.id=id;this.params=params;this.defaults=defaults;this.body=body;this.generator=generator;this.expression=false;this.finish();return this},finishFunctionExpression:function(id,params,defaults,body,generator){this.type=Syntax.FunctionExpression;this.id=id;this.params=params;this.defaults=defaults;this.body=body;this.generator=generator;this.expression=false;this.finish();return this},finishIdentifier:function(name){this.type=Syntax.Identifier;this.name=name;this.finish();return this},finishIfStatement:function(test,consequent,alternate){this.type=Syntax.IfStatement;this.test=test;this.consequent=consequent;this.alternate=alternate;this.finish();return this},finishLabeledStatement:function(label,body){this.type=Syntax.LabeledStatement;this.label=label;this.body=body;this.finish();return this},finishLiteral:function(token){this.type=Syntax.Literal;this.value=token.value;this.raw=source.slice(token.start,token.end);if(token.regex){this.regex=token.regex}this.finish();return this},finishMemberExpression:function(accessor,object,property){this.type=Syntax.MemberExpression;this.computed=accessor==="[";this.object=object;this.property=property;this.finish();return this},finishMetaProperty:function(meta,property){this.type=Syntax.MetaProperty;this.meta=meta;this.property=property;this.finish();return this},finishNewExpression:function(callee,args){this.type=Syntax.NewExpression;this.callee=callee;this.arguments=args;this.finish();return this},finishObjectExpression:function(properties){this.type=Syntax.ObjectExpression;this.properties=properties;this.finish();return this},finishObjectPattern:function(properties){this.type=Syntax.ObjectPattern;this.properties=properties;this.finish();return this},finishPostfixExpression:function(operator,argument){this.type=Syntax.UpdateExpression;this.operator=operator;this.argument=argument;this.prefix=false;this.finish();return this},finishProgram:function(body,sourceType){this.type=Syntax.Program;this.body=body;this.sourceType=sourceType;this.finish();return this},finishProperty:function(kind,key,computed,value,method,shorthand){this.type=Syntax.Property;this.key=key;this.computed=computed;this.value=value;this.kind=kind;this.method=method;this.shorthand=shorthand;this.finish();return this},finishRestElement:function(argument){this.type=Syntax.RestElement;this.argument=argument;this.finish();return this},finishReturnStatement:function(argument){this.type=Syntax.ReturnStatement;this.argument=argument;this.finish();return this},finishSequenceExpression:function(expressions){this.type=Syntax.SequenceExpression;this.expressions=expressions;this.finish();return this},finishSpreadElement:function(argument){this.type=Syntax.SpreadElement;this.argument=argument;this.finish();return this},finishSwitchCase:function(test,consequent){this.type=Syntax.SwitchCase;this.test=test;this.consequent=consequent;this.finish();return this},finishSuper:function(){this.type=Syntax.Super;this.finish();return this},finishSwitchStatement:function(discriminant,cases){this.type=Syntax.SwitchStatement;this.discriminant=discriminant;this.cases=cases;this.finish();return this},finishTaggedTemplateExpression:function(tag,quasi){this.type=Syntax.TaggedTemplateExpression;this.tag=tag;this.quasi=quasi;this.finish();return this},finishTemplateElement:function(value,tail){this.type=Syntax.TemplateElement;this.value=value;this.tail=tail;this.finish();return this},finishTemplateLiteral:function(quasis,expressions){this.type=Syntax.TemplateLiteral;this.quasis=quasis;this.expressions=expressions;this.finish();return this},finishThisExpression:function(){this.type=Syntax.ThisExpression;this.finish();return this},finishThrowStatement:function(argument){this.type=Syntax.ThrowStatement;this.argument=argument;this.finish();return this},finishTryStatement:function(block,handler,finalizer){this.type=Syntax.TryStatement;this.block=block;this.guardedHandlers=[];this.handlers=handler?[handler]:[];this.handler=handler;this.finalizer=finalizer;this.finish();return this},finishUnaryExpression:function(operator,argument){this.type=operator==="++"||operator==="--"?Syntax.UpdateExpression:Syntax.UnaryExpression;this.operator=operator;this.argument=argument;this.prefix=true;this.finish();return this},finishVariableDeclaration:function(declarations){this.type=Syntax.VariableDeclaration;this.declarations=declarations;this.kind="var";this.finish();return this},finishLexicalDeclaration:function(declarations,kind){this.type=Syntax.VariableDeclaration;this.declarations=declarations;this.kind=kind;this.finish();return this},finishVariableDeclarator:function(id,init){this.type=Syntax.VariableDeclarator;this.id=id;this.init=init;this.finish();return this},finishWhileStatement:function(test,body){this.type=Syntax.WhileStatement;this.test=test;this.body=body;this.finish();return this},finishWithStatement:function(object,body){this.type=Syntax.WithStatement;this.object=object;this.body=body;this.finish();return this},finishExportSpecifier:function(local,exported){this.type=Syntax.ExportSpecifier;this.exported=exported||local;this.local=local;this.finish();return this},finishImportDefaultSpecifier:function(local){this.type=Syntax.ImportDefaultSpecifier;this.local=local;this.finish();return this},finishImportNamespaceSpecifier:function(local){this.type=Syntax.ImportNamespaceSpecifier;this.local=local;this.finish();return this},finishExportNamedDeclaration:function(declaration,specifiers,src){this.type=Syntax.ExportNamedDeclaration;this.declaration=declaration;this.specifiers=specifiers;this.source=src;this.finish();return this},finishExportDefaultDeclaration:function(declaration){this.type=Syntax.ExportDefaultDeclaration;this.declaration=declaration;this.finish();return this},finishExportAllDeclaration:function(src){this.type=Syntax.ExportAllDeclaration;this.source=src;this.finish();return this},finishImportSpecifier:function(local,imported){this.type=Syntax.ImportSpecifier;this.local=local||imported;this.imported=imported;this.finish();return this},finishImportDeclaration:function(specifiers,src){this.type=Syntax.ImportDeclaration;this.specifiers=specifiers;this.source=src;this.finish();return this},finishYieldExpression:function(argument,delegate){this.type=Syntax.YieldExpression;this.argument=argument;this.delegate=delegate;this.finish();return this}};function recordError(error){var e,existing;for(e=0;e<extra.errors.length;e++){existing=extra.errors[e];if(existing.index===error.index&&existing.message===error.message){return}}extra.errors.push(error)}function constructError(msg,column){var error=new Error(msg);try{throw error}catch(base){if(Object.create&&Object.defineProperty){error=Object.create(base);Object.defineProperty(error,"column",{value:column})}}finally{return error}}function createError(line,pos,description){var msg,column,error;msg="Line "+line+": "+description;column=pos-(scanning?lineStart:lastLineStart)+1;error=constructError(msg,column);error.lineNumber=line;error.description=description;error.index=pos;return error}function throwError(messageFormat){var args,msg;args=Array.prototype.slice.call(arguments,1);msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert(idx<args.length,"Message reference must be in range");return args[idx]});throw createError(lastLineNumber,lastIndex,msg)}function tolerateError(messageFormat){var args,msg,error;args=Array.prototype.slice.call(arguments,1);msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert(idx<args.length,"Message reference must be in range");return args[idx]});error=createError(lineNumber,lastIndex,msg);if(extra.errors){recordError(error)}else{throw error}}function unexpectedTokenError(token,message){var value,msg=message||Messages.UnexpectedToken;if(token){if(!message){msg=token.type===Token.EOF?Messages.UnexpectedEOS:token.type===Token.Identifier?Messages.UnexpectedIdentifier:token.type===Token.NumericLiteral?Messages.UnexpectedNumber:token.type===Token.StringLiteral?Messages.UnexpectedString:token.type===Token.Template?Messages.UnexpectedTemplate:Messages.UnexpectedToken;if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){msg=Messages.UnexpectedReserved}else if(strict&&isStrictModeReservedWord(token.value)){msg=Messages.StrictReservedWord}}}value=token.type===Token.Template?token.value.raw:token.value}else{value="ILLEGAL"}msg=msg.replace("%0",value);return token&&typeof token.lineNumber==="number"?createError(token.lineNumber,token.start,msg):createError(scanning?lineNumber:lastLineNumber,scanning?index:lastIndex,msg)}function throwUnexpectedToken(token,message){throw unexpectedTokenError(token,message)}function tolerateUnexpectedToken(token,message){var error=unexpectedTokenError(token,message);if(extra.errors){recordError(error)}else{throw error}}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpectedToken(token)}}function expectCommaSeparator(){var token;if(extra.errors){token=lookahead;if(token.type===Token.Punctuator&&token.value===","){lex()}else if(token.type===Token.Punctuator&&token.value===";"){lex();tolerateUnexpectedToken(token)}else{tolerateUnexpectedToken(token,Messages.UnexpectedToken)}}else{expect(",")}}function expectKeyword(keyword){var token=lex();if(token.type!==Token.Keyword||token.value!==keyword){throwUnexpectedToken(token)}}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchContextualKeyword(keyword){return lookahead.type===Token.Identifier&&lookahead.value===keyword}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function consumeSemicolon(){if(source.charCodeAt(startIndex)===59||match(";")){lex();return}if(hasLineTerminator){return}lastIndex=startIndex;lastLineNumber=startLineNumber;lastLineStart=startLineStart;if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpectedToken(lookahead)}}function isolateCoverGrammar(parser){var oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError,result;isBindingElement=true;isAssignmentTarget=true;firstCoverInitializedNameError=null;result=parser();if(firstCoverInitializedNameError!==null){throwUnexpectedToken(firstCoverInitializedNameError)}isBindingElement=oldIsBindingElement;isAssignmentTarget=oldIsAssignmentTarget;firstCoverInitializedNameError=oldFirstCoverInitializedNameError;return result}function inheritCoverGrammar(parser){var oldIsBindingElement=isBindingElement,oldIsAssignmentTarget=isAssignmentTarget,oldFirstCoverInitializedNameError=firstCoverInitializedNameError,result;isBindingElement=true;isAssignmentTarget=true;firstCoverInitializedNameError=null;result=parser();isBindingElement=isBindingElement&&oldIsBindingElement;isAssignmentTarget=isAssignmentTarget&&oldIsAssignmentTarget;firstCoverInitializedNameError=oldFirstCoverInitializedNameError||firstCoverInitializedNameError;return result}function parseArrayPattern(params,kind){var node=new Node,elements=[],rest,restNode;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else{if(match("...")){restNode=new Node;lex();params.push(lookahead);rest=parseVariableIdentifier(kind);elements.push(restNode.finishRestElement(rest));break}else{elements.push(parsePatternWithDefault(params,kind))}if(!match("]")){expect(",")}}}expect("]");return node.finishArrayPattern(elements)}function parsePropertyPattern(params,kind){var node=new Node,key,keyToken,computed=match("["),init;if(lookahead.type===Token.Identifier){keyToken=lookahead;key=parseVariableIdentifier();if(match("=")){params.push(keyToken);lex();init=parseAssignmentExpression();return node.finishProperty("init",key,false,new WrappingNode(keyToken).finishAssignmentPattern(key,init),false,true)}else if(!match(":")){params.push(keyToken);return node.finishProperty("init",key,false,key,false,true)}}else{key=parseObjectPropertyKey()}expect(":");init=parsePatternWithDefault(params,kind);return node.finishProperty("init",key,computed,init,false,false)}function parseObjectPattern(params,kind){var node=new Node,properties=[];expect("{");while(!match("}")){properties.push(parsePropertyPattern(params,kind));if(!match("}")){expect(",")}}lex();return node.finishObjectPattern(properties)}function parsePattern(params,kind){if(match("[")){return parseArrayPattern(params,kind)}else if(match("{")){return parseObjectPattern(params,kind)}else if(matchKeyword("let")){if(kind==="const"||kind==="let"){tolerateUnexpectedToken(lookahead,Messages.UnexpectedToken)}}params.push(lookahead);return parseVariableIdentifier(kind)}function parsePatternWithDefault(params,kind){var startToken=lookahead,pattern,previousAllowYield,right;pattern=parsePattern(params,kind);if(match("=")){lex();previousAllowYield=state.allowYield;state.allowYield=true;right=isolateCoverGrammar(parseAssignmentExpression);state.allowYield=previousAllowYield;pattern=new WrappingNode(startToken).finishAssignmentPattern(pattern,right)}return pattern}function parseArrayInitializer(){var elements=[],node=new Node,restSpread;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else if(match("...")){restSpread=new Node;lex();restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression));if(!match("]")){isAssignmentTarget=isBindingElement=false;expect(",")}elements.push(restSpread)}else{elements.push(inheritCoverGrammar(parseAssignmentExpression));if(!match("]")){expect(",")}}}lex();return node.finishArrayExpression(elements)}function parsePropertyFunction(node,paramInfo,isGenerator){var previousStrict,body;isAssignmentTarget=isBindingElement=false;previousStrict=strict;body=isolateCoverGrammar(parseFunctionSourceElements);if(strict&&paramInfo.firstRestricted){tolerateUnexpectedToken(paramInfo.firstRestricted,paramInfo.message)}if(strict&&paramInfo.stricted){tolerateUnexpectedToken(paramInfo.stricted,paramInfo.message)}strict=previousStrict;return node.finishFunctionExpression(null,paramInfo.params,paramInfo.defaults,body,isGenerator)}function parsePropertyMethodFunction(){var params,method,node=new Node,previousAllowYield=state.allowYield;state.allowYield=false;params=parseParams();state.allowYield=previousAllowYield;state.allowYield=false;method=parsePropertyFunction(node,params,false);state.allowYield=previousAllowYield;return method}function parseObjectPropertyKey(){var token,node=new Node,expr;token=lex();switch(token.type){case Token.StringLiteral:case Token.NumericLiteral:if(strict&&token.octal){tolerateUnexpectedToken(token,Messages.StrictOctalLiteral)}return node.finishLiteral(token);case Token.Identifier:case Token.BooleanLiteral:case Token.NullLiteral:case Token.Keyword:return node.finishIdentifier(token.value);case Token.Punctuator:if(token.value==="["){expr=isolateCoverGrammar(parseAssignmentExpression);expect("]");return expr}break}throwUnexpectedToken(token)}function lookaheadPropertyName(){switch(lookahead.type){case Token.Identifier:case Token.StringLiteral:case Token.BooleanLiteral:case Token.NullLiteral:case Token.NumericLiteral:case Token.Keyword:return true;case Token.Punctuator:return lookahead.value==="["}return false}function tryParseMethodDefinition(token,key,computed,node){var value,options,methodNode,params,previousAllowYield=state.allowYield;if(token.type===Token.Identifier){if(token.value==="get"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;expect("(");expect(")");state.allowYield=false;value=parsePropertyFunction(methodNode,{params:[],defaults:[],stricted:null,firstRestricted:null,message:null},false);state.allowYield=previousAllowYield;return node.finishProperty("get",key,computed,value,false,false)}else if(token.value==="set"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;expect("(");options={params:[],defaultCount:0,defaults:[],firstRestricted:null,paramSet:{}};if(match(")")){tolerateUnexpectedToken(lookahead)}else{state.allowYield=false;parseParam(options);state.allowYield=previousAllowYield;if(options.defaultCount===0){options.defaults=[]}}expect(")");state.allowYield=false;value=parsePropertyFunction(methodNode,options,false);state.allowYield=previousAllowYield;return node.finishProperty("set",key,computed,value,false,false)}}else if(token.type===Token.Punctuator&&token.value==="*"&&lookaheadPropertyName()){computed=match("[");key=parseObjectPropertyKey();methodNode=new Node;state.allowYield=true;params=parseParams();state.allowYield=previousAllowYield;state.allowYield=false;value=parsePropertyFunction(methodNode,params,true);state.allowYield=previousAllowYield;return node.finishProperty("init",key,computed,value,true,false)}if(key&&match("(")){value=parsePropertyMethodFunction();return node.finishProperty("init",key,computed,value,true,false)}return null}function parseObjectProperty(hasProto){var token=lookahead,node=new Node,computed,key,maybeMethod,proto,value;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey()}maybeMethod=tryParseMethodDefinition(token,key,computed,node);if(maybeMethod){return maybeMethod}if(!key){throwUnexpectedToken(lookahead)}if(!computed){proto=key.type===Syntax.Identifier&&key.name==="__proto__"||key.type===Syntax.Literal&&key.value==="__proto__";if(hasProto.value&&proto){tolerateError(Messages.DuplicateProtoProperty)}hasProto.value|=proto}if(match(":")){lex();value=inheritCoverGrammar(parseAssignmentExpression);return node.finishProperty("init",key,computed,value,false,false)}if(token.type===Token.Identifier){if(match("=")){firstCoverInitializedNameError=lookahead;lex();value=isolateCoverGrammar(parseAssignmentExpression);return node.finishProperty("init",key,computed,new WrappingNode(token).finishAssignmentPattern(key,value),false,true)}return node.finishProperty("init",key,computed,key,false,true)}throwUnexpectedToken(lookahead)}function parseObjectInitializer(){var properties=[],hasProto={value:false},node=new Node;expect("{");while(!match("}")){properties.push(parseObjectProperty(hasProto));if(!match("}")){expectCommaSeparator()}}expect("}");return node.finishObjectExpression(properties)}function reinterpretExpressionAsPattern(expr){var i;switch(expr.type){case Syntax.Identifier:case Syntax.MemberExpression:case Syntax.RestElement:case Syntax.AssignmentPattern:break;case Syntax.SpreadElement:expr.type=Syntax.RestElement;reinterpretExpressionAsPattern(expr.argument);break;case Syntax.ArrayExpression:expr.type=Syntax.ArrayPattern;for(i=0;i<expr.elements.length;i++){if(expr.elements[i]!==null){reinterpretExpressionAsPattern(expr.elements[i])}}break;case Syntax.ObjectExpression:expr.type=Syntax.ObjectPattern;

for(i=0;i<expr.properties.length;i++){reinterpretExpressionAsPattern(expr.properties[i].value)}break;case Syntax.AssignmentExpression:expr.type=Syntax.AssignmentPattern;reinterpretExpressionAsPattern(expr.left);break;default:break}}function parseTemplateElement(option){var node,token;if(lookahead.type!==Token.Template||option.head&&!lookahead.head){throwUnexpectedToken()}node=new Node;token=lex();return node.finishTemplateElement({raw:token.value.raw,cooked:token.value.cooked},token.tail)}function parseTemplateLiteral(){var quasi,quasis,expressions,node=new Node;quasi=parseTemplateElement({head:true});quasis=[quasi];expressions=[];while(!quasi.tail){expressions.push(parseExpression());quasi=parseTemplateElement({head:false});quasis.push(quasi)}return node.finishTemplateLiteral(quasis,expressions)}function parseGroupExpression(){var expr,expressions,startToken,i,params=[];expect("(");if(match(")")){lex();if(!match("=>")){expect("=>")}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[],rawParams:[]}}startToken=lookahead;if(match("...")){expr=parseRestElement(params);expect(")");if(!match("=>")){expect("=>")}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]}}isBindingElement=true;expr=inheritCoverGrammar(parseAssignmentExpression);if(match(",")){isAssignmentTarget=false;expressions=[expr];while(startIndex<length){if(!match(",")){break}lex();if(match("...")){if(!isBindingElement){throwUnexpectedToken(lookahead)}expressions.push(parseRestElement(params));expect(")");if(!match("=>")){expect("=>")}isBindingElement=false;for(i=0;i<expressions.length;i++){reinterpretExpressionAsPattern(expressions[i])}return{type:PlaceHolders.ArrowParameterPlaceHolder,params:expressions}}expressions.push(inheritCoverGrammar(parseAssignmentExpression))}expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}expect(")");if(match("=>")){if(expr.type===Syntax.Identifier&&expr.name==="yield"){return{type:PlaceHolders.ArrowParameterPlaceHolder,params:[expr]}}if(!isBindingElement){throwUnexpectedToken(lookahead)}if(expr.type===Syntax.SequenceExpression){for(i=0;i<expr.expressions.length;i++){reinterpretExpressionAsPattern(expr.expressions[i])}}else{reinterpretExpressionAsPattern(expr)}expr={type:PlaceHolders.ArrowParameterPlaceHolder,params:expr.type===Syntax.SequenceExpression?expr.expressions:[expr]}}isBindingElement=false;return expr}function parsePrimaryExpression(){var type,token,expr,node;if(match("(")){isBindingElement=false;return inheritCoverGrammar(parseGroupExpression)}if(match("[")){return inheritCoverGrammar(parseArrayInitializer)}if(match("{")){return inheritCoverGrammar(parseObjectInitializer)}type=lookahead.type;node=new Node;if(type===Token.Identifier){if(state.sourceType==="module"&&lookahead.value==="await"){tolerateUnexpectedToken(lookahead)}expr=node.finishIdentifier(lex().value)}else if(type===Token.StringLiteral||type===Token.NumericLiteral){isAssignmentTarget=isBindingElement=false;if(strict&&lookahead.octal){tolerateUnexpectedToken(lookahead,Messages.StrictOctalLiteral)}expr=node.finishLiteral(lex())}else if(type===Token.Keyword){if(!strict&&state.allowYield&&matchKeyword("yield")){return parseNonComputedProperty()}if(!strict&&matchKeyword("let")){return node.finishIdentifier(lex().value)}isAssignmentTarget=isBindingElement=false;if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("this")){lex();return node.finishThisExpression()}if(matchKeyword("class")){return parseClassExpression()}throwUnexpectedToken(lex())}else if(type===Token.BooleanLiteral){isAssignmentTarget=isBindingElement=false;token=lex();token.value=token.value==="true";expr=node.finishLiteral(token)}else if(type===Token.NullLiteral){isAssignmentTarget=isBindingElement=false;token=lex();token.value=null;expr=node.finishLiteral(token)}else if(match("/")||match("/=")){isAssignmentTarget=isBindingElement=false;index=startIndex;if(typeof extra.tokens!=="undefined"){token=collectRegex()}else{token=scanRegExp()}lex();expr=node.finishLiteral(token)}else if(type===Token.Template){expr=parseTemplateLiteral()}else{throwUnexpectedToken(lex())}return expr}function parseArguments(){var args=[],expr;expect("(");if(!match(")")){while(startIndex<length){if(match("...")){expr=new Node;lex();expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression))}else{expr=isolateCoverGrammar(parseAssignmentExpression)}args.push(expr);if(match(")")){break}expectCommaSeparator()}}expect(")");return args}function parseNonComputedProperty(){var token,node=new Node;token=lex();if(!isIdentifierName(token)){throwUnexpectedToken(token)}return node.finishIdentifier(token.value)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=isolateCoverGrammar(parseExpression);expect("]");return expr}function parseNewExpression(){var callee,args,node=new Node;expectKeyword("new");if(match(".")){lex();if(lookahead.type===Token.Identifier&&lookahead.value==="target"){if(state.inFunctionBody){lex();return node.finishMetaProperty("new","target")}}throwUnexpectedToken(lookahead)}callee=isolateCoverGrammar(parseLeftHandSideExpression);args=match("(")?parseArguments():[];isAssignmentTarget=isBindingElement=false;return node.finishNewExpression(callee,args)}function parseLeftHandSideExpressionAllowCall(){var quasi,expr,args,property,startToken,previousAllowIn=state.allowIn;startToken=lookahead;state.allowIn=true;if(matchKeyword("super")&&state.inFunctionBody){expr=new Node;lex();expr=expr.finishSuper();if(!match("(")&&!match(".")&&!match("[")){throwUnexpectedToken(lookahead)}}else{expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression)}for(;;){if(match(".")){isBindingElement=false;isAssignmentTarget=true;property=parseNonComputedMember();expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property)}else if(match("(")){isBindingElement=false;isAssignmentTarget=false;args=parseArguments();expr=new WrappingNode(startToken).finishCallExpression(expr,args)}else if(match("[")){isBindingElement=false;isAssignmentTarget=true;property=parseComputedMember();expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property)}else if(lookahead.type===Token.Template&&lookahead.head){quasi=parseTemplateLiteral();expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}else{break}}state.allowIn=previousAllowIn;return expr}function parseLeftHandSideExpression(){var quasi,expr,property,startToken;assert(state.allowIn,"callee of new expression always allow in keyword.");startToken=lookahead;if(matchKeyword("super")&&state.inFunctionBody){expr=new Node;lex();expr=expr.finishSuper();if(!match("[")&&!match(".")){throwUnexpectedToken(lookahead)}}else{expr=inheritCoverGrammar(matchKeyword("new")?parseNewExpression:parsePrimaryExpression)}for(;;){if(match("[")){isBindingElement=false;isAssignmentTarget=true;property=parseComputedMember();expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property)}else if(match(".")){isBindingElement=false;isAssignmentTarget=true;property=parseNonComputedMember();expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property)}else if(lookahead.type===Token.Template&&lookahead.head){quasi=parseTemplateLiteral();expr=new WrappingNode(startToken).finishTaggedTemplateExpression(expr,quasi)}else{break}}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;expr=inheritCoverGrammar(parseLeftHandSideExpressionAllowCall);if(!hasLineTerminator&&lookahead.type===Token.Punctuator){if(match("++")||match("--")){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){tolerateError(Messages.StrictLHSPostfix)}if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}isAssignmentTarget=isBindingElement=false;token=lex();expr=new WrappingNode(startToken).finishPostfixExpression(token.value,expr)}}return expr}function parseUnaryExpression(){var token,expr,startToken;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){expr=parsePostfixExpression()}else if(match("++")||match("--")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){tolerateError(Messages.StrictLHSPrefix)}if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);isAssignmentTarget=isBindingElement=false}else if(match("+")||match("-")||match("~")||match("!")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);isAssignmentTarget=isBindingElement=false}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){startToken=lookahead;token=lex();expr=inheritCoverGrammar(parseUnaryExpression);expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr);if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){tolerateError(Messages.StrictDelete)}isAssignmentTarget=isBindingElement=false}else{expr=parsePostfixExpression()}return expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;marker=lookahead;left=inheritCoverGrammar(parseUnaryExpression);token=lookahead;prec=binaryPrecedence(token,state.allowIn);if(prec===0){return left}isAssignmentTarget=isBindingElement=false;token.prec=prec;lex();markers=[marker,lookahead];right=isolateCoverGrammar(parseUnaryExpression);stack=[left,token,right];while((prec=binaryPrecedence(lookahead,state.allowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();markers.pop();expr=new WrappingNode(markers[markers.length-1]).finishBinaryExpression(operator,left,right);stack.push(expr)}token=lex();token.prec=prec;stack.push(token);markers.push(lookahead);expr=isolateCoverGrammar(parseUnaryExpression);stack.push(expr)}i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=new WrappingNode(markers.pop()).finishBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;startToken=lookahead;expr=inheritCoverGrammar(parseBinaryExpression);if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=isolateCoverGrammar(parseAssignmentExpression);state.allowIn=previousAllowIn;expect(":");alternate=isolateCoverGrammar(parseAssignmentExpression);expr=new WrappingNode(startToken).finishConditionalExpression(expr,consequent,alternate);isAssignmentTarget=isBindingElement=false}return expr}function parseConciseBody(){if(match("{")){return parseFunctionSourceElements()}return isolateCoverGrammar(parseAssignmentExpression)}function checkPatternParam(options,param){var i;switch(param.type){case Syntax.Identifier:validateParam(options,param,param.name);break;case Syntax.RestElement:checkPatternParam(options,param.argument);break;case Syntax.AssignmentPattern:checkPatternParam(options,param.left);break;case Syntax.ArrayPattern:for(i=0;i<param.elements.length;i++){if(param.elements[i]!==null){checkPatternParam(options,param.elements[i])}}break;case Syntax.YieldExpression:break;default:assert(param.type===Syntax.ObjectPattern,"Invalid type");for(i=0;i<param.properties.length;i++){checkPatternParam(options,param.properties[i].value)}break}}function reinterpretAsCoverFormalsList(expr){var i,len,param,params,defaults,defaultCount,options,token;defaults=[];defaultCount=0;params=[expr];switch(expr.type){case Syntax.Identifier:break;case PlaceHolders.ArrowParameterPlaceHolder:params=expr.params;break;default:return null}options={paramSet:{}};for(i=0,len=params.length;i<len;i+=1){param=params[i];switch(param.type){case Syntax.AssignmentPattern:params[i]=param.left;if(param.right.type===Syntax.YieldExpression){if(param.right.argument){throwUnexpectedToken(lookahead)}param.right.type=Syntax.Identifier;param.right.name="yield";delete param.right.argument;delete param.right.delegate}defaults.push(param.right);++defaultCount;checkPatternParam(options,param.left);break;default:checkPatternParam(options,param);params[i]=param;defaults.push(null);break}}if(strict||!state.allowYield){for(i=0,len=params.length;i<len;i+=1){param=params[i];if(param.type===Syntax.YieldExpression){throwUnexpectedToken(lookahead)}}}if(options.message===Messages.StrictParamDupe){token=strict?options.stricted:options.firstRestricted;throwUnexpectedToken(token,options.message)}if(defaultCount===0){defaults=[]}return{params:params,defaults:defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,node){var previousStrict,previousAllowYield,body;if(hasLineTerminator){tolerateUnexpectedToken(lookahead)}expect("=>");previousStrict=strict;previousAllowYield=state.allowYield;state.allowYield=true;body=parseConciseBody();if(strict&&options.firstRestricted){throwUnexpectedToken(options.firstRestricted,options.message)}if(strict&&options.stricted){tolerateUnexpectedToken(options.stricted,options.message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishArrowFunctionExpression(options.params,options.defaults,body,body.type!==Syntax.BlockStatement)}function parseYieldExpression(){var argument,expr,delegate,previousAllowYield;argument=null;expr=new Node;delegate=false;expectKeyword("yield");if(!hasLineTerminator){previousAllowYield=state.allowYield;state.allowYield=false;delegate=match("*");if(delegate){lex();argument=parseAssignmentExpression()}else{if(!match(";")&&!match("}")&&!match(")")&&lookahead.type!==Token.EOF){argument=parseAssignmentExpression()}}state.allowYield=previousAllowYield}return expr.finishYieldExpression(argument,delegate)}function parseAssignmentExpression(){var token,expr,right,list,startToken;startToken=lookahead;token=lookahead;if(!state.allowYield&&matchKeyword("yield")){return parseYieldExpression()}expr=parseConditionalExpression();if(expr.type===PlaceHolders.ArrowParameterPlaceHolder||match("=>")){isAssignmentTarget=isBindingElement=false;list=reinterpretAsCoverFormalsList(expr);if(list){firstCoverInitializedNameError=null;return parseArrowFunctionExpression(list,new WrappingNode(startToken))}return expr}if(matchAssign()){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInAssignment)}if(strict&&expr.type===Syntax.Identifier){if(isRestrictedWord(expr.name)){tolerateUnexpectedToken(token,Messages.StrictLHSAssignment)}if(isStrictModeReservedWord(expr.name)){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}}if(!match("=")){isAssignmentTarget=isBindingElement=false}else{reinterpretExpressionAsPattern(expr)}token=lex();right=isolateCoverGrammar(parseAssignmentExpression);expr=new WrappingNode(startToken).finishAssignmentExpression(token.value,expr,right);firstCoverInitializedNameError=null}return expr}function parseExpression(){var expr,startToken=lookahead,expressions;expr=isolateCoverGrammar(parseAssignmentExpression);if(match(",")){expressions=[expr];while(startIndex<length){if(!match(",")){break}lex();expressions.push(isolateCoverGrammar(parseAssignmentExpression))}expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}return expr}function parseStatementListItem(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"export":if(state.sourceType!=="module"){tolerateUnexpectedToken(lookahead,Messages.IllegalExportDeclaration)}return parseExportDeclaration();case"import":if(state.sourceType!=="module"){tolerateUnexpectedToken(lookahead,Messages.IllegalImportDeclaration)}return parseImportDeclaration();case"const":return parseLexicalDeclaration({inFor:false});case"function":return parseFunctionDeclaration(new Node);case"class":return parseClassDeclaration()}}if(matchKeyword("let")&&isLexicalDeclaration()){return parseLexicalDeclaration({inFor:false})}return parseStatement()}function parseStatementList(){var list=[];while(startIndex<length){if(match("}")){break}list.push(parseStatementListItem())}return list}function parseBlock(){var block,node=new Node;expect("{");block=parseStatementList();expect("}");return node.finishBlockStatement(block)}function parseVariableIdentifier(kind){var token,node=new Node;token=lex();if(token.type===Token.Keyword&&token.value==="yield"){if(strict){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}if(!state.allowYield){throwUnexpectedToken(token)}}else if(token.type!==Token.Identifier){if(strict&&token.type===Token.Keyword&&isStrictModeReservedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictReservedWord)}else{if(strict||token.value!=="let"||kind!=="var"){throwUnexpectedToken(token)}}}else if(state.sourceType==="module"&&token.type===Token.Identifier&&token.value==="await"){tolerateUnexpectedToken(token)}return node.finishIdentifier(token.value)}function parseVariableDeclaration(options){var init=null,id,node=new Node,params=[];id=parsePattern(params,"var");if(strict&&isRestrictedWord(id.name)){tolerateError(Messages.StrictVarName)}if(match("=")){lex();init=isolateCoverGrammar(parseAssignmentExpression)}else if(id.type!==Syntax.Identifier&&!options.inFor){expect("=")}return node.finishVariableDeclarator(id,init)}function parseVariableDeclarationList(options){var opt,list;opt={inFor:options.inFor};list=[parseVariableDeclaration(opt)];while(match(",")){lex();list.push(parseVariableDeclaration(opt))}return list}function parseVariableStatement(node){var declarations;expectKeyword("var");declarations=parseVariableDeclarationList({inFor:false});consumeSemicolon();return node.finishVariableDeclaration(declarations)}function parseLexicalBinding(kind,options){var init=null,id,node=new Node,params=[];id=parsePattern(params,kind);if(strict&&id.type===Syntax.Identifier&&isRestrictedWord(id.name)){tolerateError(Messages.StrictVarName)}if(kind==="const"){if(!matchKeyword("in")&&!matchContextualKeyword("of")){expect("=");init=isolateCoverGrammar(parseAssignmentExpression)}}else if(!options.inFor&&id.type!==Syntax.Identifier||match("=")){expect("=");init=isolateCoverGrammar(parseAssignmentExpression)}return node.finishVariableDeclarator(id,init)}function parseBindingList(kind,options){var list=[parseLexicalBinding(kind,options)];while(match(",")){lex();list.push(parseLexicalBinding(kind,options))}return list}function tokenizerState(){return{index:index,lineNumber:lineNumber,lineStart:lineStart,hasLineTerminator:hasLineTerminator,lastIndex:lastIndex,lastLineNumber:lastLineNumber,lastLineStart:lastLineStart,startIndex:startIndex,startLineNumber:startLineNumber,startLineStart:startLineStart,lookahead:lookahead,tokenCount:extra.tokens?extra.tokens.length:0}}function resetTokenizerState(ts){index=ts.index;lineNumber=ts.lineNumber;lineStart=ts.lineStart;hasLineTerminator=ts.hasLineTerminator;lastIndex=ts.lastIndex;lastLineNumber=ts.lastLineNumber;lastLineStart=ts.lastLineStart;startIndex=ts.startIndex;startLineNumber=ts.startLineNumber;startLineStart=ts.startLineStart;lookahead=ts.lookahead;if(extra.tokens){extra.tokens.splice(ts.tokenCount,extra.tokens.length)}}function isLexicalDeclaration(){var lexical,ts;ts=tokenizerState();lex();lexical=lookahead.type===Token.Identifier||match("[")||match("{")||matchKeyword("let")||matchKeyword("yield");resetTokenizerState(ts);return lexical}function parseLexicalDeclaration(options){var kind,declarations,node=new Node;kind=lex().value;assert(kind==="let"||kind==="const","Lexical declaration must be either let or const");declarations=parseBindingList(kind,options);consumeSemicolon();return node.finishLexicalDeclaration(declarations,kind)}function parseRestElement(params){var param,node=new Node;lex();if(match("{")){throwError(Messages.ObjectPatternAsRestParameter)}params.push(lookahead);param=parseVariableIdentifier();if(match("=")){throwError(Messages.DefaultRestParameter)}if(!match(")")){throwError(Messages.ParameterAfterRestParameter)}return node.finishRestElement(param)}function parseEmptyStatement(node){expect(";");return node.finishEmptyStatement()}function parseExpressionStatement(node){var expr=parseExpression();consumeSemicolon();return node.finishExpressionStatement(expr)}function parseIfStatement(node){var test,consequent,alternate;expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return node.finishIfStatement(test,consequent,alternate)}function parseDoWhileStatement(node){var body,test,oldInIteration;expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return node.finishDoWhileStatement(body,test)}function parseWhileStatement(node){var test,body,oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return node.finishWhileStatement(test,body)}function parseForStatement(node){var init,forIn,initSeq,initStartToken,test,update,left,right,kind,declarations,body,oldInIteration,previousAllowIn=state.allowIn;init=test=update=null;forIn=true;expectKeyword("for");expect("(");if(match(";")){lex()}else{if(matchKeyword("var")){init=new Node;lex();state.allowIn=false;declarations=parseVariableDeclarationList({inFor:true});state.allowIn=previousAllowIn;if(declarations.length===1&&matchKeyword("in")){init=init.finishVariableDeclaration(declarations);lex();left=init;right=parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&matchContextualKeyword("of")){init=init.finishVariableDeclaration(declarations);lex();left=init;right=parseAssignmentExpression();init=null;forIn=false}else{init=init.finishVariableDeclaration(declarations);expect(";")}}else if(matchKeyword("const")||matchKeyword("let")){init=new Node;kind=lex().value;if(!strict&&lookahead.value==="in"){init=init.finishIdentifier(kind);lex();left=init;right=parseExpression();init=null}else{state.allowIn=false;declarations=parseBindingList(kind,{inFor:true});state.allowIn=previousAllowIn;if(declarations.length===1&&declarations[0].init===null&&matchKeyword("in")){init=init.finishLexicalDeclaration(declarations,kind);lex();left=init;right=parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&matchContextualKeyword("of")){init=init.finishLexicalDeclaration(declarations,kind);lex();left=init;right=parseAssignmentExpression();init=null;forIn=false}else{consumeSemicolon();init=init.finishLexicalDeclaration(declarations,kind)}}}else{initStartToken=lookahead;state.allowIn=false;init=inheritCoverGrammar(parseAssignmentExpression);state.allowIn=previousAllowIn;if(matchKeyword("in")){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInForIn)}lex();reinterpretExpressionAsPattern(init);left=init;right=parseExpression();init=null}else if(matchContextualKeyword("of")){if(!isAssignmentTarget){tolerateError(Messages.InvalidLHSInForLoop)}lex();reinterpretExpressionAsPattern(init);left=init;right=parseAssignmentExpression();init=null;forIn=false}else{if(match(",")){initSeq=[init];while(match(",")){lex();initSeq.push(isolateCoverGrammar(parseAssignmentExpression))}init=new WrappingNode(initStartToken).finishSequenceExpression(initSeq)}expect(";")}}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=isolateCoverGrammar(parseStatement);state.inIteration=oldInIteration;return typeof left==="undefined"?node.finishForStatement(init,test,update,body):forIn?node.finishForInStatement(left,right,body):node.finishForOfStatement(left,right,body)}function parseContinueStatement(node){var label=null,key;expectKeyword("continue");if(source.charCodeAt(startIndex)===59){lex();if(!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(null)}if(hasLineTerminator){if(!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError(Messages.IllegalContinue)}return node.finishContinueStatement(label)}function parseBreakStatement(node){var label=null,key;expectKeyword("break");if(source.charCodeAt(lastIndex)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}return node.finishBreakStatement(null)}if(hasLineTerminator){if(!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}}else if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError(Messages.IllegalBreak)}return node.finishBreakStatement(label)}function parseReturnStatement(node){var argument=null;expectKeyword("return");if(!state.inFunctionBody){tolerateError(Messages.IllegalReturn)}if(source.charCodeAt(lastIndex)===32){if(isIdentifierStart(source.charCodeAt(lastIndex+1))){argument=parseExpression();consumeSemicolon();return node.finishReturnStatement(argument)}}if(hasLineTerminator){return node.finishReturnStatement(null)}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return node.finishReturnStatement(argument)}function parseWithStatement(node){var object,body;if(strict){tolerateError(Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return node.finishWithStatement(object,body)}function parseSwitchCase(){var test,consequent=[],statement,node=new Node;if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(startIndex<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}statement=parseStatementListItem();consequent.push(statement)}return node.finishSwitchCase(test,consequent)}function parseSwitchStatement(node){var discriminant,cases,clause,oldInSwitch,defaultFound;expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return node.finishSwitchStatement(discriminant,cases)}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(startIndex<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError(Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return node.finishSwitchStatement(discriminant,cases)}function parseThrowStatement(node){var argument;expectKeyword("throw");if(hasLineTerminator){throwError(Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return node.finishThrowStatement(argument)}function parseCatchClause(){var param,params=[],paramMap={},key,i,body,node=new Node;expectKeyword("catch");expect("(");if(match(")")){throwUnexpectedToken(lookahead)}param=parsePattern(params);for(i=0;i<params.length;i++){key="$"+params[i].value;if(Object.prototype.hasOwnProperty.call(paramMap,key)){tolerateError(Messages.DuplicateBinding,params[i].value)}paramMap[key]=true}if(strict&&isRestrictedWord(param.name)){tolerateError(Messages.StrictCatchVariable)}expect(")");body=parseBlock();return node.finishCatchClause(param,body)}function parseTryStatement(node){var block,handler=null,finalizer=null;expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handler=parseCatchClause()}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(!handler&&!finalizer){throwError(Messages.NoCatchOrFinally)}return node.finishTryStatement(block,handler,finalizer)}function parseDebuggerStatement(node){expectKeyword("debugger");consumeSemicolon();return node.finishDebuggerStatement()}function parseStatement(){var type=lookahead.type,expr,labeledBody,key,node;if(type===Token.EOF){throwUnexpectedToken(lookahead)}if(type===Token.Punctuator&&lookahead.value==="{"){return parseBlock()}isAssignmentTarget=isBindingElement=true;node=new Node;if(type===Token.Punctuator){switch(lookahead.value){case";":return parseEmptyStatement(node);case"(":return parseExpressionStatement(node);default:break}}else if(type===Token.Keyword){switch(lookahead.value){case"break":return parseBreakStatement(node);case"continue":return parseContinueStatement(node);case"debugger":return parseDebuggerStatement(node);case"do":return parseDoWhileStatement(node);case"for":return parseForStatement(node);case"function":return parseFunctionDeclaration(node);case"if":return parseIfStatement(node);case"return":return parseReturnStatement(node);case"switch":return parseSwitchStatement(node);case"throw":return parseThrowStatement(node);case"try":return parseTryStatement(node);case"var":return parseVariableStatement(node);case"while":return parseWhileStatement(node);case"with":return parseWithStatement(node);default:break}}expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError(Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return node.finishLabeledStatement(expr,labeledBody)}consumeSemicolon();return node.finishExpressionStatement(expr)}function parseFunctionSourceElements(){var statement,body=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,node=new Node;expect("{");while(startIndex<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;statement=parseStatementListItem();body.push(statement);if(statement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;while(startIndex<length){if(match("}")){break}body.push(parseStatementListItem())}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;return node.finishBlockStatement(body)}function validateParam(options,param,name){var key="$"+name;if(strict){if(isRestrictedWord(name)){options.stricted=param;options.message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}else if(!options.firstRestricted){if(isRestrictedWord(name)){options.firstRestricted=param;options.message=Messages.StrictParamName}else if(isStrictModeReservedWord(name)){options.firstRestricted=param;

options.message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}options.paramSet[key]=true}function parseParam(options){var token,param,params=[],i,def;token=lookahead;if(token.value==="..."){param=parseRestElement(params);validateParam(options,param.argument,param.argument.name);options.params.push(param);options.defaults.push(null);return false}param=parsePatternWithDefault(params);for(i=0;i<params.length;i++){validateParam(options,params[i],params[i].value)}if(param.type===Syntax.AssignmentPattern){def=param.right;param=param.left;++options.defaultCount}options.params.push(param);options.defaults.push(def);return!match(")")}function parseParams(firstRestricted){var options;options={params:[],defaultCount:0,defaults:[],firstRestricted:firstRestricted};expect("(");if(!match(")")){options.paramSet={};while(startIndex<length){if(!parseParam(options)){break}expect(",")}}expect(")");if(options.defaultCount===0){options.defaults=[]}return{params:options.params,defaults:options.defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseFunctionDeclaration(node,identifierIsOptional){var id=null,params=[],defaults=[],body,token,stricted,tmp,firstRestricted,message,previousStrict,isGenerator,previousAllowYield;previousAllowYield=state.allowYield;expectKeyword("function");isGenerator=match("*");if(isGenerator){lex()}if(!identifierIsOptional||!match("(")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}state.allowYield=!isGenerator;tmp=parseParams(firstRestricted);params=tmp.params;defaults=tmp.defaults;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwUnexpectedToken(firstRestricted,message)}if(strict&&stricted){tolerateUnexpectedToken(stricted,message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishFunctionDeclaration(id,params,defaults,body,isGenerator)}function parseFunctionExpression(){var token,id=null,stricted,firstRestricted,message,tmp,params=[],defaults=[],body,previousStrict,node=new Node,isGenerator,previousAllowYield;previousAllowYield=state.allowYield;expectKeyword("function");isGenerator=match("*");if(isGenerator){lex()}state.allowYield=!isGenerator;if(!match("(")){token=lookahead;id=!strict&&!isGenerator&&matchKeyword("yield")?parseNonComputedProperty():parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){tolerateUnexpectedToken(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}tmp=parseParams(firstRestricted);params=tmp.params;defaults=tmp.defaults;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwUnexpectedToken(firstRestricted,message)}if(strict&&stricted){tolerateUnexpectedToken(stricted,message)}strict=previousStrict;state.allowYield=previousAllowYield;return node.finishFunctionExpression(id,params,defaults,body,isGenerator)}function parseClassBody(){var classBody,token,isStatic,hasConstructor=false,body,method,computed,key;classBody=new Node;expect("{");body=[];while(!match("}")){if(match(";")){lex()}else{method=new Node;token=lookahead;isStatic=false;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey();if(key.name==="static"&&(lookaheadPropertyName()||match("*"))){token=lookahead;isStatic=true;computed=match("[");if(match("*")){lex()}else{key=parseObjectPropertyKey()}}}method=tryParseMethodDefinition(token,key,computed,method);if(method){method["static"]=isStatic;if(method.kind==="init"){method.kind="method"}if(!isStatic){if(!method.computed&&(method.key.name||method.key.value.toString())==="constructor"){if(method.kind!=="method"||!method.method||method.value.generator){throwUnexpectedToken(token,Messages.ConstructorSpecialMethod)}if(hasConstructor){throwUnexpectedToken(token,Messages.DuplicateConstructor)}else{hasConstructor=true}method.kind="constructor"}}else{if(!method.computed&&(method.key.name||method.key.value.toString())==="prototype"){throwUnexpectedToken(token,Messages.StaticPrototype)}}method.type=Syntax.MethodDefinition;delete method.method;delete method.shorthand;body.push(method)}else{throwUnexpectedToken(lookahead)}}}lex();return classBody.finishClassBody(body)}function parseClassDeclaration(identifierIsOptional){var id=null,superClass=null,classNode=new Node,classBody,previousStrict=strict;strict=true;expectKeyword("class");if(!identifierIsOptional||lookahead.type===Token.Identifier){id=parseVariableIdentifier()}if(matchKeyword("extends")){lex();superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)}classBody=parseClassBody();strict=previousStrict;return classNode.finishClassDeclaration(id,superClass,classBody)}function parseClassExpression(){var id=null,superClass=null,classNode=new Node,classBody,previousStrict=strict;strict=true;expectKeyword("class");if(lookahead.type===Token.Identifier){id=parseVariableIdentifier()}if(matchKeyword("extends")){lex();superClass=isolateCoverGrammar(parseLeftHandSideExpressionAllowCall)}classBody=parseClassBody();strict=previousStrict;return classNode.finishClassExpression(id,superClass,classBody)}function parseModuleSpecifier(){var node=new Node;if(lookahead.type!==Token.StringLiteral){throwError(Messages.InvalidModuleSpecifier)}return node.finishLiteral(lex())}function parseExportSpecifier(){var exported,local,node=new Node,def;if(matchKeyword("default")){def=new Node;lex();local=def.finishIdentifier("default")}else{local=parseVariableIdentifier()}if(matchContextualKeyword("as")){lex();exported=parseNonComputedProperty()}return node.finishExportSpecifier(local,exported)}function parseExportNamedDeclaration(node){var declaration=null,isExportFromIdentifier,src=null,specifiers=[];if(lookahead.type===Token.Keyword){switch(lookahead.value){case"let":case"const":declaration=parseLexicalDeclaration({inFor:false});return node.finishExportNamedDeclaration(declaration,specifiers,null);case"var":case"class":case"function":declaration=parseStatementListItem();return node.finishExportNamedDeclaration(declaration,specifiers,null)}}expect("{");while(!match("}")){isExportFromIdentifier=isExportFromIdentifier||matchKeyword("default");specifiers.push(parseExportSpecifier());if(!match("}")){expect(",");if(match("}")){break}}}expect("}");if(matchContextualKeyword("from")){lex();src=parseModuleSpecifier();consumeSemicolon()}else if(isExportFromIdentifier){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}else{consumeSemicolon()}return node.finishExportNamedDeclaration(declaration,specifiers,src)}function parseExportDefaultDeclaration(node){var declaration=null,expression=null;expectKeyword("default");if(matchKeyword("function")){declaration=parseFunctionDeclaration(new Node,true);return node.finishExportDefaultDeclaration(declaration)}if(matchKeyword("class")){declaration=parseClassDeclaration(true);return node.finishExportDefaultDeclaration(declaration)}if(matchContextualKeyword("from")){throwError(Messages.UnexpectedToken,lookahead.value)}if(match("{")){expression=parseObjectInitializer()}else if(match("[")){expression=parseArrayInitializer()}else{expression=parseAssignmentExpression()}consumeSemicolon();return node.finishExportDefaultDeclaration(expression)}function parseExportAllDeclaration(node){var src;expect("*");if(!matchContextualKeyword("from")){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier();consumeSemicolon();return node.finishExportAllDeclaration(src)}function parseExportDeclaration(){var node=new Node;if(state.inFunctionBody){throwError(Messages.IllegalExportDeclaration)}expectKeyword("export");if(matchKeyword("default")){return parseExportDefaultDeclaration(node)}if(match("*")){return parseExportAllDeclaration(node)}return parseExportNamedDeclaration(node)}function parseImportSpecifier(){var local,imported,node=new Node;imported=parseNonComputedProperty();if(matchContextualKeyword("as")){lex();local=parseVariableIdentifier()}return node.finishImportSpecifier(local,imported)}function parseNamedImports(){var specifiers=[];expect("{");while(!match("}")){specifiers.push(parseImportSpecifier());if(!match("}")){expect(",");if(match("}")){break}}}expect("}");return specifiers}function parseImportDefaultSpecifier(){var local,node=new Node;local=parseNonComputedProperty();return node.finishImportDefaultSpecifier(local)}function parseImportNamespaceSpecifier(){var local,node=new Node;expect("*");if(!matchContextualKeyword("as")){throwError(Messages.NoAsAfterImportNamespace)}lex();local=parseNonComputedProperty();return node.finishImportNamespaceSpecifier(local)}function parseImportDeclaration(){var specifiers=[],src,node=new Node;if(state.inFunctionBody){throwError(Messages.IllegalImportDeclaration)}expectKeyword("import");if(lookahead.type===Token.StringLiteral){src=parseModuleSpecifier()}else{if(match("{")){specifiers=specifiers.concat(parseNamedImports())}else if(match("*")){specifiers.push(parseImportNamespaceSpecifier())}else if(isIdentifierName(lookahead)&&!matchKeyword("default")){specifiers.push(parseImportDefaultSpecifier());if(match(",")){lex();if(match("*")){specifiers.push(parseImportNamespaceSpecifier())}else if(match("{")){specifiers=specifiers.concat(parseNamedImports())}else{throwUnexpectedToken(lookahead)}}}else{throwUnexpectedToken(lex())}if(!matchContextualKeyword("from")){throwError(lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier()}consumeSemicolon();return node.finishImportDeclaration(specifiers,src)}function parseScriptBody(){var statement,body=[],token,directive,firstRestricted;while(startIndex<length){token=lookahead;if(token.type!==Token.StringLiteral){break}statement=parseStatementListItem();body.push(statement);if(statement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){tolerateUnexpectedToken(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(startIndex<length){statement=parseStatementListItem();if(typeof statement==="undefined"){break}body.push(statement)}return body}function parseProgram(){var body,node;peek();node=new Node;body=parseScriptBody();return node.finishProgram(body,state.sourceType)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(entry.regex){token.regex={pattern:entry.regex.pattern,flags:entry.regex.flags}}if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function tokenize(code,options,delegate){var toString,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;length=source.length;lookahead=null;state={allowIn:true,allowYield:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1,curlyStack:[]};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenValues=[];extra.tokenize=true;extra.delegate=delegate;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}try{peek();if(lookahead.type===Token.EOF){return extra.tokens}lex();while(lookahead.type!==Token.EOF){try{lex()}catch(lexError){if(extra.errors){recordError(lexError);break}else{throw lexError}}}tokens=extra.tokens;if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;startIndex=index;startLineNumber=lineNumber;startLineStart=lineStart;length=source.length;lookahead=null;state={allowIn:true,allowYield:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1,curlyStack:[],sourceType:"script"};strict=false;extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){extra.source=toString(options.source)}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}if(options.sourceType==="module"){state.sourceType=options.sourceType;strict=true}}try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{extra={}}return program}exports.version="2.7.3";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},{}],111:[function(require,module,exports){(function(){"use strict";var escope,estraverse,esutils,utility,version,assert,Syntax,Map;escope=require("escope");estraverse=require("estraverse");esutils=require("esutils");utility=require("./utility");Map=require("./map");version=require("../package.json").version;Syntax=estraverse.Syntax;assert=function assert(cond,message){if(!cond){throw new Error(message)}};if(version.indexOf("-dev",version.length-4)===-1){assert=function(){}}function NameGenerator(scope,options){this._scope=scope;this._functionName="";if(!options.distinguishFunctionExpressionScope&&this._scope.upper&&this._scope.upper.functionExpressionScope){this._functionName=this._scope.upper.block.id.name}}NameGenerator.prototype.passAsUnique=function passAsUnique(name){var i,iz;if(this._functionName===name){return false}if(esutils.keyword.isKeywordES5(name,true)||esutils.keyword.isRestrictedWord(name)){return false}if(this._scope.taints.has(name)){return false}for(i=0,iz=this._scope.through.length;i<iz;++i){if(this._scope.through[i].identifier.name===name){return false}}return true};NameGenerator.prototype.generateName=function generateName(tip){do{tip=utility.generateNextName(tip)}while(!this.passAsUnique(tip));return tip};function run(scope,options){var i,iz,j,jz,variable,name,def,ref,generator;generator=new NameGenerator(scope,options);if(scope.isStatic()){name="9";scope.variables.sort(function(a,b){if(a.tainted){return 1}if(b.tainted){return-1}return b.identifiers.length+b.references.length-(a.identifiers.length+a.references.length)});for(i=0,iz=scope.variables.length;i<iz;++i){variable=scope.variables[i];if(variable.tainted){continue}if(variable.identifiers.length===0){continue}name=generator.generateName(name);for(j=0,jz=variable.identifiers.length;j<jz;++j){def=variable.identifiers[j];def.name=name}for(j=0,jz=variable.references.length;j<jz;++j){ref=variable.references[j];ref.identifier.name=name}}}}function Label(node,upper){this.node=node;this.upper=upper;this.users=[];this.names=new Map;this.name=null}Label.prototype.mangle=function(){var tip,current,i,iz;tip="9";for(current=this.upper;current;current=current.upper){if(current.name!==null){this.names.set(current.name,true)}}do{tip=utility.generateNextName(tip)}while(this.names.has(tip));this.name=tip;for(current=this.upper;current;current=current.upper){current.names.set(tip,true)}this.node.label.name=tip;for(i=0,iz=this.users.length;i<iz;++i){this.users[i].label.name=tip}};function LabelScope(upper){this.map=new Map;this.upper=upper;this.label=null;this.labels=[]}LabelScope.prototype.register=function register(node){var name;assert(node.type===Syntax.LabeledStatement,"node should be LabeledStatement");this.label=new Label(node,this.label);this.labels.push(this.label);name=node.label.name;assert(!this.map.has(name),"duplicate label is found");this.map.set(name,this.label)};LabelScope.prototype.unregister=function unregister(node){var name,ref;if(node.type!==Syntax.LabeledStatement){return}name=node.label.name;ref=this.map.get(name);this.map["delete"](name);this.label=ref.upper};LabelScope.prototype.resolve=function resolve(node){var name;if(node.label){name=node.label.name;assert(this.map.has(name),"unresolved label");this.map.get(name).users.push(node)}};LabelScope.prototype.close=function close(){var i,iz,label;this.labels.sort(function(lhs,rhs){return rhs.users.length-lhs.users.length});for(i=0,iz=this.labels.length;i<iz;++i){label=this.labels[i];label.mangle()}return this.upper};function mangleLabels(tree){var labelScope;estraverse.traverse(tree,{enter:function(node){if(escope.Scope.isVariableScopeRequired(node)){labelScope=new LabelScope(labelScope);return}switch(node.type){case Syntax.LabeledStatement:labelScope.register(node);break;case Syntax.BreakStatement:case Syntax.ContinueStatement:labelScope.resolve(node);break}},leave:function(node){labelScope.unregister(node);if(escope.Scope.isVariableScopeRequired(node)){labelScope=labelScope.close()}}});return tree}function mangle(tree,options){var result,manager,i,iz;if(options==null){options={destructive:true}}result=options.destructive==null||options.destructive?tree:utility.deepCopy(tree);manager=escope.analyze(result,{directive:true});for(i=0,iz=manager.scopes.length;i<iz;++i){run(manager.scopes[i],options)}return mangleLabels(result)}exports.mangle=mangle;exports.version=version;exports.generateNextName=utility.generateNextName})()},{"../package.json":116,"./map":112,"./utility":113,escope:65,estraverse:114,esutils:122}],112:[function(require,module,exports){arguments[4][72][0].apply(exports,arguments)},{dup:72}],113:[function(require,module,exports){(function(){"use strict";var isArray,NameSequence,ZeroSequenceCache;isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){function deepCopyInternal(obj,result){var key,val;for(key in obj){if(key.lastIndexOf("__",0)===0){continue}if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){if(val instanceof RegExp){val=new RegExp(val)}else{val=deepCopyInternal(val,isArray(val)?[]:{})}}result[key]=val}}return result}return deepCopyInternal(obj,isArray(obj)?[]:{})}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}ZeroSequenceCache=[];function zeroSequence(num){var res=ZeroSequenceCache[num];if(res!==undefined){return res}res=stringRepeat("0",num);ZeroSequenceCache[num]=res;return res}NameSequence="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_$".split("");function generateNextName(name){var ch,index,cur;cur=name.length-1;do{ch=name.charAt(cur);index=NameSequence.indexOf(ch);if(index!==NameSequence.length-1){return name.substring(0,cur)+NameSequence[index+1]+zeroSequence(name.length-(cur+1))}--cur}while(cur>=0);return"a"+zeroSequence(name.length)}exports.generateNextName=generateNextName;exports.deepCopy=deepCopy})()},{}],114:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null;

}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":115}],115:[function(require,module,exports){module.exports={_args:[[{raw:"estraverse@~4.1.1",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"~4.1.1",spec:">=4.1.1 <4.2.0",type:"range"},"/agents/node_modules/webppl/node_modules/esshorten"]],_from:"estraverse@>=4.1.1 <4.2.0",_id:"estraverse@4.1.1",_inCache:true,_location:"/esshorten/estraverse",_nodeVersion:"4.1.1",_npmUser:{name:"constellation",email:"utatane.tea@gmail.com"},_npmVersion:"2.14.4",_phantomChildren:{},_requested:{raw:"estraverse@~4.1.1",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"~4.1.1",spec:">=4.1.1 <4.2.0",type:"range"},_requiredBy:["/esshorten"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-4.1.1.tgz",_shasum:"f6caca728933a850ef90661d0e17982ba47111a2",_shrinkwrap:null,_spec:"estraverse@~4.1.1",_where:"/agents/node_modules/webppl/node_modules/esshorten",bugs:{url:"https://github.com/estools/estraverse/issues"},dependencies:{},description:"ECMAScript JS AST traversal functions",devDependencies:{chai:"^2.1.1","coffee-script":"^1.8.0",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},directories:{},dist:{shasum:"f6caca728933a850ef90661d0e17982ba47111a2",tarball:"https://registry.npmjs.org/estraverse/-/estraverse-4.1.1.tgz"},engines:{node:">=0.10.0"},gitHead:"bbcccbfe98296585e4311c8755e1d00dcd581e3c",homepage:"https://github.com/estools/estraverse",license:"BSD-2-Clause",main:"estraverse.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"},{name:"michaelficarra",email:"npm@michael.ficarra.me"},{name:"nzakas",email:"nicholas@nczconsulting.com"}],name:"estraverse",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers coffee:coffee-script/register"},version:"4.1.1"}},{}],116:[function(require,module,exports){module.exports={_args:[[{raw:"esshorten@~1.1.0",scope:null,escapedName:"esshorten",name:"esshorten",rawSpec:"~1.1.0",spec:">=1.1.0 <1.2.0",type:"range"},"/agents/node_modules/webppl/node_modules/esmangle"]],_from:"esshorten@>=1.1.0 <1.2.0",_id:"esshorten@1.1.1",_inCache:true,_location:"/esshorten",_nodeVersion:"4.1.1",_npmUser:{name:"constellation",email:"utatane.tea@gmail.com"},_npmVersion:"2.14.4",_phantomChildren:{},_requested:{raw:"esshorten@~1.1.0",scope:null,escapedName:"esshorten",name:"esshorten",rawSpec:"~1.1.0",spec:">=1.1.0 <1.2.0",type:"range"},_requiredBy:["/esmangle"],_resolved:"https://registry.npmjs.org/esshorten/-/esshorten-1.1.1.tgz",_shasum:"174f96b7cc267e46872d814e7db7c290bdff61a9",_shrinkwrap:null,_spec:"esshorten@~1.1.0",_where:"/agents/node_modules/webppl/node_modules/esmangle",bugs:{url:"https://github.com/estools/esshorten/issues"},dependencies:{escope:"~1.0.1",estraverse:"~4.1.1",esutils:"~2.0.2"},description:"Shorten (mangle) names in JavaScript code",devDependencies:{chai:"*","coffee-script":"~1.10.0","commonjs-everywhere":"~0.9.7",gulp:"~3.9.0","gulp-jshint":"~1.11.2","gulp-mocha":"~2.1.3","jshint-stylish":"~2.0.1"},directories:{lib:"./lib"},dist:{shasum:"174f96b7cc267e46872d814e7db7c290bdff61a9",tarball:"https://registry.npmjs.org/esshorten/-/esshorten-1.1.1.tgz"},engines:{node:">=0.6.0"},gitHead:"213bac0e0a321d4ab837d3ee7c93433c5cd67763",homepage:"https://github.com/estools/esshorten#readme",licenses:[{type:"BSD",url:"http://github.com/estools/esshorten/raw/master/LICENSE.BSD"}],main:"lib/esshorten.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"},{name:"michaelficarra",email:"npm@michael.ficarra.me"}],name:"esshorten",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/estools/esshorten.git"},scripts:{lint:"gulp lint",test:"gulp travis","unit-test":"gulp test"},version:"1.1.1"}},{}],117:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=null;if(visitor.fallback==="iteration"){this.__fallback=objectKeys}else if(typeof visitor.fallback==="function"){this.__fallback=visitor.fallback}this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=this.__fallback(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=this.__fallback(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":118}],118:[function(require,module,exports){module.exports={_args:[[{raw:"estraverse@^4.1.0",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"^4.1.0",spec:">=4.1.0 <5.0.0",type:"range"},"/agents/node_modules/webppl"]],_from:"estraverse@>=4.1.0 <5.0.0",_id:"estraverse@4.2.0",_inCache:true,_location:"/estraverse",_nodeVersion:"0.12.9",_npmOperationalInternal:{host:"packages-12-west.internal.npmjs.com",tmp:"tmp/estraverse-4.2.0.tgz_1457646738925_0.7118953282479197"},_npmUser:{name:"nzakas",email:"nicholas@nczconsulting.com"},_npmVersion:"2.14.9",_phantomChildren:{},_requested:{raw:"estraverse@^4.1.0",scope:null,escapedName:"estraverse",name:"estraverse",rawSpec:"^4.1.0",spec:">=4.1.0 <5.0.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-4.2.0.tgz",_shasum:"0dee3fed31fcd469618ce7342099fc1afa0bdb13",_shrinkwrap:null,_spec:"estraverse@^4.1.0",_where:"/agents/node_modules/webppl",bugs:{url:"https://github.com/estools/estraverse/issues"},dependencies:{},description:"ECMAScript JS AST traversal functions",devDependencies:{"babel-preset-es2015":"^6.3.13","babel-register":"^6.3.13",chai:"^2.1.1",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},directories:{},dist:{shasum:"0dee3fed31fcd469618ce7342099fc1afa0bdb13",tarball:"https://registry.npmjs.org/estraverse/-/estraverse-4.2.0.tgz"},engines:{node:">=0.10.0"},gitHead:"6f6a4e99653908e859c7c10d04d9518bf4844ede",homepage:"https://github.com/estools/estraverse",license:"BSD-2-Clause",main:"estraverse.js",maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"},{name:"michaelficarra",email:"npm@michael.ficarra.me"},{name:"nzakas",email:"nicholas@nczconsulting.com"}],name:"estraverse",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers js:babel-register"},version:"4.2.0"}},{}],119:[function(require,module,exports){(function(){"use strict";function isExpression(node){if(node==null){return false}switch(node.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return true}return false}function isIterationStatement(node){if(node==null){return false}switch(node.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return true}return false}function isStatement(node){if(node==null){return false}switch(node.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return true}return false}function isSourceElement(node){return isStatement(node)||node!=null&&node.type==="FunctionDeclaration"}function trailingStatement(node){switch(node.type){case"IfStatement":if(node.alternate!=null){return node.alternate}return node.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return node.body}return null}function isProblematicIfStatement(node){var current;if(node.type!=="IfStatement"){return false}if(node.alternate==null){return false}current=node.consequent;do{if(current.type==="IfStatement"){if(current.alternate==null){return true}}current=trailingStatement(current)}while(current);return false}module.exports={isExpression:isExpression,isStatement:isStatement,isIterationStatement:isIterationStatement,isSourceElement:isSourceElement,isProblematicIfStatement:isProblematicIfStatement,trailingStatement:trailingStatement}})()},{}],120:[function(require,module,exports){(function(){"use strict";var ES6Regex,ES5Regex,NON_ASCII_WHITESPACES,IDENTIFIER_START,IDENTIFIER_PART,ch;ES5Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/
};ES6Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function isDecimalDigit(ch){return 48<=ch&&ch<=57}function isHexDigit(ch){return 48<=ch&&ch<=57||97<=ch&&ch<=102||65<=ch&&ch<=70}function isOctalDigit(ch){return ch>=48&&ch<=55}NON_ASCII_WHITESPACES=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&NON_ASCII_WHITESPACES.indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function fromCodePoint(cp){if(cp<=65535){return String.fromCharCode(cp)}var cu1=String.fromCharCode(Math.floor((cp-65536)/1024)+55296);var cu2=String.fromCharCode((cp-65536)%1024+56320);return cu1+cu2}IDENTIFIER_START=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_START[ch]=ch>=97&&ch<=122||ch>=65&&ch<=90||ch===36||ch===95}IDENTIFIER_PART=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_PART[ch]=ch>=97&&ch<=122||ch>=65&&ch<=90||ch>=48&&ch<=57||ch===36||ch===95}function isIdentifierStartES5(ch){return ch<128?IDENTIFIER_START[ch]:ES5Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPartES5(ch){return ch<128?IDENTIFIER_PART[ch]:ES5Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}function isIdentifierStartES6(ch){return ch<128?IDENTIFIER_START[ch]:ES6Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPartES6(ch){return ch<128?IDENTIFIER_PART[ch]:ES6Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}module.exports={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStartES5:isIdentifierStartES5,isIdentifierPartES5:isIdentifierPartES5,isIdentifierStartES6:isIdentifierStartES6,isIdentifierPartES6:isIdentifierPartES6}})()},{}],121:[function(require,module,exports){(function(){"use strict";var code=require("./code");function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false}}function isKeywordES5(id,strict){if(!strict&&id==="yield"){return false}return isKeywordES6(id,strict)}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function isReservedWordES5(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES5(id,strict)}function isReservedWordES6(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES6(id,strict)}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isIdentifierNameES5(id){var i,iz,ch;if(id.length===0){return false}ch=id.charCodeAt(0);if(!code.isIdentifierStartES5(ch)){return false}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPartES5(ch)){return false}}return true}function decodeUtf16(lead,trail){return(lead-55296)*1024+(trail-56320)+65536}function isIdentifierNameES6(id){var i,iz,ch,lowCh,check;if(id.length===0){return false}check=code.isIdentifierStartES6;for(i=0,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(55296<=ch&&ch<=56319){++i;if(i>=iz){return false}lowCh=id.charCodeAt(i);if(!(56320<=lowCh&&lowCh<=57343)){return false}ch=decodeUtf16(ch,lowCh)}if(!check(ch)){return false}check=code.isIdentifierPartES6}return true}function isIdentifierES5(id,strict){return isIdentifierNameES5(id)&&!isReservedWordES5(id,strict)}function isIdentifierES6(id,strict){return isIdentifierNameES6(id)&&!isReservedWordES6(id,strict)}module.exports={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isReservedWordES5:isReservedWordES5,isReservedWordES6:isReservedWordES6,isRestrictedWord:isRestrictedWord,isIdentifierNameES5:isIdentifierNameES5,isIdentifierNameES6:isIdentifierNameES6,isIdentifierES5:isIdentifierES5,isIdentifierES6:isIdentifierES6}})()},{"./code":120}],122:[function(require,module,exports){(function(){"use strict";exports.ast=require("./ast");exports.code=require("./code");exports.keyword=require("./keyword")})()},{"./ast":119,"./code":120,"./keyword":121}],123:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{dup:1,pseudomap:126,util:339,yallist:149}],124:[function(require,module,exports){(function(global){var performance=global.performance||{};var present=function(){var names=["now","webkitNow","msNow","mozNow","oNow"];while(names.length){var name=names.shift();if(name in performance){return performance[name].bind(performance)}}var dateNow=Date.now||function(){return(new Date).getTime()};var navigationStart=(performance.timing||{}).navigationStart||dateNow();return function(){return dateNow()-navigationStart}}();present.performanceNow=performance.now;present.noConflict=function(){performance.now=present.performanceNow};present.conflict=function(){performance.now=present};present.conflict();module.exports=present}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],125:[function(require,module,exports){module.exports=PriorityQueue;function PriorityQueue(comparator){this._comparator=comparator||PriorityQueue.DEFAULT_COMPARATOR;this._elements=[]}PriorityQueue.DEFAULT_COMPARATOR=function(a,b){if(typeof a==="number"&&typeof b==="number"){return a-b}else{a=a.toString();b=b.toString();if(a==b)return 0;return a>b?1:-1}};PriorityQueue.prototype.isEmpty=function(){return this.size()===0};PriorityQueue.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]};PriorityQueue.prototype.deq=function(){var first=this.peek();var last=this._elements.pop();var size=this.size();if(size===0)return first;this._elements[0]=last;var current=0;while(current<size){var largest=current;var left=2*current+1;var right=2*current+2;if(left<size&&this._compare(left,largest)>=0){largest=left}if(right<size&&this._compare(right,largest)>=0){largest=right}if(largest===current)break;this._swap(largest,current);current=largest}return first};PriorityQueue.prototype.enq=function(element){var size=this._elements.push(element);var current=size-1;while(current>0){var parent=Math.floor((current-1)/2);if(this._compare(current,parent)<=0)break;this._swap(parent,current);current=parent}return size};PriorityQueue.prototype.size=function(){return this._elements.length};PriorityQueue.prototype.forEach=function(fn){return this._elements.forEach(fn)};PriorityQueue.prototype._compare=function(a,b){return this._comparator(this._elements[a],this._elements[b])};PriorityQueue.prototype._swap=function(a,b){var aux=this._elements[a];this._elements[a]=this._elements[b];this._elements[b]=aux}},{}],126:[function(require,module,exports){arguments[4][3][0].apply(exports,arguments)},{"./pseudomap":127,_process:306,dup:3}],127:[function(require,module,exports){arguments[4][4][0].apply(exports,arguments)},{dup:4}],128:[function(require,module,exports){var alea=require("./lib/alea");var xor128=require("./lib/xor128");var xorwow=require("./lib/xorwow");var xorshift7=require("./lib/xorshift7");var xor4096=require("./lib/xor4096");var tychei=require("./lib/tychei");var sr=require("./seedrandom");sr.alea=alea;sr.xor128=xor128;sr.xorwow=xorwow;sr.xorshift7=xorshift7;sr.xor4096=xor4096;sr.tychei=tychei;module.exports=sr},{"./lib/alea":129,"./lib/tychei":130,"./lib/xor128":131,"./lib/xor4096":132,"./lib/xorshift7":133,"./lib/xorwow":134,"./seedrandom":135}],129:[function(require,module,exports){(function(global,module,define){function Alea(seed){var me=this,mash=Mash();me.next=function(){var t=2091639*me.s0+me.c*2.3283064365386963e-10;me.s0=me.s1;me.s1=me.s2;return me.s2=t-(me.c=t|0)};me.c=1;me.s0=mash(" ");me.s1=mash(" ");me.s2=mash(" ");me.s0-=mash(seed);if(me.s0<0){me.s0+=1}me.s1-=mash(seed);if(me.s1<0){me.s1+=1}me.s2-=mash(seed);if(me.s2<0){me.s2+=1}mash=null}function copy(f,t){t.c=f.c;t.s0=f.s0;t.s1=f.s1;t.s2=f.s2;return t}function impl(seed,opts){var xg=new Alea(seed),state=opts&&opts.state,prng=xg.next;prng.int32=function(){return xg.next()*4294967296|0};prng.double=function(){return prng()+(prng()*2097152|0)*1.1102230246251565e-16};prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}function Mash(){var n=4022871197;var mash=function(data){data=data.toString();for(var i=0;i<data.length;i++){n+=data.charCodeAt(i);var h=.02519603282416938*n;n=h>>>0;h-=n;h*=n;n=h>>>0;h-=n;n+=h*4294967296}return(n>>>0)*2.3283064365386963e-10};return mash}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.alea=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],130:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var b=me.b,c=me.c,d=me.d,a=me.a;b=b<<25^b>>>7^c;c=c-d|0;d=d<<24^d>>>8^a;a=a-b|0;me.b=b=b<<20^b>>>12^c;me.c=c=c-d|0;me.d=d<<16^c>>>16^a;return me.a=a-b|0};me.a=0;me.b=0;me.c=2654435769|0;me.d=1367130551;if(seed===Math.floor(seed)){me.a=seed/4294967296|0;me.b=seed|0}else{strseed+=seed}for(var k=0;k<strseed.length+20;k++){me.b^=strseed.charCodeAt(k)|0;me.next()}}function copy(f,t){t.a=f.a;t.b=f.b;t.c=f.c;t.d=f.d;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.tychei=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],131:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.x=0;me.y=0;me.z=0;me.w=0;me.next=function(){var t=me.x^me.x<<11;me.x=me.y;me.y=me.z;me.z=me.w;return me.w^=me.w>>>19^t^t>>>8};if(seed===(seed|0)){me.x=seed}else{strseed+=seed}for(var k=0;k<strseed.length+64;k++){me.x^=strseed.charCodeAt(k)|0;me.next()}}function copy(f,t){t.x=f.x;t.y=f.y;t.z=f.z;t.w=f.w;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xor128=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],132:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var w=me.w,X=me.X,i=me.i,t,v;me.w=w=w+1640531527|0;v=X[i+34&127];t=X[i=i+1&127];v^=v<<13;t^=t<<17;v^=v>>>15;t^=t>>>12;v=X[i]=v^t;me.i=i;return v+(w^w>>>16)|0};function init(me,seed){var t,v,i,j,w,X=[],limit=128;if(seed===(seed|0)){v=seed;seed=null}else{seed=seed+"\x00";v=0;limit=Math.max(limit,seed.length)}for(i=0,j=-32;j<limit;++j){if(seed)v^=seed.charCodeAt((j+32)%seed.length);if(j===0)w=v;v^=v<<10;v^=v>>>15;v^=v<<4;v^=v>>>13;if(j>=0){w=w+1640531527|0;t=X[j&127]^=v+w;i=0==t?i+1:0}}if(i>=128){X[(seed&&seed.length||0)&127]=-1}i=127;for(j=4*128;j>0;--j){v=X[i+34&127];t=X[i=i+1&127];v^=v<<13;t^=t<<17;v^=v>>>15;t^=t>>>12;X[i]=v^t}me.w=w;me.X=X;me.i=i}init(me,seed)}function copy(f,t){t.i=f.i;t.w=f.w;t.X=f.X.slice();return t}function impl(seed,opts){if(seed==null)seed=+new Date;var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(state.X)copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xor4096=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],133:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var X=me.x,i=me.i,t,v,w;t=X[i];t^=t>>>7;v=t^t<<24;t=X[i+1&7];v^=t^t>>>10;t=X[i+3&7];v^=t^t>>>3;t=X[i+4&7];v^=t^t<<7;t=X[i+7&7];t=t^t<<13;v^=t^t<<9;X[i]=v;me.i=i+1&7;return v};function init(me,seed){var j,w,X=[];if(seed===(seed|0)){w=X[0]=seed}else{seed=""+seed;for(j=0;j<seed.length;++j){X[j&7]=X[j&7]<<15^seed.charCodeAt(j)+X[j+1&7]<<13}}while(X.length<8)X.push(0);for(j=0;j<8&&X[j]===0;++j);if(j==8)w=X[7]=-1;else w=X[j];me.x=X;me.i=0;for(j=256;j>0;--j){me.next()}}init(me,seed)}function copy(f,t){t.x=f.x.slice();t.i=f.i;return t}function impl(seed,opts){if(seed==null)seed=+new Date;var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(state.x)copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xorshift7=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],134:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var t=me.x^me.x>>>2;me.x=me.y;me.y=me.z;me.z=me.w;me.w=me.v;return(me.d=me.d+362437|0)+(me.v=me.v^me.v<<4^(t^t<<1))|0};me.x=0;me.y=0;me.z=0;me.w=0;me.v=0;if(seed===(seed|0)){me.x=seed}else{strseed+=seed}for(var k=0;k<strseed.length+64;k++){me.x^=strseed.charCodeAt(k)|0;if(k==strseed.length){me.d=me.x<<10^me.x>>>4}me.next()}}function copy(f,t){t.x=f.x;t.y=f.y;t.z=f.z;t.w=f.w;t.v=f.v;t.d=f.d;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xorwow=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],135:[function(require,module,exports){(function(pool,math){var global=this,width=256,chunks=6,digits=52,rngname="random",startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,nodecrypto;function seedrandom(seed,options,callback){var key=[];options=options==true?{entropy:true}:options||{};var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:seed==null?autoseed():seed,3),key);var arc4=new ARC4(key);var prng=function(){var n=arc4.g(chunks),d=startdenom,x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d};prng.int32=function(){return arc4.g(4)|0};prng.quick=function(){return arc4.g(4)/4294967296};prng.double=prng;mixkey(tostring(arc4.S),pool);return(options.pass||callback||function(prng,seed,is_math_call,state){if(state){if(state.S){copy(state,arc4)}prng.state=function(){return copy(arc4,{})}}if(is_math_call){math[rngname]=prng;return seed}else return prng})(prng,shortseed,"global"in options?options.global:this==math,options.state)}math["seed"+rngname]=seedrandom;function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];if(!keylen){key=[keylen++]}while(i<width){s[i]=i++}for(i=0;i<width;i++){s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])];s[j]=t}(me.g=function(count){var t,r=0,i=me.i,j=me.j,s=me.S;while(count--){t=s[i=mask&i+1];r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)]}me.i=i;me.j=j;return r})(width)}function copy(f,t){t.i=f.i;t.j=f.j;t.S=f.S.slice();return t}function flatten(obj,depth){var result=[],typ=typeof obj,prop;if(depth&&typ=="object"){for(prop in obj){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}return result.length?result:typ=="string"?obj:obj+"\x00"}function mixkey(seed,key){var stringseed=seed+"",smear,j=0;while(j<stringseed.length){key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++)}return tostring(key)}function autoseed(){try{if(nodecrypto){return tostring(nodecrypto.randomBytes(width))}var out=new Uint8Array(width);(global.crypto||global.msCrypto).getRandomValues(out);return tostring(out)}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date,global,plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}mixkey(math.random(),pool);if(typeof module=="object"&&module.exports){module.exports=seedrandom;try{nodecrypto=require("crypto")}catch(ex){}}else if(typeof define=="function"&&define.amd){define(function(){return seedrandom;

})}})([],Math)},{crypto:255}],136:[function(require,module,exports){var util=require("./util");var has=Object.prototype.hasOwnProperty;function ArraySet(){this._array=[];this._set=Object.create(null)}ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet;for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates)}return set};ArraySet.prototype.size=function ArraySet_size(){return Object.getOwnPropertyNames(this._set).length};ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var sStr=util.toSetString(aStr);var isDuplicate=has.call(this._set,sStr);var idx=this._array.length;if(!isDuplicate||aAllowDuplicates){this._array.push(aStr)}if(!isDuplicate){this._set[sStr]=idx}};ArraySet.prototype.has=function ArraySet_has(aStr){var sStr=util.toSetString(aStr);return has.call(this._set,sStr)};ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){var sStr=util.toSetString(aStr);if(has.call(this._set,sStr)){return this._set[sStr]}throw new Error('"'+aStr+'" is not in the set.')};ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<this._array.length){return this._array[aIdx]}throw new Error("No element indexed by "+aIdx)};ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()};exports.ArraySet=ArraySet},{"./util":145}],137:[function(require,module,exports){var base64=require("./base64");var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr,aIndex,aOutParam){var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(aIndex>=strLen){throw new Error("Expected more digits in base 64 VLQ value.")}digit=base64.decode(aStr.charCodeAt(aIndex++));if(digit===-1){throw new Error("Invalid base64 digit: "+aStr.charAt(aIndex-1))}continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aIndex}},{"./base64":138}],138:[function(require,module,exports){var intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");exports.encode=function(number){if(0<=number&&number<intToCharMap.length){return intToCharMap[number]}throw new TypeError("Must be between 0 and 63: "+number)};exports.decode=function(charCode){var bigA=65;var bigZ=90;var littleA=97;var littleZ=122;var zero=48;var nine=57;var plus=43;var slash=47;var littleOffset=26;var numberOffset=52;if(bigA<=charCode&&charCode<=bigZ){return charCode-bigA}if(littleA<=charCode&&charCode<=littleZ){return charCode-littleA+littleOffset}if(zero<=charCode&&charCode<=nine){return charCode-zero+numberOffset}if(charCode==plus){return 62}if(charCode==slash){return 63}return-1}},{}],139:[function(require,module,exports){exports.GREATEST_LOWER_BOUND=1;exports.LEAST_UPPER_BOUND=2;function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){return mid}else if(cmp>0){if(aHigh-mid>1){return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return aHigh<aHaystack.length?aHigh:-1}else{return mid}}else{if(mid-aLow>1){return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return mid}else{return aLow<0?-1:aLow}}}exports.search=function search(aNeedle,aHaystack,aCompare,aBias){if(aHaystack.length===0){return-1}var index=recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports.GREATEST_LOWER_BOUND);if(index<0){return-1}while(index-1>=0){if(aCompare(aHaystack[index],aHaystack[index-1],true)!==0){break}--index}return index}},{}],140:[function(require,module,exports){var util=require("./util");function generatedPositionAfter(mappingA,mappingB){var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0}function MappingList(){this._array=[];this._sorted=true;this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){this._array.forEach(aCallback,aThisArg)};MappingList.prototype.add=function MappingList_add(aMapping){if(generatedPositionAfter(this._last,aMapping)){this._last=aMapping;this._array.push(aMapping)}else{this._sorted=false;this._array.push(aMapping)}};MappingList.prototype.toArray=function MappingList_toArray(){if(!this._sorted){this._array.sort(util.compareByGeneratedPositionsInflated);this._sorted=true}return this._array};exports.MappingList=MappingList},{"./util":145}],141:[function(require,module,exports){function swap(ary,x,y){var temp=ary[x];ary[x]=ary[y];ary[y]=temp}function randomIntInRange(low,high){return Math.round(low+Math.random()*(high-low))}function doQuickSort(ary,comparator,p,r){if(p<r){var pivotIndex=randomIntInRange(p,r);var i=p-1;swap(ary,pivotIndex,r);var pivot=ary[r];for(var j=p;j<r;j++){if(comparator(ary[j],pivot)<=0){i+=1;swap(ary,i,j)}}swap(ary,i+1,j);var q=i+1;doQuickSort(ary,comparator,p,q-1);doQuickSort(ary,comparator,q+1,r)}}exports.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1)}},{}],142:[function(require,module,exports){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");var quickSort=require("./quick-sort").quickSort;function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap):new BasicSourceMapConsumer(sourceMap)}SourceMapConsumer.fromSourceMap=function(aSourceMap){return BasicSourceMapConsumer.fromSourceMap(aSourceMap)};SourceMapConsumer.prototype._version=3;SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{get:function(){if(!this.__generatedMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{get:function(){if(!this.__originalMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===";"||c===","};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings")};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:this._sources.at(mapping.source);if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:this._names.at(mapping.name)}},this).forEach(aCallback,context)};SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util.getArg(aArgs,"line");var needle={source:util.getArg(aArgs,"source"),originalLine:line,originalColumn:util.getArg(aArgs,"column",0)};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}if(!this._sources.has(needle.source)){return[]}needle.source=this._sources.indexOf(needle.source);var mappings=[];var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=this._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}else{var originalColumn=mapping.originalColumn;while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}}return mappings};exports.SourceMapConsumer=SourceMapConsumer;function BasicSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}sources=sources.map(String).map(util.normalize).map(function(source){return sourceRoot&&util.isAbsolute(sourceRoot)&&util.isAbsolute(source)?util.relative(sourceRoot,source):source});this._names=ArraySet.fromArray(names.map(String),true);this._sources=ArraySet.fromArray(sources,true);this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping;destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name)}destOriginalMappings.push(destMapping)}destGeneratedMappings.push(destMapping)}quickSort(smc.__originalMappings,util.compareByOriginalPositions);return smc};BasicSourceMapConsumer.prototype._version=3;Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot!=null?util.join(this.sourceRoot,s):s},this)}});function Mapping(){this.generatedLine=0;this.generatedColumn=0;this.source=null;this.originalLine=null;this.originalColumn=null;this.name=null}BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===";"){generatedLine++;index++;previousGeneratedColumn=0}else if(aStr.charAt(index)===","){index++}else{mapping=new Mapping;mapping.generatedLine=generatedLine;for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length}else{segment=[];while(index<end){base64VLQ.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value)}if(segment.length===2){throw new Error("Found a source, but no line and column")}if(segment.length===3){throw new Error("Found a source and line, but no column")}cachedSegments[str]=segment}mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){mapping.source=previousSource+segment[1];previousSource+=segment[1];mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){mapping.name=previousName+segment[4];previousName+=segment[4]}}generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){originalMappings.push(mapping)}}}quickSort(generatedMappings,util.compareByGeneratedPositionsDeflated);this.__generatedMappings=generatedMappings;quickSort(originalMappings,util.compareByOriginalPositions);this.__originalMappings=originalMappings};BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator,aBias)};BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=Infinity}};BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositionsDeflated,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);if(source!==null){source=this._sources.at(source);if(this.sourceRoot!=null){source=util.join(this.sourceRoot,source)}}var name=util.getArg(mapping,"name",null);if(name!==null){name=this._names.at(name)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:name}}}return{source:null,line:null,column:null,name:null}};BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!this.sourcesContent){return false}return this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(sc){return sc==null})};BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!this.sourcesContent){return null}if(this.sourceRoot!=null){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+aSource)){return this.sourcesContent[this._sources.indexOf("/"+aSource)]}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util.getArg(aArgs,"source");if(this.sourceRoot!=null){source=util.relative(this.sourceRoot,source)}if(!this._sources.has(source)){return{line:null,column:null,lastColumn:null}}source=this._sources.indexOf(source);var needle={source:source,originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._originalMappings[index];if(mapping.source===needle.source){return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}}}return{line:null,column:null,lastColumn:null}};exports.BasicSourceMapConsumer=BasicSourceMapConsumer;function IndexedSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sections=util.getArg(sourceMap,"sections");if(version!=this._version){throw new Error("Unsupported version: "+version)}this._sources=new ArraySet;this._names=new ArraySet;var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url){throw new Error("Support for url field in sections not implemented.")}var offset=util.getArg(s,"offset");var offsetLine=util.getArg(offset,"line");var offsetColumn=util.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.")}lastOffset=offset;return{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,"map"))}})}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;IndexedSourceMapConsumer.prototype._version=3;Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){var sources=[];for(var i=0;i<this._sections.length;i++){for(var j=0;j<this._sections[i].consumer.sources.length;j++){sources.push(this._sections[i].consumer.sources[j])}}return sources}});IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp}return needle.generatedColumn-section.generatedOffset.generatedColumn});var section=this._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null}}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias})};IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return this._sections.every(function(s){return s.consumer.hasContentsOfAllSources()})};IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(section.consumer.sources.indexOf(util.getArg(aArgs,"source"))===-1){continue}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret}}return{line:null,column:null}};IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){this.__generatedMappings=[];this.__originalMappings=[];for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);if(section.consumer.sourceRoot!==null){source=util.join(section.consumer.sourceRoot,source)}this._sources.add(source);source=this._sources.indexOf(source);var name=section.consumer._names.at(mapping.name);this._names.add(name);name=this._names.indexOf(name);var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};this.__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){this.__originalMappings.push(adjustedMapping)}}}quickSort(this.__generatedMappings,util.compareByGeneratedPositionsDeflated);quickSort(this.__originalMappings,util.compareByOriginalPositions)};exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer},{"./array-set":136,"./base64-vlq":137,"./binary-search":139,"./quick-sort":141,"./util":145}],143:[function(require,module,exports){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;var MappingList=require("./mapping-list").MappingList;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,"file",null);this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._skipValidation=util.getArg(aArgs,"skipValidation",false);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=new MappingList;this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);if(!this._skipValidation){this._validateMapping(generated,original,source,name)}if(source!=null){source=String(source);if(!this._sources.has(source)){this._sources.add(source)}}if(name!=null){name=String(name);if(!this._names.has(name)){this._names.add(name)}}this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents=Object.create(null)}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var next;var mapping;var nameIdx;var sourceIdx;var mappings=this._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next="";if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue}next+=","}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=this._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=this._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx}}result+=next}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON())};exports.SourceMapGenerator=SourceMapGenerator},{"./array-set":136,"./base64-vlq":137,"./mapping-list":140,"./util":145}],144:[function(require,module,exports){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");var REGEX_NEWLINE=/(\r?\n)/;var NEWLINE_CODE=10;var isSourceNode="$$$isSourceNode$$$";function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;this[isSourceNode]=true;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var shiftNextLine=function(){var lineContents=remainingLines.shift();var newLine=remainingLines.shift()||"";return lineContents+newLine};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[0];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;

addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLines.length>0){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.join(""))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk[isSourceNode]){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i][isSourceNode]){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column++}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode},{"./source-map-generator":143,"./util":145}],145:[function(require,module,exports){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":"}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=exports.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1)}else if(part===".."){up++}else if(up>0){if(part===""){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":"."}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===""){aRoot="."}if(aPath===""){aPath="."}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/"}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;exports.isAbsolute=function(aPath){return aPath.charAt(0)==="/"||!!aPath.match(urlRegexp)};function relative(aRoot,aPath){if(aRoot===""){aRoot="."}aRoot=aRoot.replace(/\/$/,"");var level=0;while(aPath.indexOf(aRoot+"/")!==0){var index=aRoot.lastIndexOf("/");if(index<0){return aPath}aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath}++level}return Array(level+1).join("../")+aPath.substr(aRoot.length+1)}exports.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!("__proto__"in obj)}();function identity(s){return s}function toSetString(aStr){if(isProtoString(aStr)){return"$"+aStr}return aStr}exports.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1)}return aStr}exports.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false}var length=s.length;if(length<9){return false}if(s.charCodeAt(length-1)!==95||s.charCodeAt(length-2)!==95||s.charCodeAt(length-3)!==111||s.charCodeAt(length-4)!==116||s.charCodeAt(length-5)!==111||s.charCodeAt(length-6)!==114||s.charCodeAt(length-7)!==112||s.charCodeAt(length-8)!==95||s.charCodeAt(length-9)!==95){return false}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36){return false}}return true}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp}cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0}if(aStr1>aStr2){return 1}return-1}function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated},{}],146:[function(require,module,exports){exports.SourceMapGenerator=require("./lib/source-map-generator").SourceMapGenerator;exports.SourceMapConsumer=require("./lib/source-map-consumer").SourceMapConsumer;exports.SourceNode=require("./lib/source-node").SourceNode},{"./lib/source-map-consumer":142,"./lib/source-map-generator":143,"./lib/source-node":144}],147:[function(require,module,exports){exports.get=function(belowFn){var oldLimit=Error.stackTraceLimit;Error.stackTraceLimit=Infinity;var dummyObject={};var v8Handler=Error.prepareStackTrace;Error.prepareStackTrace=function(dummyObject,v8StackTrace){return v8StackTrace};Error.captureStackTrace(dummyObject,belowFn||exports.get);var v8StackTrace=dummyObject.stack;Error.prepareStackTrace=v8Handler;Error.stackTraceLimit=oldLimit;return v8StackTrace};exports.parse=function(err){if(!err.stack){return[]}var self=this;var lines=err.stack.split("\n").slice(1);return lines.map(function(line){if(line.match(/^\s*[-]{4,}$/)){return self._createParsedCallSite({fileName:line,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,"native":null})}var lineMatch=line.match(/at (?:(.+)\s+)?\(?(?:(.+?):(\d+):(\d+)|([^)]+))\)?/);if(!lineMatch){return}var object=null;var method=null;var functionName=null;var typeName=null;var methodName=null;var isNative=lineMatch[5]==="native";if(lineMatch[1]){var methodMatch=lineMatch[1].match(/([^\.]+)(?:\.(.+))?/);object=methodMatch[1];method=methodMatch[2];functionName=lineMatch[1];typeName="Object"}if(method){typeName=object;methodName=method}if(method==="<anonymous>"){methodName=null;functionName=""}var properties={fileName:lineMatch[2]||null,lineNumber:parseInt(lineMatch[3],10)||null,functionName:functionName,typeName:typeName,methodName:methodName,columnNumber:parseInt(lineMatch[4],10)||null,"native":isNative};return self._createParsedCallSite(properties)}).filter(function(callSite){return!!callSite})};exports._createParsedCallSite=function(properties){var methods={};for(var property in properties){var prefix="get";if(property==="native"){prefix="is"}var method=prefix+property.substr(0,1).toUpperCase()+property.substr(1);(function(property){methods[method]=function(){return properties[property]}})(property)}var callSite=Object.create(methods);for(var property in properties){callSite[property]=properties[property]}return callSite}},{}],148:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;

if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}],149:[function(require,module,exports){module.exports=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach(function(item){self.push(item)})}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i])}}return self}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list")}var next=node.next;var prev=node.prev;if(next){next.prev=prev}if(prev){prev.next=next}if(node===this.head){this.head=next}if(node===this.tail){this.tail=prev}node.list.length--;node.next=null;node.prev=null;node.list=null};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return}if(node.list){node.list.removeNode(node)}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node}this.head=node;if(!this.tail){this.tail=node}this.length++};Yallist.prototype.pushNode=function(node){if(node===this.tail){return}if(node.list){node.list.removeNode(node)}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node}this.tail=node;if(!this.head){this.head=node}this.length++};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i])}return this.length};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i])}return this.length};Yallist.prototype.pop=function(){if(!this.tail)return undefined;var res=this.tail.value;this.tail=this.tail.prev;this.tail.next=null;this.length--;return res};Yallist.prototype.shift=function(){if(!this.head)return undefined;var res=this.head.value;this.head=this.head.next;this.head.prev=null;this.length--;return res};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){walker=walker.next}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){walker=walker.prev}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next}return res};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev}return res};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial}else if(this.head){walker=this.head.next;acc=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next}return acc};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial}else if(this.tail){walker=this.tail.prev;acc=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev}return acc};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next}return arr};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev}return arr};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value)}return ret};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value)}return ret};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p}this.head=tail;this.tail=head;return this};function push(self,item){self.tail=new Node(item,self.tail,null,self);if(!self.head){self.head=self.tail}self.length++}function unshift(self,item){self.head=new Node(item,null,self.head,self);if(!self.tail){self.tail=self.head}self.length++}function Node(value,prev,next,list){if(!(this instanceof Node)){return new Node(value,prev,next,list)}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev}else{this.prev=null}if(next){next.prev=this;this.next=next}else{this.next=null}}},{}],150:[function(require,module,exports){"use strict";var _=require("underscore");var ad=require("adnn/ad");var Tensor=require("./tensor");var special=require("./math/special");var valueRec=function(x){if(ad.isLifted(x)){return x.x}else if(_.isArray(x)){return _.map(x,valueRec)}else if(x instanceof Tensor){return x}else if(_.isObject(x)&&!_.isFunction(x)){var proto=Object.getPrototypeOf(x);var y=_.mapObject(x,valueRec);return _.extendOwn(Object.create(proto),y);return y}else{return x}};ad.valueRec=valueRec;ad.tensor.logGamma=ad.newUnaryFunction({OutputType:Tensor,name:"logGamma",forward:function(a){return a.logGamma()},backward:function(a){var n=a.x.length;while(n--){a.dx.data[n]+=special.digamma(a.x.data[n])*this.dx.data[n]}}});ad.scalar.logGamma=ad.newUnaryFunction({OutputType:Number,name:"logGamma",forward:function(a){return special.logGamma(a)},backward:function(a){return a.dx+=special.digamma(a.x)*this.dx}});ad.scalar.plus=function(x){return ad.scalar.add(0,x)};ad.tensor["__Tensor"]=Tensor;module.exports=ad},{"./math/special":182,"./tensor":186,"adnn/ad":13,underscore:148}],151:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var util=require("../util");var ad=require("../ad");var dists=require("../dists");var CountAggregator=function(onlyMAP){this.onlyMAP=onlyMAP;this.max={value:undefined,score:-Infinity};this.samples=[]};CountAggregator.prototype.add=function(value,score){if(this.onlyMAP){assert.ok(score!==undefined,"A score is required to compute the MAP.");if(score>this.max.score){this.max.value=value;this.max.score=score}}else{var obj=score===undefined?{value:value}:{value:value,score:score};this.samples.push(obj)}};CountAggregator.prototype.toDist=function(){if(this.onlyMAP){this.samples=[this.max]}return new dists.SampleBasedMarginal({samples:this.samples,numSamples:this.samples.length})};module.exports=CountAggregator},{"../ad":150,"../dists":154,"../util":200,assert:216,underscore:148}],152:[function(require,module,exports){"use strict";var ad=require("../ad.js");var assert=require("assert");var _=require("underscore");var dists=require("../dists");var util=require("../util");function logsumexp(a,b){assert.ok(ad.scalar.pneq(a,ad.scalar.neg(Infinity))||ad.scalar.pneq(b,ad.scalar.neg(Infinity)));var m=ad.scalar.max(a,b);return ad.scalar.add(ad.scalar.log(ad.scalar.add(ad.scalar.exp(ad.scalar.sub(a,m)),ad.scalar.exp(ad.scalar.sub(b,m)))),m)}var ScoreAggregator=function(){this.dist={}};Object.defineProperties(ScoreAggregator.prototype,{size:{get:function(){return _.size(this.dist)}}});ScoreAggregator.prototype.add=function(value,score){if(ad.scalar.peq(score,ad.scalar.neg(Infinity))){return}var key=util.serialize(value);if(ad.scalar.peq(this.dist[key],undefined)){this.dist[key]={score:ad.scalar.neg(Infinity),val:value}}this.dist[key].score=logsumexp(this.dist[key].score,score)};function normalize(dist){var logNorm=_.reduce(dist,function(acc,obj){return logsumexp(acc,obj.score)},ad.scalar.neg(Infinity));return _.mapObject(dist,function(obj){return{val:obj.val,prob:ad.scalar.exp(ad.scalar.sub(obj.score,logNorm))}})}ScoreAggregator.prototype.toDist=function(){return new dists.Marginal({dist:normalize(this.dist)})};module.exports=ScoreAggregator},{"../ad.js":150,"../dists":154,"../util":200,assert:216,underscore:148}],153:[function(require,module,exports){(function(global){"use strict";var _=require("underscore");var esprima=require("esprima");var escodegen=require("escodegen");var webppl=require("./main");var optimize=require("./transforms/optimize").optimize;var naming=require("./transforms/naming").naming;var thunkify=require("./syntax").thunkify;var cps=require("./transforms/cps").cps;var errors=require("./errors/browser");var util=require("./util");var version="v0.9.6-6bd2c98";var packages=[{name:"webppl-timeit",js:{identifier:"webpplTimeit",path:require("/agents/node_modules/webppl-timeit")},headers:[],wppl:[{code:"var timeit = function(thunk) {\n  var t0 = webpplTimeit.now();\n  var value = thunk();\n  var t1 = webpplTimeit.now();\n  return {\n    value: value,\n    runtimeInMilliseconds: t1 - t0\n  }\n}\n\nvar sleep = function(ms) {\n  webpplTimeit.sleep(ms);\n}\n",filename:"webppl-timeit/src/timeit.wppl"}],version:"v0.3.0-6bd2c98"},{name:"webppl-dp",js:{identifier:"webpplDp",path:require("/agents/node_modules/webppl-dp")},headers:[],wppl:[{code:"var dp = {\n  cache: webpplDp.cache\n};\n",filename:"webppl-dp/src/dp.wppl"}],version:"v0.1.1-6bd2c98"},{name:"webppl-agents",js:{identifier:"webpplAgents",path:require("/agents/node_modules/webppl-agents")},headers:[],wppl:[{code:"var GridWorld = webpplAgents; // reference to the exports of gridworld-viz.js\n\n// for non-browser use of viz functions\n// var viz = webpplAgents;\n// var print = function(x){\n//   return console.log(JSON.stringify(x));\n// };\n\n\n\n\n// General utilities\nvar extend = function(base, ext){\n  return _.extend({}, base, ext);\n};\n\nvar hasProperties = function(object, listProperties){\n  assert.ok( _.isObject(object) && _.isArray(listProperties), 'fail hasProperties');\n  return _.all( map( \n    function(property){ \n      return _.has(object, property);\n    }, listProperties));\n};\n\nvar ash = function(){assert.ok(0,'assert halt');};\n\nvar downToOne = function(n){\n  if (n==0){return [];}\n  else {return [n].concat(downToOne(n-1));}\n};\n\nvar arraysEqual = function(xs, ys){\n  return JSON.stringify(xs) === JSON.stringify(ys);\n};\n\nvar argMax = function(f, ar){\n  return maxWith(f, ar)[0]\n};\n\n\n\n// Helpers for displaying Dists\nvar printDist = function(x,k) {\n  var distValues = sort(x.support(), undefined, function(v){return -x.score(v);});\n  var distValues = typeof(k)=='undefined' ? distValues : distValues.slice(0,k);\n  map(\n    function(v){\n      var prob = Math.exp(x.score(v));\n      if (prob > 0.0){\n        console.log(JSON.stringify(v) + ': ' + prob.toFixed(5));\n      }\n    },\n    distValues);\n};\n\nvar printTopK = function(dist,k){\n  var distValues = sort(dist.support(), undefined, function(v){return -dist.score(v);});\n  map(\n    function(v){\n      var prob = Math.exp(dist.score(v));\n      if (prob > 0.0){\n        console.log(JSON.stringify(v) + ': ' + prob.toFixed(5));\n      }\n    },\n    distValues.slice(0,k));\n};\n\n\nvar getMarginal = function(dist,key){\n  return Infer({ method: 'enumerate' }, function(){\n    return sample(dist)[key];\n  });\n};\n\nvar getMarginalObject = function(dist,key){\n  return Infer({ method: 'enumerate' }, function(){\n    var s = sample(dist);\n    var keys = _.keys(s);\n    var omitKeys = filter(function(el){\n      return el !== key;}, keys);\n    return _.omit(s,omitKeys);\n  });\n};\n\n// Helper for displaying marginals of array of keys\nvar displayMarginals = function(dist, keys){\n  map( function(key){\n    console.log('\\n Marginal for : ', key);\n    printDist(getMarginal(dist, key) );\n  }, keys);\n};\n\n\n",filename:"webppl-agents/src/utils/generalUtils.wppl"},{code:"// --------------------------------------------------------------------\n// Optimal MDP agent\n\nvar makeMDPAgentOptimal = function(params, world) {\n  // *params* should be an object containing *utility*, a utility function, and\n  // *alpha*, which regulates the agent's softmax noise.\n  map(function(s){assert.ok(params.hasOwnProperty(s),'makeMDPAgent args');}, \n      ['utility','alpha']);\n  \n  var stateToActions = world.stateToActions;\n  var transition = world.transition;\n  var utility = params.utility;\n  var alpha = params.alpha;\n\n  var act = dp.cache( \n    function(state){\n      return Infer({ method: 'enumerate' }, function(){\n        var action = uniformDraw(stateToActions(state));\n        var eu = expectedUtility(state, action);\n        factor(alpha * eu);\n        return action;\n      });      \n    });\n  \n  var expectedUtility = dp.cache(\n    function(state, action){\n      var u = utility(state, action);\n      if (state.terminateAfterAction){\n        return u; \n      } else {                     \n        return u + expectation( Infer({ method: 'enumerate' }, function(){\n          var nextState = transition(state, action); \n          var nextAction = sample(act(nextState));\n          return expectedUtility(nextState, nextAction);  \n        }));\n      }                      \n    });\n  \n  return {\n    params : params,\n    expectedUtility : expectedUtility,\n    act: act\n  };\n};\n\n\nvar simulateMDPAgentOptimal = function(startState, world, agent, outputType) {\n  // if outputType is undefined, default to states\n  var act = agent.act;\n  var transition = world.transition;\n  var outputType = outputType ? outputType : 'states';\n\n  var selectOutput = function(state, action) {\n    var table = {states: state,\n		 actions: action,\n		 stateAction: [state, action]};\n    return table[outputType];\n  };\n\n  var sampleSequence = function(state) {\n    var action = sample(act(state));\n    var nextState = transition(state, action);\n    var out = selectOutput(state, action);\n    return state.terminateAfterAction ? [out]\n      : [out].concat(sampleSequence(nextState));\n  };\n  return sampleSequence(startState);\n};\n\n\n// --------------------------------------------------------------------\n// Hyperbolic discounting agent\n\n\nvar makeMDPAgentHyperbolic = function (params, world) {\n  assert.ok(hasProperties(params, ['utility','alpha','discount','sophisticatedOrNaive']),\n            'makeMDPAgentHyperbolic params');\n  \n  var stateToActions = world.stateToActions;\n  var transition = world.transition;\n  var utility = params.utility;\n\n  // we can specify a discount function so that our 'hyperbolic' agent can\n  // actually be an exponential discounter (or some other kind of discounter)\n  var paramsDiscountFunction = params.discountFunction;\n\n  var discountFunction = (\n    paramsDiscountFunction ||\n    function(delay){\n      return 1/(1 + params.discount*delay);\n    });\n\n  var isNaive = params.sophisticatedOrNaive=='naive';\n  \n  var act = dp.cache( \n    function(state, delay){\n      var delay = delay ? delay : 0; //make sure delay is never 'undefined'\n\n      return Infer({ method: 'enumerate' }, function(){\n        var action = uniformDraw(stateToActions(state));\n        var eu = expectedUtility(state, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });      \n    });\n  \n  var expectedUtility = dp.cache(\n    function(state, action, delay){\n      var u = discountFunction(delay) * utility(state, action);\n      assert.ok(!_.isUndefined(u),\n                \"utility undefined\" + JSON.stringify([state, action, delay, utility(state, action)]));\n      \n      if (state.terminateAfterAction){\n        return u; \n      } else {                     \n        return u + expectation( Infer({ method: 'enumerate' }, function(){\n          var nextState = transition(state, action); \n          var perceivedDelay = isNaive ? delay + 1 : 0;\n          var nextAction = sample(act(nextState, perceivedDelay));\n          return expectedUtility(nextState, nextAction, delay+1);  \n        }));\n      }                      \n    });\n  \n  return {\n    params: params,\n    expectedUtility: expectedUtility,\n    act: act\n  };\n};\n\n\nvar simulateMDPAgentHyperbolic = function(startState, world, agent, outputType) {\n  var act = agent.act;\n  var expectedUtility = agent.expectedUtility;\n  var transition = world.transition;\n  var outputType = outputType ? outputType : 'states';\n\n  var selectOutput = function(state, action){\n    var table =  {states:state, actions:action, stateAction:[state, action]};\n    return table[outputType];\n  };\n  \n  var sampleSequence = function (state) {\n    var delay = 0;\n    var action = sample(act(state, delay));\n    var nextState = transition(state, action); \n    var out = selectOutput(state, action);\n    return state.terminateAfterAction ?\n      [out] : [out].concat(sampleSequence(nextState));\n  };\n  return sampleSequence(startState);\n};\n\n\n// --------------------------------------------------------------------\n// Helper functions\n\n\n// *trajectory* must be a trajectory of states\nvar getExpectedUtilitiesMDP = function(stateTrajectory, world, agent) {\n  var stateToActions = world.stateToActions;\n  var eu = agent.expectedUtility;\n  var getAllExpectedUtilities = function(state) {\n    var availableActions = stateToActions(state);\n    return [state, map(function(action){return eu(state, action);},\n		       availableActions)];\n  };\n  return map(getAllExpectedUtilities, stateTrajectory);\n};\n\n\n// --------------------------------------------------------------------\n// Generic MDP wrappers\n\n\nvar isOptimalMDPAgent = function(agentParams){\n  var optimalProperties = function(){\n    return !(_.has(agentParams, 'discount') ||\n             _.has(agentParams, 'discountFunction') ||\n             _.has(agentParams, 'sophisticatedOrNaive'));\n  };\n  return _.isUndefined(agentParams.optimal) ? optimalProperties() : agentParams.optimal;\n};\n\n\n\nvar makeMDPAgent = function(params, world){\n  return (isOptimalMDPAgent(params) ?\n          makeMDPAgentOptimal(params, world) : \n          makeMDPAgentHyperbolic(params, world));\n};\n\n\nvar simulateMDP = function(startState, world, agent, outputType) {\n  var params = agent.params;\n  if (isOptimalMDPAgent(params)){\n    return simulateMDPAgentOptimal(startState, world, agent, outputType)  \n  } else {\n    return simulateMDPAgentHyperbolic(startState, world, agent, outputType)\n  }    \n};\n",filename:"webppl-agents/src/agents/makeMDPAgent.wppl"},{code:"\n// General POMDP utils\n\nvar hasSample = function (x) {\n  // Can't use _.has here since `sample` is an inherited property;\n  // could use _.hasIn if we switched to lodash.\n  return x.sample !== undefined;\n};\n\nvar hasUtilityPriorBelief = function(agentParams){\n  if ( _.has(agentParams,'utility') && _.has(agentParams, 'priorBelief') ){\n    var utility = agentParams.utility;\n    var priorBelief = agentParams.priorBelief;\n    return _.isFunction(utility);\n  }\n  return false;\n};\n\nvar hasTransitionObserve = function(world){\n  if ( _.has(world,'transition') && _.has(world,'observe') ){\n    var transition = world.transition;\n    var observe = world.observe;\n    return _.isFunction(transition) && _.isFunction(observe);\n  }\n  return false;\n};\n              \n\n\n//-----------------------\n// Utils for Manifest-latent Optimization\n\nvar isPOMDPWithManifestLatent = function(world){\n  return hasTransitionObserve(world) && _.has(world,'manifestStateToActions');\n}\n\nvar stateHasManifestLatent = function (x){return _.has(x,'latentState') && _.isFinite(x.manifestState.timeLeft);};\n\n\nvar buildState = function (manifestState, latentState) {\n  return { manifestState:manifestState, latentState:latentState };\n};\n\n\n// From array of POMDP manifest-latent states, extract locations array\nvar trajectoryToLocations = function(trajectory){\n  assert.ok(_.isArray(trajectory));\n  return _.map(_.map(trajectory,'manifestState'),'loc');\n};\n\n\n// From array of form [ [loc, action] ], output array of form:\n// [  [{manifestState:{loc:, timeLeft:, terminateAfterAction:}, latentState:latentState}, action ]  ]\nvar stateActionPairsToFullStates = function(locAction, latentState){\n\n  // From array of locs, add *timeLeft* and *terminateAfterAction*\n  var locationsToManifestStates = function(locs){\n    return map( function(locTime){ \n      var terminateAfterAction = locTime[1]==1;\n      return {loc: locTime[0], timeLeft:locTime[1], terminateAfterAction: terminateAfterAction};\n  }, zip( locs, downToOne(locs.length) ) );\n  };\n\n  var locs = map(first,locAction);  \n  var manifestStates = locationsToManifestStates(locs);\n  var fullStates = map( function(manifest){\n    return buildState(manifest,latentState);\n    }, manifestStates);\n  \n  return zip( fullStates, map(second,locAction) );\n};\n\n\n",filename:"webppl-agents/src/utils/POMDPUtils.wppl"},{code:"// HELPER FUNCTIONS\n\n// TODO these two functions should be moved into getPOMDPFRunctions\n\n// Test whether belief has right form for fastUpdateBelief, i.e. it's not\n// an Dist but an object with 'manifestState' and 'latentStateDist' properties\nvar isDistOverLatent = function(belief){\n  return _.has(belief, 'manifestState') && _.has(belief, 'latentStateDist')\n    && !_.has(belief,'support') && hasSample(belief.latentStateDist);\n};\n\n// Convert priorBelief from Dist over full states to Dist over latents\nvar toDistOverLatent = function(belief){\n  var manifestState = belief.support()[0].manifestState;\n  var latentStateDist = Infer({ method: 'enumerate' }, function(){return sample(belief).latentState;})\n  return {manifestState: manifestState,\n          latentStateDist: latentStateDist};\n};\n\n\n// Construct functions needed for running the POMDP agent\n// Most of the code is for the manifest-latent optimization\n\nvar getPOMDPFunctions = function(params, world){\n\n  // Sample a state from belief: works for general states and manifestLatent states.\n  var sampleBelief = function(belief){\n    if (isDistOverLatent(belief)){\n      return buildState(belief.manifestState, sample(belief.latentStateDist) );\n    } else {\n      return sample(belief);\n    };\n  };\n\n\n  // ----------------------------\n  // Manifest-latent Optimization\n\n  // Helper functions\n\n  var getBeliefToActions = function(manifestStateToActions){\n    return function(belief){\n      var manifestState = isDistOverLatent(belief) ? belief.manifestState :\n          sample(belief).manifestState;\n      return manifestStateToActions( manifestState );\n    };\n  };\n\n  var getFullObserve = function(observeLatent){\n    return function(state){\n      return {manifestState: state.manifestState, observation: observeLatent(state)};\n    };\n  };\n\n  // Agent gets an obervation in starting state without having taken an action\n  var isNullAction = function(action){return action=='noAction';};\n\n  // Optimized belief update for manifest/latent POMDPs\n  var getUpdateBeliefManifestLatent = function(transition, observe){\n\n    var isDeltaDist = function(dist){return dist.support().length===1;};\n\n    return dp.cache(\n      function(belief_, observation, action){\n\n        // If belief has form of \"Dist over {manifest:, latent:}\" then we convert\n        // to form of \"{manifest:, Dist over latent}\".\n        var belief = isDistOverLatent(belief_) ? belief_ : toDistOverLatent(belief_);\n\n        // we set the manifest state to the observed manifest state\n        var newManifestState = observation.manifestState;\n\n        // Don't update latent when you don't need to\n        if (observation.observation === 'noObservation'\n            || isDeltaDist(belief.latentStateDist) ) {\n          return extend(belief, {manifestState: newManifestState});\n        } else {\n\n          // Sample latent, update state, compare predicted observation from state\n          // to actual observation.\n\n          var newLatentDist = Infer({ method: 'enumerate' }, function(){\n            var latentState = sample(belief.latentStateDist);\n            var state = buildState( belief.manifestState, latentState);\n            var predictedNextState = isNullAction(action) ? state : transition(state, action);\n            var predictedObservation = observe(predictedNextState);\n\n            condition(_.isEqual(predictedObservation, observation));\n            return latentState;});\n\n          return {manifestState: newManifestState, latentStateDist: newLatentDist};\n        }\n      });\n  };\n\n\n  // updateBelief function for general POMDPs (no manifest/latent structure)\n  var getUpdateBeliefSimple = function(transition, observe){\n    return dp.cache(\n      function(belief, observation, action){\n        return Infer({ method: 'enumerate' }, function(){\n          var state = sample(belief);\n          var predictedNextState = isNullAction(action) ? state : transition(state, action);\n          var predictedObservation = observe(predictedNextState);\n          condition(_.isEqual(predictedObservation, observation));\n          return predictedNextState;\n        });\n      });\n  };\n\n\n  var useManifestLatent = !_.isUndefined(params.useManifestLatent) ?\n      params.useManifestLatent :\n      stateHasManifestLatent(sampleBelief(params.priorBelief))\n\n  if (useManifestLatent){\n    assert.ok( stateHasManifestLatent(sampleBelief(params.priorBelief)),\n               'state is not manifestLatent in form')\n  }\n\n\n  if (useManifestLatent){\n    var observe = getFullObserve(world.observe);\n    return {\n      sampleBelief: sampleBelief,\n      useManifestLatent: true,\n      observe : observe,\n      beliefToActions : getBeliefToActions(world.manifestStateToActions),\n      updateBelief : getUpdateBeliefManifestLatent(world.transition, observe),\n      shouldTerminate: function(state){return state.manifestState.terminateAfterAction;}\n    };\n  };\n\n  return {\n    sampleBelief: sampleBelief,\n    useManifestLatent: false,\n    observe: world.observe,\n    beliefToActions: world.beliefToActions,\n    updateBelief: getUpdateBeliefSimple(world.transition, world.observe),\n    shouldTerminate:  function(state){return state.terminateAfterAction;}\n  };\n};\n\n\n// --------------------------------------------------------------------\n// Optimal POMDP agent\n\n\nvar makePOMDPAgentOptimal = function(params, world) {\n  assert.ok( hasUtilityPriorBelief(params) && hasTransitionObserve(world), 'makePOMDPAgent params and world');\n\n  // set defaults\n  var defaults = {\n    recurseOnStateOrBelief: 'belief',\n    alpha: 1000,\n  };\n\n  var params = extend(defaults, params);\n\n  var utility = params.utility;\n  var transition = world.transition;\n  var POMDPFunctions = getPOMDPFunctions(params, world);\n\n  var observe = POMDPFunctions.observe;\n  var beliefToActions = POMDPFunctions.beliefToActions;\n  var updateBelief = POMDPFunctions.updateBelief;\n  var shouldTerminate = POMDPFunctions.shouldTerminate;\n  var sampleBelief = POMDPFunctions.sampleBelief;\n\n\n  // RECURSE ON BELIEF (BELLMAN STYLE)\n  var act = dp.cache(\n    function(belief) {\n      return Infer({ method: 'enumerate' }, function(){\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief(belief, action);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief = dp.cache(\n    function(belief, action) {\n      return expectation(\n        Infer({ method: 'enumerate' }, function(){\n          var state = sampleBelief(belief);\n          var u = utility(state, action);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: '\n                    + JSON.stringify(state));\n          if (shouldTerminate(state)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var nextBelief = updateBelief(belief, nextObservation, action);\n            var nextAction = sample(act(nextBelief));\n\n            var futureU = expectedUtilityBelief(nextBelief, nextAction);\n            return u + futureU;\n          }\n        }));\n    });\n\n\n  // RECURSE ON STATE (FIXES THE LATENT STATE)\n  var act_recState = dp.cache(\n    function(belief) {\n      return Infer({ method: 'enumerate' }, function(){\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief_recState(belief, action);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief_recState = dp.cache(\n    function(belief, action){\n      return expectation(\n        Infer({ method: 'enumerate' },  function(){\n          var state = sampleBelief(belief);\n          return expectedUtilityState_recState(belief,state, action);\n        }));\n    });\n\n  var expectedUtilityState_recState = dp.cache(\n    function(belief, state, action){\n      return expectation(  // need this for caching\n        Infer({ method: 'enumerate' },  function(){\n          var u = utility(state, action);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: '\n                    + JSON.stringify(state));\n          if (shouldTerminate(state)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var nextBelief = updateBelief(belief, nextObservation, action);\n            var nextAction = sample(act(nextBelief));\n            var futureU = expectedUtilityState_recState(nextBelief, nextState, nextAction);\n            return u + futureU;\n          }\n        }));\n    });\n\n  var act = params.recurseOnStateOrBelief === 'belief' ? act : act_recState;\n  var expectedUtilityBelief = params.recurseOnStateOrBelief === 'belief' ?\n      expectedUtilityBelief : expectedUtilityBelief_recState;\n\n  return {\n    act: act,\n    expectedUtilityBelief: expectedUtilityBelief,\n    params: params,\n    updateBelief: updateBelief,\n    POMDPFunctions: POMDPFunctions,\n  };\n};\n\n\n// --------------------------------------------------------------------\n// Sub-optimal POMDP agent\n\nvar makePOMDPAgentDelay = function (params, world){\n\n  assert.ok( hasUtilityPriorBelief(params) && hasTransitionObserve(world), 'makePOMDPAgent params and world');\n\n  var defaults = {\n    alpha: 1000,\n    recurseOnStateOrBelief: 'belief',\n    discount: 0,\n    sophisticatedOrNaive: 'naive',\n    noDelays: true,\n    updateMyopic: false,\n    rewardMyopic: false\n  };\n\n  var params = extend(defaults, params);\n\n  if (params.rewardMyopic || params.updateMyopic){\n    assert.ok( params.noDelays === false && params.sophisticatedOrNaive=== 'naive',\n    'rewardMyopic and updateMyopic require Naive agent with delays');\n  }\n\n  assert.ok( params.rewardMyopic === false || params.updateMyopic === false, \"one of rewardMyopic and updateMyopic must be false\");\n\n\n  // Variables for methods\n  var transition = world.transition;\n  var utility = params.utility;\n\n  var POMDPFunctions = getPOMDPFunctions(params, world);\n  var observe = POMDPFunctions.observe;\n  var beliefToActions = POMDPFunctions.beliefToActions;\n  var sampleBelief = POMDPFunctions.sampleBelief;\n\n  var _updateBelief = POMDPFunctions.updateBelief;\n\n  var updateBelief = function (belief, observation, action, delay) {\n    if (params.updateMyopic && (delay > params.updateMyopic.bound)){\n\n      // update manifestState (assuming no possibility that isNullAction(action))\n      var nextBelief = Infer({ method: 'enumerate' }, function(){\n        var state = sampleBelief(belief);\n        return transition(state,action);\n      });\n      return POMDPFunctions.useManifestLatent ? toDistOverLatent(nextBelief) : nextBelief;\n\n    } else {\n      return _updateBelief(belief, observation, action);\n    };\n  };\n\n\n  // Update the *delay* parameter in *expectedUtility* for sampling actions and future utilities\n  var transformDelay = function(delay){\n    var table = {naive: delay + 1, sophisticated: 0 };\n    return params.noDelays ? 0 : table[params.sophisticatedOrNaive];\n  };\n\n  var incrementDelay = function(delay){\n    return params.noDelays ? 0 : delay + 1;\n  };\n\n  // Define the discount function to be used\n  var discountFunction = params.discountFunction ? params.discountFunction\n        : function(delay){return 1.0/(1 + params.discount * delay);};\n\n  // Termination condition for *expectedUtility*\n  var shouldTerminate = function(state, delay) {\n    var terminateAfterAction = POMDPFunctions.useManifestLatent ?\n        state.manifestState.terminateAfterAction :\n        state.terminateAfterAction;\n\n    if (terminateAfterAction){return true;}\n    if (params.rewardMyopic) {return delay >= params.rewardMyopic.bound;}\n    return false;\n  };\n\n\n  // RECURSE ON BELIEF (BELLMAN STYLE)\n  var act = dp.cache(\n    function (belief, delay) {\n      assert.ok( _.isFinite(delay), 'act: delay non-finite. delay: ' + delay);\n      return Infer({ method: 'enumerate' }, function () {\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief(belief, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief = dp.cache(\n    function (belief, action, delay) {\n      return expectation(\n        Infer({ method: 'enumerate' }, function () {\n          var state = sampleBelief(belief);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: '\n                    + JSON.stringify(state));\n          var u = discountFunction(delay) * utility(state, action);\n\n          if (shouldTerminate(state, delay)){\n            return u;\n          } else {\n            var nextState = transition(state, action);\n\n            var nextObservation = observe(nextState);\n            var transformedDelay = transformDelay(delay);\n\n            var nextBelief = updateBelief(belief, nextObservation, action, transformedDelay);\n            var nextAction = sample(act(nextBelief, transformedDelay));\n\n            var futureU = expectedUtilityBelief(nextBelief, nextAction, incrementDelay(delay));\n            return u + futureU;\n          }\n        }));\n    });\n\n  // RECURSE ON STATE (FIXES THE LATENT STATE)\n  var act_recState = dp.cache(\n    function(belief, delay) {\n      assert.ok( _.isFinite(delay), 'act: delay non-finite. delay: ' + delay);\n      return Infer({ method: 'enumerate' }, function(){\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief_recState(belief, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief_recState = dp.cache(\n    function(belief, action, delay){\n      return expectation(\n        Infer({ method: 'enumerate' },  function(){\n          var state = sampleBelief(belief);\n          return expectedUtilityState_recState(belief,state, action, delay);\n        }));\n    });\n\n  var expectedUtilityState_recState = dp.cache(\n    function(belief, state, action, delay){\n      return expectation(  // need this for caching\n        Infer({ method: 'enumerate' },  function(){\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: '\n                    + JSON.stringify(state));\n          var u = discountFunction(delay) * utility(state, action);\n          if (shouldTerminate(state, delay)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var transformedDelay = transformDelay(delay);\n            var nextBelief = updateBelief(belief, nextObservation, action,\n                                          transformedDelay);\n            var nextAction = sample(act_recState(nextBelief, transformedDelay));\n            var futureU = expectedUtilityState_recState(nextBelief, nextState,\n                                                        nextAction,\n                                                        incrementDelay(delay));\n            return u + futureU;\n          }\n        }));\n    });\n\n  var act = params.recurseOnStateOrBelief === 'belief' ? act : act_recState;\n  var expectedUtility = params.recurseOnStateOrBelief === 'belief' ?\n        expectedUtilityBelief : expectedUtilityBelief_recState;\n\n  return {\n    act:act,\n    updateBelief: updateBelief,\n    expectedUtility : expectedUtility,\n    params: params,\n    POMDPFunctions: POMDPFunctions\n  };\n};\n\n\n\n// General POMDP wrappers\n\nvar isOptimalPOMDPAgent = function(agentParams){\n  var optimalProperties = function(){\n    return !(_.has(agentParams, 'noDelays') ||\n             _.has(agentParams, 'discount') ||\n             _.has(agentParams, 'myopic-observations'));\n  }\n  return _.isUndefined(agentParams.optimal) ? optimalProperties() : agentParams.optimal;\n};\n\nvar isManualPOMDPAgent = function(agentParams) {\n  return (_.has(agentParams, 'act') &&\n          _.has(agentParams, 'updateBelief') &&\n          _.has(agentParams, 'params') &&\n          _.has(agentParams.params, 'priorBelief'));\n}\n\nvar makePOMDPAgent = function(params, world){\n  if (isManualPOMDPAgent(params)) {\n    return extend(params, {\n      POMDPFunctions: getPOMDPFunctions(params.params, world)\n    });\n  } else {\n    return (isOptimalPOMDPAgent(params) ?\n            makePOMDPAgentOptimal(params, world) :\n            makePOMDPAgentDelay(params, world));\n  }\n};\n\n\nvar getMakeAgentFunction = function(beliefOrBeliefDelay){\n  assert.ok(_.includes(['belief','beliefDelay'], beliefOrBeliefDelay),\n            'getMakeAgentFunction invalid input:   ' + beliefOrBeliefDelay);\n\n  if (beliefOrBeliefDelay == 'beliefDelay') {\n    return makePOMDPAgentDelay;\n  } else {\n    return makePOMDPAgentOptimal;\n  }\n};\n\n\n\n// --------------------------------------------------------------------\n// Simulate\n\nvar getSimulateFunction = function(beliefOrBeliefDelay){\n\n  //TODO add test that agent's prior contains the true startState\n\n  assert.ok( _.includes(['belief','beliefDelay'], beliefOrBeliefDelay),\n             'getSimulateFunction invalid input: '+ beliefOrBeliefDelay);\n\n\n  var useDelays = beliefOrBeliefDelay=='beliefDelay';\n\n\n  return function (startState, world, agent, outputType) {\n    var useManifestLatent = agent.POMDPFunctions.useManifestLatent;\n\n    var totalTime = useManifestLatent ? startState.manifestState.timeLeft : startState.timeLeft;\n\n    //assert.ok(isPOMDPState(startState), 'simulateBeliefDelayAgent args');\n    assert.ok( _.includes(['states','actions','stateAction','stateBelief', 'stateObservationAction'], outputType),\n               \"outputType '\" + outputType + \"' not in ['states', 'actions', 'stateAction', 'stateBelief', 'stateObservationAction']\");\n\n    var terminateAfterAction = useManifestLatent ? startState.manifestState.terminateAfterAction :\n        startState.terminateAfterAction;\n\n    assert.ok(totalTime > 1 || startState.manifestState.terminateAfterAction,\n              'if totalTime==1, must also terminateAfterAction');\n\n    // agent methods\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n    var priorBelief = agent.params.priorBelief;\n\n\n    // world methods\n    var transition = world.transition;\n    var observe = agent.POMDPFunctions.observe;\n    var shouldTerminate = agent.POMDPFunctions.shouldTerminate;\n\n    var selectOutput = function(state, observation, action, belief){\n      var table =  {states:state,\n                    actions:action,\n                    stateAction:[state, action],\n                    stateBelief: [state, belief],\n                    stateObservationAction:{state: state,\n                                            observation: observation,\n                                            action: action}};\n      return table[outputType];\n    };\n\n\n    var sampleSequence = function(state, priorBelief, action) {\n\n      var observation = observe(state);\n      var delay = 0;\n\n      var belief = useDelays ? agentUpdateBelief(priorBelief, observation,\n                                                 action, delay) :\n            agentUpdateBelief(priorBelief, observation, action);\n\n      var action = useDelays ? sample(agentAct(belief, delay)) :\n            sample(agentAct(belief));\n\n      var output = [selectOutput(state, observation, action, belief)];\n\n      if (shouldTerminate(state)) {\n        return output;\n      } else {\n        var nextState = transition(state, action);\n        return output.concat(sampleSequence(nextState, belief, action));\n      }\n    };\n    var startAction = 'noAction';\n    return sampleSequence(startState, priorBelief, startAction);\n  };\n};\n\nvar simulatePOMDPAgent = getSimulateFunction('belief');\nvar simulatePOMDPAgentDelay = getSimulateFunction('beliefDelay');\n\n\nvar simulatePOMDP = function(startState, world, agent, outputType) {\n  var params = agent.params;\n  if (isOptimalPOMDPAgent(params)){\n    return simulatePOMDPAgent(startState, world, agent, outputType)\n  } else {\n    return simulatePOMDPAgentDelay(startState, world, agent, outputType);\n  }\n};\n",
filename:"webppl-agents/src/agents/makePOMDPAgent.wppl"},{code:"// Stochastic bandit POMDP constructor: outputs Bandit environments whose prizes are\n// strings or numbers.\n\n// The latent state stores each arm's Dist over prizes, and the manifest state\n// location contains the reward gained after the previous arm pull.\n\n\n\n// helper function\nvar inSupport = function(x, dist){\n  return _.isFinite(dist.score(x));\n};\n\n\n// main constructor function is makeBandit\nvar makeBanditWorld = function(numberOfArms) {\n  var actions = _.range(numberOfArms);\n\n  var advanceTime = function(manifestState) {\n    var newTimeLeft = manifestState.timeLeft - 1;\n    var terminateAfterAction = (newTimeLeft === 1);\n    return extend(manifestState, {timeLeft: newTimeLeft,\n  				  terminateAfterAction: terminateAfterAction});\n  };\n  \n  var manifestStateToActions = function(manifestState) {return actions;};\n\n  var transition = function(state, action){\n    \n    assert.ok(hasSample(state.latentState[action]), 'bandit transition: latent state has no Dist for given action');\n    // figure out what the prize is\n    var prize = sample(state.latentState[action]);\n\n    // make the new location the prize, advance the time\n    var manifestStateWithReward = extend(state.manifestState, {loc: prize});\n    var newManifestState = advanceTime(manifestStateWithReward);\n\n    return buildState( newManifestState, state.latentState);\n  };\n\n  var observe = function(state){\n    // in beliefAgent, the observation here will be augmented with an \n    // observation of the manifest state, and belief updating will depend on\n    // both that full observation and the action the agent took. This is all the\n    // agent needs to update, so there is no need to have an observation here.\n    // However, if we make the observation 'noObservation', the agent will not\n    // update its beliefs, which is bad, so we arbitrarily set the observation\n    // to always be 0.\n\n    return 0;\n\n  };\n\n  return {\n    manifestStateToActions: manifestStateToActions,\n    transition: transition,\n    observe: observe\n  };\n};\n\nvar makeBanditStartState = function(numberOfTrials, armToPrizeDist) {\n  return {manifestState: {loc: 'start',\n			  timeLeft: numberOfTrials,\n			  terminateAfterAction: false},\n	  latentState: armToPrizeDist};\n};\n\nvar makeBanditPOMDP = function(options) {\n\n  assert.ok(_.has(options, 'numberOfArms') && _.has(options, 'armToPrizeDist')\n	    && _.has(options, 'numberOfTrials'),\n	   'makeBanditPOMDP args: options does not contain one or more of numberOfArms, armToPrizeDist, and numberOfTrials');\n\n  var numberOfArms = options.numberOfArms;\n  var armToPrizeDist = options.armToPrizeDist;\n  var numberOfTrials = options.numberOfTrials;\n  var numericalPrizes = options.numericalPrizes;\n  var prizeToUtility = options.prizeToUtility;\n  \n  // ensure that armToPrizeDist has an entry for every arm\n  mapN(function(arm){\n    assert.ok(_.has(armToPrizeDist, arm.toString()),\n	      'makeBandit: arm ' + arm + ' has no entry in armToPrizeDist');\n  }, numberOfArms);\n  \n  // ensure that armToPrizeDist has an Dist for every arm\n  mapN(function(arm){\n    assert.ok(hasSample(armToPrizeDist[arm.toString()]),\n	      'makeBandit: arm ' + arm + ' has no Dist in armToPrizeDist');\n  }, numberOfArms);\n\n  // ensure that prizes are numerical iff numericalPrizes is true,\n  // and strings iff numericalPrizes is false\n  // also, if numericalPrizes is false, and prizeToUtility is defined, ensure\n  // that every prize has a utility\n  if (numericalPrizes) {\n    var supportIsNumeric = function(arm) {\n      var dist = armToPrizeDist[arm];\n      map(function(x){\n	assert.ok(_.isFinite(x) && inSupport(x, dist),\n		  'makeBandit: some prizes are non-numeric but numericalPrizes is true');\n      }, dist.support());\n    };\n\n    mapN(supportIsNumeric, numberOfArms);\n    \n  } else {\n    var supportIsStringy = function(arm) {\n      var dist = armToPrizeDist[arm];\n      map(function(x){\n	assert.ok(_.isString(x) && inSupport(x, dist),\n		  'makeBandit: some prizes are not strings but numericalPrizes is false');\n      }, dist.support());\n    };\n\n    mapN(supportIsStringy, numberOfArms);\n  }\n  \n  var world = makeBanditWorld(numberOfArms);\n  var startState = makeBanditStartState(numberOfTrials, armToPrizeDist);\n\n  return {\n    world: world,\n    startState: startState,\n    armToPrizeDist: armToPrizeDist,\n    numericalPrizes: numericalPrizes,\n    numberOfArms: numberOfArms\n  };\n};\n\n\nvar numericBanditUtility = function(state, action) {\n  var prize = state.manifestState.loc;\n  return prize === 'start' ? 0 : prize;\n};\n\nvar makeStringBanditUtility = function(prizeToUtility) {\n  return function(state, action) {\n    var prize = state.manifestState.loc;\n    return prize === 'start' ? 0 : prizeToUtility[prize];\n  };\n};\n\nvar makeBanditUtility = function(bandit, prizeToUtility) {\n  if (bandit.numericalPrizes) {\n    return numericBanditUtility;\n  } else {\n    var prizesHaveUtilities = function(arm) {\n      var armToPrizeDist = bandit.armToPrizeDist;\n      var dist = armToPrizeDist[arm];\n      map(function(x){\n	assert.ok(_.isFinite(prizeToUtility[x]) && inSupport(x, dist),\n		  'makeBandit: some prizes do not have utilities');\n      }, dist.support());\n    };\n\n    mapN(prizesHaveUtilities, bandit.numberOfArms);\n    \n    return makeStringBanditUtility(prizeToUtility);\n  }\n};\n\nvar makeBanditAgent = function(agentParams, bandit, beliefOrBeliefDelay,\n			       prizeToUtility) {\n  \n  var priorBelief = agentParams.priorBelief;\n  var numericalPrizes = bandit.numericalPrizes;\n\n  if (isDistOverLatent(priorBelief)) {\n    assert.ok(_.isEqual(priorBelief.manifestState,\n			bandit.startState.manifestState),\n	      'makeBanditAgent: priorBelief has wrong start manifestState');\n  } else {\n    assert.ok(hasSample(priorBelief), 'makeBanditAgent: priorBelief is neither an Dist nor an object containing a manifest state and a latentStateDist');\n    assert.ok(_.isEqual(sample(priorBelief).manifestState,\n			bandit.startState.manifestState),\n	      'makeBanditAgent: priorBelief has wrong start manifestState');\n  }\n\n  var utility = makeBanditUtility(bandit, prizeToUtility);\n  \n  var makeAgent = getMakeAgentFunction(beliefOrBeliefDelay);\n  \n  return makeAgent(extend(agentParams, {utility: utility}),\n		   bandit.world);\n};\n\n// Inference by sampling full trajectories or by doing 'off policy' inference\n\nvar inferBandit = function(bandit, baseAgentParams, prior, observedStateAction,\n			   trajectoryOrOffPolicy, numRejectionSamples,\n			   beliefOrBeliefDelay){\n  var world = bandit.world;\n  var startState = bandit.startState;\n  var numericPrizes = bandit.numericPrizes;\n\n  //var simulate = getSimulateFunction(beliefOrBeliefDelay);\n\n  var priorPrizeToUtility = prior.priorPrizeToUtility || false;\n  var priorAgentPrior = prior.priorAgentPrior;\n  var priorRewardMyopic = prior.priorRewardMyopic || false;\n\n\n  assert.ok(isPOMDPWithManifestLatent(world) && stateHasManifestLatent(startState)\n	    && hasSample(priorAgentPrior),\n	    'inferBandit args: \\n\\n startState ' + startState\n	    + ' \\n\\n priorAgentPrior' + priorAgentPrior );\n  assert.ok(trajectoryOrOffPolicy === 'trajectory'\n	    || trajectoryOrOffPolicy === 'offPolicy',\n	    'inferBandit args: trajectoryOrOffPolicy bad');\n  assert.ok( stateHasManifestLatent(observedStateAction[0][0]),\n	     'inferBandit args: observedStateAction first entry of first entry not a POMDP state');\n\n  if (priorPrizeToUtility) {\n    assert.ok(hasSample(priorPrizeToUtility), 'inferBandit args: priorPrizeToUtility defined but not an Dist');\n  }\n\n  if (priorRewardMyopic) {\n    assert.ok(hasSample(priorRewardMyopic), 'inferBandit args: priorMyopia defined but not an Dist');\n  }\n\n  \n  return Infer({ method: 'enumerate' }, function(){\n    // priors and makeAgent are specific to bandits\n    var prizeToUtility = priorPrizeToUtility ? sample(priorPrizeToUtility)\n	  : undefined;\n    var priorBelief = sample(priorAgentPrior);\n    var rewardMyopicUpdate = priorRewardMyopic ? {rewardMyopic: sample(priorRewardMyopic) } : {};\n    var newAgentParams = extend(baseAgentParams, extend({priorBelief:priorBelief}, \n                                                        rewardMyopicUpdate) );\n    \n    var agent = makeBanditAgent(newAgentParams, bandit, beliefOrBeliefDelay,\n				prizeToUtility);\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n    var observe = agent.POMDPFunctions.observe;\n\n    // Factor on whole sampled trajectory (SLOW IF NOT DETERMINISTIC AND NUM SAMPLES HIGH)\n    var factorOnTrajectory = function(){\n      var trajectoryDist = Infer({ method: 'rejection', samples: numRejectionSamples }, function(){\n        return simulatePOMDP(startState, world, agent, 'states');});\n      factor(trajectoryDist.score(map(first, observedStateAction)));\n    };\n\n    // Move agent through observed sequence \n    var factorSequenceOffPolicy = function(currentBelief, previousAction, timeIndex){\n      if (timeIndex < observedStateAction.length) { \n\n        // Go to next world state and sample observation from that state\n        var state = observedStateAction[timeIndex][0];\n        var observation = observe(state);\n\n        // Update agent's internal state and get action Dist\n        var delay = 0;     \n        var nextBelief = beliefOrBeliefDelay == 'belief' ?\n            agentUpdateBelief(currentBelief, observation, previousAction) :\n            agentUpdateBelief(currentBelief, observation, previousAction, delay);\n\n        \n        var nextActionDist = beliefOrBeliefDelay == 'belief' ? \n            agentAct(nextBelief) : agentAct(nextBelief, delay); \n\n        var observedAction = observedStateAction[timeIndex][1];\n        factor(nextActionDist.score(observedAction));\n\n        // condition on next world state, passing through updated internal state\n        factorSequenceOffPolicy(nextBelief, observedAction, timeIndex + 1);\n      }\n    };\n\n    var doInfer = (trajectoryOrOffPolicy=='trajectory') ? factorOnTrajectory() : \n        factorSequenceOffPolicy(priorBelief,'noAction', 0);\n\n    var bound = newAgentParams.rewardMyopic ? newAgentParams.rewardMyopic.bound : 0;\n    return {prizeToUtility: prizeToUtility, \n            priorBelief: priorBelief, \n            rewardMyopicBound: bound};\n  });\n};\n\nvar noDiscountBaseAgentParams = { // doesn't contain priorBelief or utility\n  alpha: 100,\n  noDelays: true,\n  discount: 0,\n  sophisticatedOrNaive: 'naive'\n};\n",filename:"webppl-agents/src/environments/bandits/makeBandit.wppl"},{code:"\n// TODO: looks like if you have named features in a gridworld, then they have to be terminal (or at terminal after *timeAtRestaurant* is exceeded). we should change this so that features can be non-terminal. \n\n// Should have a 't' feature (when inputting gridworld)\n// which indicates a terminal state. need to adjust 'advance state time' to allow for this. \n\n\nvar inGrid_ = function(gridMap, loc) {\n  return (loc[0] >= 0 && loc[0] < gridMap.xLim &&\n          loc[1] >= 0 && loc[1] < gridMap.yLim);\n}\n\nvar isBlockedLoc = function(gridMap, loc) {\n  var getFeature = gridMap.feature;\n  var feature = getFeature({ loc : loc});\n  return feature === '#';\n}\n\nvar isAllowedState_ = function(gridMap, loc) {\n  return (inGrid_(gridMap, loc)) && !isBlockedLoc(gridMap, loc);\n};\n\nvar advanceStateTime = function(state) {\n  \n  return extend(state, { \n    timeLeft : state.timeLeft - 1, \n    terminateAfterAction : state.timeLeft - 1> 1 ? state.terminateAfterAction : true, \n    previousLoc : state.loc\n  });\n};\n\nvar addPrevious = function(state) { \n  return extend(state, { previousLoc : state.loc });\n};\n\nvar advanceRestaurant = function(state, maxTimeAtRestaurant) { \n  var timeAtRestaurant = (state.timeAtRestaurant === undefined) ? 0 : state.timeAtRestaurant + 1 ;\n  var state = extend(state, { timeAtRestaurant : timeAtRestaurant }); \n\n  if (state.timeAtRestaurant < maxTimeAtRestaurant - 1) {\n    return state;\n  } else {\n    return extend(state, { terminateAfterAction : true });\n  }\n};\n\nvar moveState = function(gridMap, state, action) { \n  var loc = state.loc;\n  var gridTransition = {l: [loc[0]-1, loc[1]],\n                        r: [loc[0]+1, loc[1]],\n                        u: [loc[0], loc[1]+1],\n                        d: [loc[0], loc[1]-1]};\n\n  var possibleNextLoc = gridTransition[action];\n  assert.ok(possibleNextLoc != undefined, 'action was not found');\n\n  var nextLoc = isAllowedState_(gridMap, possibleNextLoc) ? possibleNextLoc : loc;\n  return extend(state, { loc : nextLoc });\n};\n\nvar makeGridTransition_ = function(gridMap, options) {\n  return function(state,action){\n    var getFeature = gridMap.feature;\n    var state = options.noReverse ? addPrevious(state) : state;\n    var state = !getFeature(state).name ? advanceStateTime(state) : state;\n\n    var state = !getFeature(state).name ? moveState(gridMap, state, action) : state;\n    var state = getFeature(state).name ? advanceRestaurant(state, options.maxTimeAtRestaurant) : state;\n\n    return state;\n  };\n};\n\nvar makeNoisyGridTransition_ = function(gridMap, options, transitionNoiseProb) {\n  var deterministicTransition = makeGridTransition_(gridMap, options);\n  // If agent selects *key*, with *transitionNoiseProb* they do one of the two\n  // orthogonal actions\n  var noiseActionTable = {u: ['l','r'],\n			  d: ['l','r'],\n			  l: ['u','d'],\n			  r: ['u','d']};\n\n  return function(state,action){\n    return flip(1-transitionNoiseProb) ? deterministicTransition(state,action)\n      : deterministicTransition(state, uniformDraw(noiseActionTable[action]));\n  };\n};\n\n\nvar makeGridMap = function(rfeatures)  { \n  var features = rfeatures.reverse();\n  return { \n    features : features,\n    xLim : features[0].length,\n    yLim : features.length,\n    feature : function (state) { \n      return features[state.loc[1]][state.loc[0]];\n    }\n  };\n};\n\n\n\nvar makeGridWorldDeterministic = function(features, options) {\n  var defaults = { noReverse : false, maxTimeAtRestaurant : 1 };\n  var options = extend(defaults, options);\n\n  var gridMap = makeGridMap(features); \n\n  var transition = makeGridTransition_(gridMap, options);\n  var actions = ['l', 'r', 'u', 'd'];\n\n  var stateToActions = function (state) { \n\n    var possibleActions = filter(function (action) { \n      var newState = transition(state, action);\n      if (options.noReverse && \n          state.previousLoc && \n          state.previousLoc[0] === newState.loc[0] && state.previousLoc[1] === newState.loc[1]) { return false; }\n      return state.loc[0] !== newState.loc[0] || state.loc[1] !== newState.loc[1];\n    }, actions);\n\n    if (possibleActions.length > 0) {\n      return possibleActions;\n    } else { \n      return [actions[0]];\n    }\n  };\n\n  return extend(gridMap,\n    { transition : transition, \n      actions    : actions,\n      stateToActions    : stateToActions\n    });\n};\n\n\nvar makeNoisyGridworld = function(features, inputOptions, transitionNoiseProb) {\n  var defaults = { noReverse: false, maxTimeAtRestaurant : 1 };\n\n  var options = extend(defaults, inputOptions);\n  var gridMap = makeGridMap(features); \n\n  var transition = makeNoisyGridTransition_(gridMap, options,\n					    transitionNoiseProb);\n  var actions = ['l', 'r', 'u', 'd'];\n\n  var stateToActions = function (state) { \n    var possibleActions = filter(function (action) {\n      // if noReverse, check that MAP of newState doesn't reverse you\n      var transitionDist = Infer({ method: 'enumerate' }, function(){\n	return transition(state, action);\n      });\n      var likelyNewState = MAP(transitionDist).val;\n      if (options.noReverse && state.previousLoc\n	  && state.previousLoc[0] === likelyNewState.loc[0]\n	  && state.previousLoc[1] === likelyNewState.loc[1]) {\n	return false;\n      } else {\n	return state.loc[0] !== likelyNewState.loc[0]\n	  || state.loc[1] !== likelyNewState.loc[1];\n      }}, actions);\n			\n\n    if (possibleActions.length > 0) {\n      return possibleActions;\n    } else { \n      return [actions[0]];\n    }\n  };\n\n  return extend(gridMap,\n    { transition : transition, \n      actions : actions,\n      stateToActions : stateToActions\n    });\n};\n\n\n\nvar makeGridWorldMDP = function(options){\n  \n  var defaults = {\n    noReverse: false,\n    maxTimeAtRestaurant: 1,\n    transitionNoiseProbability: 0,\n    startingLocation: [0,0],\n    totalTime: 2\n  };\n\n  var options = extend(defaults, options);\n\n  map( function(el){\n    assert.ok( _.isString(el) || _.isString(el.name), 'gridFeatures is invalid')\n  }, _.flatten(options.gridFeatures));\n\n  assert.ok( options.totalTime >= 1, 'totalTime is invalid');\n  assert.ok( options.transitionNoiseProbability <= 1, 'transitionNoiseProbability is invalid');\n  assert.ok( options.startingLocation.length == 2, 'startingLocation is invalid');\n  \n\n  var world = (options.transitionNoiseProbability == 0) ?\n      makeGridWorldDeterministic(options.gridFeatures, options) :\n      makeNoisyGridworld(options.gridFeatures, options, options.transitionNoiseProbability);\n\n  var startState = {loc: options.startingLocation, \n                    terminateAfterAction: false,\n                    timeLeft: options.totalTime};\n\n  \n  // assumes that utilities are only defined on named features and timeCost\n  // doesnt work for the hyperbolic case\n  var makeUtility = function(utilityTable){\n    assert.ok( utilityTable.hasOwnProperty('timeCost'), 'makeUtility utilityTable lacks timeCost');\n    return function(state, action){\n      var getFeature = world.feature;\n      var feature = getFeature(state);\n\n      if (feature.name) { return utilityTable[feature.name]; }\n      return utilityTable.timeCost;\n    };\n  };  \n\n  \n  // we could output 'feature' or a world\n  return {world: world, startState: startState, makeUtility: makeUtility};\n\n};  \n      \n\n  \n  \n\n\n\n\n",filename:"webppl-agents/src/environments/gridWorld/makeGridWorldMDP.wppl"},{code:"\n// note: isGridworld is different in this file than how it is in other files\nvar isGridworld = function(world){return world\n				  && arraysEqual(world.actions,\n						 ['l', 'r', 'u', 'd'])\n				  && world.hasOwnProperty('feature')\n				  && world.hasOwnProperty('xLim')\n				  && world.hasOwnProperty('yLim')\n				  && world.hasOwnProperty('transition');};\n\n\n// function that builds a gridworld POMDP\n\n// arg is a gridworld MDP, which is an object with features (an array of\n// arrays of the features at each point), xLim, yLim, feature (a function of\n// a (manifest) state that returns the features of that state), transition\n// (a transition function on manifest states), actions, and stateToActions.\n// noReverse must be false in the MDP.\n\n// manifest states in this POMDP are objects with loc (an array of two\n// numbers), timeLeft, terminateAfterAction, and timeAtRestraurant - the same as states in gridworld MDPs.\n// latent states are an object listing whether each restaurant type is open.\n// transition acts the same as in gridworld MDPs, not touching the latent state,\n// unless the transition would take the agent into a closed restaurant, in which\n// case the agent stays put.\n// observe tells the agent which adjacent restaurants are open. If the agent is not\n// adjacent to any restaurants, they get 'noObservation'.\n\n\n// TODO Change to GridWorld and access via general makeGridWorld function\n// currently returns a world (makeGridWorld does not)\nvar makeGridWorldPOMDP = function(options) {\n\n  var gridworld = makeGridWorldMDP(options).world;\n  \n  var actions = gridworld.actions;\n  var feature = gridworld.feature;\n\n  // returns an array of restaurants that neighbour a state\n  var neighbourRestaurants = function(manifestState) {\n    var loc = manifestState.loc;\n    var updateStateLoc = function(manifestState, newLoc) {\n      return extend(manifestState, {loc: newLoc});\n    };\n    \n    var potentialneighbourStates = [\n      updateStateLoc(manifestState, [loc[0] - 1, loc[1]]),\n      updateStateLoc(manifestState, [loc[0] + 1, loc[1]]),\n      updateStateLoc(manifestState, [loc[0], loc[1] + 1]),\n      updateStateLoc(manifestState, [loc[0], loc[1] - 1]),\n    ];\n\n    var neighbourStates = filter(function(manifestState){\n      return inGrid_(gridworld, manifestState.loc);\n    }, potentialneighbourStates);\n\n    var isRestaurant = function(manifestState) {\n      return feature(manifestState).name;\n    };\n\n    return filter(isRestaurant, neighbourStates);\n  };\n\n  // returns a subobject of latentState that gives the status of adjacent restaurants\n  var observe = function(state) {\n    var neighbourRests = neighbourRestaurants(state.manifestState);\n    if (_.isEmpty(neighbourRests)) {\n      return 'noObservation';\n    } else {\n      var restaurantNames = map(function(manifestState){\n	return feature(manifestState).name;}, neighbourRests);\n      \n      return map(function(name){return [name, state.latentState[name]];},\n		 restaurantNames);\n    }\n  };\n\n  \n  var _mdpTransition = gridworld.transition;\n  var mdpTransition = function(state, action) {\n    // transition the manifest state as it would be transitioned in the gridworld\n    // mdp, leave the latent state alone\n    var newManifestState = _mdpTransition(state.manifestState, action);\n    return buildState(newManifestState, state.latentState);\n  };\n\n  var transition = function(state, action) {\n    assert.ok(stateHasManifestLatent(state), 'transition state arg');\n\n    var proposedNewState = mdpTransition(state, action);\n    var newFeatureName = feature(proposedNewState.manifestState).name;\n\n    // if proposedNewState is a restaurant that is closed, stay put, but increment\n    // time. otherwise, change to proposed new state.\n    if (newFeatureName && !proposedNewState.latentState[newFeatureName]) {\n      return buildState(advanceStateTime(state.manifestState), state.latentState);\n    } else {\n      return proposedNewState;\n    }\n  };\n\n\n  var manifestStateToActions = function(manifestState){\n    var neighbourRestaurantArray = neighbourRestaurants(manifestState);\n    if (neighbourRestaurantArray.length == 0) {\n      var manifestStateToActions_ = gridworld.stateToActions;\n      return manifestStateToActions_(manifestState);\n    } else {\n      return gridworld.actions;\n    }\n  };\n\n \n  \n  return {\n    manifestStateToActions: manifestStateToActions,\n	  transition: transition,\n	  observe: observe,\n    feature : feature,\n    MDPWorld: gridworld \n  };\n};\n\n\n\n\n\n\n\nvar inferGridWorldPOMDP = function(world, startState, baseParams, trueAgentParams, prior, agentTypeAndFunctions,\n                                   trajectoryOrOffPolicy, numRejectionSamples){\n  \n \n  var makeAgent = agentTypeAndFunctions.makeAgent;\n  var simulate = agentTypeAndFunctions.simulate;\n  var beliefOrBeliefDelay = agentTypeAndFunctions.type;\n\n  var isJointPrior = prior.isJoint;\n\n  // try just not defining things instead of having them as 'undefined'\n  var jointPrior = isJointPrior ? prior.jointPrior : undefined;\n  var priorUtilityTable = isJointPrior ? undefined : prior.priorUtilityTable;\n  var priorAgentPrior = isJointPrior ? undefined : prior.priorAgentPrior;\n\n  if (isJointPrior) {\n    assert.ok(stateHasManifestLatent(startState) && hasSample(jointPrior),\n	      'inferGridworld args');\n  } else {\n    assert.ok(stateHasManifestLatent(startState) && hasSample(priorUtilityTable) && hasSample(priorAgentPrior), 'inferGridworld args');\n  }\n  \n  assert.ok(trajectoryOrOffPolicy == 'trajectory' || trajectoryOrOffPolicy=='offPolicy', \n            'trajectoryOrOffPolicy is not valid');\n  \n  assert.ok(_.isNumber(numRejectionSamples) && isPOMDPWithManifestLatent(world), 'inferGridWorld args' );\n  \n  // get observations using trueAgentParams\n  var agent = makeAgent(trueAgentParams, world);\n  var observedStateAction = simulatePOMDP(startState, world, agent, 'stateAction');\n  var observe = agent.POMDPFunctions.observe;\n  \n  assert.ok( stateHasManifestLatent(observedStateAction[0][0]), 'fullstate in trajectory for inferGridWorld');\n\n  return Infer({ method: 'enumerate' }, function(){\n    var utilityAndPrior = isJointPrior ? sample(jointPrior) : null;\n\n    var utilityTable = isJointPrior ? utilityAndPrior.utilityTable\n	  : sample(priorUtilityTable);\n    var utility = makeRestaurantUtilityFunction(world, utilityTable);\n\n    var  priorBelief = isJointPrior ? utilityAndPrior.priorBelief\n	  : sample(priorAgentPrior);\n    \n    var params = extend(baseParams, {utility:utility, priorBelief: priorBelief});\n    \n    var agent = makeAgent(params, world);\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n\n    // Factor on whole sampled trajectory (SLOW IF TRANSITIONS NOT DETERMINISTIC OR IF NUM SAMPLES HIGH)\n    var factorOnTrajectory = function(){\n      var trajectoryDist = Infer({ method: 'rejection', samples: numRejectionSamples }, function(){\n        return simulatePOMDP(startState, world, agent, 'states')});\n      factor(trajectoryDist.score(map(first, observedStateAction)));\n    };\n\n    \n    // Move agent through observed sequence \n    var factorSequenceOffPolicy = function(currentBelief, previousAction, timeIndex){\n      if (timeIndex < observedStateAction.length) { \n\n        // Go to next world state and sample observation from that state\n        var state = observedStateAction[timeIndex][0];\n        var observation = observe(state);\n\n        // Update agent's internal state and get action Dist\n        var delay = 0;     \n        var nextBelief = beliefOrBeliefDelay == 'belief' ?\n              agentUpdateBelief(currentBelief, observation, previousAction) :\n              agentUpdateBelief(currentBelief, observation, previousAction, delay);\n\n\n        var nextActionDist = beliefOrBeliefDelay == 'belief' ? \n              agentAct(nextBelief) : agentAct(nextBelief, delay); \n\n        var observedAction = observedStateAction[timeIndex][1];\n\n        factor(nextActionDist.score(observedAction));\n\n        // condition on next world state, passing through updated internal state\n        factorSequenceOffPolicy(nextBelief, observedAction, timeIndex + 1);\n      }\n    };\n\n    var doInfer = (trajectoryOrOffPolicy=='trajectory') ? factorOnTrajectory() : \n          factorSequenceOffPolicy(priorBelief,'noAction', 0);\n    \n    \n    return {utilityTable: utilityTable,\n	    priorBelief: priorBelief};\n  });\n};\n\n\n\n\nvar baseParamsNoDiscount = {\n  priorBelief: null,\n  utility: null,\n  alpha: 100,\n  noDelays: true,\n  discount: 0,\n  sophisticatedOrNaive: 'sophisticated'\n};\n\n\n",filename:"webppl-agents/src/environments/gridWorld/makeGridWorldPOMDP.wppl"},{code:"// Hike constructor\nvar makeHike = function(transitionNoiseProb, options) {\n  assert.ok( _.isFinite(transitionNoiseProb) && 0 <= transitionNoiseProb\n	    && transitionNoiseProb <= 1,\n	    'something wrong with transitionNoiseProb argument to makeHike');\n\n  var H = {name: 'Hill'};\n  var W = {name: 'West'};\n  var E = {name: 'East'};\n  var __ = ' ';\n  \n  var smallFeatures =\n	[[ __ ,  __ ,  __ ,  __ ,  __ ],\n	 [ __ , '#',  __ ,  __ ,  __ ],\n	 [ __ , '#',  W , '#',  E ],\n	 [ __ ,  __ ,  __ ,  __ ,  __ ],\n	 [ H ,  H ,  H ,  H ,  H ]];\n\n  var bigFeatures =\n	[[ __ ,  __ ,  __ ,  __ ,  __ ,  __ ],\n	 [ __ ,  __ ,  __ ,  __ ,  __ ,  __ ],\n	 [ __ ,  __ , '#',  __ ,  __ ,  __ ],\n	 [ __ ,  __ , '#',  W , '#',  E ],\n	 [ __ ,  __ ,  __ ,  __ ,  __ ,  __ ],\n	 [ H ,  H ,  H ,  H ,  H ,  H ]];\n\n  var options_ = options ? options : {big: false};\n  \n  var features = options_.big ? bigFeatures : smallFeatures;\n  \n  var options = {\n    gridFeatures: features,\n    transitionNoiseProbability: transitionNoiseProb\n  };\n  \n  return makeGridWorldMDP(options).world;\n};\n\nvar makeHikeUtilityFunction = function(world, utilityTable){\n  var feature = world.feature;\n \n  return function(state, action) {\n    var stateFeatureName = feature(state).name;\n    return stateFeatureName ? utilityTable[stateFeatureName] : utilityTable.timeCost;\n  };\n};\n\n\n",filename:"webppl-agents/src/environments/gridWorld/concreteExamples/hiking.wppl"},{code:'// Restaurant Choice Constructor and Helpers\n\n\nvar getRestaurantChoiceOptions = function(updateOptions){\n  \n  var defaults = {noReverse:true, maxTimeAtRestaurant:2};\n  var options = extend(defaults, updateOptions);\n\n  var restaurant = {\n    donutN : { name : \'Donut N\'},\n    donutS : { name : \'Donut S\'},\n    veg   : { name : \'Veg\'},\n    noodle: { name : \'Noodle\'}\n  };\n  \n  var __ = \' \'; \n  var DN = restaurant.donutN;\n  var DS = restaurant.donutS;\n  var V = restaurant.veg;\n  var N = restaurant.noodle;\n  \n  var features = \n    [[\'#\', \'#\', \'#\', \'#\',  V , \'#\'],\n     [\'#\', \'#\', \'#\',  __ ,  __ ,  __ ],  \n     [\'#\', \'#\', DN ,  __ , \'#\',  __ ],\n     [\'#\', \'#\', \'#\',  __ , \'#\',  __ ],\n     [\'#\', \'#\', \'#\',  __ ,  __ ,  __ ],\n     [\'#\', \'#\', \'#\',  __ , \'#\',  N ],\n     [ __ ,  __ ,  __ ,  __ , \'#\', \'#\'],\n     [DS , \'#\', \'#\',  __ , \'#\', \'#\']];\n\n  return extend(options, {gridFeatures: features});\n};\n\n\nvar makeRestaurantChoiceMDP = function(updateOptions){\n  var options = getRestaurantChoiceOptions(updateOptions);\n  return makeGridWorldMDP(options).world;\n};\n\n// TODO clean this up: should be one makeRestaurantChoice function that takes option POMDP true false\nvar makeRestaurantChoiceWorld = function(options){\n  if (options.POMDP){  \n    var restaurantChoiceOptions = getRestaurantChoiceOptions(options);\n    \n    return makeGridWorldPOMDP(restaurantChoiceOptions)\n  } else {\n    return makeRestaurantChoiceMDP(restaurant);\n  }\n};\n\n\n\nvar makeRestaurantUtilityFunction = function (world, utilityTable) {\n  assert.ok(_.has(utilityTable,\'Veg\') && _.has(utilityTable,\'timeCost\'), \n            \'makeRestaurantUtilityFunction: Veg or timeCost is missing\');\n\n  var getFeatureName = function(state){\n    var getFeature = world.feature;\n    return isPOMDPWithManifestLatent(world) ? getFeature(state.manifestState).name :\n      getFeature(state).name;\n  };\n\n  var defaultTimeCost = -.01;\n  \n  return function(state, action) {\n    var name = getFeatureName(state);\n\n    // compute whether there are "double utilities" (for hyperbolic discounting case)\n    var pairs = utilityTable[\'Veg\'].length == 2;\n    \n    if (name){ \n      return pairs ? utilityTable[name][state.timeAtRestaurant] : utilityTable[name];\n    }\n    return utilityTable.timeCost || defaultTimeCost;\n  };\n};\n\n\nvar restaurantChoiceStart = { \n  loc : [3,1],\n  terminateAfterAction : false,\n  timeLeft : 11\n};\n\n\n\n// trajectories starting from [3,1] for big donutWorld\nvar restaurantNameToPath = {\n  naive: [[3,1], [3,2], [3,3], [3,4], [3,5], [2,5], [2,5]],\n  \n  sophisticated: [[ 3, 1 ],[ 3, 2 ],[ 3, 3 ],[ 4, 3 ], [ 5, 3 ],\n                  [ 5, 4 ], [ 5, 5 ], [ 5, 6 ], [4, 6 ], [ 4, 7 ], [4,7] ],\n\n  donutNorth: [[3,1], [3,2], [3,3], [3,4], [3,5], [2,5], [2,5]],\n  \n  donutSouth: [[3,1], [2,1], [1,1], [0,1], [0,0], [0,0]],\n  \n  vegDirect: [[3,1], [3,2], [3,3], [3,4], [3,5], [3,6], [4,6], [4,7], [4,7]]\n};\n\nvar restaurantNameToPathSmall = {\n  naive: [[2,1], [2,2], [2,3], [2,4], [1,4]],\n  sophisticated: [[2,1], [2,2], [2,3], [3,3], [4,3], [4,4], [4,5], [3,5], [3,6]]\n};\n\nvar restaurantNameToObservationTime11 = {\n  naive: \n  [[{"loc":[3,1],"terminateAfterAction":false,"timeLeft":11},"u"],\n   [{"loc":[3,2],"terminateAfterAction":false,"timeLeft":10,"previousLoc":[3,1]},"u"],\n   [{"loc":[3,3],"terminateAfterAction":false,"timeLeft":9,"previousLoc":[3,2]},"u"],\n   [{"loc":[3,4],"terminateAfterAction":false,"timeLeft":8,"previousLoc":[3,3]},"u"],\n   [{"loc":[3,5],"terminateAfterAction":false,"timeLeft":7,"previousLoc":[3,4]},"l"],\n   [{"loc":[2,5],"terminateAfterAction":false,"timeLeft":6,"previousLoc":[3,5],"timeAtRestaurant":0},"l"],\n   [{"loc":[2,5],"terminateAfterAction":true,"timeLeft":6,"previousLoc":[2,5],"timeAtRestaurant":1},"l"]],\n\n  sophisticated:\n  [[{"loc":[3,1],"terminateAfterAction":false,"timeLeft":11},"u"],[{"loc":[3,2],"terminateAfterAction":false,"timeLeft":10,"previousLoc":[3,1]},"u"],[{"loc":[3,3],"terminateAfterAction":false,"timeLeft":9,"previousLoc":[3,2]},"r"],[{"loc":[4,3],"terminateAfterAction":false,"timeLeft":8,"previousLoc":[3,3]},"r"],[{"loc":[5,3],"terminateAfterAction":false,"timeLeft":7,"previousLoc":[4,3]},"u"],[{"loc":[5,4],"terminateAfterAction":false,"timeLeft":6,"previousLoc":[5,3]},"u"],[{"loc":[5,5],"terminateAfterAction":false,"timeLeft":5,"previousLoc":[5,4]},"u"],[{"loc":[5,6],"terminateAfterAction":false,"timeLeft":4,"previousLoc":[5,5]},"l"],[{"loc":[4,6],"terminateAfterAction":false,"timeLeft":3,"previousLoc":[5,6]},"u"],[{"loc":[4,7],"terminateAfterAction":false,"timeLeft":2,"previousLoc":[4,6],"timeAtRestaurant":0},"l"],[{"loc":[4,7],"terminateAfterAction":true,"timeLeft":2,"previousLoc":[4,7],"timeAtRestaurant":1},"l"]],\n\n  vegDirect: \n  [[{"loc":[3,1],"terminateAfterAction":false,"timeLeft":11},"u"],[{"loc":[3,2],"terminateAfterAction":false,"timeLeft":10,"previousLoc":[3,1]},"u"],[{"loc":[3,3],"terminateAfterAction":false,"timeLeft":9,"previousLoc":[3,2]},"u"],[{"loc":[3,4],"terminateAfterAction":false,"timeLeft":8,"previousLoc":[3,3]},"u"],[{"loc":[3,5],"terminateAfterAction":false,"timeLeft":7,"previousLoc":[3,4]},"u"],[{"loc":[3,6],"terminateAfterAction":false,"timeLeft":6,"previousLoc":[3,5]},"r"],[{"loc":[4,6],"terminateAfterAction":false,"timeLeft":5,"previousLoc":[3,6]},"u"],[{"loc":[4,7],"terminateAfterAction":false,"timeLeft":4,"previousLoc":[4,6],"timeAtRestaurant":0},"l"],[{"loc":[4,7],"terminateAfterAction":true,"timeLeft":4,"previousLoc":[4,7],"timeAtRestaurant":1},"l"]],\n\n  donutSouth:\n  [[{"loc":[3,1],"terminateAfterAction":false,"timeLeft":11},"l"],[{"loc":[2,1],"terminateAfterAction":false,"timeLeft":10,"previousLoc":[3,1]},"l"],[{"loc":[1,1],"terminateAfterAction":false,"timeLeft":9,"previousLoc":[2,1]},"l"],[{"loc":[0,1],"terminateAfterAction":false,"timeLeft":8,"previousLoc":[1,1]},"d"],[{"loc":[0,0],"terminateAfterAction":false,"timeLeft":7,"previousLoc":[0,1],"timeAtRestaurant":0},"l"],[{"loc":[0,0],"terminateAfterAction":true,"timeLeft":7,"previousLoc":[0,0],"timeAtRestaurant":1},"l"]]\n};\n\nvar restaurantNameToObservationTime11Reverse = function(name){\n  var ar = restaurantNameToObservationTime11[name];\n  return map( function(stateAction){\n    var state = stateAction[0];\n    var state_noPrevious = _.omit(state,\'previousLoc\');\n    return [state_noPrevious, stateAction[1]];\n  }, ar);\n};\n\nvar restaurantPathToName = function(path){\n  var table = _.invert(restaurantNameToPath);\n  var name = table[path] || \'not in table\';\n  return \'path: \' + name;\n};\n\n\n\n\n// POMDP case\n\nvar allOpenRestaurantChoiceStart = {\n  manifestState: { loc: [3,1],\n		   terminateAfterAction: false,\n		   timeLeft: 11},\n  latentState: {\'Donut N\': true,\n		\'Donut S\': true,\n		Veg: true,\n		Noodle: true}\n};\n\n\n\n// exludes last state\nvar naiveDonutNorthStates = [[3,1], [3,2], [3,3], [3,4], [3,5], [2,5]];\nvar straightToVegStates = [[3,1], [3,2], [3,3], [3,4], [3,5], [3,6], [4,6], [4,7]];\n\n\n\n\n\n\n\n',
filename:"webppl-agents/src/environments/gridWorld/concreteExamples/restaurantChoice.wppl"},{code:"\nvar getRestaurantHyperbolicInfer = function(){\n\n  // Note: agentmodels doesn't use this code currently\n  var getObservations = function(world, start, pathName){\n    \n    var temptationUtility = makeRestaurantUtilityFunction(world, {\n      'Donut N' : [10, -10],\n      'Donut S' : [10, -10],\n      'Veg'   : [-10, 20], // [-10,25] makes soph work on where reverse allowed\n      'Noodle': [-5, -5],\n      'timeCost': -.01\n    });\n    \n    var discount = pathName=='vegDirect' ? 0 : 1;\n    var sophisticatedOrNaive = pathName=='naive' ? 'naive' : 'sophisticated';\n    \n    var agent = makeMDPAgent(\n      { utility : temptationUtility,\n        alpha : 500, \n        discount : discount, \n        sophisticatedOrNaive  : sophisticatedOrNaive\n      }, world);\n    var observedStateAction = simulateMDP(start, world, agent);\n    var observedLocs = map( function(x){return x[0].loc;}, observedStateAction);   \n    // assert.ok( _.isEqual( observedLocs, restaurantNameToPath[pathName]), 'generated locs: ' + observedLocs + ' \\n stored locs: \n// ' + restaurantNameToPath[pathName]);\n    return observedStateAction;\n  };\n\n  \n  var factorSequence = function(agentAction, observedStateAction){\n    map(function (stateAction) {\n      var state   = stateAction[0];\n      var action  = stateAction[1];\n      factor(agentAction(state, 0).score(action)) ; \n    }, observedStateAction);\n  };\n\n    \n  var getPosterior = function(world, prior, observedStateAction, repeatObservations){\n    var Infer = Enumerate;\n    var priorUtilityTable = prior.utility;\n    var priorDiscounting = prior.discounting;\n    var priorAlpha = prior.alpha;\n    \n    return Infer(function () {\n      var utilityTable = priorUtilityTable();\n      var discounting = priorDiscounting();\n      var alpha = priorAlpha();\n      \n      var agent = makeMDPAgent(\n        { utility   : makeRestaurantUtilityFunction(world, utilityTable),\n          alpha     : alpha, \n          discount  : discounting.discount, \n          sophisticatedOrNaive : discounting.sophisticatedOrNaive\n        }, world);\n      var agentAction = agent.act;\n      \n      factorSequence(agentAction, observedStateAction);\n\n      if (! _.isUndefined(repeatObservations) ){ \n        repeat(repeatObservations, function(){factorSequence(agentAction, observedStateAction);});\n      }\n      \n\n      var vegMinusDonut = sum(utilityTable['Veg']) - sum(utilityTable['Donut N']);\n      var donutNGreaterDonutS = sum(utilityTable['Donut S']) < sum(utilityTable['Donut N']);\n\n      var dis = function(d){return 1/(1+discounting.discount*d);};\n      var disUDonut = function(d){\n        return dis(d)*utilityTable['Donut N'][0] + dis(d+1)*utilityTable['Donut N'][1];\n      };\n      var disUVeg = function(d){\n        return dis(d)*utilityTable['Veg'][0] + dis(d+1)*utilityTable['Veg'][1];\n      };\n      var donutTempting = (disUDonut(4) < disUVeg(6)) && (disUDonut(0) > disUVeg(2));\n      \n      return {utility: utilityTable, \n              discount: discounting.discount, \n              alpha: alpha,\n              sophisticatedOrNaive: discounting.sophisticatedOrNaive,\n              vegMinusDonut: vegMinusDonut,\n              donutNGreaterDonutS: donutNGreaterDonutS,\n              timeCost: utilityTable.timeCost,\n              donutTempting: donutTempting\n             };\n    });\n  };\n\n  return {getObservations: getObservations, getPosterior: getPosterior};\n};\n\n",filename:"webppl-agents/src/environments/gridWorld/concreteExamples/restaurantChoiceHyperbolicInfer.wppl"},{code:"// a 'bandit gridworld' is a gridworld POMDP where all restaurants are open,\n// but the agent doesn't know the quality of the food. The manifest states are\n// the same as the states of gridworld MDPs, and the latent state is an object\n// associating restaurant names to the quality of food of that chain (which is\n// assumed to be the agent's utility). When an agent is next to a restaurant, it\n// observes the food quality of that chain (perhaps by looking through the\n// window and seeing how much the patrons like their food).\n\n// since the structure of bandit gridworld is so similar to that of a gridworld\n// pomdp, we can just use that, and only update the transition function and\n// manifestStateToActions (since we don't need to worry about transitioning\n// into restaurants that are closed)\n\nvar makeBanditGridWorld = function(options) {\n  \n  var gridworldPOMDP = makeGridWorldPOMDP(options);\n  var gridworld = gridworldPOMDP.MDPWorld;\n  \n  var mdpTransition = gridworld.transition;\n  var transition = function(state, action) {\n    assert.ok(stateHasManifestLatent(state), 'transition state arg');\n    // transition the manifest state as it would be transitioned in the gridworld\n    // mdp, leave the latent state alone\n    var newManifestState = mdpTransition(state.manifestState, action);\n    return buildState(newManifestState, state.latentState);\n  };\n\n  var manifestStateToActions = gridworld.stateToActions;\n\n  return extend(gridworldPOMDP,\n		{transition: transition,\n		 manifestStateToActions: manifestStateToActions});\n\n};\n\nvar makeBanditGridWorldUtility = function(feature, timeCost) {\n  return function(state, action) {\n    var stateFeatureName = feature(state.manifestState).name;\n    if (stateFeatureName) {\n      return state.latentState[stateFeatureName];\n    } else {\n      return timeCost;\n    }\n  };\n};\n\n\n\nvar makeRestaurantSearchMDPOptions = function(options_) { \n  var A = {name: 'A'};\n  var B = {name: 'B'};\n  var C = {name: 'C'};\n  var D = {name: 'D'};\n  var E = {name: 'E'};\n\n  var options = options_ || {};\n\n  var features =\n	[['#', ' ', ' ', '#'],\n	 [ C , ' ', ' ', '#'],\n	 ['#', ' ', '#', '#'],\n	 ['#', ' ',  B , '#'],\n	 [ A , ' ', '#', '#'],\n	 ['#', ' ', '#',  D ],\n	 ['#', ' ', ' ', ' '],\n	 ['#', '#', '#',  E ]];\n\n  return extend(options, {gridFeatures: features, noReverse:true});\n};\n\n// start state for restaurant search pomdp\nvar restaurantSearchStartState =\n      {manifestState: {loc: [1, 2],\n		       timeLeft: 17,\n		       terminateAfterAction: false},\n       latentState: {A: 3, B: 3, C: 4, D: 5, E: 0}};\n\n\nvar makeRestaurantSearchPOMDP = function(){\n  var options = makeRestaurantSearchMDPOptions()\n  var world = makeBanditGridWorld(options);\n  var startState = restaurantSearchStartState;\n\n  var feature = world.feature;\n  var makeUtility = function(timeCost){\n    return makeBanditGridWorldUtility(feature, timeCost);\n  };\n                                       \n  return {mdp:world.MDPWorld, world:world, startState:startState, makeUtility: makeUtility};\n};\n\n",filename:"webppl-agents/src/environments/gridWorld/banditGridworld.wppl"},{code:'\n\nvar makeProcrastinationMDP = function(deadlineTime) {\n  var stateLocs = ["wait_state", "reward_state"];\n  var actions = ["wait", "work", "relax"];\n\n  var stateToActions = function(state) {\n    return state.loc === "wait_state" ? ["wait", "work"]\n      : ["relax"];\n  };\n\n  var advanceTime = function (state) {\n    var newTimeLeft = state.timeLeft - 1;\n    var terminateAfterAction = (newTimeLeft === 1 || state.loc === "reward_state");\n    return extend(state, {timeLeft: newTimeLeft,\n  			  terminateAfterAction: terminateAfterAction});\n  };\n\n  var transition = function(state, action) {\n    assert.ok(_.contains(stateLocs, state.loc) && _.contains(actions, action), \'procrastinate transition:\' + [state.loc,action]);\n    \n    if (state.loc === "reward_state") {\n      return advanceTime(state);\n    } else if (action === "wait") {\n      var waitSteps = state.waitSteps + 1;\n      return extend(advanceTime(state), {waitSteps: waitSteps});\n    } else {\n      var newState = extend(state, {loc: "reward_state"});\n      return advanceTime(newState);\n    }\n  };\n\n  var feature = function(state) {\n    return state.loc;\n  };\n\n  var startState = {loc: "wait_state",\n		    waitSteps: 0,\n		    timeLeft: deadlineTime,\n		    terminateAfterAction: false};\n\n  return {actions: actions,\n	  stateToActions: stateToActions,\n	  transition: transition,\n	  feature: feature,\n          startState: startState};\n};\n\n\nvar makeProcrastinationUtility = function(utilityTable) {\n  assert.ok(hasProperties(utilityTable, [\'waitCost\', \'workCost\',\n					 \'reward\']), \'makeProcrastinationUtility args\');\n  var waitCost = utilityTable.waitCost;\n  var workCost = utilityTable.workCost;\n  var reward = utilityTable.reward;\n\n  // NB: you receive the *workCost* when you leave the *wait_state*\n  // You then receive the reward when leaving the *reward_state* state\n  return function(state, action) {\n    if (state.loc === "reward_state") {\n      return reward + state.waitSteps * waitCost;\n    } else if (action === "work") {\n      return workCost;\n    } else {\n      return 0;\n    }\n  };\n};\n\nvar workInMiddle10 = [[{"loc":"wait_state","waitSteps":0,"timeLeft":10,"terminateAfterAction":false},"wait"],[{"loc":"wait_state","waitSteps":1,"timeLeft":9,"terminateAfterAction":false},"wait"],[{"loc":"wait_state","waitSteps":2,"timeLeft":8,"terminateAfterAction":false},"wait"],[{"loc":"wait_state","waitSteps":3,"timeLeft":7,"terminateAfterAction":false},"work"],[{"loc":"reward_state","waitSteps":3,"timeLeft":6,"terminateAfterAction":true},"relax"]];\n\n\n',filename:"webppl-agents/src/environments/procrastinationMDP.wppl"}],version:"v1.0.0-6bd2c98"}];var load=_.once(function(){packages.forEach(function(pkg){if(pkg.js){global[pkg.js.identifier]=pkg.js.path}pkg.headers.forEach(webppl.requireHeaderWrapper)});var bundles=webppl.parsePackageCode(packages);return bundles});function prepare(codeAndAssets,k,options){options=util.mergeDefaults(options,{filename:"webppl:program",errorHandlers:[]});var extraHandlers=options.debug?[errors.debugHandler(options.filename)]:[];options.errorHandlers=extraHandlers.concat(options.errorHandlers);return webppl.prepare(codeAndAssets,k,options)}function run(code,k,options){var codeAndAssets=compile(code,options);prepare(codeAndAssets,k,options).run()}function compile(code,options){options=options||{};var optionsExtended=_.extend({bundles:load()},options);return webppl.compile(code,optionsExtended)}function webpplCPS(code){var programAst=esprima.parse(code);var newProgramAst=optimize(cps(thunkify(programAst)));return escodegen.generate(newProgramAst)}function webpplNaming(code){var programAst=esprima.parse(code);var newProgramAst=naming(thunkify(programAst)).ast;return escodegen.generate(newProgramAst)}global.webppl={prepare:prepare,run:run,compile:compile,cps:webpplCPS,naming:webpplNaming,version:version,packages:packages}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./errors/browser":156,"./main":180,"./syntax":185,"./transforms/cps":192,"./transforms/naming":194,"./transforms/optimize":195,"./util":200,"/agents/node_modules/webppl-agents":5,"/agents/node_modules/webppl-dp":6,"/agents/node_modules/webppl-timeit":8,escodegen:50,esprima:110,underscore:148}],154:[function(require,module,exports){"use strict";var ad=require("./ad.js");var Tensor=require("./tensor");var _=require("underscore");var util=require("./util");var assert=require("assert");var inspect=require("util").inspect;var gt=require("./domain").gt;var interval=require("./domain").interval;var LOG_PI=1.1447298858494002;var LOG_2PI=1.8378770664093453;function Distribution(){}Distribution.prototype={toJSON:function(){throw new Error("Not implemented")},inspect:function(depth,options){if(_.has(this,"params")){if(this.print){return this.print()}else{return[this.meta.name,"(",inspect(this.params),")"].join("")}}else{var opts=options?_.clone(options):{};opts.customInspect=false;return inspect(this,opts)}},toString:function(){return this.inspect()},isContinuous:false,constructor:Distribution};function isDist(x){return x instanceof Distribution}function clone(dist){return new dist.constructor(dist.params)}var serialize=function(dist){return util.serialize(dist)};var deserialize=function(JSONString){var obj=util.deserialize(JSONString);if(!obj.probs||!obj.support){throw new Error("Cannot deserialize a non-distribution JSON object: "+JSONString)}return new Categorical({ps:obj.probs,vs:obj.support})};var finiteSupport={MAP:function(){var map={score:-Infinity};this.support().forEach(function(val){var score=this.score(val);if(score>map.score){map={val:val,score:score}}},this);return map},entropy:function(){return _.reduce(this.support(),function(memo,x){var score=this.score(x);return memo-(score===-Infinity?0:Math.exp(score)*score)},0,this)},toJSON:function(){var support=this.support();var probs=support.map(function(s){return Math.exp(this.score(s))},this);return{probs:probs,support:support}}};var continuousSupport={isContinuous:true};var noHMC={noHMC:true};var methodNames=["sample","score","support","print","base","transform"];function makeDistributionType(options){options=util.mergeDefaults(options,{mixins:[]});["name","params"].forEach(function(name){if(!_.has(options,name)){console.log(options);throw new Error("makeDistributionType: "+name+" is required.")}});if(options.score){var originalScoreFn=options.score;options.score=function(val){if(arguments.length!==1){throw new Error("The score method of "+this.meta.name+" expected 1 argument but received "+arguments.length+".")}return originalScoreFn.call(this,val)}}var parameterNames=_.pluck(options.params,"name");var extraConstructorFn=options.constructor;var dist=function(params){if(params===undefined&&parameterNames.length>0){throw new Error("Parameters not supplied to "+this.meta.name+" distribution.")}parameterNames.forEach(function(p){if(!params.hasOwnProperty(p)){throw new Error('Parameter "'+p+'" missing from '+this.meta.name+" distribution.")}},this);this.params=params;if(extraConstructorFn!==undefined){extraConstructorFn.call(this)}};dist.prototype=Object.create(Distribution.prototype);dist.prototype.constructor=dist;dist.prototype.meta=_.pick(options,"name","desc","params","nodoc","nohelper","wikipedia");_.extendOwn.apply(_,[dist.prototype].concat(options.mixins));_.extendOwn(dist.prototype,_.pick(options,methodNames));["sample","score"].forEach(function(method){if(!dist.prototype[method]){throw new Error('makeDistributionType: method "'+method+'" not defined for '+options.name)}});return dist}var ImproperUniform=makeDistributionType({name:"ImproperUniform",desc:"Improper continuous uniform distribution which has probability one everywhere.",params:[],nodoc:true,nohelper:true,mixins:[continuousSupport],sample:function(){throw new Error("cannot sample from this improper distribution.")},score:function(val){return 0}});var Uniform=makeDistributionType({name:"Uniform",desc:"Continuous uniform distribution over ``[a, b]``",params:[{name:"a",desc:"lower bound (real)"},{name:"b",desc:"upper bound (real > a)"}],wikipedia:"Uniform_distribution_(continuous)",mixins:[continuousSupport],sample:function(){var u=util.random();return(1-u)*ad.value(this.params.a)+u*ad.value(this.params.b)},score:function(val){if(ad.scalar.lt(val,this.params.a)||ad.scalar.gt(val,this.params.b)){return ad.scalar.neg(Infinity)}return ad.scalar.neg(ad.scalar.log(ad.scalar.sub(this.params.b,this.params.a)))},support:function(){return{lower:this.params.a,upper:this.params.b}}});var Bernoulli=makeDistributionType({name:"Bernoulli",desc:"Distribution over ``{true, false}``",params:[{name:"p",desc:"success probability",domain:interval(0,1)}],wikipedia:true,mixins:[finiteSupport],sample:function(){return util.random()<ad.value(this.params.p)},score:function(val){if(ad.scalar.pneq(val,true)&&ad.scalar.pneq(val,false)){return ad.scalar.neg(Infinity)}return val?ad.scalar.log(this.params.p):ad.scalar.log(ad.scalar.sub(1,this.params.p))},support:function(){return[true,false]}});function mvBernoulliScore(ps,x){assert.ok(ad.value(ps).rank===2);assert.ok(ad.value(ps).dims[1]===1);assert.ok(ad.value(x).rank===2);assert.ok(ad.value(x).dims[1]===1);assert.ok(ad.value(x).dims[0]===ad.value(ps).dims[0]);var xSub1=ad.tensor.sub(x,1);var pSub1=ad.tensor.sub(ps,1);return ad.tensor.sumreduce(ad.tensor.log(ad.tensor.add(ad.tensor.mul(x,ps),ad.tensor.mul(xSub1,pSub1))))}var MultivariateBernoulli=makeDistributionType({name:"MultivariateBernoulli",desc:"Distribution over a vector of independent Bernoulli variables. Each element "+"of the vector takes on a value in ``{0, 1}``. Note that this differs from ``Bernoulli`` which "+"has support ``{true, false}``.",params:[{name:"ps",desc:"probabilities",domain:interval(0,1)}],mixins:[finiteSupport],sample:function(){var ps=ad.value(this.params.ps);assert.ok(ps.rank===2);assert.ok(ps.dims[1]===1);var d=ps.dims[0];var x=new Tensor([d,1]);var n=x.length;while(n--){x.data[n]=util.random()<ps.data[n]}return x},score:function(x){return mvBernoulliScore(this.params.ps,x)},support:function(){var dims=this.params.ps.dims;var d=dims[0];var n=Math.pow(2,d);return _.times(n,function(x){return new Tensor(dims).fromFlatArray(toBinaryArray(x,d))})}});function toBinaryArray(x,length){assert.ok(x>=0&&x<Math.pow(2,length));var arr=[];for(var i=0;i<length;i++){arr.push(x%2);x=x>>1}return arr}var RandomInteger=makeDistributionType({name:"RandomInteger",desc:"Uniform distribution over ``{0,1,...,n-1}``",params:[{name:"n",desc:"number of possible values (integer >= 1)"}],wikipedia:"Uniform_distribution_(discrete)",mixins:[finiteSupport],sample:function(){return Math.floor(util.random()*this.params.n)},score:function(val){var inSupport=ad.scalar.peq(val,ad.scalar.floor(val))&&ad.scalar.leq(0,val)&&ad.scalar.lt(val,this.params.n);return inSupport?ad.scalar.neg(ad.scalar.log(this.params.n)):ad.scalar.neg(Infinity)},support:function(){return _.range(this.params.n)}});function gaussianSample(mu,sigma){var u,v,x,y,q;do{u=1-util.random();v=1.7156*(util.random()-.5);x=u-.449871;y=Math.abs(v)+.386595;q=x*x+y*(.196*y-.25472*x)}while(q>=.27597&&(q>.27846||v*v>-4*u*u*Math.log(u)));return mu+sigma*v/u}function gaussianScore(mu,sigma,x){return ad.scalar.mul(ad.scalar.neg(.5),ad.scalar.add(ad.scalar.add(LOG_2PI,ad.scalar.mul(2,ad.scalar.log(sigma))),ad.scalar.div(ad.scalar.mul(ad.scalar.sub(x,mu),ad.scalar.sub(x,mu)),ad.scalar.mul(sigma,sigma))))}var Gaussian=makeDistributionType({name:"Gaussian",desc:"Distribution over reals.",params:[{name:"mu",desc:"mean (real)"},{name:"sigma",desc:"standard deviation (real)",domain:gt(0)}],wikipedia:"Normal_distribution",mixins:[continuousSupport],sample:function(){return gaussianSample(ad.value(this.params.mu),ad.value(this.params.sigma))},score:function(x){return gaussianScore(this.params.mu,this.params.sigma,x)},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.add(ad.scalar.mul(sigma,x),mu)}});function mvGaussianSample(mu,cov){var d=mu.dims[0];var z=new Tensor([d,1]);for(var i=0;i<d;i++){z.data[i]=gaussianSample(0,1)}var L=cov.cholesky();return L.dot(z).add(mu)}function mvGaussianScore(mu,cov,x){var _x=ad.value(x);var _mu=ad.value(mu);var _cov=ad.value(cov);if(!util.isVector(_x)||!util.tensorEqDim0(_x,_mu)){return-Infinity}var d=_mu.dims[0];var dLog2Pi=d*LOG_2PI;var logDetCov=ad.scalar.log(ad.tensor.determinant(cov));var z=ad.tensor.sub(x,mu);var zT=ad.tensor.transpose(z);var prec=ad.tensor.inverse(cov);return ad.scalar.mul(-.5,ad.scalar.add(dLog2Pi,ad.scalar.add(logDetCov,ad.tensor.get(ad.tensor.dot(ad.tensor.dot(zT,prec),z),0))))}var MultivariateGaussian=makeDistributionType({name:"MultivariateGaussian",desc:"Multivariate Gaussian distribution with full covariance matrix. "+"If ``mu`` has length d and ``cov`` is a ``d``-by-``d`` matrix, "+"then the distribution is over vectors of length ``d``.",params:[{name:"mu",desc:"mean vector"},{name:"cov",desc:"covariance matrix "+"(must be symmetric positive semidefinite)"}],wikipedia:"Multivariate_normal_distribution",mixins:[continuousSupport],constructor:function(){var _mu=ad.value(this.params.mu);var _cov=ad.value(this.params.cov);if(!util.isVector(_mu)){throw new Error(this.meta.name+": mu should be a vector.")}if(!util.isMatrix(_cov)){throw new Error(this.meta.name+": cov should be a matrix.")}if(!util.tensorEqDim0(_mu,_cov)){throw new Error(this.meta.name+": dimension mismatch between mu and cov.")}},sample:function(){return mvGaussianSample(ad.value(this.params.mu),ad.value(this.params.cov))},score:function(val){return mvGaussianScore(this.params.mu,this.params.cov,val)}});function diagCovGaussianSample(mu,sigma){var dims=mu.dims;var x=new Tensor(dims);var n=x.length;while(n--){x.data[n]=gaussianSample(mu.data[n],sigma.data[n])}return x}function diagCovGaussianScore(mu,sigma,x){var _x=ad.value(x);var _mu=ad.value(mu);if(!util.isTensor(_x)||!util.tensorEqDims(_x,_mu)){return-Infinity}var d=_mu.length;var dLog2Pi=d*LOG_2PI;var logDetCov=ad.scalar.mul(2,ad.tensor.sumreduce(ad.tensor.log(sigma)));var z=ad.tensor.div(ad.tensor.sub(x,mu),sigma);return ad.scalar.mul(-.5,ad.scalar.add(dLog2Pi,ad.scalar.add(logDetCov,ad.tensor.sumreduce(ad.tensor.mul(z,z)))))}var DiagCovGaussian=makeDistributionType({name:"DiagCovGaussian",desc:"A distribution over tensors in which each element is independent and Gaussian distributed, "+"with its own mean and standard deviation. i.e. A multivariate Gaussian distribution with "+"diagonal covariance matrix. The distribution is over tensors that have the same shape as the "+"parameters ``mu`` and ``sigma``, which in turn must have the same shape as each other.",params:[{name:"mu",desc:"mean tensor"},{name:"sigma",desc:"tensor of standard deviations",domain:gt(0)}],mixins:[continuousSupport],constructor:function(){var _mu=ad.value(this.params.mu);var _sigma=ad.value(this.params.sigma);if(!util.isTensor(_mu)){throw new Error(this.meta.name+": mu should be a tensor.")}if(!util.isTensor(_sigma)){throw new Error(this.meta.name+": sigma should be a tensor.")}if(!util.tensorEqDims(_mu,_sigma)){throw new Error(this.meta.name+": mu and sigma should be the same shape.")}},sample:function(){return diagCovGaussianSample(ad.value(this.params.mu),ad.value(this.params.sigma))},score:function(x){return diagCovGaussianScore(this.params.mu,this.params.sigma,x)},base:function(){var dims=ad.value(this.params.mu).dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.tensor.add(ad.tensor.mul(sigma,x),mu)}});var squishToProbSimplex=function(x){var d=ad.value(x).dims[0];var u=ad.tensor.reshape(ad.tensor.concat(x,ad.tensor.fromScalars(0)),[d+1,1]);return ad.tensor.softmax(u)};var LogisticNormal=makeDistributionType({name:"LogisticNormal",desc:"A distribution over probability vectors obtained by transforming a random variable "+"drawn from ``DiagCovGaussian({mu: mu, sigma: sigma})``. If ``mu`` and ``sigma`` have length ``d`` "+"then the distribution is over probability vectors of length ``d+1``.",params:[{name:"mu",desc:"mean vector"},{name:"sigma",desc:"vector of standard deviations",domain:gt(0)}],wikipedia:"Logit-normal_distribution#Multivariate_generalization",mixins:[continuousSupport,noHMC],constructor:function(){var _mu=ad.value(this.params.mu);var _sigma=ad.value(this.params.sigma);if(!util.isVector(_mu)){throw new Error(this.meta.name+": mu should be a vector.")}if(!util.isVector(_sigma)){throw new Error(this.meta.name+": sigma should be a vector.")}if(!util.tensorEqDim0(_mu,_sigma)){throw new Error(this.meta.name+": mu and sigma should have the same length.")}},sample:function(){return squishToProbSimplex(diagCovGaussianSample(ad.value(this.params.mu),ad.value(this.params.sigma)))},score:function(val){var mu=this.params.mu;var sigma=this.params.sigma;var _mu=ad.value(mu);var _val=ad.value(val);if(!util.isVector(_val)||_val.dims[0]-1!==_mu.dims[0]){return-Infinity}var d=_mu.dims[0];var u=ad.tensor.reshape(ad.tensor.range(val,0,d),[d,1]);var u_last=ad.tensor.get(val,d);var inv=ad.tensor.log(ad.tensor.div(u,u_last));var normScore=diagCovGaussianScore(mu,sigma,inv);return ad.scalar.sub(normScore,ad.tensor.sumreduce(ad.tensor.log(val)))},base:function(){var dims=ad.value(this.params.mu).dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return squishToProbSimplex(ad.tensor.add(ad.tensor.mul(sigma,x),mu))}});var LogitNormal=makeDistributionType({name:"LogitNormal",desc:"A distribution over ``(a,b)`` obtained by scaling and shifting a standard logit-normal.",params:[{name:"mu",desc:"location (real)"},{name:"sigma",desc:"scale (real)",domain:gt(0)},{name:"a",desc:"lower bound (real)"},{name:"b",desc:"upper bound (real) *(>a)*"}],wikipedia:"Logit-normal_distribution",mixins:[continuousSupport],sample:function(){var a=ad.value(this.params.a);var b=ad.value(this.params.b);var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);var x=gaussianSample(mu,sigma);return ad.scalar.sigmoid(x)*(b-a)+a},score:function(val){var a=this.params.a;var b=this.params.b;var y=ad.scalar.div(ad.scalar.sub(val,a),ad.scalar.sub(b,a));var x=ad.scalar.log(ad.scalar.div(y,ad.scalar.sub(1,y)));var gaussScore=gaussianScore(this.params.mu,this.params.sigma,x);return ad.scalar.sub(gaussScore,ad.scalar.log(ad.scalar.mul(ad.scalar.mul(y,ad.scalar.sub(1,y)),ad.scalar.sub(b,a))))},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var a=this.params.a;var b=this.params.b;var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.add(ad.scalar.mul(ad.scalar.sigmoid(ad.scalar.add(ad.scalar.mul(x,sigma),mu)),ad.scalar.sub(b,a)),a)},support:function(){return{lower:this.params.a,upper:this.params.b}}});var IspNormal=makeDistributionType({name:"IspNormal",nodoc:true,desc:"A distribution over positive reals obtained by mapping a Gaussian "+"distributed variable through the softplus function.",params:[{name:"mu",desc:"location (real)"},{name:"sigma",desc:"scale (real)",domain:gt(0)}],mixins:[continuousSupport],sample:function(){var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);return Math.log(Math.exp(gaussianSample(mu,sigma))+1)},score:function(val){var mu=this.params.mu;var sigma=this.params.sigma;var x=ad.scalar.log(ad.scalar.sub(ad.scalar.exp(val),1));return ad.scalar.sub(ad.scalar.add(gaussianScore(mu,sigma,x),val),x)},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.log(ad.scalar.add(ad.scalar.exp(ad.scalar.add(ad.scalar.mul(x,sigma),mu)),1))},support:function(){return{lower:0,upper:Infinity}}});function tensorGaussianSample(mu,sigma,dims){var x=new Tensor(dims);var n=x.length;while(n--){x.data[n]=gaussianSample(mu,sigma)}return x}function tensorGaussianScore(mu,sigma,dims,x){var _x=ad.value(x);if(!util.isTensor(_x)||!_.isEqual(_x.dims,dims)){return-Infinity}var d=_x.length;var dLog2Pi=d*LOG_2PI;var _2dLogSigma=ad.scalar.mul(2*d,ad.scalar.log(sigma));var sigma2=ad.scalar.pow(sigma,2);var xSubMu=ad.tensor.sub(x,mu);var z=ad.scalar.div(ad.tensor.sumreduce(ad.tensor.mul(xSubMu,xSubMu)),sigma2);return ad.scalar.mul(-.5,ad.scalar.sum(dLog2Pi,_2dLogSigma,z))}var TensorGaussian=makeDistributionType({name:"TensorGaussian",desc:"Distribution over a tensor of independent Gaussian variables.",params:[{name:"mu",desc:"mean"},{name:"sigma",desc:"standard deviation",domain:gt(0)},{name:"dims",desc:"dimension of tensor"}],mixins:[continuousSupport],constructor:function(){var _mu=ad.value(this.params.mu);var _sigma=ad.value(this.params.sigma);if(!_.isNumber(_mu)){throw new Error(this.meta.name+": mu should be a number.")}if(!_.isNumber(_sigma)){throw new Error(this.meta.name+": sigma should be a number.")}if(!Array.isArray(this.params.dims)){throw new Error(this.meta.name+": dims should be an array.")}},sample:function(){var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);var dims=this.params.dims;return tensorGaussianSample(mu,sigma,dims)},score:function(x){return tensorGaussianScore(this.params.mu,this.params.sigma,this.params.dims,x)},base:function(){var dims=this.params.dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.tensor.add(ad.tensor.mul(x,sigma),mu)}});var Cauchy=makeDistributionType({name:"Cauchy",desc:"Distribution over ``[-Infinity, Infinity]``",params:[{name:"location",desc:"(real in [-Infinity, Infinity])"},{name:"scale",desc:"(real)",domain:gt(0)}],wikipedia:true,mixins:[continuousSupport],sample:function(){var u=util.random();return ad.value(this.params.location)+ad.value(this.params.scale)*Math.tan(Math.PI*(u-.5))},score:function(x){var scale=this.params.scale;var location=this.params.location;return ad.scalar.sub(ad.scalar.sub(ad.scalar.neg(LOG_PI),ad.scalar.log(scale)),ad.scalar.log(ad.scalar.add(1,ad.scalar.pow(ad.scalar.div(ad.scalar.sub(x,location),scale),2))))},base:function(){return new Uniform({a:0,b:1})},transform:function(x){var location=this.params.location;var scale=this.params.scale;return ad.scalar.add(location,ad.scalar.mul(scale,ad.scalar.tan(ad.scalar.mul(ad.scalar.PI,ad.scalar.sub(x,.5)))))}});function sum(xs){return xs.reduce(function(a,b){return ad.scalar.add(a,b)},0)}function discreteScore(ps,i){var scoreFn=_.isArray(ps)?discreteScoreArray:discreteScoreVector;return scoreFn(ps,i)}function inDiscreteSupport(val,dim){return val===Math.floor(val)&&0<=val&&val<dim}function discreteScoreVector(probs,val){var _probs=ad.value(probs);assert.ok(ad.scalar.peq(_probs.rank,2));assert.ok(ad.scalar.peq(_probs.dims[1],1));var d=_probs.dims[0];return inDiscreteSupport(val,d)?ad.scalar.log(ad.scalar.div(T.get(probs,val),T.sumreduce(probs))):ad.scalar.neg(Infinity)}function discreteScoreArray(probs,val){var d=probs.length;return inDiscreteSupport(val,d)?ad.scalar.log(ad.scalar.div(probs[val],sum(probs))):ad.scalar.neg(Infinity)}function toUnliftedArray(x){return _.isArray(x)?x.map(ad.value):ad.value(x).data}var Discrete=makeDistributionType({name:"Discrete",desc:"Distribution over ``{0,1,...,ps.length-1}`` with P(i) proportional to ``ps[i]``",params:[{name:"ps",desc:"array or vector of probabilities (can be unnormalized)",domain:gt(0)}],wikipedia:"Categorical_distribution",mixins:[finiteSupport],sample:function(){return discreteSample(toUnliftedArray(this.params.ps))},score:function(val){return discreteScore(this.params.ps,val)},support:function(){return _.range(ad.value(this.params.ps).length)}});function gammaSample(shape,scale){if(shape<1){var r;r=gammaSample(1+shape,scale)*Math.pow(util.random(),1/shape);if(r===0){util.warn("gamma sample underflow, rounded to nearest representable support value");return Number.MIN_VALUE}return r}var x,v,u;var d=shape-1/3;var c=1/Math.sqrt(9*d);while(true){do{x=gaussianSample(0,1);v=1+c*x}while(v<=0);v=v*v*v;u=util.random();if(u<1-.331*x*x*x*x||Math.log(u)<.5*x*x+d*(1-v+Math.log(v))){return scale*d*v}}}function expGammaSample(shape,scale){if(shape<1){var r;r=expGammaSample(1+shape,scale)+Math.log(util.random())/shape;if(r===-Infinity){util.warn("log gamma sample underflow, rounded to nearest representable support value");return-Number.MAX_VALUE}return r}var x,v,u,log_v;var d=shape-1/3;var c=1/Math.sqrt(9*d);while(true){do{x=gaussianSample(0,1);v=1+c*x}while(v<=0);log_v=3*Math.log(v);v=v*v*v;u=util.random();if(u<1-.331*x*x*x*x||Math.log(u)<.5*x*x+d*(1-v+Math.log(v))){return Math.log(scale)+Math.log(d)+log_v}}}function expGammaScore(shape,scale,val){var x=val;return ad.scalar.sub(ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(ad.scalar.sub(shape,1),x),ad.scalar.div(ad.scalar.exp(x),scale)),ad.scalar.logGamma(shape)),ad.scalar.mul(shape,ad.scalar.log(scale)))}var Gamma=makeDistributionType({name:"Gamma",desc:"Distribution over positive reals.",params:[{name:"shape",desc:"shape parameter (real)",
domain:gt(0)},{name:"scale",desc:"scale parameter (real)",domain:gt(0)}],wikipedia:true,mixins:[continuousSupport],sample:function(){return gammaSample(ad.value(this.params.shape),ad.value(this.params.scale))},score:function(x){var shape=this.params.shape;var scale=this.params.scale;return ad.scalar.sub(ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(ad.scalar.sub(shape,1),ad.scalar.log(x)),ad.scalar.div(x,scale)),ad.scalar.logGamma(shape)),ad.scalar.mul(shape,ad.scalar.log(scale)))},support:function(){return{lower:0,upper:Infinity}}});var Exponential=makeDistributionType({name:"Exponential",desc:"Distribution over ``[0, Infinity]``",params:[{name:"a",desc:"rate (real)",domain:gt(0)}],wikipedia:true,mixins:[continuousSupport],sample:function(){var u=util.random();return Math.log(u)/(-1*ad.value(this.params.a))},score:function(val){return ad.scalar.sub(ad.scalar.log(this.params.a),ad.scalar.mul(this.params.a,val))},base:function(){return new Uniform({a:0,b:1})},transform:function(x){return ad.scalar.div(ad.scalar.log(x),ad.scalar.neg(this.params.a))},support:function(){return{lower:0,upper:Infinity}}});function logBeta(a,b){return ad.scalar.sub(ad.scalar.add(ad.scalar.logGamma(a),ad.scalar.logGamma(b)),ad.scalar.logGamma(ad.scalar.add(a,b)))}var Beta=makeDistributionType({name:"Beta",desc:"Distribution over ``[0, 1]``",params:[{name:"a",desc:"shape (real)",domain:gt(0)},{name:"b",desc:"shape (real)",domain:gt(0)}],wikipedia:true,mixins:[continuousSupport],sample:function(){return betaSample(ad.value(this.params.a),ad.value(this.params.b))},score:function(x){var a=this.params.a;var b=this.params.b;return ad.scalar.gt(x,0)&&ad.scalar.lt(x,1)?ad.scalar.sub(ad.scalar.add(ad.scalar.mul(ad.scalar.sub(a,1),ad.scalar.log(x)),ad.scalar.mul(ad.scalar.sub(b,1),ad.scalar.log(ad.scalar.sub(1,x)))),logBeta(a,b)):ad.scalar.neg(Infinity)},support:function(){return{lower:0,upper:1}}});function betaSample(a,b){var log_x=expGammaSample(a,1);var log_y=expGammaSample(b,1);var v=1/(1+Math.exp(log_y-log_x));if(v===0){util.warn("beta sample underflow, rounded to nearest representable support value");v=Number.MIN_VALUE}else if(v===1){util.warn("beta sample overflow, rounded to nearest representable support value");v=1-Number.EPSILON/2}return v}function binomialSample(p,n){var k=0;var N=10;var a,b;while(n>N){a=Math.floor(1+n/2);b=1+n-a;var x=betaSample(a,b);if(x>=p){n=a-1;p/=x}else{k+=a;n=b-1;p=(p-x)/(1-x)}}var u;for(var i=0;i<n;i++){u=util.random();if(u<p){k++}}return k||0}var Binomial=makeDistributionType({name:"Binomial",desc:"Distribution over the number of successes for ``n`` independent ``Bernoulli({p: p})`` trials.",params:[{name:"p",desc:"success probability",domain:interval(0,1)},{name:"n",desc:"number of trials (integer > 0)"}],wikipedia:true,mixins:[finiteSupport],sample:function(){return binomialSample(ad.value(this.params.p),this.params.n)},score:function(val){var p=this.params.p;var n=this.params.n;if(!(ad.scalar.peq(typeof val,"number")&&ad.scalar.geq(val,0)&&ad.scalar.leq(val,n)&&ad.scalar.peq(val%1,0))){return ad.scalar.neg(Infinity)}var logNumPermutations=0;var m,o;if(ad.scalar.lt(val,ad.scalar.sub(n,val))){m=val;o=ad.scalar.sub(n,val)}else{m=ad.scalar.sub(n,val);o=val}for(var i=ad.scalar.add(o,1);ad.scalar.leq(i,n);i++){logNumPermutations=ad.scalar.add(logNumPermutations,ad.scalar.log(i))}logNumPermutations=ad.scalar.sub(logNumPermutations,lnfactExact(m));return ad.scalar.add(ad.scalar.add(logNumPermutations,ad.scalar.eq(val,0)?0:ad.scalar.mul(val,ad.scalar.log(p))),ad.scalar.eq(ad.scalar.sub(n,val),0)?0:ad.scalar.mul(ad.scalar.sub(n,val),ad.scalar.log(ad.scalar.sub(1,p))))},support:function(){return _.range(0,this.params.n+1)}});function zeros(n){var a=new Array(n);for(var i=0;i<n;i++){a[i]=0}return a}function multinomialSample(theta,n){var a=zeros(theta.length);for(var i=0;i<n;i++){a[discreteSample(theta)]++}return a}var Multinomial=makeDistributionType({name:"Multinomial",desc:"Distribution over counts for ``n`` independent ``Discrete({ps: ps})`` trials.",params:[{name:"ps",desc:"probabilities (array of reals that sum to 1)",domain:interval(0,1)},{name:"n",desc:"number of trials (integer > 0)"}],wikipedia:true,mixins:[finiteSupport],sample:function(){return multinomialSample(this.params.ps.map(ad.value),this.params.n)},score:function(val){if(ad.scalar.pneq(sum(val),this.params.n)){return ad.scalar.neg(Infinity)}var x=[];var y=[];for(var i=0;ad.scalar.lt(i,this.params.ps.length);i++){x[i]=lnfact(val[i]);y[i]=ad.scalar.mul(val[i],ad.scalar.log(this.params.ps[i]))}return ad.scalar.add(ad.scalar.sub(lnfact(this.params.n),sum(x)),sum(y))},support:function(){var combinations=allDiscreteCombinations(this.params.n,this.params.ps,[],0);var toHist=function(l){return buildHistogramFromCombinations(l,this.params.ps)}.bind(this);var hists=combinations.map(toHist);return hists}});function allDiscreteCombinations(k,states,got,pos){var support=[];if(got.length==k){return[_.clone(got)]}for(var i=pos;i<states.length;i++){got.push(i);support=support.concat(allDiscreteCombinations(k,states,got,i));got.pop()}return support}function buildHistogramFromCombinations(samples,states){var stateIndices=_.range(states.length);var zeroHist=_.chain(stateIndices).map(function(i){return[i,0]}).object().value();var hist=_.defaults(_.countBy(samples),zeroHist);var array=_.sortBy(hist,function(val,key){return key});return array}function fact(x){var t=1;while(ad.scalar.gt(x,1)){t=ad.scalar.mul(t,x);x=ad.scalar.sub(x,1)}return t}function lnfact(x){if(ad.scalar.lt(x,1)){x=1}if(ad.scalar.lt(x,12)){return ad.scalar.log(fact(ad.scalar.round(x)))}var invx=ad.scalar.div(1,x);var invx2=ad.scalar.mul(invx,invx);var invx3=ad.scalar.mul(invx2,invx);var invx5=ad.scalar.mul(invx3,invx2);var invx7=ad.scalar.mul(invx5,invx2);var sum=ad.scalar.sub(ad.scalar.mul(ad.scalar.add(x,.5),ad.scalar.log(x)),x);sum=ad.scalar.add(sum,ad.scalar.div(ad.scalar.log(ad.scalar.mul(2,ad.scalar.PI)),2));sum=ad.scalar.add(sum,ad.scalar.sub(ad.scalar.div(invx,12),ad.scalar.div(invx3,360)));sum=ad.scalar.add(sum,ad.scalar.sub(ad.scalar.div(invx5,1260),ad.scalar.div(invx7,1680)));return sum}function lnfactExact(x){if(ad.scalar.lt(x,0)){throw new Error(ad.scalar.add("lnfactExact called on negative argument ",x))}if(ad.scalar.lt(x,1)){x=1}var t=0;while(ad.scalar.gt(x,1)){t=ad.scalar.add(t,ad.scalar.log(x));x=ad.scalar.sub(x,1)}return t}var Poisson=makeDistributionType({name:"Poisson",desc:"Distribution over integers.",params:[{name:"mu",desc:"mean (real)",domain:gt(0)}],wikipedia:true,sample:function(){var k=0;var mu=ad.value(this.params.mu);while(mu>10){var m=7/8*mu;var x=gammaSample(m,1);if(x>mu){return k+binomialSample(mu/x,m-1)||0}else{mu-=x;k+=m}}var emu=Math.exp(-mu);var p=1;do{p*=util.random();k++}while(p>emu);return k-1||0},score:function(val){return ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(val,ad.scalar.log(this.params.mu)),this.params.mu),lnfact(val))}});function dirichletSample(alpha){assert.ok(alpha.rank===2);assert.ok(alpha.dims[1]===1);var n=alpha.dims[0];var ssum=0;var theta=new Tensor([n,1]);var t;for(var i=0;i<n;i++){t=gammaSample(alpha.data[i],1);theta.data[i]=t;ssum+=t}for(var j=0;j<n;j++){theta.data[j]/=ssum;if(theta.data[j]===0){theta.data[j]=Number.MIN_VALUE}if(theta.data[j]===1){theta.data[j]=1-Number.EPSILON/2}}return theta}function dirichletScore(alpha,val){var _val=ad.value(val);var _alpha=ad.value(alpha);if(!util.isVector(_val)||!util.tensorEqDim0(_val,_alpha)){return-Infinity}return ad.scalar.add(ad.tensor.sumreduce(ad.tensor.sub(ad.tensor.mul(ad.tensor.sub(alpha,1),ad.tensor.log(val)),ad.tensor.logGamma(alpha))),ad.scalar.logGamma(ad.tensor.sumreduce(alpha)))}var Dirichlet=makeDistributionType({name:"Dirichlet",desc:"Distribution over probability vectors. "+"If ``alpha`` has length ``d`` then the distribution "+"is over probability vectors of length ``d``.",params:[{name:"alpha",desc:"vector of concentration parameters",domain:gt(0)}],wikipedia:true,mixins:[continuousSupport,noHMC],constructor:function(){var _alpha=ad.value(this.params.alpha);if(!util.isVector(_alpha)){throw new Error(this.meta.name+": alpha should be a vector.")}},sample:function(){return dirichletSample(ad.value(this.params.alpha))},score:function(val){return dirichletScore(this.params.alpha,val)}});function discreteSample(theta){var thetaSum=util.sum(theta);var x=util.random()*thetaSum;var k=theta.length;var probAccum=0;for(var i=0;i<k;i++){probAccum+=theta[i];if(x<probAccum){return i}}return k-1}var Marginal=makeDistributionType({name:"Marginal",nodoc:true,nohelper:true,params:[{name:"dist"}],mixins:[finiteSupport],constructor:function(){var norm=_.reduce(this.params.dist,function(acc,obj){return ad.scalar.add(acc,obj.prob)},0);assert.ok(ad.scalar.lt(ad.scalar.abs(ad.scalar.sub(1,norm)),1e-8),"Expected marginal distribution to be normalized.");this.supp=_.map(this.params.dist,function(obj){return obj.val});this.getDist=function(){return this.params.dist}},sample:function(){var x=util.random();var dist=this.params.dist;var probAccum=0;for(var i in dist){if(dist.hasOwnProperty(i)){probAccum=ad.scalar.add(probAccum,dist[i].prob);if(ad.scalar.lt(x,probAccum)){return dist[i].val}}}return this.params.dist[i].val},score:function(val){var obj=this.params.dist[util.serialize(val)];return obj?ad.scalar.log(obj.prob):ad.scalar.neg(Infinity)},support:function(){return this.supp},print:function(){return printMarginal(this.params.dist)}});var SampleBasedMarginal=makeDistributionType({name:"SampleBasedMarginal",nodoc:true,nohelper:true,params:[{name:"samples"}],mixins:[finiteSupport],constructor:function(){if(!_.isArray(this.params.samples)||this.params.samples.length===0){throw new Error("Expected samples to be a non-empty array.")}this.samples=this.params.samples;this.getDist=function(){if(this._cacheddist){return this._cacheddist}else{var dist={};this.params.samples.forEach(function(obj){var val=obj.value;var key=util.serialize(val);if(dist[key]===undefined){dist[key]={val:val,prob:0}}dist[key].prob+=1});var n=this.params.samples.length;_.each(dist,function(obj){obj.prob/=n});this._cacheddist=dist;return dist}}},sample:function(){var n=this.params.samples.length;return this.params.samples[Math.floor(util.random()*n)].value},score:function(val){var key=util.serialize(val);var obj=this.getDist()[key];return obj===undefined?-Infinity:Math.log(obj.prob)},support:function(){if(this.params.samples.length===1){return[this.params.samples[0].value]}else if(this._cachedsupport){return this._cachedsupport}else{var support=_.map(this.getDist(),_.property("val"));this._cachedsupport=support;return support}},print:function(){return printMarginal(this.getDist())}});function printMarginal(dist){return"Marginal:\n"+_.map(dist,function(obj,val){return[val,obj.prob]}).sort(function(a,b){return b[1]-a[1]}).map(function(pair){return"    "+pair[0]+" : "+pair[1]}).join("\n")}var Categorical=makeDistributionType({name:"Categorical",desc:"Distribution over elements of ``vs`` with ``P(vs[i])`` proportional to ``ps[i]``",params:[{name:"ps",desc:"array or vector of probabilities (can be unnormalized)",domain:gt(0)},{name:"vs",desc:"support (array of values)"}],wikipedia:true,nohelper:true,mixins:[finiteSupport],constructor:function(){this.ixmap=_.object(this.params.vs.map(function(v,ix){return[util.serialize(v),ix]}))},sample:function(){var ix=discreteSample(toUnliftedArray(this.params.ps));var vs=this.params.vs.map(ad.value);return vs[ix]},score:function(val){var ix=this.ixmap[util.serialize(val)];return discreteScore(this.params.ps,ix)},support:function(){return this.params.vs}});var Delta=makeDistributionType({name:"Delta",desc:"Discrete distribution that assigns probability one to the single "+"element in its support. This is only useful in special circumstances as sampling "+"from ``Delta({v: val})`` can be replaced with ``val`` itself. Furthermore, a ``Delta`` "+"distribution parameterized by a random choice should not be used with MCMC based inference, "+"as doing so produces incorrect results.",params:[{name:"v",desc:"support element"}],mixins:[finiteSupport],sample:function(){return ad.value(this.params.v)},score:function(val){return ad.value(val)===ad.value(this.params.v)?0:-Infinity},support:function(){return[this.params.v]},base:function(){return this},transform:function(x){return this.params.v}});function metadata(){return _.chain(distributions).pairs().sortBy(function(pair){return pair[0]}).map(function(pair){return pair[1]}).map(function(dist){return dist.prototype.meta}).value()}var distributions={Uniform:Uniform,ImproperUniform:ImproperUniform,Bernoulli:Bernoulli,MultivariateBernoulli:MultivariateBernoulli,RandomInteger:RandomInteger,Gaussian:Gaussian,MultivariateGaussian:MultivariateGaussian,DiagCovGaussian:DiagCovGaussian,TensorGaussian:TensorGaussian,LogisticNormal:LogisticNormal,LogitNormal:LogitNormal,IspNormal:IspNormal,Cauchy:Cauchy,Discrete:Discrete,Gamma:Gamma,Exponential:Exponential,Beta:Beta,Binomial:Binomial,Multinomial:Multinomial,Poisson:Poisson,Dirichlet:Dirichlet,Marginal:Marginal,SampleBasedMarginal:SampleBasedMarginal,Categorical:Categorical,Delta:Delta};module.exports=_.assign({betaSample:betaSample,binomialSample:binomialSample,discreteSample:discreteSample,gaussianSample:gaussianSample,tensorGaussianSample:tensorGaussianSample,gammaSample:gammaSample,dirichletSample:dirichletSample,serialize:serialize,deserialize:deserialize,squishToProbSimplex:squishToProbSimplex,isDist:isDist,metadata:metadata},distributions)},{"./ad.js":150,"./domain":155,"./tensor":186,"./util":200,assert:216,underscore:148,util:339}],155:[function(require,module,exports){"use strict";function RealInterval(a,b){this.a=a;this.b=b}function gt(a){return new RealInterval(a,Infinity)}function lt(b){return new RealInterval(-Infinity,b)}function interval(a,b){return new RealInterval(a,b)}function Simplex(){}var simplex=new Simplex;module.exports={RealInterval:RealInterval,gt:gt,lt:lt,interval:interval,simplex:simplex}},{}],156:[function(require,module,exports){"use strict";var _=require("underscore");var errors=require("./errors");var parseV8=require("./parsers").parseV8;function isChrome(){return window.chrome&&window.chrome.runtime}function extendErrorChrome(error,fileName){var stack=errors.recoverStack(error,parseV8);var entry=_.findWhere(stack,{fileName:fileName});error.wpplError=entry}function debugHandler(fileName){return function(error){if(error instanceof Error&&isChrome()){extendErrorChrome(error,fileName)}throw error}}module.exports={debugHandler:debugHandler}},{"./errors":157,"./parsers":158,underscore:148}],157:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var SourceMap=require("source-map");var util=require("../util");function extendError(error,assets,currentAddress){if(error instanceof Error){error.sourceMap=assets.sourceMap;error.wpplCallStack=addressToWpplCallStack(currentAddress.value,assets.addressMap);error.wpplRuntimeError=true}}function addressToStack(address){if(address===undefined){return[]}var addUnderscore=function(s){return"_"+s};var split=address.split("_").slice(1).map(addUnderscore);split.reverse();return split}function addressToWpplCallStack(address,addressMap){var stack=addressToStack(address);return _.chain(stack).map(function(id){var loc=addressMap[id];return loc&&{fileName:loc.source,lineNumber:loc.start.line,columnNumber:loc.start.column,"native":false,webppl:true,name:loc.name,id:id}}).filter().value()}function recoverStack(error,parseStack){return util.pipeline([parseStack,filterJsStackTrace,function(s){return sourceMapJsStackTrace(s,error.sourceMap)},function(s){return s.concat(error.wpplCallStack)}])(error)}function filterJsStackTrace(stackTrace){var ix=_.findIndex(stackTrace,_.matcher({webppl:true}));return ix>=0?stackTrace.slice(0,ix+1):stackTrace}function filterGensym(name){return name===null||name.slice(0,7)==="_result"?null:name}function sourceMapJsStackTrace(stackTrace,sourceMap){var map=new SourceMap.SourceMapConsumer(sourceMap);return _.chain(stackTrace).map(function(entry){if(entry.webppl){var pos=map.originalPositionFor({line:entry.lineNumber,column:entry.columnNumber});return positionPopulated(pos)?{fileName:pos.source,lineNumber:pos.line,columnNumber:pos.column,"native":entry.native,webppl:true,name:filterGensym(pos.name)}:null}else{return entry}}).filter().value()}function positionPopulated(pos){return pos.source!==null&&pos.line!==null&&pos.column!==null}module.exports={recoverStack:recoverStack,extendError:extendError}},{"../util":200,assert:216,"source-map":146,underscore:148}],158:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var stackTrace=require("stack-trace");function parseV8(error){assert.ok(error instanceof Error);var parsed=stackTrace.parse(error);return parsed.map(function(entry){var e=_.pick(entry,"fileName","lineNumber","columnNumber","native");e.webppl=entry.fileName==="<anonymous>";if(entry.columnNumber!==null){e.columnNumber=entry.columnNumber-1}e.name=null;return e})}module.exports={parseV8:parseV8}},{assert:216,"stack-trace":147,underscore:148}],159:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var util=require("./util");var Tensor=require("./tensor");var ad=require("./ad");var dists=require("./dists");var domains=require("./domain");var T=ad.tensor;function independent(targetDist,sampleAddress,env){var relativeAddress=util.relativizeAddress(env,sampleAddress);var baseName=relativeAddress+"$mf$"+targetDist.meta.name+"$";var distSpec=spec(targetDist);var guideParams=_.mapObject(distSpec.params,function(spec,name){return _.has(spec,"param")?makeParam(spec.param,name,baseName,env):spec.const});return new distSpec.type(guideParams)}function makeParam(paramSpec,paramName,baseName,env){var dims=paramSpec.dims;var domain=paramSpec.domain;var name=baseName+paramName;var viParamDim,squish;if(domain){var ret=squishFn(domain,dims);viParamDim=ret.dimsIn;squish=ret.f}else{viParamDim=dims}var param=registerParam(env,name,viParamDim);if(squish){param=squish(param)}if(dims.length===1&&dims[0]===1){param=ad.tensor.get(param,0)}return param}function registerParam(env,name,dims){return util.registerParams(env,name,function(){return[new Tensor(dims)]})[0]}function spec(targetDist){if(targetDist instanceof dists.Dirichlet){return dirichletSpec(targetDist)}else if(targetDist instanceof dists.TensorGaussian){return tensorGaussianSpec(targetDist)}else if(targetDist instanceof dists.Uniform){return uniformSpec(targetDist)}else if(targetDist instanceof dists.Gamma){return gammaSpec(targetDist)}else if(targetDist instanceof dists.Beta){return betaSpec(targetDist)}else if(targetDist instanceof dists.Discrete){return discreteSpec(targetDist)}else if(targetDist instanceof dists.RandomInteger||targetDist instanceof dists.Binomial||targetDist instanceof dists.MultivariateGaussian){throwAutoGuideError(targetDist)}else{return defaultSpec(targetDist)}}function throwAutoGuideError(targetDist){var msg="Cannot automatically generate a guide for a "+targetDist.meta.name+" distribution.";throw new Error(msg)}function defaultSpec(targetDist){var paramSpec=_.map(targetDist.meta.params,function(paramMeta){var name=paramMeta.name;var targetParam=ad.value(targetDist.params[name]);var dims;if(targetParam instanceof Tensor){dims=targetParam.dims}else if(_.isNumber(targetParam)){dims=[1]}else{throwAutoGuideError(targetDist)}return[name,{param:{dims:dims,domain:paramMeta.domain}}]});return{type:targetDist.constructor,params:_.object(paramSpec)}}function dirichletSpec(targetDist){var d=ad.value(targetDist.params.alpha).length-1;return{type:dists.LogisticNormal,params:{mu:{param:{dims:[d,1]}},sigma:{param:{dims:[d,1],domain:domains.gt(0)}}}}}function tensorGaussianSpec(targetDist){var dims=targetDist.params.dims;return{type:dists.DiagCovGaussian,params:{mu:{param:{dims:dims}},sigma:{param:{dims:dims,domain:domains.gt(0)}}}}}function uniformSpec(targetDist){return{type:dists.LogitNormal,params:{a:{"const":targetDist.params.a},b:{"const":targetDist.params.b},mu:{param:{dims:[1]}},sigma:{param:{dims:[1],domain:domains.gt(0)}}}}}function betaSpec(targetDist){return{type:dists.LogitNormal,params:{a:{"const":0},b:{"const":1},mu:{param:{dims:[1]}},sigma:{param:{dims:[1],domain:domains.gt(0)}}}}}function gammaSpec(targetDist){return{type:dists.IspNormal,params:{mu:{param:{dims:[1]}},sigma:{param:{dims:[1],domain:domains.gt(0)}}}}}function discreteSpec(targetDist){var d=ad.value(targetDist.params.ps).length;return{type:dists.Discrete,params:{ps:{param:{dims:[d,1],domain:domains.simplex}}}}}function softplus(x){return T.log(T.add(T.exp(x),1))}function squishFn(domain,dimsOut){if(domain instanceof domains.RealInterval){return{dimsIn:dimsOut,f:squishToInterval(domain)}}else if(domain===domains.simplex){if(dimsOut.length!==2||dimsOut[1]!==1){throw new Error("Can only map vectors to the probability simplex.")}return{dimsIn:[dimsOut[0]-1,1],f:dists.squishToProbSimplex}}else{throw new Error("Unknown domain type.")}}function squishToInterval(domain){var a=domain.a;var b=domain.b;if(a===-Infinity){return function(x){var y=softplus(x);return T.add(T.neg(y),b)}}else if(b===Infinity){return function(x){var y=softplus(x);return T.add(y,a)}}else{return function(x){var y=T.sigmoid(x);return T.add(T.mul(y,b-a),a)}}}module.exports={independent:independent}},{"./ad":150,"./dists":154,"./domain":155,"./tensor":186,"./util":200,assert:216,underscore:148}],160:[function(require,module,exports){var FUNCTION="function",STRING="string",UNDEFINED=undefined;function toStr(obj){return typeof obj==STRING?obj:""+obj}function hashObject(obj){var hashCode;if(typeof obj==STRING){return obj}else if(typeof obj.hashCode==FUNCTION){hashCode=obj.hashCode();return typeof hashCode==STRING?hashCode:hashObject(hashCode)}else{return toStr(obj)}}function merge(o1,o2){for(var i in o2){if(o2.hasOwnProperty(i)){o1[i]=o2[i]}}}function equals_fixedValueHasEquals(fixedValue,variableValue){return fixedValue.equals(variableValue)}function equals_fixedValueNoEquals(fixedValue,variableValue){return typeof variableValue.equals==FUNCTION?variableValue.equals(fixedValue):fixedValue===variableValue}function createKeyValCheck(kvStr){return function(kv){if(kv===null){throw new Error("null is not a valid "+kvStr)}else if(kv===UNDEFINED){throw new Error(kvStr+" must not be undefined")}}}var checkKey=createKeyValCheck("key"),checkValue=createKeyValCheck("value");function Bucket(hash,firstKey,firstValue,equalityFunction){this[0]=hash;this.entries=[];this.addEntry(firstKey,firstValue);if(equalityFunction!==null){this.getEqualityFunction=function(){return equalityFunction}}}var EXISTENCE=0,ENTRY=1,ENTRY_INDEX_AND_VALUE=2;function createBucketSearcher(mode){return function(key){var i=this.entries.length,entry,equals=this.getEqualityFunction(key);while(i--){entry=this.entries[i];if(equals(key,entry[0])){switch(mode){case EXISTENCE:return true;case ENTRY:return entry;case ENTRY_INDEX_AND_VALUE:return[i,entry[1]]}}}return false}}function createBucketLister(entryProperty){return function(aggregatedArr){var startIndex=aggregatedArr.length;for(var i=0,entries=this.entries,len=entries.length;i<len;++i){aggregatedArr[startIndex+i]=entries[i][entryProperty]}}}Bucket.prototype={getEqualityFunction:function(searchValue){return typeof searchValue.equals==FUNCTION?equals_fixedValueHasEquals:equals_fixedValueNoEquals},getEntryForKey:createBucketSearcher(ENTRY),getEntryAndIndexForKey:createBucketSearcher(ENTRY_INDEX_AND_VALUE),removeEntryForKey:function(key){var result=this.getEntryAndIndexForKey(key);if(result){this.entries.splice(result[0],1);return result[1]}return null},addEntry:function(key,value){this.entries.push([key,value])},keys:createBucketLister(0),values:createBucketLister(1),getEntries:function(destEntries){var startIndex=destEntries.length;for(var i=0,entries=this.entries,len=entries.length;i<len;++i){destEntries[startIndex+i]=entries[i].slice(0)}},containsKey:createBucketSearcher(EXISTENCE),containsValue:function(value){var entries=this.entries,i=entries.length;while(i--){if(value===entries[i][1]){return true}}return false}};function searchBuckets(buckets,hash){var i=buckets.length,bucket;while(i--){bucket=buckets[i];if(hash===bucket[0]){return i}}return null}function getBucketForHash(bucketsByHash,hash){var bucket=bucketsByHash[hash];return bucket&&bucket instanceof Bucket?bucket:null}function Hashtable(){var buckets=[];var bucketsByHash={};var properties={replaceDuplicateKey:true,hashCode:hashObject,equals:null};var size=0;var biggestBucket=null;var arg0=arguments[0],arg1=arguments[1];if(arg1!==UNDEFINED){properties.hashCode=arg0;properties.equals=arg1}else if(arg0!==UNDEFINED){merge(properties,arg0)}var hashCode=properties.hashCode,equals=properties.equals;this.properties=properties;this.put=function(key,value){checkKey(key);checkValue(value);var hash=hashCode(key),bucket,bucketEntry,oldValue=null;bucket=getBucketForHash(bucketsByHash,hash);if(bucket){bucketEntry=bucket.getEntryForKey(key);if(bucketEntry){if(properties.replaceDuplicateKey){bucketEntry[0]=key}oldValue=bucketEntry[1];bucketEntry[1]=value}else{bucket.addEntry(key,value);size++;if(biggestBucket===null||bucket.entries.length>biggestBucket.entries.length)biggestBucket=bucket}}else{bucket=new Bucket(hash,key,value,equals);buckets.push(bucket);bucketsByHash[hash]=bucket;size++;if(biggestBucket===null||bucket.entries.length>biggestBucket.entries.length)biggestBucket=bucket}return oldValue};this.get=function(key){checkKey(key);var hash=hashCode(key);var bucket=getBucketForHash(bucketsByHash,hash);if(bucket){var bucketEntry=bucket.getEntryForKey(key);if(bucketEntry){return bucketEntry[1]}}return null};this.containsKey=function(key){checkKey(key);var bucketKey=hashCode(key);var bucket=getBucketForHash(bucketsByHash,bucketKey);return bucket?bucket.containsKey(key):false};this.containsValue=function(value){checkValue(value);var i=buckets.length;while(i--){if(buckets[i].containsValue(value)){return true}}return false};this.clear=function(){buckets.length=0;bucketsByHash={};size=0;biggestBucket=null};this.isEmpty=function(){return!buckets.length};var createBucketAggregator=function(bucketFuncName){return function(){var aggregated=[],i=buckets.length;while(i--){buckets[i][bucketFuncName](aggregated)}return aggregated}};this.keys=createBucketAggregator("keys");this.values=createBucketAggregator("values");this.entries=createBucketAggregator("getEntries");this.remove=function(key){checkKey(key);var hash=hashCode(key),bucketIndex,oldValue=null;var bucket=getBucketForHash(bucketsByHash,hash);if(bucket){oldValue=bucket.removeEntryForKey(key);if(oldValue!==null){if(bucket.entries.length==0){bucketIndex=searchBuckets(buckets,hash);buckets.splice(bucketIndex,1);delete bucketsByHash[hash]}size--;if(biggestBucket===bucket){if(buckets.length===0)biggestBucket=null;else{biggestBucket=buckets[0];var i=buckets.length;while(i--){if(buckets[i].entries.length>biggestBucket.entries.length)biggestBucket=buckets[i]}}}}}return oldValue};this.equals=function(hashtable){var keys,key,val,count=size;if(count==hashtable.size){keys=this.keys();while(count--){key=keys[count];val=hashtable.get(key);if(val===null||val!==this.get(key)){return false}}return true}return false};this.getRandom=function(){var L=biggestBucket.entries.length;while(true){var bi=Math.floor(util.random()*buckets.length);var bucket=buckets[bi];var p=Math.floor(util.random()*L);if(p<bucket.entries.length)return bucket.entries[p][1]}}}Hashtable.prototype={each:function(callback){var entries=this.entries(),i=entries.length,entry;while(i--){entry=entries[i];callback(entry[0],entry[1])}},putAll:function(hashtable,conflictCallback){var entries=hashtable.entries();var entry,key,value,thisValue,i=entries.length;var hasConflictCallback=typeof conflictCallback==FUNCTION;while(i--){entry=entries[i];key=entry[0];value=entry[1];if(hasConflictCallback&&(thisValue=this.get(key))){value=conflictCallback(key,thisValue,value)}this.put(key,value)}},clone:function(){var clone=new Hashtable(this.properties);clone.putAll(this);return clone}};Hashtable.prototype.toQueryString=function(){var entries=this.entries(),i=entries.length,entry;var parts=[];while(i--){entry=entries[i];parts[i]=encodeURIComponent(toStr(entry[0]))+"="+encodeURIComponent(toStr(entry[1]))}return parts.join("&")};module.exports={Hashtable:Hashtable}},{}],161:[function(require,module,exports){(function(process,global){"use strict";var assert=require("assert");var _=require("underscore");var nn=require("adnn/nn");try{var util=require("./util");var dists=require("./dists");var enumerate=require("./inference/enumerate");var mcmc=require("./inference/mcmc");var asyncpf=require("./inference/asyncpf");var pmcmc=require("./inference/pmcmc");var smc=require("./inference/smc");var rejection=require("./inference/rejection");var incrementalmh=require("./inference/incrementalmh");var optimize=require("./inference/optimize");var forwardSample=require("./inference/forwardSample");var headerUtils=require("./headerUtils");var Query=require("./query").Query;var ad=require("./ad");var Tensor=require("./tensor")}catch(e){if(e.code==="MODULE_NOT_FOUND"){console.error(e.message);console.error("Run ./scripts/adify and try again.");process.exit()}else{throw e}}module.exports=function(env){env.defaultCoroutine={sample:function(s,k,a,dist){return k(s,dist.sample())},factor:function(){throw new Error("factor allowed only inside inference.")},exit:function(s,r){return r},incrementalize:function(s,k,a,fn,args){var args=[s,k,a].concat(args);return fn.apply(global,args)},a:""};env.reset=function(){env.coroutine=env.defaultCoroutine};env.reset();env.sample=function(s,k,a,dist,options){if(!dists.isDist(dist)){throw new Error('sample() expected a distribution but received "'+JSON.stringify(dist)+'".')}return env.coroutine.sample(s,k,a,dist,options)};env.factor=function(s,k,a,score){assert.ok(!isNaN(ad.value(score)),"factor() score was NaN");return env.coroutine.factor(s,k,a,score)};env.sampleWithFactor=function(s,k,a,dist,scoreFn){if(typeof env.coroutine.sampleWithFactor==="function"){return env.coroutine.sampleWithFactor(s,k,a,dist,scoreFn)}else{var sampleK=function(s,v){var scoreK=function(s,sc){var factorK=function(s){return k(s,v)};return env.factor(s,factorK,a+"swf2",sc)};return scoreFn(s,scoreK,a+"swf1",v)};return env.sample(s,sampleK,a,dist)}};env.exit=function(s,retval){return env.coroutine.exit(s,retval)};env.incrementalize=function(s,k,a,fn,args){args=args||[];return env.coroutine.incrementalize(s,k,a,fn,args)};env.query=new Query;var exports={_top:util.runningInBrowser()?window:global};function addExports(obj){_.extend(exports,obj)}addExports({factor:env.factor,sample:env.sample,sampleWithFactor:env.sampleWithFactor,incrementalize:env.incrementalize,query:env.query});addExports({_:_,util:util,assert:assert,ad:ad,nn:nn,T:ad.tensor,dists:dists});var headerModules=[enumerate,asyncpf,mcmc,incrementalmh,pmcmc,smc,rejection,optimize,forwardSample,headerUtils];headerModules.forEach(function(mod){addExports(mod(env))});return exports}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":150,"./dists":154,"./headerUtils":162,"./inference/asyncpf":163,"./inference/enumerate":167,"./inference/forwardSample":169,"./inference/incrementalmh":171,"./inference/mcmc":174,"./inference/optimize":176,"./inference/pmcmc":177,"./inference/rejection":178,"./inference/smc":179,"./query":184,"./tensor":186,"./util":200,_process:306,"adnn/nn":15,assert:216,underscore:148}],162:[function(require,module,exports){(function(global){"use strict";var _=require("underscore");var serialize=require("./util").serialize;var Tensor=require("./tensor");var LRU=require("lru-cache");var ad=require("./ad");var assert=require("assert");var util=require("./util");var dists=require("./dists");module.exports=function(env){
function display(s,k,a,x){return k(s,console.log(ad.valueRec(x)))}function cache(s,k,a,f,maxSize){var c=LRU(maxSize);var cf=function(s,k,a){var args=Array.prototype.slice.call(arguments,3);var stringedArgs=serialize(args);if(c.has(stringedArgs)){return k(s,c.get(stringedArgs))}else{var newk=function(s,r){if(c.has(stringedArgs)){console.log("Already in cache:",stringedArgs);if(serialize(c.get(stringedArgs))!==serialize(r)){console.log("OLD AND NEW CACHE VALUE DIFFER!");console.log("Old value:",c.get(stringedArgs));console.log("New value:",r)}}c.set(stringedArgs,r);if(!maxSize&&c.length===1e4){console.log(c.length+" function calls have been cached.");console.log("The size of the cache can be limited by calling cache(f, maxSize).")}return k(s,r)};return f.apply(this,[s,newk,a].concat(args))}};return k(s,cf)}function apply(s,k,a,wpplFn,args){return wpplFn.apply(global,[s,k,a].concat(args))}var __uniqueid=0;var _Fn={tag:function(fn,lexid,freevarvals){fn.__lexid=lexid;fn.__uniqueid=__uniqueid++;fn.__freeVarVals=freevarvals;return fn}};var _addr={save:function(obj,address){obj.value=address}};var zeros=function(s,k,a,dims){return k(s,new Tensor(dims))};var ones=function(s,k,a,dims){return k(s,new Tensor(dims).fill(1))};var dimsForScalarParam=[1];var param=function(s,k,a,options){options=util.mergeDefaults(options,{mu:0,sigma:.1,dims:dimsForScalarParam});var mu=options.mu;var sigma=options.sigma;var dims=options.dims;var name=_.has(options,"name")?options.name:util.relativizeAddress(env,a);var val=util.registerParams(env,name,function(){var val=new Tensor(dims);if(sigma===0){val.fill(mu)}else{for(var i=0;i<val.length;i++){val.data[i]=dists.gaussianSample(mu,sigma)}}return[val]})[0];return k(s,dims===dimsForScalarParam?ad.tensor.get(val,0):val)};function mapData(s,k,a,opts,obsFn){opts=opts||{};var data=opts.data;if(!_.isArray(data)){throw new Error("mapData: No data given.")}var batchSize=opts.batchSize!==undefined?opts.batchSize:data.length;if(batchSize<0||batchSize>data.length){throw new Error("mapData: Invalid batchSize.")}var ix=env.coroutine.mapDataFetch?env.coroutine.mapDataFetch(data,batchSize,a):null;assert.ok(ix===null||_.isArray(ix));var doReturn=ix===null;return cpsMapData(s,function(s,v){if(env.coroutine.mapDataFinal){env.coroutine.mapDataFinal(a)}return k(s,doReturn?v:undefined)},a,data,ix,obsFn)}function cpsMapData(s,k,a,data,indices,f,acc,i){i=i===undefined?0:i;acc=acc===undefined?[]:acc;var length=indices===null?data.length:indices.length;if(i===length){return k(s,acc)}else{var ix=indices===null?i:indices[i];if(env.coroutine.mapDataEnter){env.coroutine.mapDataEnter()}return f(s,function(s,v){if(env.coroutine.mapDataLeave){env.coroutine.mapDataLeave()}return function(){return cpsMapData(s,k,a,data,indices,f,acc.concat([v]),i+1)}},a.concat("_$$"+ix),data[ix],ix)}}return{display:display,cache:cache,apply:apply,_Fn:_Fn,_addr:_addr,zeros:zeros,ones:ones,param:param,mapData:mapData}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":150,"./dists":154,"./tensor":186,"./util":200,assert:216,"lru-cache":123,underscore:148}],163:[function(require,module,exports){"use strict";var _=require("underscore");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function copyOneParticle(particle){return{continuation:particle.continuation,weight:particle.weight,completed:particle.completed,factorIndex:particle.factorIndex,value:particle.value,numChildrenToSpawn:1,multiplicity:particle.multiplicity,store:_.clone(particle.store)}}function initParticle(s,cont){return{continuation:cont,weight:0,completed:false,factorIndex:undefined,value:undefined,numChildrenToSpawn:0,multiplicity:1,store:_.clone(s)}}function AsyncPF(s,k,a,wpplFn,options){util.throwUnlessOpts(options,"AsyncPF");this.numParticles=0;this.bufferSize=options.bufferSize==undefined?options.particles:options.bufferSize;this.initNumParticles=Math.floor(this.bufferSize*(1/2));this.exitK=function(s){return wpplFn(s,env.exit,a)};this.store=s;this.buffer=[];for(var i=0;i<this.initNumParticles;i++){this.buffer.push(initParticle(this.store,this.exitK))}this.obsWeights={};this.exitedParticles=0;this.hist=new CountAggregator;this.k=k;this.oldCoroutine=env.coroutine;env.coroutine=this;this.oldStore=_.clone(s)}AsyncPF.prototype.run=function(numP){this.numParticles=numP==undefined?this.numParticles:this.numParticles+numP;var p,launchP;var i=Math.floor((this.buffer.length+1)*util.random());if(i==this.buffer.length){p=initParticle(this.store,this.exitK)}else{launchP=this.buffer[i];if(launchP.numChildrenToSpawn>1){p=copyOneParticle(launchP);launchP.numChildrenToSpawn-=1}else{p=launchP;this.buffer=util.deleteIndex(this.buffer,i)}}this.activeParticle=p;return p.continuation(p.store)};AsyncPF.prototype.sample=function(s,cc,a,dist){return cc(s,dist.sample())};AsyncPF.prototype.factor=function(s,cc,a,score){this.activeParticle.weight+=score;this.activeParticle.continuation=cc;this.activeParticle.store=s;var fi=this.activeParticle.factorIndex;var newFI=fi==undefined?0:fi+1;this.activeParticle.factorIndex=newFI;this.branching(newFI);return this.run()};AsyncPF.prototype.branching=function(factorIndex){var lk=this.obsWeights[factorIndex];if(lk==undefined){var det={wbar:this.activeParticle.weight,mnk:1};this.obsWeights[factorIndex]=[det];this.activeParticle.numChildrenToSpawn=1}else{var currMultiplicity=this.activeParticle.multiplicity;var currWeight=this.activeParticle.weight;var denom=lk.length+currMultiplicity;var prevWBar=lk[lk.length-1].wbar;var wbar=-Math.log(denom)+util.logsumexp([Math.log(lk.length)+prevWBar,Math.log(currMultiplicity)+currWeight]);if(wbar>0)throw new Error("Positive weight!!");var logRatio=currWeight-wbar;var numChildrenAndWeight=[];if(logRatio<0){numChildrenAndWeight=Math.log(util.random())<logRatio?[1,wbar]:[0,-Infinity]}else{var totalChildren=0;for(var v=0;v<lk.length;v++)totalChildren+=lk[v].mnk;var minK=Math.min(this.numParticles,lk.length);var rnk=isNaN(logRatio)?1:Math.exp(logRatio);var clampedRnk=totalChildren<=minK?Math.ceil(rnk):Math.floor(rnk);numChildrenAndWeight=[clampedRnk,currWeight-Math.log(clampedRnk)]}var det2={wbar:wbar,mnk:numChildrenAndWeight[0]};this.obsWeights[factorIndex]=lk.concat([det2]);if(numChildrenAndWeight[0]>0){if(this.buffer.length<this.bufferSize){this.activeParticle.numChildrenToSpawn=numChildrenAndWeight[0];this.activeParticle.weight=numChildrenAndWeight[1]}else{this.activeParticle.multiplicity*=numChildrenAndWeight[0];this.activeParticle.numChildrenToSpawn=1;this.activeParticle.weight=numChildrenAndWeight[1]}this.buffer.push(this.activeParticle)}}};AsyncPF.prototype.exit=function(s,retval){this.activeParticle.value=retval;this.activeParticle.completed=true;this.activeParticle.weight+=Math.log(this.activeParticle.multiplicity);this.exitedParticles+=1;this.hist.add(retval);if(this.exitedParticles<this.numParticles){return this.run()}else{var dist=this.hist.toDist();var lastFactorIndex=this.activeParticle.factorIndex;var olk=this.obsWeights[lastFactorIndex];var Kn=_.reduce(olk,function(a,b){return a+b.mnk},0);dist.normalizationConstant=Math.log(Kn)-Math.log(this.numParticles)+olk[olk.length-1].wbar;var currCoroutine=this;dist.continue=function(s,k,a,numP){currCoroutine.k=k;currCoroutine.oldCoroutine=env.coroutine;env.coroutine=currCoroutine;currCoroutine.oldStore=_.clone(s);return currCoroutine.run(numP)};env.coroutine=this.oldCoroutine;return this.k(this.oldStore,dist)}};AsyncPF.prototype.incrementalize=env.defaultCoroutine.incrementalize;function asyncPF(s,cc,a,wpplFn,options){options=options||{};return new AsyncPF(s,cc,a,wpplFn,options).run(options.particles)}return{AsyncPF:asyncPF}}},{"../aggregation/CountAggregator":151,"../util":200,underscore:148}],164:[function(require,module,exports){"use strict";var util=require("../util");module.exports=function(env){var driftKernelCoroutine={sample:notAllowed("sample"),factor:notAllowed("factor"),incrementalize:env.defaultCoroutine.incrementalize};function getProposalDist(s,a,dist,options,prevVal,k){if(options&&options.driftKernel){var coroutine=env.coroutine;env.coroutine=driftKernelCoroutine;return options.driftKernel(s,function(s,val){env.coroutine=coroutine;return k(s,val)},a,prevVal)}else{return k(s,dist)}}function notAllowed(fn){return function(){throw new Error(fn+" not allowed inside drift kernels.")}}function proposalWarning(priorDist){util.warn("Proposal from drift kernel has zero probability under "+priorDist.meta.name+" prior.")}return{getProposalDist:getProposalDist,proposalWarning:proposalWarning}}},{"../util":200}],165:[function(require,module,exports){"use strict";var ad=require("../ad.js");var _=require("underscore");var assert=require("assert");var util=require("../util");var ad=require("../ad");var paramStruct=require("../paramStruct");var guide=require("../guide");var graph=require("./elbograph");var RootNode=graph.RootNode;var SampleNode=graph.SampleNode;var FactorNode=graph.FactorNode;var SplitNode=graph.SplitNode;var JoinNode=graph.JoinNode;module.exports=function(env){function ELBO(wpplFn,s,a,options,state,params,step,cont){this.opts=util.mergeDefaults(options,{samples:1,avgBaselines:true,avgBaselineDecay:.9,naiveLR:false,dumpGraph:false,debugWeights:false});this.params=params;this.step=step;this.state=state;this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.a=a;this.mapDataStack=[{multiplier:1}];this.mapDataIx={};if(!_.has(this.state,"baselines")){this.state.baselines={}}this.baselineUpdates={};this.coroutine=env.coroutine;env.coroutine=this}function top(stack){return stack[stack.length-1]}function checkScoreIsFinite(score,source){var _score=ad.value(score);if(!isFinite(_score)){var msg="ELBO: The score of the previous sample under the "+source+" program was "+_score+".";if(_.isNaN(_score)){msg+=" Reducing the step size may help."}throw new Error(msg)}}ELBO.prototype={run:function(){var elbo=0;var grad={};return util.cpsLoop(this.opts.samples,function(i,next){this.iter=i;return this.estimateGradient(function(g,elbo_i){paramStruct.addEq(grad,g);elbo+=elbo_i;return next()})}.bind(this),function(){paramStruct.divEq(grad,this.opts.samples);elbo/=this.opts.samples;this.updateBaselines();env.coroutine=this.coroutine;return this.cont(grad,elbo)}.bind(this))},estimateGradient:function(cont){this.paramsSeen={};this.nodes=[];var root=new RootNode;this.prevNode=root;this.nodes.push(root);return this.wpplFn(_.clone(this.s),function(){graph.propagateWeights(this.nodes);if(this.step===0&&this.iter===0&&this.opts.dumpGraph){var dot=graph.generateDot(this.nodes);fs.writeFileSync("deps.dot",dot)}var ret=this.buildObjective();if(ad.isLifted(ret.objective)){ret.objective.backprop()}var grads=_.mapObject(this.paramsSeen,function(params){return params.map(ad.derivative)});return cont(grads,ret.elbo)}.bind(this),this.a)},buildObjective:function(){var naiveLR=this.opts.naiveLR;var rootNode=this.nodes[0];assert.ok(rootNode instanceof RootNode);assert.ok(_.isNumber(rootNode.weight));var objective=this.nodes.reduce(function(acc,node){if(node instanceof SampleNode&&node.reparam){return ad.scalar.add(acc,ad.scalar.mul(node.multiplier,ad.scalar.sub(node.logq,node.logp)))}else if(node instanceof SampleNode){assert.ok(!node.param);var weight=naiveLR?rootNode.weight:node.weight;assert.ok(_.isNumber(weight));var b=this.computeBaseline(node.address,weight);return ad.scalar.add(acc,ad.scalar.mul(node.multiplier,ad.scalar.sub(ad.scalar.mul(node.logq,ad.scalar.sub(weight,b)),node.logp)))}else if(node instanceof FactorNode){return ad.scalar.sub(acc,ad.scalar.mul(node.multiplier,node.score))}else{return acc}}.bind(this),0);var elbo=ad.scalar.neg(rootNode.weight);return{objective:objective,elbo:elbo}},computeBaseline:function(address,weight){if(!this.opts.avgBaselines){return 0}var baselines=this.state.baselines;var baselineUpdates=this.baselineUpdates;if(!_.has(baselineUpdates,address)){baselineUpdates[address]={n:1,mean:weight}}else{var prev=baselineUpdates[address];var n=prev.n+1;var mean=(prev.n*prev.mean+weight)/n;baselineUpdates[address].n=n;baselineUpdates[address].mean=mean}return _.has(baselines,address)?baselines[address]:weight*.99},updateBaselines:function(){var decay=this.opts.avgBaselineDecay;var baselines=this.state.baselines;_.each(this.baselineUpdates,function(obj,address){baselines[address]=_.has(baselines,address)?decay*baselines[address]+(1-decay)*obj.mean:obj.mean},this)},sample:function(s,k,a,dist,options){options=options||{};var guideDist;if(options.guide){guideDist=options.guide}else{guideDist=guide.independent(dist,a,env);if(this.step===0&&this.opts.verbose&&!this.mfWarningIssued){this.mfWarningIssued=true;console.log("ELBO: Defaulting to mean-field for one or more choices.")}}var ret=this.sampleGuide(guideDist,options);var val=ret.val;var logp=dist.score(val);var logq=guideDist.score(val);checkScoreIsFinite(logp,"target");checkScoreIsFinite(logq,"guide");var m=top(this.mapDataStack).multiplier;var node=new SampleNode(this.prevNode,logp,logq,ret.reparam,a,dist,guideDist,val,m,this.opts.debugWeights);this.prevNode=node;this.nodes.push(node);return k(s,val)},sampleGuide:function(dist,options){var val,reparam;if((!_.has(options,"reparam")||options.reparam)&&dist.base&&dist.transform){var baseDist=dist.base();var z=baseDist.sample();val=dist.transform(z);reparam=true}else if(options.reparam&&!(dist.base&&dist.transform)){throw dist+" does not support reparameterization."}else{val=dist.sample();reparam=false}return{val:val,reparam:reparam}},factor:function(s,k,a,score,name){if(!isFinite(ad.value(score))){throw new Error("ELBO: factor score is not finite.")}var m=top(this.mapDataStack).multiplier;var node=new FactorNode(this.prevNode,score,m,this.opts.debugWeights);this.prevNode=node;this.nodes.push(node);return k(s)},mapDataFetch:function(data,batchSize,address){var ix;if(_.has(this.mapDataIx,address)){ix=this.mapDataIx[address]}else{if(batchSize===data.length){ix=null}else{ix=_.times(batchSize,function(){return Math.floor(util.random()*data.length)})}this.mapDataIx[address]=ix}if(batchSize>0){var joinNode=new JoinNode;var splitNode=new SplitNode(this.prevNode,batchSize,data.length,joinNode);this.nodes.push(splitNode);var thisM=data.length/batchSize;var prevM=top(this.mapDataStack).multiplier;var multiplier=thisM*prevM;this.mapDataStack.push({splitNode:splitNode,joinNode:joinNode,multiplier:multiplier})}else{this.mapDataStack.push(null)}return ix},mapDataEnter:function(){this.prevNode=top(this.mapDataStack).splitNode},mapDataLeave:function(){top(this.mapDataStack).joinNode.parents.push(this.prevNode)},mapDataFinal:function(address){var top=this.mapDataStack.pop();if(top!==null){var joinNode=top.joinNode;this.prevNode=joinNode;this.nodes.push(joinNode)}},incrementalize:env.defaultCoroutine.incrementalize,constructor:ELBO};return function(){var coroutine=Object.create(ELBO.prototype);ELBO.apply(coroutine,arguments);return coroutine.run()}}},{"../ad":150,"../ad.js":150,"../guide":159,"../paramStruct":183,"../util":200,"./elbograph":166,assert:216,underscore:148}],166:[function(require,module,exports){"use strict";var ad=require("../ad");var nodeid=0;function RootNode(){this.id=nodeid++;this.parents=[];this.weight=0}function SampleNode(parent,logp,logq,reparam,address,targetDist,guideDist,value,multiplier,debug){this.id=nodeid++;var _logp=ad.value(logp);var _logq=ad.value(logq);this.parents=[parent];this.logp=logp;this.logq=logq;this.weight=debug?1:_logq-_logp;this.reparam=reparam;this.address=address;this.multiplier=multiplier;this.targetDist=targetDist}SampleNode.prototype.label=function(){return[this.targetDist.meta.name+"("+this.id+")","w="+this.weight,"m="+this.multiplier].join("\\n")};function FactorNode(parent,score,multiplier,debug){this.id=nodeid++;var _score=ad.value(score);this.parents=[parent];this.score=score;this.weight=debug?1:-_score;this.multiplier=multiplier}FactorNode.prototype.label=function(){return["Factor"+"("+this.id+")","w="+this.weight,"m="+this.multiplier].join("\\n")};function SplitNode(parent,batchSize,n,joinNode){this.id=nodeid++;this.parents=[parent];this.batchSize=batchSize;this.n=n;this.joinNode=joinNode;this.weight=0}function JoinNode(){this.id=nodeid++;this.parents=[];this.weight=0}function propagateWeights(nodes){var i=nodes.length;while(--i){var node=nodes[i];if(node instanceof SplitNode){node.weight=node.n/node.batchSize*node.weight-(node.n-1)*node.joinNode.weight}node.parents.forEach(function(parent){parent.weight+=node.weight})}}var edge=function(parent,child){return"  "+parent.id+" -> "+child.id+";"};var shape=function(node,shape){return"  "+node.id+' [shape = "'+shape+'"]'};var label=function(node){return"  "+node.id+' [label = "'+node.label()+'"]'};function generateDot(nodes){var edges=[];var append=function(x){edges.push(x)};nodes.forEach(function(node){if(node instanceof FactorNode){append(shape(node,"box"))}if(node instanceof RootNode||node instanceof JoinNode||node instanceof SplitNode){append(shape(node,"point"))}if(node.label){append(label(node))}node.parents.forEach(function(parent){append(edge(parent,node))})});return"digraph {\n"+edges.join("\n")+"\n}\n"}module.exports={RootNode:RootNode,SampleNode:SampleNode,FactorNode:FactorNode,SplitNode:SplitNode,JoinNode:JoinNode,propagateWeights:propagateWeights,generateDot:generateDot}},{"../ad":150}],167:[function(require,module,exports){"use strict";var ad=require("../ad.js");var _=require("underscore");var PriorityQueue=require("priorityqueuejs");var util=require("../util");var ScoreAggregator=require("../aggregation/ScoreAggregator");module.exports=function(env){function Enumerate(store,k,a,wpplFn,options){util.throwUnlessOpts(options,"Enumerate");options=util.mergeDefaults(options,{maxExecutions:Infinity});this.maxExecutions=options.maxExecutions;this.score=0;this.marginal=new ScoreAggregator;this.numCompletedExecutions=0;this.store=store;this.k=k;this.a=a;this.wpplFn=wpplFn;var strategy=strategies[options.strategy]||defaultStrategy(options.maxExecutions);this.queue=strategy.makeQ();this.coroutine=env.coroutine;env.coroutine=this}Enumerate.prototype.run=function(){return this.wpplFn(_.clone(this.store),env.exit,this.a)};Enumerate.prototype.nextInQueue=function(){var nextState=this.queue.deq();this.score=nextState.score;return nextState.continuation(nextState.store,nextState.value)};Enumerate.prototype.enqueueContinuation=function(continuation,value,score,store){var state={continuation:continuation,value:value,score:score,store:_.clone(store)};this.queue.enq(state)};var getSupport=function(dist){if(dist.isContinuous||!dist.support){console.error(dist);throw new Error("Enumerate can only be used with distributions that have finite support.")}var supp=dist.support();if(ad.scalar.peq(supp.length,0)){console.error(dist);throw new Error("Enumerate encountered a distribution with empty support!")}return supp};Enumerate.prototype.sample=function(store,k,a,dist){var support=getSupport(dist);_.each(support,function(value){this.enqueueContinuation(k,value,ad.scalar.add(this.score,dist.score(value)),store)},this);return this.nextInQueue()};Enumerate.prototype.factor=function(s,k,a,score){this.score=ad.scalar.add(this.score,score);if(ad.scalar.peq(this.score,ad.scalar.neg(Infinity))){return this.exit()}return k(s)};Enumerate.prototype.sampleWithFactor=function(store,k,a,dist,scoreFn){var support=getSupport(dist);return util.cpsForEach(function(value,i,support,nextK){return scoreFn(store,function(store,extraScore){var score=ad.scalar.add(ad.scalar.add(env.coroutine.score,dist.score(value)),extraScore);env.coroutine.enqueueContinuation(k,value,score,store);return nextK()},a,value)},function(){return env.coroutine.nextInQueue()},support)};Enumerate.prototype.exit=function(s,retval){this.marginal.add(retval,this.score);this.numCompletedExecutions=ad.scalar.add(this.numCompletedExecutions,1);if(ad.scalar.gt(this.queue.size(),0)&&ad.scalar.lt(this.numCompletedExecutions,this.maxExecutions)){return this.nextInQueue()}else{if(ad.scalar.peq(this.marginal.size,0)){throw new Error("All paths explored by Enumerate have probability zero.")}env.coroutine=this.coroutine;return this.k(this.store,this.marginal.toDist())}};Enumerate.prototype.incrementalize=env.defaultCoroutine.incrementalize;var strategies={likelyFirst:{makeQ:function(){return new PriorityQueue(function(a,b){return ad.scalar.sub(a.score,b.score)})}},depthFirst:{makeQ:function(){var q=[];q.size=function(){return q.length};q.enq=q.push;q.deq=q.pop;return q}},breadthFirst:{makeQ:function(){var q=[];q.size=function(){return q.length};q.enq=q.push;q.deq=q.shift;return q}}};function defaultStrategy(maxExecutions){return strategies[_.isFinite(maxExecutions)?"likelyFirst":"depthFirst"]}return{Enumerate:function(s,k,a,wpplFn,options){return new Enumerate(s,k,a,wpplFn,options).run()}}}},{"../ad.js":150,"../aggregation/ScoreAggregator":152,"../util":200,priorityqueuejs:125,underscore:148}],168:[function(require,module,exports){"use strict";var ad=require("../ad.js");var _=require("underscore");var assert=require("assert");var util=require("../util");var ad=require("../ad");var paramStruct=require("../paramStruct");module.exports=function(env){function EUBO(wpplFn,s,a,options,state,params,step,cont){this.opts=util.mergeDefaults(options,{batchSize:1});if(!_.has(this.opts,"traces")){throw"Example traces required."}this.traces=this.opts.traces;if(this.opts.batchSize<=0||this.opts.batchSize>this.traces.length){throw"Invalid batchSize."}this.params=params;this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.a=a;this.coroutine=env.coroutine;env.coroutine=this}EUBO.prototype={run:function(){var eubo=0;var grad={};var traces=sampleMiniBatch(this.traces,this.opts.batchSize);return util.cpsForEach(function(trace,i,traces,next){return this.estimateGradient(trace,function(g,eubo_i){paramStruct.addEq(grad,g);eubo+=eubo_i;return next()})}.bind(this),function(){paramStruct.divEq(grad,traces.length);eubo/=traces.length;env.coroutine=this.coroutine;return this.cont(grad,eubo)}.bind(this),traces)},estimateGradient:function(trace,cont){this.trace=trace;this.paramsSeen={};this.logq=0;return this.wpplFn(_.clone(this.s),function(){var objective=ad.scalar.neg(this.logq);objective.backprop();var grads=_.mapObject(this.paramsSeen,function(params){return params.map(ad.derivative)});var logp=ad.value(trace.score);var logq=ad.value(this.logq);return cont(grads,ad.scalar.sub(logp,logq))}.bind(this),this.a)},sample:function(s,k,a,dist,options){if(!_.has(options,"guide")){throw"Guide not specified."}var guideDist=options.guide;var rel=util.relativizeAddress(env,a);var guideVal=this.trace.findChoice(ad.scalar.add(this.trace.baseAddress,rel)).val;assert.notStrictEqual(guideVal,undefined);var _guideVal=ad.value(guideVal);this.logq=ad.scalar.add(this.logq,guideDist.score(_guideVal));return k(s,_guideVal)},factor:function(s,k,a,score){return k(s)},incrementalize:env.defaultCoroutine.incrementalize,constructor:EUBO};function sampleMiniBatch(data,batchSize){if(data.length===batchSize){return data}else{var miniBatch=[];_.times(batchSize,function(){var ix=Math.floor(util.random()*data.length);miniBatch.push(data[ix])});return miniBatch}}return function(){var coroutine=Object.create(EUBO.prototype);EUBO.apply(coroutine,arguments);return coroutine.run()}}},{"../ad":150,"../ad.js":150,"../paramStruct":183,"../util":200,assert:216,underscore:148}],169:[function(require,module,exports){"use strict";var _=require("underscore");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");var guide=require("../guide");module.exports=function(env){function ForwardSample(s,k,a,wpplFn,options){this.opts=util.mergeDefaults(options,{samples:1,guide:false,verbose:false,params:{}});this.params=this.opts.params;this.wpplFn=wpplFn;this.s=s;this.k=k;this.a=a;this.coroutine=env.coroutine;env.coroutine=this}ForwardSample.prototype={run:function(){var hist=new CountAggregator;var logWeights=[];return util.cpsLoop(this.opts.samples,function(i,next){this.logWeight=0;return this.wpplFn(_.clone(this.s),function(s,val){logWeights.push(this.logWeight);hist.add(val);return next()}.bind(this),this.a)}.bind(this),function(){env.coroutine=this.coroutine;var dist=hist.toDist();if(!this.opts.guide){var numSamples=this.opts.samples;dist.normalizationConstant=util.logsumexp(logWeights)-Math.log(numSamples)}return this.k(this.s,dist)}.bind(this))},sample:function(s,k,a,dist,options){var distribution=this.opts.guide?options&&options.guide||guide.independent(dist,a,env):dist;return k(s,distribution.sample())},factor:function(s,k,a,score){this.logWeight+=ad.value(score);return k(s)},incrementalize:env.defaultCoroutine.incrementalize,constructor:ForwardSample};return{ForwardSample:function(){var coroutine=Object.create(ForwardSample.prototype);ForwardSample.apply(coroutine,arguments);return coroutine.run()}}}},{"../ad":150,"../aggregation/CountAggregator":151,"../guide":159,"../util":200,underscore:148}],170:[function(require,module,exports){"use strict";var _=require("underscore");var assert=require("assert");var util=require("../util");var dists=require("../dists");var Trace=require("../trace");var ad=require("../ad");var Tensor=require("../tensor");var generic=require("../math/genericArithmetic");var addEq=generic.addEq;var add=generic.add;var mul=generic.mul;var sum=generic.sum;module.exports=function(env){function HMCKernel(cont,oldTrace,options){var options=util.mergeDefaults(options,{steps:5,stepSize:.1,exitFactor:0});this.steps=options.steps;this.stepSize=options.stepSize;this.exitFactor=options.exitFactor;assert.ok(this.steps>0);this.cont=cont;this.oldTrace=oldTrace;this.a=oldTrace.baseAddress;this.coroutine=env.coroutine;env.coroutine=this}HMCKernel.prototype.sample=function(s,k,a,dist,options){var prevChoice=this.prevTrace.findChoice(a);if(!prevChoice){throw new Error("HMC does not support structural continuous variables.")}var val;if(dist.isContinuous){if(dist.noHMC){throw new Error("HMC does not yet support the "+dist.meta.name+" distribution")}var prevVal=ad.value(prevChoice.val);var _val=add(prevVal,mul(this.momentum[a],this.stepSize));if(dist.support){var support=dist.support();var lower=support.lower;var upper=support.upper;while(_val<lower||_val>upper){if(_val<lower){_val=lower+(lower-_val);this.momentum[a]*=-1}if(_val>upper){_val=upper-(_val-upper);this.momentum[a]*=-1}}}val=ad.lift(_val)}else{val=prevChoice.val}this.trace.addChoice(dist,val,a,s,k,options);return k(s,val)};HMCKernel.prototype.factor=function(s,k,a,score){this.trace.numFactors+=1;this.trace.score=ad.scalar.add(this.trace.score,score);if(this.trace.numFactors===this.exitFactor){this.trace.saveContinuation(s,k);return this.exit(s,undefined,true)}return k(s)};HMCKernel.prototype.run=function(){var numChoices=this.oldTrace.choices.reduce(function(acc,c){return acc+(c.dist.isContinuous?1:0)},0);if(numChoices===0){return this.continue(this.oldTrace)}if(ad.isLifted(this.oldTrace.score)){this.oldTrace.score.zeroDerivatives()}this.momentum=sampleMomentum(this.oldTrace);var oldH=computeH(this.oldTrace,this.momentum);this.momentumStep(this.oldTrace,.5);return util.cpsIterate(this.steps-1,this.oldTrace,this.leapFrogStep.bind(this),function(trace){return this.positionStep(function(finalTrace){this.momentumStep(finalTrace,.5);var newH=computeH(finalTrace,this.momentum);var p=Math.min(1,Math.exp(newH-oldH));var accept=util.random()<p;return this.finish(accept?finalTrace:this.oldTrace,accept)}.bind(this),trace)}.bind(this))};function stdGaussianSampleLike(x){return x instanceof Tensor?dists.tensorGaussianSample(0,1,x.dims):dists.gaussianSample(0,1)}function sampleMomentum(trace){var momentum={};_.each(trace.choices,function(choice){if(choice.dist.isContinuous){momentum[choice.address]=stdGaussianSampleLike(ad.value(choice.val))}});return momentum}HMCKernel.prototype.leapFrogStep=function(cont,trace){return this.positionStep(function(newTrace){this.momentumStep(newTrace,1);return cont(newTrace)}.bind(this),trace)};HMCKernel.prototype.positionStep=function(cont,trace){this.prevTrace=trace;this.trace=this.prevTrace.fresh();this.positionStepCont=cont;env.query.clear();return this.trace.continue()};HMCKernel.prototype.exit=function(k,val,earlyExit){if(!earlyExit){this.trace.complete(val)}else{assert(this.trace.store);assert(this.trace.k);assert(!this.trace.isComplete())}var cont=this.positionStepCont;this.positionStepCont=undefined;return cont(this.trace)};HMCKernel.prototype.momentumStep=function(trace,scaleFactor){if(ad.isLifted(trace.score)){trace.score.backprop();var stepSize=this.stepSize*scaleFactor;_.each(trace.choices,function(choice){if(choice.dist.isContinuous){this.momentum[choice.address]=addEq(this.momentum[choice.address],mul(ad.derivative(choice.val),stepSize))}},this)}};function computeH(trace,momentum){var score=ad.value(trace.score);var kinetic=.5*_.reduce(momentum,function(memo,p){return memo+sum(mul(p,p))},0);var x=score-kinetic;return x}HMCKernel.prototype.finish=function(trace,accepted){assert(_.isBoolean(accepted));if(accepted&&trace.value===env.query){trace.value=env.query.getTable()}if(this.oldTrace.info){var oldInfo=this.oldTrace.info;trace.info={accepted:oldInfo.accepted+accepted,total:oldInfo.total+1}}return this.continue(trace)};HMCKernel.prototype.continue=function(trace){env.coroutine=this.coroutine;return this.cont(trace)};HMCKernel.prototype.incrementalize=env.defaultCoroutine.incrementalize;return _.extendOwn(function(cont,oldTrace,options){return new HMCKernel(cont,oldTrace,options).run()},{adRequired:true})}},{"../ad":150,"../dists":154,"../math/genericArithmetic":181,"../tensor":186,"../trace":187,"../util":200,assert:216,underscore:148}],171:[function(require,module,exports){(function(global){"use strict";var _=require("underscore");var assert=require("assert");var util=require("../util");var Hashtable=require("../hashtable").Hashtable;var Query=require("../query").Query;var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){var drift=require("./driftKernel")(env);var DEBUG=0;function debuglog(debuglevel){if(DEBUG>=debuglevel){var args=Array.prototype.slice.call(arguments,1);console.log.apply(console,args)}}function tabbedlog(debuglevel,depth){if(DEBUG>=debuglevel){var args=Array.prototype.slice.call(arguments,2);var pad="";for(var i=0;i<depth;i++)pad+="  ";pad+="["+depth+"] ";console.log.apply(console,[pad].concat(args))}}function touch(node){if(!node.__snapshot){node.coroutine.touch(node);node.__snapshot={reachable:true}}}function updateProperty(node,prop,val){touch(node);if(!node.__snapshot[prop])node.__snapshot[prop]=node[prop];node[prop]=val}function hasSnapshotForProperty(node,prop){return node.__snapshot!==undefined&&node.__snapshot[prop]!==undefined}function restoreSnapshot(node){for(var prop in node.__snapshot){node[prop]=node.__snapshot[prop]}node.__snapshot=undefined}function discardSnapshot(node){node.__snapshot=undefined}function DistNode(coroutine,parent,s,k,a,dist,args){this.coroutine=coroutine;this.store=_.clone(s);this.continuation=k;this.address=a;this.dist=dist;this.args=args;this.parent=parent;this.depth=parent.depth+1;this.index=parent.nextChildIdx;this.reachable=true;this.needsUpdate=false;this.val=dist.sample();this.score=0;this.rescore();this.coroutine.addDist(this)}DistNode.prototype.print=function(){tabbedlog(0,this.depth,"DistNode",this.dist,this.val,this.reachable?"":"!!UNREACHABLE!!")};DistNode.prototype.execute=function(){tabbedlog(4,this.depth,"execute distribution");if(this.needsUpdate){tabbedlog(4,this.depth,"yes, dist changed");tabbedlog(5,this.depth,"old dist:",this.__snapshot?this.__snapshot.dist:undefined,"new dist:",this.dist);this.needsUpdate=false;this.rescore()}else{tabbedlog(4,this.depth,"no, dist has not changed");tabbedlog(5,this.depth,"dist:",this.dist)}if(this.score===-Infinity){tabbedlog(4,this.depth,"score became -Infinity; bailing out early");return this.coroutine.exit();

}else{return this.kontinue()}};DistNode.prototype.registerInputChanges=function(s,k,dist,args){updateProperty(this,"store",_.clone(s));updateProperty(this,"continuation",k);updateProperty(this,"index",this.parent.nextChildIdx);updateProperty(this,"args",args);this.reachable=true;if(!distEqual(dist,this.dist)){this.needsUpdate=true;updateProperty(this,"dist",dist)}};DistNode.prototype.kontinue=function(){this.parent.notifyChildExecuted(this);return this.continuation(_.clone(this.store),this.val)};DistNode.prototype.killDescendantLeaves=function(){this.coroutine.removeDist(this)};DistNode.prototype.propose=function(){var oldval=this.val;var sampleOptions=this.args[0];return drift.getProposalDist(this.store,this.address,this.dist,sampleOptions,oldval,function(s,fwdPropDist){var newval=fwdPropDist.sample();tabbedlog(4,this.depth,"proposing change to distribution.","oldval:",oldval,"newval:",newval);if(oldval===newval){tabbedlog(4,this.depth,"proposal didn't change value; bailing out early");tabbedlog(5,this.depth,"value:",this.val);return this.coroutine.exit()}else{updateProperty(this,"store",_.clone(this.store));updateProperty(this,"val",newval);this.rescore();if(this.score===-Infinity&&_.has(sampleOptions,"driftKernel")){drift.proposalWarning(this.dist)}return drift.getProposalDist(s,this.address,this.dist,sampleOptions,newval,function(s,rvsPropDist){this.coroutine.rvsPropLP=rvsPropDist.score(oldval);this.coroutine.fwdPropLP=fwdPropDist.score(newval);tabbedlog(1,this.depth,"initial rvsPropLP:",this.coroutine.rvsPropLP,"initial fwdPropLP:",this.coroutine.fwdPropLP);this.needsUpdate=false;if(this.coroutine.doFullRerun){for(var node=this.parent;node!==null;node=node.parent)node.needsUpdate=true;return this.coroutine.runFromStart()}else{this.parent.notifyChildChanged(this);this.coroutine.restoreStackUpTo(this.parent);return this.execute()}}.bind(this))}}.bind(this))};DistNode.prototype.rescore=function(){var oldscore=this.score;updateProperty(this,"score",this.dist.score(this.val));this.coroutine.score+=this.score-oldscore};function distEqual(dist1,dist2){return dist1.constructor===dist2.constructor&&distParamsEqual(dist1.params,dist2.params)}function distParamsEqual(p1,p2){if(p1===p2){return true}for(var k in p1){if(p1.hasOwnProperty(k)){var v1=p1[k],v2=p2[k];if(typeof v1==="number"){if(v1!==v2){return false}}else if(_.isArray(v1)){if(!_.isEqual(v1,v2)){return false}}else{return false}}}return true}function FactorNode(coroutine,parent,s,k,a,unused,args){this.coroutine=coroutine;this.store=s;this.continuation=k;this.address=a;this.parent=parent;this.depth=parent.depth+1;this.index=parent.nextChildIdx;this.reachable=true;this.rescore(0,args[0]);tabbedlog(3,this.depth,"new factor")}FactorNode.prototype.print=function(){tabbedlog(0,this.depth,"FactorNode",this.reachable?"":"!!UNREACHABLE!!")};FactorNode.prototype.execute=function(){if(this.score===-Infinity){tabbedlog(4,this.depth,"score became -Infinity; bailing out early");return this.coroutine.exit()}else{return this.kontinue()}};FactorNode.prototype.registerInputChanges=function(s,k,unused,args){updateProperty(this,"store",s);updateProperty(this,"continuation",k);updateProperty(this,"index",this.parent.nextChildIdx);this.reachable=true;if(this.score!==args[0])this.rescore(this.score,args[0])};FactorNode.prototype.kontinue=function(){this.parent.notifyChildExecuted(this);return this.continuation(this.store)};FactorNode.prototype.killDescendantLeaves=function(){tabbedlog(3,this.depth,"kill factor",this.address);this.coroutine.score-=this.score};FactorNode.prototype.rescore=function(oldscore,score){updateProperty(this,"score",score);this.coroutine.score+=score-oldscore};function storesEqual(s1,s2){var prop;for(prop in s1){if(s1[prop]!==s2[prop])return false}for(prop in s2){if(s1[prop]!==s2[prop])return false}return true}var fnEquivCache={};function fnsEqual(f1,f2){if(f1===f2)return true;if(f1.__lexid===undefined||f2.__lexid===undefined)return false;if(f1.__lexid===f2.__lexid){var key=JSON.stringify([f1.__uniqueid,f2.__uniqueid]);var val=fnEquivCache[key];if(val===undefined){val=true;for(var i=0;i<f1.__freeVarVals.length;i++){var v1=f1.__freeVarVals[i];var v2=f2.__freeVarVals[i];var eq=_.isFunction(v1)&&_.isFunction(v2)?fnsEqual(v1,v2):v1===v2;if(!eq){val=false;break}}fnEquivCache[key]=val}return val}return false}function FunctionNode(coroutine,parent,s,k,a,fn,args){this.coroutine=coroutine;this.continuation=k;this.address=a;this.func=fn;this.parent=parent;this.depth=parent?parent.depth+1:0;this.index=parent?parent.nextChildIdx:undefined;this.children=[];this.nextChildIdx=0;this.reachable=true;this.needsUpdate=true;this.inStore=_.clone(s);this.args=args;this.initialized=false;this.retval=undefined;this.outStore=null}FunctionNode.prototype.print=function(){tabbedlog(0,this.depth,"FunctionNode",this.args,this.retval,this.reachable?"":"!!UNREACHABLE!!");for(var i=0;i<this.children.length;i++)this.children[i].print()};FunctionNode.prototype.execute=function(){tabbedlog(4,this.depth,"execute function");if(this.needsUpdate){if(this.initialized)this.coroutine.cacheAdapter.registerMiss(this);tabbedlog(4,this.depth,"yes, function args changed; executing");tabbedlog(5,this.depth,"old args:",this.__snapshot?this.__snapshot.args:undefined,"new args:",this.args);this.needsUpdate=false;this.coroutine.nodeStack.push(this);this.nextChildIdx=0;var nchildren=this.children.length;for(var i=0;i<nchildren;i++){touch(this.children[i]);this.children[i].reachable=false}tabbedlog(4,this.depth,"Children marked unreachable on execute:",nchildren);var coroutine=this.coroutine;var continuation=this.continuation;var address=this.address;this.entered=true;return this.func.apply(global,[this.inStore,function(s,retval){if(!coroutine.cacheAdapter.shouldCache(address))return continuation(s,retval);var that=coroutine.nodeStack.pop();tabbedlog(4,that.depth,"continue from function");that.initialized=true;var newchildren=[];var nchildren=that.children.length;var ii=0;for(var i=0;i<nchildren;i++){var child=that.children[i];if(!child.reachable)child.killDescendantLeaves();else{updateProperty(child,"index",ii++);newchildren.push(child)}}updateProperty(that,"children",newchildren);if(!that.entered&&that.retval===retval&&storesEqual(that.outStore,s)){tabbedlog(4,that.depth,"bailing b/c function return val not changed");tabbedlog(5,that.depth,"return val:",retval);coroutine.cacheAdapter.registerHit(that);return coroutine.exit()}if(!that.entered&&that.parent!==null)that.parent.notifyChildChanged(that);if(!that.entered)coroutine.cacheAdapter.registerMiss(that);that.entered=false;tabbedlog(4,that.depth,"function return val has changed, or cannot bail");tabbedlog(5,that.depth,"old ret val:",that.retval,"new ret val:",retval);updateProperty(that,"retval",retval);updateProperty(that,"outStore",_.clone(s));return that.kontinue()},this.address].concat(this.args))}else{this.coroutine.cacheAdapter.registerHit(this);tabbedlog(4,this.depth,"no, function args have not changed; continuing");tabbedlog(5,this.depth,"args:",this.args);return this.kontinue()}};FunctionNode.prototype.registerInputChanges=function(s,k,fn,args){updateProperty(this,"continuation",k);if(this.parent)updateProperty(this,"index",this.parent.nextChildIdx);this.reachable=true;if(!fnsEqual(fn,this.func)){this.needsUpdate=true;updateProperty(this,"func",fn)}if(this.args.length!==args.length){this.needsUpdate=true;updateProperty(this,"args",args)}else{var i=args.length;for(var i=0;i<args.length;i++){if(args[i]!==this.args[i]){this.needsUpdate=true;updateProperty(this,"args",args);break}}}if(!storesEqual(this.inStore,s)){this.needsUpdate=true;updateProperty(this,"inStore",_.clone(s))}};FunctionNode.prototype.killDescendantLeaves=function(){tabbedlog(3,this.depth,"kill function (and all descendant leaves)",this.address);var stack=[this];while(stack.length>0){var node=stack.pop();if(node.score!==undefined)node.killDescendantLeaves();else{var n=node.children.length;while(n--)stack.push(node.children[n])}}};FunctionNode.prototype.kontinue=function(){if(this.parent!==null)this.parent.notifyChildExecuted(this);return this.continuation(_.clone(this.outStore),this.retval)};FunctionNode.prototype.notifyChildExecuted=function(child){this.nextChildIdx=child.index+1};FunctionNode.prototype.notifyChildChanged=function(child){var nchildren=this.children.length;var totalmarked=0;for(var i=child.index+1;i<nchildren;i++){touch(this.children[i]);this.children[i].reachable=false;totalmarked++}tabbedlog(4,this.depth,"Children marked unreachable on child change:",totalmarked)};FunctionNode.prototype.removeFromCache=function(){if(this.parent.children[this.index]===this){var n=this.children.length;for(var i=0;i<n;i++){var child=this.children[i];child.parent=this.parent;child.index=this.index+i;var stack=[child];while(stack.length>0){var node=stack.pop();node.depth--;if(node.children){var nn=node.children.length;while(nn--)stack.push(node.children[nn])}}}for(var i=this.index+1;i<this.parent.children.length;i++){this.parent.children[i].index=i+n-1}this.children.unshift(this.index,1);Array.prototype.splice.apply(this.parent.children,this.children)}};function ArrayDistMasterList(){this.distNodes=[]}ArrayDistMasterList.prototype.size=function(){return this.distNodes.length};ArrayDistMasterList.prototype.oldSize=function(){return this.oldDistNodes===undefined?undefined:this.oldDistNodes.length};ArrayDistMasterList.prototype.addDist=function(node){this.distNodes.push(node)};ArrayDistMasterList.prototype.removeDist=function(node){touch(node);node.reachable=false};ArrayDistMasterList.prototype.preProposal=function(){this.oldDistNodes=this.distNodes.slice()};ArrayDistMasterList.prototype.postProposal=function(){this.distNodes=_.filter(this.distNodes,function(node){return node.reachable})};ArrayDistMasterList.prototype.getRandom=function(){var idx=Math.floor(util.random()*this.distNodes.length);return this.distNodes[idx]};ArrayDistMasterList.prototype.restoreOnReject=function(){this.distNodes=this.oldDistNodes};function HashtableDistMasterList(){this.distNodeMap=new Hashtable;this.distsAdded=[];this.distsRemoved=[];this.numDists=0}HashtableDistMasterList.prototype.size=function(){return this.numDists};HashtableDistMasterList.prototype.oldSize=function(){return this.oldNumDists};HashtableDistMasterList.prototype.addDist=function(node){this.distNodeMap.put(node.address,node);this.distsAdded.push(node);this.numDists++};HashtableDistMasterList.prototype.removeDist=function(node){this.distNodeMap.remove(node.address);this.distsRemoved.push(node);this.numDists--};HashtableDistMasterList.prototype.preProposal=function(){this.oldNumDists=this.numDists;this.distsAdded=[];this.distsRemoved=[]};HashtableDistMasterList.prototype.postProposal=function(){};HashtableDistMasterList.prototype.getRandom=function(){return this.distNodeMap.getRandom()};HashtableDistMasterList.prototype.restoreOnReject=function(){this.numDists=this.oldNumDists;var n=this.distsAdded.length;while(n--){var node=this.distsAdded[n];this.distNodeMap.remove(node.address)}n=this.distsRemoved.length;while(n--){var node=this.distsRemoved[n];this.distNodeMap.put(node.address,node)}};HashtableDistMasterList.prototype.checkConsistency=function(tag){for(var i=0;i<this.distsAdded.length;i++){var addr=this.distsAdded[i].address;if(!this.distNodeMap.get(addr))throw new Error("WTF - hash table doesn't contain node "+addr+" that we added ("+tag+")")}for(var i=0;i<this.distsRemoved.length;i++){var addr=this.distsRemoved[i].address;if(this.distNodeMap.get(addr))throw new Error("WTF - hash table contains node "+addr+" that we removed ("+tag+")")}};function CacheAdapter(minHitRate,fuseLength,iterFuseLength){this.minHitRate=minHitRate;this.fuseLength=fuseLength;this.iterFuseLength=iterFuseLength;this.addrToId={};this.stats={};this.idsToRemove={};this.hasIdsToRemove=false}CacheAdapter.prototype.id=function(addr){var id=this.addrToId[addr];if(id===undefined){var arr=addr.split("_");id=arr[arr.length-1];this.addrToId[addr]=id}return id};CacheAdapter.prototype.getStats=function(addr){var id=this.id(addr);var stats=this.stats[id];if(stats===undefined){stats={shouldCache:true,hits:0,total:0};this.stats[id]=stats}return stats};CacheAdapter.prototype.shouldCache=function(addr){return this.getStats(addr).shouldCache};CacheAdapter.prototype.registerHit=function(node){var stats=this.getStats(node.address);stats.hits++;stats.total++;if(node.parent!==null&&node.coroutine.totalIterations-node.coroutine.iterations>this.iterFuseLength&&stats.total>=this.fuseLength&&stats.hits/stats.total<this.minHitRate){this.idsToRemove[this.id(node.address)]=true;this.hasIdsToRemove=true}};CacheAdapter.prototype.registerMiss=function(node){var stats=this.getStats(node.address);stats.total++;if(node.parent!==null&&node.coroutine.totalIterations-node.coroutine.iterations>this.iterFuseLength&&stats.total>=this.fuseLength&&stats.hits/stats.total<this.minHitRate){this.idsToRemove[this.id(node.address)]=true;this.hasIdsToRemove=true}};CacheAdapter.prototype.adapt=function(cacheRoot){if(this.hasIdsToRemove){for(var id in this.idsToRemove){var s=this.stats[id];debuglog(5,"Cache adapter removing nodes w/ id",id,"hit rate:",s.hits/s.total);this.stats[id].shouldCache=false}var stack=[cacheRoot];while(stack.length>0){var node=stack.pop();if(node.children!==undefined){var n=node.children.length;while(n--)stack.push(node.children[n])}if(this.idsToRemove[this.id(node.address)]){node.removeFromCache()}}this.idsToRemove={};this.hasIdsToRemove=false;if(DEBUG>=6){debuglog(6,"=== Post-adaptation cache status ===");cacheRoot.print()}}};CacheAdapter.prototype.report=function(){for(var id in this.stats){console.log(id,":",this.stats[id])}};function IncrementalMH(s,k,a,wpplFn,opts){util.throwUnlessOpts(opts,"IncrementalMH");var numSamples=opts.samples===undefined?1:opts.samples;var dontAdapt=opts.dontAdapt===undefined?false:opts.dontAdapt;var debuglevel=opts.debuglevel===undefined?0:opts.debuglevel;var verbose=opts.verbose===undefined?false:opts.verbose;var doFullRerun=opts.doFullRerun===undefined?false:opts.doFullRerun;var onlyMAP=opts.onlyMAP===undefined?false:opts.onlyMAP;var minHitRate=opts.cacheMinHitRate===undefined?1e-8:opts.cacheMinHitRate;var fuseLength=opts.cacheFuseLength===undefined?50:opts.cacheFuseLength;var lag=opts.lag===undefined?0:opts.lag;var iterFuseLength=opts.cacheIterFuseLength===undefined?10:opts.cacheIterFuseLength;var burn=opts.burn===undefined?0:opts.burn;var verboseLag=opts.verboseLag===undefined?1:opts.verboseLag;if(doFullRerun)dontAdapt=true;DEBUG=debuglevel;this.verbose=verbose;this.k=k;this.oldStore=s;this.iterations=numSamples*(lag+1)+burn;this.wpplFn=wpplFn;this.s=s;this.a=a;this.aggregator=new CountAggregator(onlyMAP);this.totalIterations=this.iterations;this.acceptedProps=0;this.lag=lag;this.burn=burn;this.verboseLag=verboseLag;this.doFullRerun=doFullRerun;this.doAdapt=!dontAdapt;this.cacheAdapter=new CacheAdapter(minHitRate,fuseLength,iterFuseLength);this.oldCoroutine=env.coroutine;env.coroutine=this}IncrementalMH.prototype.run=function(){this.cacheRoot=null;this.distMasterList=new HashtableDistMasterList;this.touchedNodes=[];this.score=0;this.fwdPropLP=0;this.rvsPropLP=0;this.query=new Query;env.query.clear();debuglog(1,"-------------------------------------");debuglog(1,"RUN FROM START");return this.runFromStart()};IncrementalMH.prototype.runFromStart=function(){this.nodeStack=[];return this.incrementalize(this.s,env.exit,this.a,this.wpplFn,[])};IncrementalMH.prototype.factor=function(s,k,a,score){return this.cachelookup(FactorNode,s,k,a,null,[score]).execute()};IncrementalMH.prototype.sample=function(s,k,a,dist,options,name){var n=this.cachelookup(DistNode,s,k,a,dist,[options]);n.name=name;return n.execute()};IncrementalMH.prototype.touch=function(node){this.touchedNodes.push(node)};function acceptProb(currScore,oldScore,currN,oldN,rvsPropLP,fwdPropLP){if(oldScore===undefined){return 1}if(currScore===-Infinity)return 0;debuglog(1,"currScore:",currScore,"oldScore",oldScore);debuglog(1,"rvsPropLP:",rvsPropLP,"fwdPropLP:",fwdPropLP);var fw=-Math.log(oldN)+fwdPropLP;var bw=-Math.log(currN)+rvsPropLP;var p=Math.exp(currScore-oldScore+bw-fw);assert.ok(!isNaN(p));var acceptance=Math.min(1,p);return acceptance}IncrementalMH.prototype.isInitialized=function(){return this.iterations<this.totalIterations};IncrementalMH.prototype.exit=function(){if(this.iterations>0){if(!this.isInitialized()&&this.score===-Infinity){return this.run()}else{var iternum=this.totalIterations-this.iterations;debuglog(1,"iteration",iternum);if(this.verbose&&this.iterations%this.verboseLag===0){if(iternum>this.burn){console.log("IncrementalMH iteration "+(iternum-this.burn)+" / "+(this.totalIterations-this.burn))}else{console.log("IncrementalMH burnin "+iternum+" / "+this.burn)}}this.iterations--;this.distMasterList.postProposal();debuglog(2,"Num vars:",this.distMasterList.size());debuglog(2,"Touched nodes:",this.touchedNodes.length);var acceptance=acceptProb(this.score,this.oldScore,this.distMasterList.size(),this.distMasterList.oldSize(),this.rvsPropLP,this.fwdPropLP);debuglog(1,"num vars:",this.distMasterList.size(),"old num vars:",this.distMasterList.oldSize());debuglog(1,"acceptance prob:",acceptance);if(util.random()>=acceptance){debuglog(1,"REJECT");this.score=this.oldScore;var n=this.touchedNodes.length;while(n--)restoreSnapshot(this.touchedNodes[n]);this.distMasterList.restoreOnReject()}else{debuglog(1,"ACCEPT");var n=this.touchedNodes.length;while(n--)discardSnapshot(this.touchedNodes[n]);this.acceptedProps++;this.query.addAll(env.query)}env.query.clear();var val=this.cacheRoot.retval;debuglog(1,"return val:",val);if(iternum%(this.lag+1)===0&&iternum>=this.burn){if(val===env.query)val=this.query.getTable();this.aggregator.add(val,this.score)}if(DEBUG>=6){debuglog(6,"=== Cache status ===");this.cacheRoot.print()}if(this.doAdapt)this.cacheAdapter.adapt(this.cacheRoot);if(this.distMasterList.numDists>0){this.oldScore=this.score;this.distMasterList.preProposal();this.touchedNodes=[];this.fwdPropLP=0;this.rvsPropLP=0;var propnode=this.distMasterList.getRandom();debuglog(1,"----------------------------------------------------------------------");debuglog(1,"PROPOSAL","type:",propnode.dist,"address:",propnode.address);return propnode.propose()}else{return this.runFromStart()}}}else{var k=this.k;env.coroutine=this.oldCoroutine;if(DEBUG>=5){console.log("Acceptance ratio: "+this.acceptedProps/this.totalIterations);this.cacheAdapter.report()}return k(this.oldStore,this.aggregator.toDist())}};IncrementalMH.prototype.incrementalize=function(s,k,a,fn,args){if(this.cacheAdapter.shouldCache(a))return this.cachelookup(FunctionNode,s,k,a,fn,args).execute();else return env.defaultCoroutine.incrementalize(s,k,a,fn,args)};IncrementalMH.prototype.cachelookup=function(NodeType,s,k,a,fn,args){var cacheNode;if(this.cacheRoot===null){cacheNode=new NodeType(this,null,s,k,a,fn,args);this.cacheRoot=cacheNode}else if(this.nodeStack.length===0){if(a!==this.cacheRoot.address)throw new Error("Wrong address for cache root lookup");cacheNode=this.cacheRoot;cacheNode.registerInputChanges(s,k,fn,args)}else{var currNode=this.nodeStack[this.nodeStack.length-1];tabbedlog(3,currNode.depth,"lookup",NodeType.name,a);cacheNode=this.findNode(currNode,a);if(cacheNode){tabbedlog(3,currNode.depth,"found");cacheNode.registerInputChanges(s,k,fn,args)}else{if(DEBUG){var addrs=_.map(_.filter(currNode.children,function(node){return node instanceof NodeType}),function(node){return node.address});tabbedlog(3,currNode.depth,"*not* found");tabbedlog(4,currNode.depth,"options were",addrs)}cacheNode=new NodeType(this,currNode,s,k,a,fn,args);var insertidx=currNode.nextChildIdx;if(!hasSnapshotForProperty(currNode,"children"))updateProperty(currNode,"children",currNode.children.slice());currNode.children.splice(insertidx,0,cacheNode)}}return cacheNode};IncrementalMH.prototype.findNode=function(parentNode,address){if(!this.isInitialized())return undefined;var nodes=parentNode.children;var nexti=parentNode.nextChildIdx;for(var i=nexti;i<nodes.length;i++){if(nodes[i].address===address){if(i!==nexti){if(!hasSnapshotForProperty(parentNode,"children")){nodes=nodes.slice();updateProperty(parentNode,"children",nodes)}var tmp=nodes[i];nodes[i]=nodes[nexti];nodes[nexti]=tmp}return nodes[nexti]}}};IncrementalMH.prototype.addDist=function(node){tabbedlog(3,node.depth,"new distribution");this.distMasterList.addDist(node);this.fwdPropLP+=node.score};IncrementalMH.prototype.removeDist=function(node){tabbedlog(3,node.depth,"kill distribution",node.address);this.distMasterList.removeDist(node);this.rvsPropLP+=node.score;this.score-=node.score};IncrementalMH.prototype.restoreStackUpTo=function(node){this.nodeStack=[];while(node!==null){this.nodeStack.push(node);node=node.parent}this.nodeStack.reverse()};IncrementalMH.prototype.addressInCache=function(addr){var stack=[this.cacheRoot];while(stack.length>0){var node=stack.pop();if(node.address===addr)return true;if(node.children!==undefined)for(var i=0;i<node.children.length;i++)stack.push(node.children[i])}return false};IncrementalMH.prototype.checkReachabilityConsistency=function(){var stack=[this.cacheRoot];while(stack.length>0){var node=stack.pop();if(!node.reachable)throw new Error("WTF - found unreachable node in cache.");if(node.children!==undefined)for(var i=0;i<node.children.length;i++)stack.push(node.children[i])}return false};function imh(s,cc,a,wpplFn,opts){opts=opts||{};return new IncrementalMH(s,cc,a,wpplFn,opts).run()}return{IncrementalMH:imh}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../aggregation/CountAggregator":151,"../hashtable":160,"../query":184,"../util":200,"./driftKernel":164,assert:216,underscore:148}],172:[function(require,module,exports){"use strict";var _=require("underscore");var assert=require("assert");var Trace=require("../trace");var ad=require("../ad");module.exports=function(env){var warnAfter=[1e3,1e4,1e5,1e6];function Initialize(cont,wpplFn,s,k,a,options){this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.k=k;this.a=a;this.ad=options.ad;this.failures=0;this.coroutine=env.coroutine;env.coroutine=this}Initialize.prototype.run=function(){this.trace=new Trace(this.wpplFn,this.s,this.k,this.a);env.query.clear();return this.trace.continue()};Initialize.prototype.sample=function(s,k,a,dist,options){var _val=dist.sample();var val=this.ad&&dist.isContinuous?ad.lift(_val):_val;this.trace.addChoice(dist,val,a,s,k,options);return k(s,val)};Initialize.prototype.factor=function(s,k,a,score){if(ad.value(score)===-Infinity){return this.fail()}this.trace.score=ad.scalar.add(this.trace.score,score);return k(s)};Initialize.prototype.fail=function(){this.failures+=1;var ix=warnAfter.indexOf(this.failures);if(ix>=0){console.log(["Initialization warning [",ix+1,"/",warnAfter.length,"]: Trace not initialized after ",this.failures," attempts."].join(""))}return this.run()};Initialize.prototype.exit=function(s,val){assert.notStrictEqual(this.trace.score,-Infinity);this.trace.complete(val);if(this.trace.value===env.query){this.trace.value=env.query.getTable()}env.coroutine=this.coroutine;return this.cont(this.trace)};Initialize.prototype.incrementalize=env.defaultCoroutine.incrementalize;return function(cont,wpplFn,s,k,a,options){return new Initialize(cont,wpplFn,s,k,a,options).run()}}},{"../ad":150,"../trace":187,assert:216,underscore:148}],173:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var util=require("../util");module.exports=function(env){var MHKernel=require("./mhkernel")(env);var HMCKernel=require("./hmckernel")(env);function HMCwithMHKernel(cont,oldTrace,options){return HMCKernel(function(trace){var opts=_.extendOwn({discreteOnly:true,adRequired:true},options);return MHKernel(cont,trace,opts)},oldTrace,options)}HMCwithMHKernel.adRequired=true;var kernels={MH:MHKernel,HMC:HMCwithMHKernel,HMConly:HMCKernel};function parseOptions(obj){function isKernelOption(obj){return _.isString(obj)&&_.has(kernels,obj)||_.size(obj)===1&&_.has(kernels,_.keys(obj)[0])}if(!isKernelOption(obj)){throw new Error("Unrecognized kernel option: "+JSON.stringify(obj))}var name=_.isString(obj)?obj:_.keys(obj)[0];var options=_.isString(obj)?{}:_.values(obj)[0];var kernel=kernels[name];return _.extendOwn(function(cont,oldTrace,extraOptions){var allOptions=_.extendOwn({},options,extraOptions);return kernel(cont,oldTrace,allOptions)},kernel)}function tap(fn){return function(k,trace){fn(trace);return k(trace)}}function sequence(){var kernels=arguments;assert(kernels.length>1);if(kernels.length===2){return function(k,trace1){return kernels[0](function(trace2){return kernels[1](k,trace2)},trace1)}}else{return sequence(kernels[0],sequence.apply(null,_.rest(kernels)))}}function repeat(n,kernel){return function(k,trace){return util.cpsIterate(n,trace,kernel,k)}}return{parseOptions:parseOptions,tap:tap,sequence:sequence,repeat:repeat}}},{"../util":200,"./hmckernel":170,"./mhkernel":175,assert:216,underscore:148}],174:[function(require,module,exports){(function(process){"use strict";var _=require("underscore");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");module.exports=function(env){var Initialize=require("./initialize")(env);var kernels=require("./kernels")(env);function MCMC(s,k,a,wpplFn,options){util.throwUnlessOpts(options,"MCMC");var options=util.mergeDefaults(options,{samples:100,kernel:"MH",lag:0,burn:0,callbacks:[]});options.kernel=kernels.parseOptions(options.kernel);var callbacks=options.verbose?[makeVMCallbackForPlatform()].concat(options.callbacks):options.callbacks;_.invoke(callbacks,"setup",numIters(options));var aggregator=new CountAggregator(options.onlyMAP);var addToAggregator=options.kernel.adRequired?function(value,score){aggregator.add(ad.valueRec(value),ad.value(score))}:aggregator.add.bind(aggregator);var initialize,run,finish;initialize=function(){_.invoke(callbacks,"initialize");return Initialize(run,wpplFn,s,env.exit,a,{ad:options.kernel.adRequired})};run=function(initialTrace){initialTrace.info={accepted:0,total:0};var callback=kernels.tap(function(trace){_.invoke(callbacks,"iteration",trace)});var collectSample=makeExtractValue(addToAggregator);var kernel=kernels.sequence(options.kernel,callback);var chain=kernels.sequence(kernels.repeat(options.burn,kernel),kernels.repeat(options.samples,kernels.sequence(kernels.repeat(options.lag+1,kernel),collectSample)));return chain(finish,initialTrace)};finish=function(trace){_.invoke(callbacks,"finish",trace);return k(s,aggregator.toDist())};return initialize()}function makeExtractValue(fn){return kernels.tap(function(trace){fn(trace.value,trace.score)})}function numIters(opts){return opts.burn+(opts.lag+1)*opts.samples}function makeVMCallback(opts){var curIter=0;return{iteration:function(trace){opts.iteration(trace,curIter++)},finish:function(trace){opts.finish(trace,curIter-1)}}}function makeSimpleVMCallback(){return makeVMCallback({iteration:function(trace,i){console.log(formatOutput(trace,i))},finish:_.identity})}function makeOverwritingVMCallback(){var writeCurIter=function(trace,i){process.stdout.write("\r"+formatOutput(trace,i))};return makeVMCallback({iteration:_.throttle(writeCurIter,200,{trailing:false}),finish:function(trace,i){writeCurIter(trace,i);console.log()}})}function formatOutput(trace,i){var ratio=trace.info.total===0?0:trace.info.accepted/trace.info.total;return"Iteration: "+i+" | Acceptance ratio: "+ratio.toFixed(4)}function makeVMCallbackForPlatform(){return util.runningInBrowser()?makeSimpleVMCallback():makeOverwritingVMCallback()}return{MCMC:MCMC}}}).call(this,require("_process"))},{"../ad":150,"../aggregation/CountAggregator":151,"../util":200,"./initialize":172,"./kernels":173,_process:306,underscore:148}],175:[function(require,module,exports){"use strict";var _=require("underscore");var assert=require("assert");var util=require("../util");var ad=require("../ad");module.exports=function(env){var drift=require("./driftKernel")(env);function MHKernel(cont,oldTrace,options){var options=util.mergeDefaults(options,{proposalBoundary:0,exitFactor:0,permissive:false,discreteOnly:false,adRequired:false});if(!options.permissive){assert.notStrictEqual(oldTrace.score,-Infinity)}this.cont=cont;this.oldTrace=oldTrace;this.a=oldTrace.baseAddress;this.reused={};this.proposalBoundary=options.proposalBoundary;this.exitFactor=options.exitFactor;this.discreteOnly=options.discreteOnly;this.adRequired=options.adRequired;this.coroutine=env.coroutine;env.coroutine=this}MHKernel.prototype.run=function(){this.regenFrom=this.sampleRegenChoice(this.oldTrace);if(this.regenFrom<0){return this.continue(this.oldTrace)}env.query.clear();this.trace=this.oldTrace.upto(this.regenFrom);var regen=this.oldTrace.choiceAtIndex(this.regenFrom);return this.resample(_.clone(regen.store),regen.k,regen.address,regen.dist,regen.options)};MHKernel.prototype.factor=function(s,k,a,score){if(ad.value(score)===-Infinity){return this.finish(this.oldTrace,false)}this.trace.numFactors+=1;this.trace.score=ad.scalar.add(this.trace.score,score);if(this.trace.numFactors===this.exitFactor){this.trace.saveContinuation(s,k);return this.exit(s,undefined,true)}return k(s)};MHKernel.prototype.sample=function(s,k,a,dist,options){var prevChoice=this.oldTrace.findChoice(a);var val;if(prevChoice){val=prevChoice.val;this.reused[a]=true}else{var _val=dist.sample();val=this.adRequired&&dist.isContinuous?ad.lift(_val):_val}return this.addChoiceToTrace(s,k,a,dist,options,val)};MHKernel.prototype.resample=function(s,k,a,dist,options){var prevChoice=this.oldTrace.findChoice(a);assert(prevChoice);return drift.getProposalDist(s,a,dist,options,prevChoice.val,function(s,fwdProposalDist){var _val=fwdProposalDist.sample();var val=this.adRequired&&fwdProposalDist.isContinuous?ad.lift(_val):_val;if(!fwdProposalDist.isContinuous&&prevChoice.val===val){return this.finish(this.oldTrace,true)}return drift.getProposalDist(s,a,dist,options,val,function(s,revProposalDist){this.fwdProposalDist=fwdProposalDist;this.revProposalDist=revProposalDist;return this.addChoiceToTrace(s,k,a,dist,options,val,true)}.bind(this))}.bind(this))};MHKernel.prototype.addChoiceToTrace=function(s,k,a,dist,options,val,atResample){this.trace.addChoice(dist,val,a,s,k,options);if(ad.value(this.trace.score)===-Infinity){if(atResample&&_.has(options,"driftKernel")){drift.proposalWarning(dist)}return this.finish(this.oldTrace,false)}return k(s,val)};MHKernel.prototype.exit=function(s,val,earlyExit){if(!earlyExit){this.trace.complete(val)}else{assert(this.trace.store);assert(this.trace.k);assert(!this.trace.isComplete())}var prob=this.acceptProb(this.trace,this.oldTrace);var accept=util.random()<prob;return this.finish(accept?this.trace:this.oldTrace,accept)};MHKernel.prototype.finish=function(trace,accepted){assert(_.isBoolean(accepted));if(accepted&&trace.value===env.query){trace.value=_.extendOwn({},this.oldTrace.value,env.query.getTable())}if(this.oldTrace.info){var oldInfo=this.oldTrace.info;trace.info={accepted:oldInfo.accepted+accepted,total:oldInfo.total+1}}return this.continue(trace)};MHKernel.prototype.continue=function(trace){env.coroutine=this.coroutine;return this.cont(trace)};MHKernel.prototype.incrementalize=env.defaultCoroutine.incrementalize;MHKernel.prototype.proposableDiscreteDistIndices=function(trace){return _.range(this.proposalBoundary,trace.length).filter(function(i){return!trace.choices[i].dist.isContinuous})};MHKernel.prototype.numRegenChoices=function(trace){if(this.discreteOnly){return this.proposableDiscreteDistIndices(trace).length}else{return trace.length-this.proposalBoundary}};MHKernel.prototype.sampleRegenChoice=function(trace){return this.discreteOnly?this.sampleRegenChoiceDiscrete(trace):this.sampleRegenChoiceAny(trace)};MHKernel.prototype.sampleRegenChoiceDiscrete=function(trace){var indices=this.proposableDiscreteDistIndices(trace);

return indices.length>0?indices[Math.floor(util.random()*indices.length)]:-1};MHKernel.prototype.sampleRegenChoiceAny=function(trace){var numChoices=trace.length-this.proposalBoundary;return numChoices>0?this.proposalBoundary+Math.floor(util.random()*numChoices):-1};MHKernel.prototype.acceptProb=function(trace,oldTrace){var fw=this.transitionProb(oldTrace,trace,this.fwdProposalDist);var bw=this.transitionProb(trace,oldTrace,this.revProposalDist);var p=Math.exp(ad.value(trace.score)-ad.value(oldTrace.score)+bw-fw);assert(!isNaN(p));return Math.min(1,p)};MHKernel.prototype.transitionProb=function(fromTrace,toTrace,proposalDist){var regenChoice=toTrace.choiceAtIndex(this.regenFrom);var score=ad.value(proposalDist.score(regenChoice.val));score+=util.sum(toTrace.choices.slice(this.regenFrom+1).map(function(choice){return this.reused.hasOwnProperty(choice.address)?0:ad.value(choice.dist.score(choice.val))},this));score-=Math.log(this.numRegenChoices(fromTrace));assert(!isNaN(score));return score};return function(cont,runWppl,oldTrace,options){return new MHKernel(cont,runWppl,oldTrace,options).run()}}},{"../ad":150,"../util":200,"./driftKernel":164,assert:216,underscore:148}],176:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");var nodeutil=require("util");var present=require("present");var util=require("../util");var optMethods=require("adnn/opt");var paramStruct=require("../paramStruct");var nodeUtil=require("util");module.exports=function(env){var estimators={ELBO:require("./elbo")(env),EUBO:require("./eubo")(env)};function Optimize(s,k,a,fnOrOptions,maybeOptions){var wpplFn,options;if(_.isFunction(fnOrOptions)){wpplFn=fnOrOptions;options=maybeOptions}else if(util.isObject(fnOrOptions)){wpplFn=fnOrOptions.model;options=_.omit(fnOrOptions,"model");if(!_.isFunction(wpplFn)&&_.isFunction(maybeOptions)){throw new Error("Optimize: expected model to be included in options.")}}else{throw new Error("Optimize: expected first argument to be an options object or a function.")}if(!_.isFunction(wpplFn)){throw new Error("Optimize: a model was not specified.")}options=util.mergeDefaults(options,{params:{},optMethod:"adam",estimator:"ELBO",steps:1,clip:false,showGradNorm:false,checkGradients:true,verbose:true,onFinish:function(s,k,a){return k(s)},logProgress:false,logProgressFilename:"optimizeProgress.csv",logProgressThrottle:200,checkpointParams:false,checkpointParamsFilename:"optimizeParams.json",checkpointParamsThrottle:1e4});var state={};var estimator=util.getValAndOpts(options.estimator,function(name,opts){if(!_.has(estimators,name)){throw new Error("Optimize: "+name+" is not a valid estimator. "+"The following estimators are available: "+_.keys(estimators).join(", ")+".")}opts=util.mergeDefaults(opts,_.pick(options,"verbose"));return _.partial(estimators[name],wpplFn,s,a,opts,state)});var optimizer=util.getValAndOpts(options.optMethod,function(name,opts){name=name==="gd"?"sgd":name;return optMethods[name](opts)});var paramObj=paramStruct.deepCopy(options.params);var showProgress=_.throttle(function(i,objective){console.log("Iteration "+i+": "+objective)},200,{trailing:false});var history=[];var logFile,logProgress;if(options.logProgress){logFile=fs.openSync(options.logProgressFilename,"w");fs.writeSync(logFile,"index,iter,time,objective\n");var ncalls=0;var starttime=present();logProgress=_.throttle(function(i,objective){var t=(present()-starttime)/1e3;fs.writeSync(logFile,nodeUtil.format("%d,%d,%d,%d\n",ncalls,i,t,objective));ncalls++},options.logProgressThrottle,{trailing:false})}var saveParams,checkpointParams;if(options.checkpointParams){saveParams=function(){var prms=_.mapObject(paramObj,function(lst){return lst.map(function(tensor){var tcopy=_.clone(tensor);tcopy.data=tensor.toFlatArray();return tcopy})});fs.writeFileSync(options.checkpointParamsFilename,JSON.stringify(prms))};checkpointParams=_.throttle(saveParams,options.checkpointParamsThrottle,{trailing:false})}return util.cpsLoop(options.steps,function(i,next){return estimator(paramObj,i,function(gradObj,objective){if(options.checkGradients){checkGradients(gradObj)}if(options.clip||options.showGradNorm){var norm=paramStruct.norm(gradObj);if(options.showGradNorm){console.log("L2 norm of gradient: "+norm)}if(options.clip){paramStruct.clip(gradObj,options.clip,norm)}}if(options.verbose){showProgress(i,objective)}if(options.logProgress){logProgress(i,objective)}if(options.checkpointParams){checkpointParams()}history.push(objective);optimizer(gradObj,paramObj,i);return next()})},function(){return options.onFinish(s,function(s){if(options.logProgress){fs.closeSync(logFile)}if(options.checkpointParams){saveParams()}return k(s,paramObj)},a,{history:history})})}function allZero(tensor){return!tensor.anyreduce()}function allFinite(tensor){return _.all(tensor.data,isFinite)}function checkGradients(gradObj){_.each(gradObj,function(grads,name){_.each(grads,function(g,i){if(allZero(g)){logGradWarning(name,i,"zero")}if(!allFinite(g)){logGradWarning(name,i,"not finite")}})})}var issuedGradWarning={};function logGradWarning(name,i,problem){var key=name+i+problem;if(!_.has(issuedGradWarning,key)){console.warn("Gradient for param "+name+":"+i+" is "+problem+".");issuedGradWarning[key]=true}}return{Optimize:Optimize}}},{"../paramStruct":183,"../util":200,"./elbo":165,"./eubo":168,"adnn/opt":25,assert:216,present:124,underscore:148,util:339}],177:[function(require,module,exports){"use strict";var _=require("underscore");var dists=require("../dists");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function last(xs){return xs[xs.length-1]}function PMCMC(s,cc,a,wpplFn,options){util.throwUnlessOpts(options,"PMCMC");this.oldCoroutine=env.coroutine;env.coroutine=this;this.k=cc;this.oldStore=s;this.particleIndex=0;this.retainedParticle=undefined;this.numSweeps=options.sweeps;this.sweep=0;this.wpplFn=wpplFn;this.address=a;this.numParticles=options.particles;this.resetParticles();this.hist=new CountAggregator}PMCMC.prototype.run=function(){return this.activeContinuationWithStore()};PMCMC.prototype.resetParticles=function(){var that=this;this.particles=[];var exitK=function(s){return that.wpplFn(s,env.exit,that.address)};for(var i=0;i<this.numParticles;i++){var particle={continuations:[exitK],stores:[that.oldStore],weights:[0],value:undefined};this.particles.push(_.clone(particle))}};PMCMC.prototype.activeParticle=function(){return this.particles[this.particleIndex]};PMCMC.prototype.activeContinuation=function(){return last(this.activeParticle().continuations)};PMCMC.prototype.activeContinuationWithStore=function(){var k=last(this.activeParticle().continuations);var s=_.clone(last(this.activeParticle().stores));return function(){return k(s)}};PMCMC.prototype.allParticlesAdvanced=function(){return this.particleIndex+1===this.particles.length};PMCMC.prototype.sample=function(s,cc,a,dist){return cc(s,dist.sample())};PMCMC.prototype.particleAtStep=function(particle,step){return{continuations:particle.continuations.slice(0,step+1),stores:particle.stores.slice(0,step+1),weights:particle.weights.slice(0,step+1),value:particle.value}};PMCMC.prototype.updateActiveParticle=function(weight,continuation,store){var particle=this.activeParticle();particle.continuations=particle.continuations.concat([continuation]);particle.stores=particle.stores.concat([_.clone(store)]);particle.weights=particle.weights.concat([weight])};PMCMC.prototype.copyParticle=function(particle){return{continuations:particle.continuations.slice(0),weights:particle.weights.slice(0),value:particle.value,stores:particle.stores.map(_.clone)}};PMCMC.prototype.resampleParticles=function(particles){var weights=particles.map(function(particle){return Math.exp(last(particle.weights))});var j;var newParticles=[];for(var i=0;i<particles.length;i++){j=dists.discreteSample(weights);newParticles.push(this.copyParticle(particles[j]))}return newParticles};PMCMC.prototype.factor=function(s,cc,a,score){this.updateActiveParticle(score,cc,s);if(this.allParticlesAdvanced()){if(this.sweep>0){var particles=this.particles;var step=this.particles[0].continuations.length-1;particles=particles.concat(this.particleAtStep(this.retainedParticle,step));this.particles=this.resampleParticles(particles).slice(1)}else{this.particles=this.resampleParticles(this.particles)}this.particleIndex=0}else{this.particleIndex+=1}return this.activeContinuationWithStore()};PMCMC.prototype.exit=function(s,retval){this.activeParticle().value=retval;if(!this.allParticlesAdvanced()){this.particleIndex+=1;return this.activeContinuationWithStore()}else{if(this.sweep>0){this.particles.concat(this.retainedParticle).forEach(function(particle){this.hist.add(particle.value)}.bind(this))}this.retainedParticle=this.particles[0];if(this.sweep<this.numSweeps){this.sweep+=1;this.particleIndex=0;this.resetParticles();return this.activeContinuationWithStore()}else{env.coroutine=this.oldCoroutine;return this.k(this.oldStore,this.hist.toDist())}}};PMCMC.prototype.incrementalize=env.defaultCoroutine.incrementalize;function pmc(s,cc,a,wpplFn,options){return new PMCMC(s,cc,a,wpplFn,options).run()}return{PMCMC:pmc}}},{"../aggregation/CountAggregator":151,"../dists":154,"../util":200,underscore:148}],178:[function(require,module,exports){"use strict";var _=require("underscore");var assert=require("assert");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function Rejection(s,k,a,wpplFn,options){util.throwUnlessOpts(options,"Rejection");options=util.mergeDefaults(options,{samples:1,maxScore:0,incremental:false});this.numSamples=options.samples;this.maxScore=options.maxScore;this.incremental=options.incremental;this.s=s;this.k=k;this.a=a;this.wpplFn=wpplFn;this.hist=new CountAggregator;this.oldCoroutine=env.coroutine;env.coroutine=this;if(!_.isNumber(this.numSamples)||this.numSamples<=0){throw new Error("samples should be a positive integer.")}if(this.incremental&&this.maxScore>0){util.warn("Rejection: Reduce maxScore to zero for better performance.")}}Rejection.prototype.run=function(){this.scoreSoFar=0;this.threshold=this.maxScore+Math.log(util.random());return this.wpplFn(_.clone(this.s),env.exit,this.a)};Rejection.prototype.sample=function(s,k,a,dist){return k(s,dist.sample())};Rejection.prototype.factor=function(s,k,a,score){if(this.incremental){assert(score<=0,"Score must be <= 0 for incremental rejection.")}this.scoreSoFar+=score;if(this.incremental&&this.scoreSoFar<=this.threshold||score===-Infinity){return this.run()}else{return k(s)}};Rejection.prototype.exit=function(s,retval){assert(this.scoreSoFar<=this.maxScore,"Score exceeded upper bound.");if(this.scoreSoFar>this.threshold){this.hist.add(retval);this.numSamples-=1}if(this.numSamples===0){env.coroutine=this.oldCoroutine;return this.k(this.s,this.hist.toDist())}else{return this.run()}};Rejection.prototype.incrementalize=env.defaultCoroutine.incrementalize;function rej(s,k,a,wpplFn,options){return new Rejection(s,k,a,wpplFn,options).run()}return{Rejection:rej}}},{"../aggregation/CountAggregator":151,"../util":200,assert:216,underscore:148}],179:[function(require,module,exports){"use strict";var _=require("underscore");var util=require("../util");var dists=require("../dists");var Trace=require("../trace");var assert=require("assert");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");var paramStruct=require("../paramStruct");module.exports=function(env){var kernels=require("./kernels")(env);function SMC(s,k,a,wpplFn,options){util.throwUnlessOpts(options,"SMC");var options=util.mergeDefaults(options,{particles:100,rejuvSteps:0,rejuvKernel:"MH",finalRejuv:true,saveTraces:false,ignoreGuide:false,onlyMAP:false,params:{}});this.rejuvKernel=kernels.parseOptions(options.rejuvKernel);this.rejuvSteps=options.rejuvSteps;this.performRejuv=this.rejuvSteps>0;this.adRequired=this.performRejuv&&this.rejuvKernel.adRequired;this.performFinalRejuv=this.performRejuv&&options.finalRejuv;this.numParticles=options.particles;this.debug=options.debug;this.saveTraces=options.saveTraces;this.ignoreGuide=options.ignoreGuide;this.onlyMAP=options.onlyMAP;this.params=paramStruct.copy(options.params);this.particles=[];this.completeParticles=[];this.particleIndex=0;this.step=0;for(var i=0;i<this.numParticles;i++){var trace=new Trace(wpplFn,s,env.exit,a);this.particles.push(new Particle(trace))}this.s=s;this.k=k;this.a=a;this.coroutine=env.coroutine;env.coroutine=this}SMC.prototype.run=function(){return this.runCurrentParticle()};SMC.prototype.sample=function(s,k,a,dist,options){var _val,choiceScore,importanceScore;if(options&&_.has(options,"guide")&&!this.ignoreGuide){var importanceDist=options.guide;_val=importanceDist.sample();choiceScore=dist.score(_val);importanceScore=importanceDist.score(_val)}else{_val=dist.sample();choiceScore=importanceScore=dist.score(_val)}var particle=this.currentParticle();particle.logWeight+=ad.value(choiceScore)-ad.value(importanceScore);var val=this.adRequired&&dist.isContinuous?ad.lift(_val):_val;if(this.performRejuv||this.saveTraces){particle.trace.addChoice(dist,val,a,s,k,options)}else{particle.trace.score=ad.scalar.add(particle.trace.score,choiceScore)}return k(s,val)};SMC.prototype.factor=function(s,k,a,score){var particle=this.currentParticle();particle.trace.numFactors+=1;particle.trace.saveContinuation(s,k);particle.trace.score=ad.scalar.add(particle.trace.score,score);particle.logWeight+=ad.value(score);this.debugLog("("+this.particleIndex+") Factor: "+a);return this.sync()};SMC.prototype.atLastParticle=function(){return this.particleIndex===this.particles.length-1};SMC.prototype.currentParticle=function(){return this.particles[this.particleIndex]};SMC.prototype.runCurrentParticle=function(){return this.currentParticle().trace.continue()};SMC.prototype.advanceParticleIndex=function(){this.particleIndex+=1};SMC.prototype.allParticles=function(){return this.completeParticles.concat(this.particles)};function resampleParticles(particles){if(particles.length===1){return particles}var m=particles.length;var logW=util.logsumexp(_.pluck(particles,"logWeight"));var logAvgW=logW-Math.log(m);assert.notStrictEqual(logAvgW,-Infinity,"All particles have zero weight.");var retainedParticles=[];var newWeights=[];_.each(particles,function(particle){var w=Math.exp(particle.logWeight-logAvgW);var nRetained=Math.floor(w);newWeights.push(w-nRetained);for(var i=0;i<nRetained;i++){retainedParticles.push(particle.copy())}});var numNewParticles=m-retainedParticles.length;var newParticles=[];var j;for(var i=0;i<numNewParticles;i++){j=dists.discreteSample(newWeights);newParticles.push(particles[j].copy())}var allParticles=newParticles.concat(retainedParticles);_.each(allParticles,function(p){p.logWeight=logAvgW});return allParticles}SMC.prototype.rejuvenateParticles=function(particles,cont){if(!this.performRejuv){return cont(particles)}assert(!this.particlesAreWeighted(particles),"Cannot rejuvenate weighted particles.");return util.cpsForEach(function(p,i,ps,next){return this.rejuvenateParticle(next,p)}.bind(this),function(){return cont(particles)},particles)};SMC.prototype.rejuvenateParticle=function(cont,particle){var kernelOptions={proposalBoundary:particle.proposalBoundary};if(this.performRejuv){kernelOptions.exitFactor=this.step}var kernel=_.partial(this.rejuvKernel,_,_,kernelOptions);var chain=kernels.repeat(this.rejuvSteps,kernel);return chain(function(trace){particle.trace=trace;return cont()},particle.trace)};SMC.prototype.particlesAreWeighted=function(particles){var lw=_.first(particles).logWeight;return _.any(particles,function(p){return p.logWeight!==lw})};SMC.prototype.particlesAreInSync=function(particles){return _.all(particles,function(p){var trace=p.trace;return trace.isComplete()&&trace.numFactors<this.step||!trace.isComplete()&&trace.numFactors===this.step}.bind(this))};SMC.prototype.sync=function(){if(!this.atLastParticle()){this.advanceParticleIndex();return this.runCurrentParticle()}else{this.step+=1;this.debugLog("***** sync :: step = "+this.step+" *****");var allParticles=this.allParticles();assert(this.particlesAreInSync(allParticles));var resampledParticles=resampleParticles(allParticles);assert.strictEqual(resampledParticles.length,this.numParticles);var numActiveParticles=_.reduce(resampledParticles,function(acc,p){return acc+(p.trace.isComplete()?0:1)},0);if(numActiveParticles>0){this.particleIndex=0;return this.rejuvenateParticles(resampledParticles,function(rejuvenatedParticles){assert(this.particlesAreInSync(rejuvenatedParticles));var p=_.partition(rejuvenatedParticles,function(p){return p.trace.isComplete()});this.completeParticles=p[0];this.particles=p[1];this.debugLog(p[1].length+" active particles after resample/rejuv.\n");if(this.particles.length>0){return this.runCurrentParticle()}else{return this.finish()}}.bind(this))}else{this.particles=[];this.completeParticles=resampledParticles;return this.finish()}}};SMC.prototype.debugLog=function(s){if(this.debug){console.log(s)}};SMC.prototype.exit=function(s,val){this.currentParticle().trace.complete(val);this.debugLog("("+this.particleIndex+") Exit | Value: "+val);return this.sync()};SMC.prototype.finish=function(s,val){assert.strictEqual(this.completeParticles.length,this.numParticles);var hist=new CountAggregator(this.onlyMAP);var traces=[];var aggregate=function(trace){var value=this.adRequired?ad.valueRec(trace.value):trace.value;var score=this.adRequired?ad.valueRec(trace.score):trace.score;hist.add(value,score);if(this.saveTraces){traces.push(trace)}}.bind(this);var logAvgW=_.first(this.completeParticles).logWeight;return util.cpsForEach(function(particle,i,ps,k){if(this.performFinalRejuv){var chain=kernels.repeat(this.rejuvSteps,kernels.sequence(this.rejuvKernel,kernels.tap(aggregate)));return chain(k,particle.trace)}else{aggregate(particle.trace);return k()}}.bind(this),function(){var dist=hist.toDist();dist.normalizationConstant=logAvgW;if(this.saveTraces){dist.traces=traces;dist.guideParams=this.params}env.coroutine=this.coroutine;return this.k(this.s,dist)}.bind(this),this.completeParticles)};SMC.prototype.incrementalize=env.defaultCoroutine.incrementalize;function setProposalBoundary(s,k,a){if(env.coroutine.currentParticle){var particle=env.coroutine.currentParticle();particle.proposalBoundary=particle.trace.length}return k(s)}var Particle=function(trace){this.trace=trace;this.logWeight=0;this.proposalBoundary=0};Particle.prototype.copy=function(){var p=new Particle(this.trace.copy());p.logWeight=this.logWeight;p.proposalBoundary=this.proposalBoundary;return p};return{SMC:function(s,k,a,wpplFn,options){return new SMC(s,k,a,wpplFn,options).run()},setProposalBoundary:setProposalBoundary}}},{"../ad":150,"../aggregation/CountAggregator":151,"../dists":154,"../paramStruct":183,"../trace":187,"../util":200,"./kernels":173,assert:216,underscore:148}],180:[function(require,module,exports){(function(global){"use strict";var types=require("ast-types");var build=types.builders;var esprima=require("esprima");var escodegen=require("escodegen");var assert=require("assert");var _=require("underscore");var ad=require("./transforms/ad").ad;var cps=require("./transforms/cps").cps;var addFilename=require("./transforms/addFilename").addFilename;var optimize=require("./transforms/optimize").optimize;var naming=require("./transforms/naming").naming;var store=require("./transforms/store").store;var stack=require("./transforms/stack");var varargs=require("./transforms/varargs").varargs;var trampoline=require("./transforms/trampoline").trampoline;var freevars=require("./transforms/freevars").freevars;var caching=require("./transforms/caching");var thunkify=require("./syntax").thunkify;var util=require("./util");var errors=require("./errors/errors");var env={};function requireHeader(path){requireHeaderWrapper(require(path))}function requireHeaderWrapper(wrapper){makePropertiesGlobal(wrapper(env))}function makePropertiesGlobal(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){global[prop]=obj[prop]}}}requireHeaderWrapper(require("./header"));function concatPrograms(programs){assert.ok(_.isArray(programs));var concat=function(p0,p1){return build.program(p0.body.concat(p1.body))};var emptyProgram=esprima.parse("");return programs.reduce(concat,emptyProgram)}function parse(code,filename){var ast=esprima.parse(code,{loc:true});return addFilename(ast,filename)}function parseAll(bundles){return bundles.map(function(bundle){var ast=parse(bundle.code,bundle.filename);return _.extendOwn({ast:ast},bundle)})}function headerPackage(){var dists="// This file was automatically generated by 'scripts/distHeader'.\n'no caching';\nvar Bernoulli = function(params) { return util.jsnew(dists.Bernoulli, params); };\nvar bernoulli = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {p: arg0};\n  return sample(Bernoulli(params));\n};\nvar Beta = function(params) { return util.jsnew(dists.Beta, params); };\nvar beta = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0, b: arg1};\n  return sample(Beta(params));\n};\nvar Binomial = function(params) { return util.jsnew(dists.Binomial, params); };\nvar binomial = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {p: arg0, n: arg1};\n  return sample(Binomial(params));\n};\nvar Categorical = function(params) { return util.jsnew(dists.Categorical, params); };\nvar Cauchy = function(params) { return util.jsnew(dists.Cauchy, params); };\nvar cauchy = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {location: arg0, scale: arg1};\n  return sample(Cauchy(params));\n};\nvar Delta = function(params) { return util.jsnew(dists.Delta, params); };\nvar delta = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {v: arg0};\n  return sample(Delta(params));\n};\nvar DiagCovGaussian = function(params) { return util.jsnew(dists.DiagCovGaussian, params); };\nvar diagCovGaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(DiagCovGaussian(params));\n};\nvar Dirichlet = function(params) { return util.jsnew(dists.Dirichlet, params); };\nvar dirichlet = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {alpha: arg0};\n  return sample(Dirichlet(params));\n};\nvar Discrete = function(params) { return util.jsnew(dists.Discrete, params); };\nvar discrete = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0};\n  return sample(Discrete(params));\n};\nvar Exponential = function(params) { return util.jsnew(dists.Exponential, params); };\nvar exponential = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0};\n  return sample(Exponential(params));\n};\nvar Gamma = function(params) { return util.jsnew(dists.Gamma, params); };\nvar gamma = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {shape: arg0, scale: arg1};\n  return sample(Gamma(params));\n};\nvar Gaussian = function(params) { return util.jsnew(dists.Gaussian, params); };\nvar gaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(Gaussian(params));\n};\nvar ImproperUniform = function(params) { return util.jsnew(dists.ImproperUniform, params); };\nvar IspNormal = function(params) { return util.jsnew(dists.IspNormal, params); };\nvar ispNormal = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(IspNormal(params));\n};\nvar LogisticNormal = function(params) { return util.jsnew(dists.LogisticNormal, params); };\nvar logisticNormal = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(LogisticNormal(params));\n};\nvar LogitNormal = function(params) { return util.jsnew(dists.LogitNormal, params); };\nvar logitNormal = function(arg0, arg1, arg2, arg3) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1, a: arg2, b: arg3};\n  return sample(LogitNormal(params));\n};\nvar Marginal = function(params) { return util.jsnew(dists.Marginal, params); };\nvar Multinomial = function(params) { return util.jsnew(dists.Multinomial, params); };\nvar multinomial = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0, n: arg1};\n  return sample(Multinomial(params));\n};\nvar MultivariateBernoulli = function(params) { return util.jsnew(dists.MultivariateBernoulli, params); };\nvar multivariateBernoulli = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0};\n  return sample(MultivariateBernoulli(params));\n};\nvar MultivariateGaussian = function(params) { return util.jsnew(dists.MultivariateGaussian, params); };\nvar multivariateGaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, cov: arg1};\n  return sample(MultivariateGaussian(params));\n};\nvar Poisson = function(params) { return util.jsnew(dists.Poisson, params); };\nvar poisson = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0};\n  return sample(Poisson(params));\n};\nvar RandomInteger = function(params) { return util.jsnew(dists.RandomInteger, params); };\nvar randomInteger = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {n: arg0};\n  return sample(RandomInteger(params));\n};\nvar SampleBasedMarginal = function(params) { return util.jsnew(dists.SampleBasedMarginal, params); };\nvar TensorGaussian = function(params) { return util.jsnew(dists.TensorGaussian, params); };\nvar tensorGaussian = function(arg0, arg1, arg2) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1, dims: arg2};\n  return sample(TensorGaussian(params));\n};\nvar Uniform = function(params) { return util.jsnew(dists.Uniform, params); };\nvar uniform = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0, b: arg1};\n  return sample(Uniform(params));\n};";var header="'no caching';\n\n// Other distribution helpers\n\nvar flip = function(p) {\n  var params = {p: (p !== undefined) ? p : .5};\n  return sample(Bernoulli(params));\n};\n\nvar categorical = function(arg1, arg2) {\n  var params = util.isObject(arg1) ? arg1 : {ps: arg1, vs: arg2};\n  return params.vs[discrete(params.ps)];\n};\n\nvar uniformDraw = function(arg) {\n  var vs = util.isObject(arg) ? arg.vs : arg;\n  if (vs.length == 0) {\n    return undefined;\n  } else {\n    return vs[sample(RandomInteger({n: vs.length}))];\n  }\n};\n\nvar serializeDist = function(d) {\n  return dists.serialize(d);\n};\n\nvar deserializeDist = function(JSONString) {\n  return dists.deserialize(JSONString);\n};\n\n// Drift kernel helpers\n\nvar gaussianDrift = function(params) {\n  return sample(Gaussian(_.omit(params, 'width')), {\n    driftKernel: function(prevVal) {\n      var width = _.has(params, 'width') ? params.width : params.sigma * 0.7;\n      return Gaussian({mu: prevVal, sigma: width});\n    }\n  });\n};\n\nvar dirichletDrift = function(params) {\n  return sample(Dirichlet(_.omit(params, 'concentration')), {\n    driftKernel: function(prevVal) {\n      var c = _.has(params, 'concentration') ? params.concentration : 10;\n      var alpha = T.mul(prevVal, c);\n      return Dirichlet({alpha: alpha});\n    }\n  });\n};\n\nvar uniformDrift = function(params) {\n  return sample(Uniform(_.omit(params, 'width')), {\n    driftKernel: function(prevVal) {\n      var width = _.has(params, 'width') ? params.width : 0.1;\n      var a = Math.max(params.a, prevVal - width);\n      var b = Math.min(params.b, prevVal + width);\n      return Uniform({a: a, b: b});\n    }\n  });\n};\n\n// XRPs\n\nvar makeBetaBernoulli = function(pseudocounts) {\n  globalStore.BBindex = 1 + (globalStore.BBindex || 0);\n  var bbname = 'BB' + globalStore.BBindex;\n  globalStore[bbname] = pseudocounts;\n  return function() {\n    var pc = globalStore[bbname];  // get current sufficient stats\n    var val = sample(Bernoulli({p: pc[0] / (pc[0] + pc[1])}));  // sample from predictive.\n    globalStore[bbname] = [pc[0] + val, pc[1] + !val];  // update sufficient stats\n    return val;\n  };\n};\n\nvar makeDirichletDiscrete = function(pseudocounts) {\n  var addCount = function(a, i, j) {\n    var j = j || 0;\n    if (a.length === 0) {\n      return [];\n    } else {\n      return [a[0] + (i === j)].concat(addCount(a.slice(1), i, j + 1));\n    }\n  };\n  globalStore.DDindex = 1 + (globalStore.DDindex || 0);\n  var ddname = 'DD' + globalStore.DDindex;\n  globalStore[ddname] = pseudocounts;\n  return function() {\n    var pc = globalStore[ddname];  // get current sufficient stats\n    var val = sample(Discrete({ps: pc}));  // sample from predictive. (doesn't need to be normalized.)\n    globalStore[ddname] = addCount(pc, val); // update sufficient stats\n    return val;\n  };\n};\n\nvar mem = function(f) {\n  globalStore.memIndex = 1 + (globalStore.memIndex || 0);\n  var key = 'mem' + globalStore.memIndex;\n  return function() {\n    var stringedArgs = key + util.serialize(arguments);\n    if (_.has(globalStore, stringedArgs)) {\n      return globalStore[stringedArgs];\n    } else {\n      var val = apply(f, arguments);\n      globalStore[stringedArgs] = val;\n      return val;\n    }\n  };\n};\n\nvar isEven = function(v) {\n  return v % 2 === 0;\n};\nvar isOdd = function(v) {\n  return v % 2 != 0;\n};\n\nvar idF = function(x) {\n  return x;\n};\nvar constF = function(f) {\n  return function() {\n    return f;\n  };\n};\nvar falseF = function() {\n  return false;\n};\nvar trueF = function() {\n  return true;\n};\n\n// Probability computations & calculations\n\nvar MAP = function(dist) {\n  return dist.MAP();\n};\n\nvar expectation = function(dist, func) {\n  var f = func || idF;\n  var supp = dist.support();\n  return reduce(function(s, acc) {\n    return acc + Math.exp(dist.score(s)) * f(s);\n  }, 0, supp);\n};\n\nvar entropy = function(dist) {\n  return dist.entropy();\n};\n\n// Data structures & higher-order functions\n\nvar append = function(a, b) {\n  return a.concat(b);\n};\nvar cons = function(a, b) {\n  return [a].concat(b);\n};\nvar snoc = function(a, b) {\n  return a.concat([b]);\n};\n\nvar first = function(xs) {\n  return xs[0];\n};\nvar second = function(xs) {\n  return xs[1];\n};\nvar third = function(xs) {\n  return xs[2];\n};\nvar fourth = function(xs) {\n  return xs[3];\n};\nvar secondLast = function(xs) {\n  return xs[xs.length - 2];\n};\nvar last = function(xs) {\n  return xs[xs.length - 1];\n};\n\nvar most = function(xs) {\n  return xs.slice(0, xs.length - 1);\n}\n\nvar rest = function(xs) {\n  return xs.slice(1);\n};\n\nvar map_helper = function(i, j, f) {\n  var n = j - i + 1;\n  if (n == 0) {\n    return []\n  } else if (n == 1) {\n    return [f(i)];\n  } else {\n    var n1 = Math.ceil(n / 2);\n    return map_helper(i, i + n1 - 1, f).concat(map_helper(i + n1, j, f));\n  }\n}\n\n// recursively split input array so that we only call\n// concat a logarithmic number of times\nvar map = function(fn, l) {\n  return map_helper(0, l.length - 1, function(i) { return fn(l[i]) })\n}\n\n// assumes that length l1 == length l2\nvar map2 = function(fn, l1, l2) {\n  return map_helper(0, l1.length - 1, function(i) { return fn(l1[i], l2[i]) })\n}\n\n// sugar for map(f, [0,1,...,n-1])\nvar mapN = function(fn, n) {\n  return map_helper(0, n - 1, function(i) { return fn(i) })\n}\n\nvar mapIndexed = function(fn, l) {\n  return map_helper(0, l.length - 1, function(i) { return fn(i, l[i]) })\n}\n\nvar mapObject = function(fn, obj) {\n  return _.object(\n      map(\n      function(kv) {\n        return [kv[0], fn(kv[0], kv[1])]\n      },\n      _.pairs(obj))\n  );\n};\n\nvar reduce = function(fn, init, ar) {\n  var n = ar.length;\n  var helper = function(i) {\n    if (i === n) {\n      return init\n    } else {\n      return fn(ar[i], helper(i + 1))\n    }\n  }\n\n  return helper(0);\n};\n\nvar sum = function(l) {\n  return reduce(function(a, b) { return a + b; }, 0, l);\n};\nvar product = function(l) {\n  return reduce(function(a, b) { return a * b; }, 1, l);\n};\n\nvar listMean = function(l) {\n  return sum(l) / l.length;\n};\nvar listVar = function(l, mu) {\n  var mu = mu === undefined ? listMean(l) : mu;\n  return reduce(function(a, acc) {\n    return acc + (a - mu) * (a - mu);\n  }, 0, l) / l.length;\n\n};\nvar listStdev = function(l, mu) {\n  return Math.sqrt(listVar(l, mu));\n};\n\nvar normalize = function(xs) {\n  var Z = sum(xs);\n  return map(function(x) {\n    return x / Z;\n  }, xs);\n};\n\nvar all = function(p, l) {\n  return reduce(function(x, acc) {\n    return acc && p(x);\n  }, true, l);\n};\n\nvar any = function(p, l) {\n  return reduce(function(x, acc) {\n    return acc || p(x);\n  }, false, l);\n};\n\nvar zip = function(xs, ys) {\n  return map2(function(x, y) { return [x, y]},\n              xs,\n              ys)\n};\n\nvar filter = function(fn, ar) {\n  var helper = function(i, j) {\n    var n = j - i + 1;\n    if (n == 0) {\n      return [];\n    } else if (n == 1) {\n      return (fn(ar[i]) ? [ar[i]] : []);\n    } else {\n      var n1 = Math.ceil(n / 2);\n      return helper(i, i + n1 - 1).concat(helper(i + n1, j));\n    }\n  }\n\n  return helper(0, ar.length - 1)\n};\n\nvar find = function(f, ar) {\n  var n = ar.length;\n  var helper = function(i) {\n    if (i === n) {\n      return undefined;\n    } else if (f(ar[i])) {\n      return ar[i];\n    } else {\n      return helper(i + 1);\n    }\n  }\n  return helper(0);\n};\n\nvar remove = function(a, ar) {\n  return filter(function(e) {\n    return a != e;\n  }, ar);\n};\n\n\nvar minWith = function(f, ar) {\n  var fn = function(_ar, _best) {\n    if (_ar.length === 0) {\n      return _best;\n    } else if (_ar[0][1] < _best[1]) {\n      return fn(_ar.slice(1), _ar[0]);\n    } else {\n      return fn(_ar.slice(1), _best);\n    }\n  };\n  return fn(zip(ar, map(f, ar)), [Infinity, Infinity]);\n};\n\nvar maxWith = function(f, ar) {\n  var fn = function(_ar, _best) {\n    if (_ar.length === 0) {\n      return _best;\n    } else if (_ar[0][1] > _best[1]) {\n      return fn(_ar.slice(1), _ar[0]);\n    } else {\n      return fn(_ar.slice(1), _best);\n    }\n  };\n  return fn(zip(ar, map(f, ar)), [-Infinity, -Infinity]);\n};\n\n// bin array into items satisfying a predicate p and items not satifying it\nvar span = function(p, ar) {\n  var n = ar.length;\n  var helper = function(i, _ts, _fs) {\n    return (i === n ?\n            [_ts, _fs] :\n            (p(ar[i]) ?\n             helper(i + 1, snoc(_ts, ar[i]), _fs) :\n             helper(i + 1, _ts, snoc(_fs, ar[i]))));\n  };\n  return helper(0, [], []);\n};\n\n// group array items by a comparator\n// NB: there is still room for optimization here\nvar groupBy = function(cmp, ar) {\n  if (ar.length === 0) {\n    return [];\n  } else {\n    var x = ar[0];\n    var sp = span(function(b) { return cmp(x, b); }, ar.slice(1));\n    return [cons(x, sp[0])].concat(groupBy(cmp, sp[1]));\n  }\n};\n\nvar repeat = function(n, fn) {\n  var helper = function(m) {\n    if (m == 0) {\n      return [];\n    } else if (m == 1) {\n      return [fn()];\n    } else {\n      var m1 = Math.ceil(m / 2),\n          m2 = m - m1;\n      return helper(m1).concat(helper(m2));\n    }\n  }\n\n  return helper(n);\n}\n\nvar compose = function(f, g) {\n  return function(x) {\n    return f(g(x));\n  };\n};\n\nvar everyOther = function(l) {\n  return l.length <= 1 ? l : [l[0]].concat(everyOther(l.slice(2)));\n};\n\nvar _merge = function(l1, l2, pred, key) {\n  return (l1.length === 0 ?\n          l2 :\n          (l2.length === 0 ?\n           l1 :\n           (pred(key(l1[0]), key(l2[0])) ?\n            [l1[0]].concat(_merge(l1.slice(1), l2, pred, key)) :\n            [l2[0]].concat(_merge(l1, l2.slice(1), pred, key)))));\n};\n\nvar _sort = function(l, pred, key) {\n  return ((l.length <= 1) ?\n          l :\n          _merge(_sort(everyOther(l), pred, key),\n                 _sort(everyOther(l.slice(1)), pred, key),\n                 pred,\n                 key));\n};\n\nvar lt = function(a, b) {\n  return a < b;\n};\n\nvar gt = function(a, b) {\n  return a > b;\n};\n\nvar sort = function(l, pred, key) {\n  return _sort(l, (pred || lt), (key || idF));\n};\n\nvar sortOn = function(l, key, pred) {\n  return _sort(l, (pred || lt), key);\n};\n\nvar condition = function(bool) {\n  factor(bool ? 0 : -Infinity);\n};\n\nvar observe = function(dist, val) {\n  if (val !== undefined) {\n    factor(dist.score(val));\n    return val;\n  } else {\n    return sample(dist);\n  }\n};\n\nvar MH = function(wpplFn, samples, burn) {\n  return MCMC(wpplFn, { samples: samples, burn: burn });\n};\n\nvar ParticleFilter = function(wpplFn, particles) {\n  return SMC(wpplFn, { particles: particles, rejuvSteps: 0 });\n};\n\nvar ParticleFilterRejuv = function(wpplFn, particles, rejuvSteps) {\n  return SMC(wpplFn, { particles: particles, rejuvSteps: rejuvSteps });\n};\n\nvar SampleGuide = function(wpplFn, options) {\n  return ForwardSample(wpplFn, _.extendOwn({guide: true}, _.omit(options, 'guide')));\n};\n\nvar OptimizeThenSample = function(wpplFn, options) {\n  var params = Optimize(wpplFn, _.omit(options, 'samples'));\n  var opts = _.extendOwn({params: params}, _.pick(options, 'samples', 'verbose'));\n  return SampleGuide(wpplFn, opts);\n};\n\nvar Infer = function(options, maybeFn) {\n  if (!util.isObject(options)) {\n    util.fatal('Infer: expected first argument to be an options object.');\n  }\n  var wpplFn = maybeFn || options.model;\n  if (!_.isFunction(wpplFn)) {\n    util.fatal('Infer: a model was not specified.');\n  }\n\n  // Map from camelCase options to PascalCase coroutine names. Also\n  // used to ensure the supplied method name is a valid inference\n  // routine.\n  var methodMap = {\n    SMC: SMC,\n    MCMC: MCMC,\n    PMCMC: PMCMC,\n    asyncPF: AsyncPF,\n    rejection: Rejection,\n    enumerate: Enumerate,\n    incrementalMH: IncrementalMH,\n    forward: ForwardSample,\n    optimize: OptimizeThenSample\n  };\n\n  var methodName = options.method || 'enumerate';\n  if (!_.has(methodMap, methodName)) {\n    var methodNames = _.keys(methodMap);\n    var msg = 'Infer: \\'' + methodName +\n        '\\' is not a valid method. The following methods are available: ' +\n        methodNames.join(', ') + '.';\n    util.fatal(msg);\n  }\n  var method = methodMap[methodName];\n  return method(wpplFn, _.omit(options, 'method', 'model'));\n};\n\n// Convenience function for creating maximum likelihood model\n// parameters.\nvar modelParam = function(options) {\n  return sample(ImproperUniform(), {\n    guide: Delta({v: param(options)})\n  });\n};\n\n// Convenience functions for building tensors out of scalars\nvar Vector = function(arr) {\n  var n = arr.length;\n  var t = ad.tensor.fromScalars(arr);\n  return ad.tensor.reshape(t, [n, 1]);\n};\nvar Matrix = function(arr) {\n  var n = arr.length;\n  var m = arr[0].length;\n  var t = ad.tensor.fromScalars(_.flatten(arr));\n  return ad.tensor.reshape(t, [n, m]);\n};\nvar Tensor = function(dims, arr) {\n  var t = ad.tensor.fromScalars(arr);\n  return ad.tensor.reshape(t, dims);\n};\n";

return{wppl:[{code:dists,filename:"dists.wppl"},{code:header,filename:"header.wppl"}]}}function unpack(packages){return _.chain(packages).map(function(pkg){return pkg.wppl.map(function(wppl){return{code:wppl.code,filename:wppl.filename}})}).flatten().value()}function parsePackageCode(packages,verbose){function _parsePackageCode(){var allPackages=[headerPackage()].concat(packages);return util.pipeline([unpack,parseAll])(allPackages)}return util.timeif(verbose,"parsePackageCode",_parsePackageCode)}function applyCaching(asts){return asts.map(function(ast){return caching.hasNoCachingDirective(ast)?ast:caching.transform(ast)})}function copyAst(ast){var ret=_.isArray(ast)?[]:{};_.each(ast,function(val,key){ret[key]=_.isObject(val)?copyAst(val):val});return ret}function generateCodeAndSourceMap(code,filename,bundles,ast){var codeAndMap=escodegen.generate(ast,{sourceMap:true,sourceMapWithCode:true});var sourceMap=JSON.parse(codeAndMap.map);sourceMap.sourcesContent=sourceMap.sources.map(function(fn){return fn===filename?code:_.findWhere(bundles,{filename:fn}).code});return{code:codeAndMap.code,sourceMap:sourceMap}}function compile(code,options){options=util.mergeDefaults(options,{verbose:false,filename:"webppl:program"});var bundles=options.bundles||parsePackageCode([],options.verbose);var addressMap;var saveAddressMap=function(obj){addressMap=obj.map;return obj.ast};var transforms=options.transforms||[ad,thunkify,naming,saveAddressMap,varargs,cps,store,optimize,options.debug?stack.transform:_.identity,trampoline,stack.wrapProgram];function _compile(){var programAst=parse(code,options.filename);var asts=_.pluck(bundles,"ast").map(copyAst).concat(programAst);assert.strictEqual(bundles[0].filename,"dists.wppl");assert.strictEqual(bundles[1].filename,"header.wppl");var doCaching=_.any(asts.slice(2),caching.transformRequired);if(options.verbose&&doCaching){console.log("Caching transform will be applied.")}var generateCodeAndAssets=function(ast){var obj=generateCodeAndSourceMap(code,options.filename,bundles,ast);obj.addressMap=addressMap;return obj};return util.pipeline([doCaching?applyCaching:_.identity,concatPrograms,doCaching?freevars:_.identity,util.pipeline(transforms),generateCodeAndAssets])(asts)}return util.timeif(options.verbose,"compile",_compile)}function wrapWithHandler(f,handler){return function(x,y){try{return f(x,y)}catch(e){handler(e)}}}function wrapRunner(baseRunner,handlers){var wrappedRunner=handlers.reduce(wrapWithHandler,baseRunner);var runner=function(t){return wrappedRunner(t,runner)};return runner}function prepare(codeAndAssets,k,options){options=util.mergeDefaults(options,{errorHandlers:[],initialStore:{}});var currentAddress={value:undefined};var defaultHandler=function(error){errors.extendError(error,codeAndAssets,currentAddress);throw error};var allErrorHandlers=[defaultHandler].concat(options.errorHandlers);var baseRunner=options.baseRunner||util.trampolineRunners[util.runningInBrowser()?"web":"cli"]();var runner=wrapRunner(baseRunner,allErrorHandlers);var run=function(){env.reset();eval.call(global,codeAndAssets.code)(currentAddress)(runner)(options.initialStore,k,"")};return{run:run,runner:runner}}function run(code,k,options){options=options||{};var codeAndAssets=compile(code,options);util.timeif(options.verbose,"run",prepare(codeAndAssets,k,options).run)}global.webpplEval=function(s,k,a,code,runnerName){if(runnerName===undefined){runnerName=util.runningInBrowser()?"web":"cli"}var handler=function(error){throw"webpplEval error:\n"+error};var baseRunner=util.trampolineRunners[runnerName]();var runner=wrapRunner(baseRunner,[handler]);var compiledCode=compile(code,{filename:"webppl:eval"}).code;return eval.call(global,compiledCode)({})(runner)(s,k,a)};module.exports={requireHeader:requireHeader,requireHeaderWrapper:requireHeaderWrapper,parsePackageCode:parsePackageCode,prepare:prepare,run:run,compile:compile}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./errors/errors":157,"./header":161,"./syntax":185,"./transforms/ad":188,"./transforms/addFilename":189,"./transforms/caching":191,"./transforms/cps":192,"./transforms/freevars":193,"./transforms/naming":194,"./transforms/optimize":195,"./transforms/stack":196,"./transforms/store":197,"./transforms/trampoline":198,"./transforms/varargs":199,"./util":200,assert:216,"ast-types":49,escodegen:50,esprima:110,underscore:148}],181:[function(require,module,exports){"use strict";var assert=require("assert");var Tensor=require("../tensor");function add(x,y){if(x instanceof Tensor){return x.add(y)}else if(typeof x==="number"){return x+y}else{throw new Error("add: unhandled types")}}function addEq(x,y){if(x instanceof Tensor){return x.addeq(y)}else if(typeof x==="number"){return x+y}else{throw new Error("addEq: unhandled types")}}function mul(x,y){if(x instanceof Tensor){return x.mul(y)}else if(typeof x==="number"){return x*y}else{throw new Error("mul: unhandled types")}}function sum(x){if(x instanceof Tensor){return x.sumreduce()}else if(typeof x==="number"){return x}else{throw new Error("sum: unhandled type")}}module.exports={add:add,addEq:addEq,mul:mul,sum:sum}},{"../tensor":186,assert:216}],182:[function(require,module,exports){"use strict";var gammaCof=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];function logGamma(xx){var x=xx-1;var tmp=x+5.5;tmp-=(x+.5)*Math.log(tmp);var ser=1.000000000190015;for(var j=0;j<=5;j++){x+=1;ser+=gammaCof[j]/x}return-tmp+Math.log(2.5066282746310007*ser)}function digamma(x){if(x<6){return digamma(x+1)-1/x}return Math.log(x)-1/(2*x)-1/(12*Math.pow(x,2))+1/(120*Math.pow(x,4))-1/(252*Math.pow(x,6))+1/(240*Math.pow(x,8))-5/(660*Math.pow(x,10))+691/(32760*Math.pow(x,12))-1/(12*Math.pow(x,14))}function trigamma(x){if(x<30){return trigamma(x+1)+1/(x*x)}return 1/x+1/(2*Math.pow(x,2))+1/(6*Math.pow(x,3))-1/(30*Math.pow(x,5))+1/(42*Math.pow(x,7))-1/(30*Math.pow(x,9))}function doubleFactorial(x){var parity=x%2;var product=1;for(var i=1;i<=x;i++){if(i%2==parity){product*=i}}return product}module.exports={logGamma:logGamma,digamma:digamma,trigamma:trigamma,doubleFactorial:doubleFactorial}},{}],183:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("underscore");function addEq(g,h){_.each(h,function(hs,a){if(!_.has(g,a)){g[a]=hs}else{var gs=g[a];assert.strictEqual(gs.length,hs.length);for(var i=0;i<gs.length;i++){gs[i].addeq(hs[i])}}})}function mulEq(g,s){_.each(g,function(gs){for(var i=0;i<gs.length;i++){gs[i].muleq(s)}})}function divEq(g,s){_.each(g,function(gs){for(var i=0;i<gs.length;i++){gs[i].diveq(s)}})}function norm(g){var normsq=0;_.each(g,function(gs){_.each(gs,function(g){normsq+=g.mul(g).sumreduce()})});return Math.sqrt(normsq)}function clip(g,threshold,normOfG){assert.ok(_.isNumber(threshold));if(normOfG>threshold){mulEq(g,threshold/normOfG);assert.ok(Math.abs(threshold-norm(g))<1e-10)}}function copy(g){return _.mapObject(g,function(arr){return arr.slice()})}function deepCopy(g){return _.mapObject(g,function(arr){return arr.map(function(tensor){return tensor.clone()})})}module.exports={addEq:addEq,mulEq:mulEq,divEq:divEq,norm:norm,clip:clip,copy:copy,deepCopy:deepCopy}},{assert:216,underscore:148}],184:[function(require,module,exports){"use strict";function Query(){this.table={}}Query.prototype.add=function(key,val){this.table[key]=val};Query.prototype.addAll=function(other){for(var key in other.table)this.table[key]=other.table[key]};Query.prototype.clear=function(){this.table={}};Query.prototype.getTable=function(){var tbl={};for(var key in this.table)tbl[key]=this.table[key];return tbl};module.exports={Query:Query}},{}],185:[function(require,module,exports){"use strict";var types=require("ast-types").namedTypes;var build=require("ast-types").builders;var keys=require("estraverse").VisitorKeys;var Syntax=require("estraverse").Syntax;function makeGenvar(){var gensym=require("./util").makeGensym();return function(name){return build.identifier("_".concat(gensym(name)))}}function fail(message,node){return function(){console.log(node);console.log(message);throw new Error(message)}}function clause(type,destructor){return function(node,fail){if(types.hasOwnProperty(type)){if(types[type].check(node)){return destructor.apply(this,keys[type].map(function(key){return node[key]}))}else{return fail()}}else{throw new Error("no type "+type)}}}function match(node,clauses,fail){for(var i=0;i<clauses.length;i++){var failed=false;var value=clauses[i](node,function(){failed=true});if(!failed){return value}}return fail()}function failSafe(who,fail){if(typeof fail==="function"){return fail()}else{throw new Error(who+": fail is not a function")}}function inProgram(f,fail){return function(node){if(types.Program.check(node)&&node.body.length===1&&types.ExpressionStatement.check(node.body[0])){return build.program([build.expressionStatement(f(node.body[0].expression))])}else{return failSafe("inProgram",fail)}}}function inBody(f,fail){return inProgram(function(node){if(types.FunctionExpression.check(node)){return build.functionExpression(node.id,node.params,build.blockStatement(f(build.program(node.body.body)).body))}else{return failSafe("inBody",fail)}},fail)}function returnify(nodes){if(nodes.length===0){return nodes}else{var returnNode=match(nodes[nodes.length-1],[clause(Syntax.BlockStatement,function(body){return build.blockStatement(returnify(body))}),clause(Syntax.EmptyStatement,function(){return build.emptyStatement()}),clause(Syntax.ExpressionStatement,function(expression){return build.returnStatement(expression)}),clause(Syntax.IfStatement,function(test,consequent,alternate){return build.ifStatement(test,build.blockStatement(returnify(consequent.body)),alternate===null?null:build.blockStatement(returnify(alternate.body)))}),clause(Syntax.ReturnStatement,function(argument){return build.returnStatement(argument)})],function(){return});if(returnNode){nodes[nodes.length-1]=returnNode}else{nodes=nodes.concat(build.returnStatement(build.identifier("undefined")))}return nodes}}function isPrimitive(node){switch(node.type){case Syntax.FunctionExpression:case Syntax.Identifier:case Syntax.CallExpression:return false;case Syntax.MemberExpression:return types.Identifier.check(node.object)||!node.computed&&types.Identifier.check(node.property);default:console.log(node);throw new Error("isPrimitive doesn't handle node")}}function thunkify(node,fail){if(types.Program.check(node)){return build.program([build.expressionStatement(build.functionExpression(null,[],build.blockStatement(returnify(node.body))))])}else{return failSafe("thunkify",fail)}}module.exports={makeGenvar:makeGenvar,fail:fail,clause:clause,match:match,thunkify:thunkify,inProgram:inProgram,inBody:inBody,isPrimitive:isPrimitive}},{"./util":200,"ast-types":49,estraverse:117}],186:[function(require,module,exports){"use strict";var Tensor=require("adnn/tensor");var special=require("./math/special");Tensor.prototype.logGamma=function(){var out=new Tensor(this.dims);var n=this.data.length;while(n--){out.data[n]=special.logGamma(this.data[n])}return out};module.exports=Tensor},{"./math/special":182,"adnn/tensor":30}],187:[function(require,module,exports){"use strict";var _=require("underscore");var assert=require("assert");var isDist=require("./dists").isDist;var ad=require("./ad");var Trace=function(wpplFn,s,k,a){this.wpplFn=wpplFn;this.initialStore=s;this.exitK=k;this.baseAddress=a;this.choices=[];this.addressMap={};this.length=0;this.score=0;this.numFactors=0};Trace.prototype.fresh=function(){return new Trace(this.wpplFn,this.initialStore,this.exitK,this.baseAddress)};Trace.prototype.choiceAtIndex=function(index){return this.choices[index]};Trace.prototype.findChoice=function(address){return this.addressMap[address]};Trace.prototype.saveContinuation=function(s,k){this.store=s;this.k=k};Trace.prototype.continue=function(){if(this.k&&this.store){return this.k(this.store)}else{return this.wpplFn(_.clone(this.initialStore),this.exitK,this.baseAddress)}};Trace.prototype.addChoice=function(dist,val,address,store,continuation,options){var choice={k:continuation,address:address,dist:dist,options:options,score:this.score,val:val,store:_.clone(store),numFactors:this.numFactors};this.choices.push(choice);this.addressMap[address]=choice;this.length+=1;this.score=ad.scalar.add(this.score,dist.score(val))};Trace.prototype.complete=function(value){assert.strictEqual(this.value,undefined);this.value=value;this.k=this.store=undefined};Trace.prototype.isComplete=function(){return this.k===undefined&&this.store===undefined};Trace.prototype.upto=function(i){assert(i<this.length);var t=this.fresh();t.choices=this.choices.slice(0,i);t.choices.forEach(function(choice){t.addressMap[choice.address]=choice});t.length=t.choices.length;t.score=this.choices[i].score;t.numFactors=this.choices[i].numFactors;return t};Trace.prototype.copy=function(){var t=this.fresh();t.choices=this.choices.slice(0);t.addressMap=_.clone(this.addressMap);t.length=this.length;t.score=this.score;t.k=this.k;t.store=_.clone(this.store);t.address=this.address;t.value=this.value;t.numFactors=this.numFactors;return t};Trace.prototype.checkConsistency=function(){assert(_.isFunction(this.wpplFn));assert(_.isFunction(this.exitK));assert(this.initialStore);assert(this.baseAddress);assert(this.k&&this.store||!this.k&&!this.store);assert(this.choices.length===this.length);assert(_.keys(this.addressMap).length===this.length);this.choices.forEach(function(choice){assert(_.has(this.addressMap,choice.address))},this);assert(this.value===undefined||this.k===undefined&&this.store===undefined)};module.exports=Trace},{"./ad":150,"./dists":154,assert:216,underscore:148}],188:[function(require,module,exports){"use strict";var estraverse=require("estraverse");var build=require("./builders");var rules=function(node){switch(node.type){case"UnaryExpression":switch(node.operator){case"+":return"ad.scalar.plus";case"-":return"ad.scalar.neg"}break;case"BinaryExpression":switch(node.operator){case"*":return"ad.scalar.mul";case"/":return"ad.scalar.div";case"+":return"ad.scalar.add";case"-":return"ad.scalar.sub";case"<":return"ad.scalar.lt";case"<=":return"ad.scalar.leq";case">":return"ad.scalar.gt";case">=":return"ad.scalar.geq";case"==":return"ad.scalar.eq";case"!=":return"ad.scalar.neq";case"===":return"ad.scalar.peq";case"!==":return"ad.scalar.pneq"}break}return false};function parse(dotted){return dotted.split(".").map(build.identifier).reduce(function(a,b){return build.memberExpression(a,b)})}function rewrite(node,fn){var callee=parse(fn);if(node.type==="UnaryExpression"){return build.callExpression(callee,[node.argument])}else if(node.type==="BinaryExpression"){return build.callExpression(callee,[node.left,node.right])}else{throw new Error("Unexpected node type")}}function isInplaceAssignmentOp(op){return op==="+="||op==="-="||op==="*="||op==="/="}function ad(ast){return estraverse.replace(ast,{enter:function(node,parent){var fn=rules(node);if(fn){return rewrite(node,fn)}if(node.type==="AssignmentExpression"&&isInplaceAssignmentOp(node.operator)){return build.assignmentExpression("=",node.left,build.binaryExpression(node.operator[0],node.left,node.right))}if(node.type==="MemberExpression"&&node.object.type==="Identifier"&&node.object.name==="Math"){return build.memberExpression(parse("ad.scalar"),node.property,node.computed)}}})}module.exports={ad:ad}},{"./builders":190,estraverse:117}],189:[function(require,module,exports){var replace=require("estraverse").replace;function addFilenameMain(ast,filename){return replace(ast,{enter:function(node){node.loc.source=filename;return node}})}module.exports={addFilename:addFilenameMain}},{estraverse:117}],190:[function(require,module,exports){var builders=require("ast-types").builders;var _=require("underscore");function isLocationNode(node){return _.has(node,"start")&&_.has(node,"end")}module.exports=_.mapObject(builders,function(builder){return function(){var args=_.toArray(arguments);if(args.length>0&&isLocationNode(_.last(args))){var node=builder.apply(null,args.slice(0,-1));node.loc=_.last(args);return node}else{return builder.apply(null,args)}}})},{"ast-types":49,underscore:148}],191:[function(require,module,exports){"use strict";var _=require("underscore");var estraverse=require("estraverse");var build=require("ast-types").builders;var types=require("ast-types").types;var isPrimitive=require("../syntax").isPrimitive;var Syntax=estraverse.Syntax;var cacheExempt=["flip","randomInteger","discrete","gaussian","uniform","uniformDraw","dirichlet","poisson","binomial","beta","exponential","gamma","factor","sample","sampleWithFactor"];var cacheExemptTable={};_.each(cacheExempt,function(funcName){cacheExemptTable[funcName]=true});cacheExempt=cacheExemptTable;function shouldCache(callee){if(isPrimitive(callee))return false;if(callee.type===Syntax.Identifier&&cacheExempt[callee.name])return false;return true}function exit(node){switch(node.type){case Syntax.CallExpression:if(shouldCache(node.callee)){return build.callExpression(build.identifier("incrementalize"),[node.callee,build.arrayExpression(node.arguments)])}default:}}function cachingMain(node){return estraverse.replace(node,{leave:exit})}function isImhIdentifier(node){return node.type==="Identifier"&&node.name==="IncrementalMH"}function isImhInferMethodOption(node){return node.type==="Property"&&(node.key.type==="Identifier"&&node.key.name==="method"||node.key.type==="Literal"&&node.key.value==="method")&&(node.value.type==="Literal"&&node.value.value==="incrementalMH")}function transformRequired(programAST){var flag=false;estraverse.traverse(programAST,{enter:function(node){if(isImhIdentifier(node)||isImhInferMethodOption(node)){flag=true;this.break()}}});return flag}function hasNoCachingDirective(ast){return ast.body.length>0&&ast.body[0].type===Syntax.ExpressionStatement&&ast.body[0].expression.type===Syntax.Literal&&ast.body[0].expression.value==="no caching"}module.exports={transform:cachingMain,transformRequired:transformRequired,hasNoCachingDirective:hasNoCachingDirective}},{"../syntax":185,"ast-types":49,estraverse:117,underscore:148}],192:[function(require,module,exports){"use strict";var assert=require("assert");var build=require("./builders");var types=require("ast-types").namedTypes;var Syntax=require("estraverse").Syntax;var match=require("../syntax").match;var clause=require("../syntax").clause;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;var isPrimitive=require("../syntax").isPrimitive;var makeGenvar=require("../syntax").makeGenvar;var genvar=null;function buildFunction(params,body,id){return build.functionExpression(id||null,params,build.blockStatement([build.expressionStatement(body)]))}function buildCall(callee,args){return build.callExpression(callee,args)}function buildContinuation(param,body){return buildFunction([param],body)}function buildContinuationCall(callee,arg){return buildCall(callee,[arg])}function cpsFunction(id,params,body){var k=genvar("k");return buildFunction([k].concat(params),cpsFinalStatement(body,k,k),id)}function bindContinuation(k,metaK){if(types.Identifier.check(k)){return metaK(k)}else{var k0=genvar("k");return buildCall(buildFunction([k0],metaK(k0)),[k])}}function atomize(node,metaK){return match(node,[clause(Syntax.ArrayExpression,function(elements){return atomizeStar(elements,function(elements){return metaK(build.arrayExpression(elements))})}),clause(Syntax.AssignmentExpression,function(left,right){var err=false,line,msg;if(left.type===Syntax.MemberExpression){if(!(left.object.name==="globalStore")){err=true;msg="You tried to assign to a field of "+left.object.name+", but you can only assign to fields of globalStore"}}else{err=true;if(left.name==="globalStore"){msg="You must assign to a field of globalStore, not globalStore itself"}else{msg="Did you mean var "+left.name+" = ?"}}if(err){line=left.loc.start.line;throw new Error("Line "+line+": "+msg)}return atomize(left,function(left){return atomize(right,function(right){return metaK(build.assignmentExpression(node.operator,left,right))})})}),clause(Syntax.BinaryExpression,function(left,right){return atomize(left,function(left){return atomize(right,function(right){return metaK(build.binaryExpression(node.operator,left,right))})})}),clause(Syntax.CallExpression,function(callee,args){if(isPrimitive(callee)){return atomize(callee,function(callee){return atomizeStar(args,function(args){return metaK(build.callExpression(callee,args))})})}else{var x=genvar("result");x.loc=node.loc;return cps(node,buildContinuation(x,metaK(x)))}}),clause(Syntax.ConditionalExpression,function(test,consequent,alternate){return atomize(test,function(test){var x=genvar("result");return bindContinuation(buildContinuation(x,metaK(x)),function(k){return build.conditionalExpression(test,cps(consequent,k),cps(alternate,k))})})}),clause(Syntax.FunctionExpression,function(id,params,body){return metaK(cpsFunction(id,params,body))}),clause(Syntax.Identifier,function(){return metaK(node)}),clause(Syntax.Literal,function(){return metaK(node)}),clause(Syntax.LogicalExpression,function(left,right){return atomize(left,function(left){var x=genvar("result");return bindContinuation(buildContinuation(x,metaK(x)),function(k){if(node.operator==="||"){return build.conditionalExpression(left,cps(left,k),cps(right,k))}else if(node.operator==="&&"){return build.conditionalExpression(left,cps(right,k),cps(left,k))}else{console.log(node.operator);throw new Error("cps: unhandled logical operator "+node.operator)}})})}),clause(Syntax.MemberExpression,function(object,property){return atomize(object,function(object){return atomize(property,function(property){return metaK(build.memberExpression(object,property,node.computed,node.loc))})})}),clause(Syntax.ObjectExpression,function(properties){return atomizeStar(properties,function(properties){return metaK(build.objectExpression(properties))})}),clause(Syntax.Property,function(key,value){return atomize(value,function(value){return metaK(build.property("init",key,value))})}),clause(Syntax.UnaryExpression,function(argument){return atomize(argument,function(argument){return metaK(build.unaryExpression(node.operator,argument))})}),clause(Syntax.DebuggerStatement,function(){var body=build.blockStatement([node]);return metaK(buildCall(build.functionExpression(null,[],body),[]))})],fail("atomize: unrecognized node",node))}function atomizeStar(es,metaK){es=es.concat();function loop(i){if(i===es.length){return metaK(es)}else{return atomize(es[i],function(e){es[i]=e;return loop(i+1)})}}return loop(0)}function cps(node,k){switch(node.type){case Syntax.ArrayExpression:case Syntax.AssignmentExpression:case Syntax.BinaryExpression:case Syntax.FunctionExpression:case Syntax.Identifier:case Syntax.Literal:case Syntax.MemberExpression:case Syntax.ObjectExpression:case Syntax.UnaryExpression:case Syntax.DebuggerStatement:return atomize(node,function(node){return buildContinuationCall(k,node)});default:return match(node,[clause(Syntax.CallExpression,function(callee,args){return atomize(callee,function(callee){return atomizeStar(args,function(args){if(isPrimitive(callee)){return buildContinuationCall(k,buildCall(callee,args))}else{return buildCall(callee,[k].concat(args))}})})}),clause(Syntax.ConditionalExpression,function(test,consequent,alternate){return atomize(test,function(test){return bindContinuation(k,function(k){return build.conditionalExpression(test,cps(consequent,k),cps(alternate,k))})})}),clause(Syntax.LogicalExpression,function(left,right){return atomize(left,function(left){return bindContinuation(k,function(k){if(node.operator==="||"){return build.conditionalExpression(left,cps(left,k),cps(right,k))}else if(node.operator==="&&"){return build.conditionalExpression(left,cps(right,k),cps(left,k))}else{console.log(node.operator);throw new Error("cps: unhandled logical operator "+node.operator)}})})})],fail("can't cps",node))}}function cpsDeclarations(declarations,i,metaK){return clause(Syntax.VariableDeclarator,function(id,init){if(types.FunctionExpression.check(init)){init.id=id}if(i+1===declarations.length){return cps(init,metaK(id))}else{return cps(init,buildContinuation(id,cpsDeclarations(declarations,i+1,metaK)))}})(declarations[i],fail("expected declarator",declarations[i]))}function cpsSequence(nodes,i,k,fk){if(i===nodes.length){return cps(build.identifier("undefined"),k)}else if(i+1===nodes.length){return cpsFinalStatement(nodes[i],k,fk)}else{return cpsInnerStatement(nodes[i],cpsSequence(nodes,i+1,k,fk),fk)}}function cpsInnerStatement(node,e,fk){return match(node,[clause(Syntax.BlockStatement,function(body){return cpsSequence(body,0,buildContinuation(genvar("dummy"),e),fk)}),clause(Syntax.EmptyStatement,function(){return e}),clause(Syntax.ExpressionStatement,function(expression){return cps(expression,buildContinuation(genvar("dummy"),e))}),clause(Syntax.IfStatement,function(test,consequent,alternate){if(!alternate){alternate=build.emptyStatement()}var k=buildContinuation(genvar("dummy"),e);return bindContinuation(k,function(k){return atomize(test,function(test){return build.conditionalExpression(test,cpsFinalStatement(consequent,k,fk),cpsFinalStatement(alternate,k,fk))})})}),clause(Syntax.ReturnStatement,function(argument){return cps(argument||build.identifier("undefined"),fk)}),clause(Syntax.VariableDeclaration,function(declarations){return cpsDeclarations(declarations,0,function(id){return buildContinuation(id,e)})}),clause(Syntax.DebuggerStatement,function(){return cps(node,buildContinuation(genvar("debugger"),e))})],fail("cpsInnerStatement",node))}function cpsFinalStatement(node,k,fk){return match(node,[clause(Syntax.BlockStatement,function(body){return cpsSequence(body,0,k,fk)}),clause(Syntax.EmptyStatement,function(){return cps(build.identifier("undefined"),k)}),clause(Syntax.ExpressionStatement,function(expression){return cps(expression,k)}),clause(Syntax.IfStatement,function(test,consequent,alternate){if(!alternate){alternate=build.emptyStatement()}return bindContinuation(k,function(k){return atomize(test,function(test){return build.conditionalExpression(test,cpsFinalStatement(consequent,k,fk),cpsFinalStatement(alternate,k,fk))})})}),clause(Syntax.ReturnStatement,function(argument){return cps(argument||build.identifier("undefined"),fk)}),clause(Syntax.VariableDeclaration,function(declarations){return cpsDeclarations(declarations,0,function(id){return buildContinuation(id,cps(build.identifier("undefined"),k))})}),clause(Syntax.DebuggerStatement,function(){return cps(node,k)})],fail("cpsFinalStatement",node))}function cpsMain(node){genvar=makeGenvar();return inProgram(function(expression){return clause(Syntax.FunctionExpression,function(id,params,body){return cpsFunction(id,params,body)})(expression,fail("cps: expected FunctionExpression",expression))})(node,fail("cps: inProgram",node))}module.exports={cps:cpsMain}},{"../syntax":185,"./builders":190,assert:216,"ast-types":49,estraverse:117}],193:[function(require,module,exports){"use strict";var _=require("underscore");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("ast-types").builders;var types=require("ast-types").types;var makeGensym=require("../util").makeGensym;var genid=null;var boundVarsStack=null;var freeVarsStack=null;var literalIdentifiers={undefined:true,NaN:true,Infinity:true};function identifierIsVar(node,parent){if(literalIdentifiers[node.name])return false;if(parent.type===Syntax.MemberExpression&&!parent.computed&&node===parent.property)return false;if(parent.type===Syntax.Property&&node===parent.key)return false;return true}function enter(node,parent){switch(node.type){case Syntax.FunctionExpression:var boundVars={};for(var i=0;i<node.params.length;i++)boundVars[node.params[i].name]=true;boundVarsStack.push(boundVars);freeVarsStack.push({});break;case Syntax.VariableDeclarator:if(boundVarsStack.length>0)boundVarsStack[boundVarsStack.length-1][node.id.name]=true;break;case Syntax.Identifier:if(boundVarsStack.length>0&&identifierIsVar(node,parent)){if(!boundVarsStack[boundVarsStack.length-1][node.name])freeVarsStack[freeVarsStack.length-1][node.name]=true}break;default:}}function exit(node){switch(node.type){case Syntax.FunctionExpression:var freeVars=freeVarsStack.pop();var freeVarNodes=[];for(var name in freeVars){freeVarNodes.push(build.identifier(name))}boundVarsStack.pop();var wrappedFn=build.callExpression(build.memberExpression(build.identifier("_Fn"),build.identifier("tag"),false),[node,build.literal(genid(0)),build.arrayExpression(freeVarNodes)]);if(freeVarsStack.length>0){var outerFreeVars=freeVarsStack[freeVarsStack.length-1];var outerBoundVars=boundVarsStack[boundVarsStack.length-1];for(var name in freeVars){if(outerBoundVars[name]===undefined)outerFreeVars[name]=true}}return wrappedFn;default:}}function freevarsMain(node){genid=makeGensym();boundVarsStack=[];freeVarsStack=[];return replace(node,{enter:enter,leave:exit})}module.exports={freevars:freevarsMain}},{"../util":200,"ast-types":49,estraverse:117,underscore:148}],194:[function(require,module,exports){"use strict";var _=require("underscore");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("./builders");var makeGensym=require("../util").makeGensym;var makeGenvar=require("../syntax").makeGenvar;var inProgram=require("../syntax").inProgram;var fail=require("../syntax").fail;var isPrimitive=require("../syntax").isPrimitive;function makeGenlit(){var gensym=makeGensym();return function(){return build.literal(gensym("_"))}}var genlit=null;var genvar=null;var addresses=[];function makeAddressExtension(address,literal){return build.callExpression(build.memberExpression(address,build.identifier("concat"),false),[literal])}function generating(node){switch(node.type){case Syntax.FunctionExpression:addresses.unshift(genvar("address"));break;default:}}function naming(node,map){switch(node.type){case Syntax.FunctionExpression:return build.functionExpression(node.id,[addresses.shift()].concat(node.params),node.body);case Syntax.CallExpression:if(isPrimitive(node.callee)){return node}else{var lit=genlit();var name=node.callee.type===Syntax.Identifier?node.callee.name:null;map[lit.value]=_.extendOwn({name:name},node.loc);return build.callExpression(node.callee,[makeAddressExtension(addresses[0],lit)].concat(node.arguments),node.loc)}default:}}function namingMain(node){genlit=makeGenlit();genvar=makeGenvar();var map={};var ast=inProgram(function(node){return replace(node,{enter:generating,leave:function(node){return naming(node,map)}})})(node,fail("naming: inProgram",node));return{ast:ast,map:map}}module.exports={naming:namingMain}},{"../syntax":185,"../util":200,"./builders":190,estraverse:117,underscore:148}],195:[function(require,module,exports){"use strict";var esmangle=require("esmangle");var estraverse=require("estraverse");var types=require("ast-types");var build=types.builders;var Syntax=estraverse.Syntax;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;function createPipeline(){var pipeline=["pass/transform-dynamic-to-static-property-access","pass/transform-dynamic-to-static-property-definition","pass/transform-immediate-function-call","pass/transform-logical-association","pass/reordering-function-declarations","pass/remove-unused-label","pass/remove-empty-statement","pass/remove-wasted-blocks","pass/transform-to-compound-assignment","pass/transform-branch-to-expression","pass/transform-typeof-undefined","pass/reduce-sequence-expression","pass/reduce-branch-jump","pass/reduce-multiple-if-statements","pass/dead-code-elimination","pass/remove-side-effect-free-expressions","pass/remove-context-sensitive-expressions","pass/tree-based-constant-folding","pass/drop-variable-definition","pass/eliminate-duplicate-function-declarations"];pipeline=[pipeline.map(esmangle.pass.require)];pipeline.push({
once:true,pass:["post/transform-static-to-dynamic-property-access","post/transform-infinity","post/rewrite-boolean","post/rewrite-conditional-expression","post/omit-parens-in-void-context-iife"].map(esmangle.pass.require)});return pipeline}function identifiersEqual(x,y){return types.namedTypes.Identifier.check(x)&&types.namedTypes.Identifier.check(y)&&x.name===y.name}function optimize(node){switch(node.type){case Syntax.BlockStatement:for(var i=0;i<node.body.length;i++){var ithNode=node.body[i];if(types.namedTypes.VariableDeclaration.check(ithNode)){var declaration=ithNode.declarations[0];if(identifiersEqual(declaration.id,declaration.init)){node.body.splice(i,1)}}}return node;case Syntax.ExpressionStatement:if(types.namedTypes.CallExpression.check(node.expression)&&types.namedTypes.FunctionExpression.check(node.expression.callee)){var funcNode=node.expression.callee;var appNode=node.expression;var stmts=[];for(var i=0;i<appNode.arguments.length;i++){var stmt=build.variableDeclaration("var",[build.variableDeclarator(funcNode.params[i],appNode.arguments[i])]);stmts.push(stmt)}stmts.push(funcNode.body);return build.blockStatement(stmts)}else{return node}case Syntax.VariableDeclaration:if(node.declarations.length===1&&node.declarations[0].id.name.slice(0,9)==="_debugger"){return build.debuggerStatement()}else{return node}default:return node}}function optimizeMain(node){return inProgram(function(node){return esmangle.optimize(estraverse.replace(node,{enter:optimize,leave:optimize}),createPipeline(),{inStrictCode:true,legacy:false})})(node,fail("optimize: inBody",node))}module.exports={optimize:optimizeMain}},{"../syntax":185,"ast-types":49,esmangle:70,estraverse:117}],196:[function(require,module,exports){"use strict";var assert=require("assert");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("ast-types").builders;var localVarName="_currentAddress";var globalVarName="_globalCurrentAddress";var saveAddressFn=["_addr","save"];function transformFnBody(node){var addressParam=node.params[2];var bindAddress=build.variableDeclaration("var",[build.variableDeclarator(build.identifier(localVarName),addressParam)]);var saveAddress=build.expressionStatement(build.callExpression(build.memberExpression(build.identifier(saveAddressFn[0]),build.identifier(saveAddressFn[1])),[build.identifier(globalVarName),addressParam]));var expr=build.functionExpression(node.id,node.params,build.blockStatement([bindAddress,saveAddress].concat(node.body.body)));expr.loc=node.loc;return expr}function transformContinuation(node){var saveAddress=build.expressionStatement(build.callExpression(build.memberExpression(build.identifier(saveAddressFn[0]),build.identifier(saveAddressFn[1])),[build.identifier(globalVarName),build.identifier(localVarName)]));var expr=build.functionExpression(node.id,node.params,build.blockStatement([saveAddress].concat(node.body.body)));expr.loc=node.loc;return expr}function isWpplFnExpr(node){return node.params.length>=3}function isContinuation(node){return node.params.length===2}function transform(node){switch(node.type){case Syntax.FunctionExpression:if(isContinuation(node)){return transformContinuation(node)}else if(isWpplFnExpr(node)){return transformFnBody(node)}else{throw"unreachable"}default:return node}}function wrapProgram(node){var expr=node.body[0].expression;assert.ok(expr.type===Syntax.CallExpression);return build.program([build.expressionStatement(build.functionExpression(null,[build.identifier(globalVarName)],build.blockStatement([build.returnStatement(expr)])))])}module.exports={transform:function(node){return replace(node,{leave:transform})},wrapProgram:wrapProgram}},{assert:216,"ast-types":49,estraverse:117}],197:[function(require,module,exports){"use strict";var estraverse=require("estraverse");var Syntax=estraverse.Syntax;var build=require("ast-types").builders;var isPrimitive=require("../syntax").isPrimitive;var storeIdNode=build.identifier("globalStore");function store(node){switch(node.type){case Syntax.FunctionExpression:return build.functionExpression(node.id,[storeIdNode].concat(node.params),node.body);case Syntax.CallExpression:if(isPrimitive(node.callee)){return node}else if(node.arguments.length>0&&node.arguments[0].type==="Identifier"&&node.arguments[0].name==="globalStore"){return node}else{return build.callExpression(node.callee,[storeIdNode].concat(node.arguments))}default:return node}}function storeMain(node){return estraverse.replace(node,{leave:store})}module.exports={store:storeMain}},{"../syntax":185,"ast-types":49,estraverse:117}],198:[function(require,module,exports){"use strict";var replace=require("estraverse").replace;var Syntax=require("estraverse").Syntax;var build=require("ast-types").builders;var types=require("ast-types").namedTypes;var parse=require("esprima").parse;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;var isPrimitive=require("../syntax").isPrimitive;var util=require("../util");var _=require("underscore");function thunkify(node){return build.functionExpression(null,[],build.blockStatement([build.returnStatement(node)]),false,false)}function skip(node){if(types.ReturnStatement.check(node)){this.skip()}}function trampoline(node){switch(node.type){case Syntax.ExpressionStatement:switch(node.expression.type){case Syntax.CallExpression:if(isPrimitive(node.expression.callee)){return node}else{return build.returnStatement(thunkify(node.expression))}default:return build.returnStatement(thunkify(node.expression))}default:return node}}var driverFn=function(p){return function(runTrampoline){return function(s,k,a){runTrampoline(function(){return p(s,k,a)})}}};var driver=parse("("+driverFn.toString()+")").body[0].expression;function trampolineMain(node){var r=inProgram(function(node){return build.callExpression(driver,[replace(node,{enter:skip,leave:trampoline})])})(node,fail("trampoline",node));return r}module.exports={trampoline:trampolineMain}},{"../syntax":185,"../util":200,"ast-types":49,esprima:110,estraverse:117,underscore:148}],199:[function(require,module,exports){"use strict";var assert=require("assert");var estraverse=require("estraverse");var types=require("ast-types");var esprima=require("esprima");var Syntax=estraverse.Syntax;var argumentsIdCounter=0;function makeArgumentsIdentifier(){argumentsIdCounter+=1;return"_arguments"+argumentsIdCounter}var fnStack=[];function pushFn(node){if(node.type===Syntax.FunctionExpression){fnStack.push(node)}}function popFn(node){if(node.type===Syntax.FunctionExpression){assert.strictEqual(node,fnStack[fnStack.length-1]);fnStack.pop()}}function getEnclosingFunctionNode(){if(fnStack.length===0){throw new Error('Used "arguments" outside of function context!')}return fnStack[fnStack.length-1]}function varargs(node){switch(node.type){case Syntax.Identifier:if(node.name!=="arguments"){return node}var functionNode=getEnclosingFunctionNode();var argumentsId=functionNode.argumentsId||makeArgumentsIdentifier();node.name=argumentsId;if(functionNode.argumentsId===undefined){functionNode.argumentsId=argumentsId;assert.equal(functionNode.body.type,"BlockStatement");var argsDeclaration=esprima.parse("var REPLACEME = Array.prototype.slice.call(arguments, 3);").body[0];argsDeclaration.declarations[0].id.name=argumentsId;functionNode.body.body=[argsDeclaration].concat(functionNode.body.body)}return node;default:return node}}function varargsMain(node){node=estraverse.replace(node,{enter:function(node){pushFn(node);return varargs(node)},leave:function(node){popFn(node)}});return node}module.exports={varargs:varargsMain}},{assert:216,"ast-types":49,esprima:110,estraverse:117}],200:[function(require,module,exports){(function(global){"use strict";var _=require("underscore");var assert=require("assert");var seedrandom=require("seedrandom");var ad=require("./ad");var Tensor=require("./tensor");var rng=Math.random;var trampolineRunners={web:function(yieldEvery){yieldEvery=yieldEvery||100;var f=function(t,wrappedF){var lastPauseTime=Date.now();if(f.__cancel__){f.__cancel__=false}else{while(t){var currTime=Date.now();if(currTime-lastPauseTime>yieldEvery){return setTimeout(function(){wrappedF(t,wrappedF)},0)}else{t=t()}}}};return f},cli:function(){return function(t){while(t){t=t()}}}};function random(){return rng()}function seedRNG(seed){rng=seedrandom(seed)}function resetRNG(){rng=Math.random}function assertValidRandomSeed(seed){var msg="Random seed should be a positive integer.";assert(_.isFinite(seed)&&seed>=0,msg)}function runningInBrowser(){return typeof window!=="undefined"}function makeGensym(){var seq=0;return function(prefix){var result=prefix+seq;seq+=1;return result}}var gensym=makeGensym();function prettyJSON(obj){console.log(JSON.stringify(obj,null,2))}function asArray(arg){return arg?[].concat(arg):[]}function sum(xs){if(xs.length===0){return 0}else{var total=_.reduce(xs,function(a,b){return a+b});return total}}function product(xs){var result=1;for(var i=0,n=xs.length;i<n;i++){result*=xs[i]}return result}function logsumexp(a){var m=Math.max.apply(null,a);var sum=0;for(var i=0;i<a.length;++i){sum+=a[i]===-Infinity?0:Math.exp(a[i]-m)}return m+Math.log(sum)}var deleteIndex=function(arr,i){return arr.slice(0,i).concat(arr.slice(i+1))};function cpsForEach(func,cont,xs,i){i=i===undefined?0:i;if(i===xs.length){return cont()}else{return func(xs[i],i,xs,function(){return function(){return cpsForEach(func,cont,xs,i+1)}})}}function cpsLoop(n,func,cont){function loop(i){if(i===n){return cont()}else{return func(i,function(){return function(){return loop(i+1)}})}}assert(_.isNumber(n),"Number expected.");return loop(0)}function cpsIterate(n,initial,func,cont){var val=initial;return cpsLoop(n,function(i,next){return func(function(nextVal){val=nextVal;return next()},val)},function(){return cont(val)})}function histExpectation(hist,func){var f=func||_.identity;return _.reduce(hist,function(acc,obj){return acc+obj.prob*f(obj.val)},0)}function histStd(hist){var m=histExpectation(hist);return Math.sqrt(histExpectation(hist,function(x){return Math.pow(x-m,2)}))}function sameKeys(obj1,obj2){return _.size(obj1)===_.size(obj2)&&_.all(_.keys(obj1),function(key){return _.has(obj2,key)})}function histsApproximatelyEqual(actualHist,expectedHist,tolerance,exactSupport){if(expectedHist===undefined||actualHist===undefined){return false}if(exactSupport&&!sameKeys(actualHist,expectedHist)){return false}return _.all(expectedHist,function(expectedValue,key){var value=actualHist[key]||0;return Math.abs(value-expectedValue)<=tolerance})}function mergeDefaults(options,defaults){return _.defaults(options?_.clone(options):{},defaults)}function throwUnlessOpts(options,fnName){assert.ok(fnName);if(options!==undefined&&!_.isObject(options)){throw fnName+" expected an options object but received: "+JSON.stringify(options)}}function getValAndOpts(obj,cont){var args;if(_.isString(obj)){args=[obj,{}]}else{if(_.size(obj)!==1){throw"Expected an object with a single key but received: "+JSON.stringify(obj)}var key=_.keys(obj)[0];args=[key,obj[key]]}return cont.apply(null,args)}function InfToJSON(k,v){if(v===Infinity){return"Infinity"}else if(v===-Infinity){return"-Infinity"}else{return v}}function InfFromJSON(k,v){if(v==="Infinity"){return Infinity}else if(v==="-Infinity"){return-Infinity}else{return v}}function serialize(o){return JSON.stringify(o,InfToJSON)}function deserialize(o){return JSON.parse(o,InfFromJSON)}function time(name,thunk){if(console.time){console.time(name);var ret=thunk();console.timeEnd(name);return ret}else{return thunk()}}function timeif(bool,name,thunk){return bool?time(name,thunk):thunk()}function pipeline(fns){return _.compose.apply(null,fns.reverse())}function warn(msg){if(!global.suppressWarnings){console.warn(msg)}}function fatal(msg){throw msg}function jsnew(ctor,arg){return new ctor(arg)}function isObject(x){return x!==undefined&&x!==null&&typeof x==="object"&&Object.getPrototypeOf(x)===Object.prototype}function isTensor(t){return t instanceof Tensor}function isMatrix(t){return t instanceof Tensor&&t.rank===2}function isVector(t){return t instanceof Tensor&&t.rank===2&&t.dims[1]===1}function tensorEqDim0(v,w){return v.dims[0]===w.dims[0]}function tensorEqDims(t1,t2){if(t1.dims.length!==t2.dims.length){return false}for(var i=0;i<t1.dims.length;i++){if(t1.dims[i]!==t2.dims[i]){return false}}return true}function relativizeAddress(env,address){assert.ok(_.has(env.coroutine,"a"),"Entry address not saved on coroutine.");var baseAddress=env.coroutine.a;assert.ok(address.slice(0,baseAddress.length)===baseAddress,"Address prefix mismatch.");return address.slice(baseAddress.length)}var registerParams=function(env,name,getParams,setParams){var paramStore=env.coroutine.params;var paramsSeen=env.coroutine.paramsSeen;if(paramStore===undefined){return getParams().map(ad.value)}else if(paramsSeen&&_.has(paramsSeen,name)){return paramsSeen[name]}else{var params;if(_.has(paramStore,name)){params=paramStore[name].map(ad.lift)}else{var _params=getParams().map(ad.value);paramStore[name]=_params;params=_params.map(ad.lift)}if(paramsSeen){paramsSeen[name]=params}if(setParams){setParams(params)}return params}};module.exports={trampolineRunners:trampolineRunners,random:random,seedRNG:seedRNG,resetRNG:resetRNG,assertValidRandomSeed:assertValidRandomSeed,cpsForEach:cpsForEach,cpsLoop:cpsLoop,cpsIterate:cpsIterate,histExpectation:histExpectation,histStd:histStd,histsApproximatelyEqual:histsApproximatelyEqual,gensym:gensym,logsumexp:logsumexp,deleteIndex:deleteIndex,makeGensym:makeGensym,prettyJSON:prettyJSON,runningInBrowser:runningInBrowser,mergeDefaults:mergeDefaults,throwUnlessOpts:throwUnlessOpts,getValAndOpts:getValAndOpts,sum:sum,product:product,asArray:asArray,serialize:serialize,deserialize:deserialize,timeif:timeif,pipeline:pipeline,warn:warn,fatal:fatal,jsnew:jsnew,isObject:isObject,isTensor:isTensor,isVector:isVector,isMatrix:isMatrix,tensorEqDim0:tensorEqDim0,tensorEqDims:tensorEqDims,relativizeAddress:relativizeAddress,registerParams:registerParams}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":150,"./tensor":186,assert:216,seedrandom:128,underscore:148}],201:[function(require,module,exports){arguments[4][149][0].apply(exports,arguments)},{dup:149}],202:[function(require,module,exports){var asn1=exports;asn1.bignum=require("bn.js");asn1.define=require("./asn1/api").define;asn1.base=require("./asn1/base");asn1.constants=require("./asn1/constants");asn1.decoders=require("./asn1/decoders");asn1.encoders=require("./asn1/encoders")},{"./asn1/api":203,"./asn1/base":205,"./asn1/constants":209,"./asn1/decoders":211,"./asn1/encoders":214,"bn.js":218}],203:[function(require,module,exports){var asn1=require("../asn1");var inherits=require("inherits");var api=exports;api.define=function define(name,body){return new Entity(name,body)};function Entity(name,body){this.name=name;this.body=body;this.decoders={};this.encoders={}}Entity.prototype._createNamed=function createNamed(base){var named;try{named=require("vm").runInThisContext("(function "+this.name+"(entity) {\n"+"  this._initNamed(entity);\n"+"})")}catch(e){named=function(entity){this._initNamed(entity)}}inherits(named,base);named.prototype._initNamed=function initnamed(entity){base.call(this,entity)};return new named(this)};Entity.prototype._getDecoder=function _getDecoder(enc){enc=enc||"der";if(!this.decoders.hasOwnProperty(enc))this.decoders[enc]=this._createNamed(asn1.decoders[enc]);return this.decoders[enc]};Entity.prototype.decode=function decode(data,enc,options){return this._getDecoder(enc).decode(data,options)};Entity.prototype._getEncoder=function _getEncoder(enc){enc=enc||"der";if(!this.encoders.hasOwnProperty(enc))this.encoders[enc]=this._createNamed(asn1.encoders[enc]);return this.encoders[enc]};Entity.prototype.encode=function encode(data,enc,reporter){return this._getEncoder(enc).encode(data,reporter)}},{"../asn1":202,inherits:293,vm:340}],204:[function(require,module,exports){var inherits=require("inherits");var Reporter=require("../base").Reporter;var Buffer=require("buffer").Buffer;function DecoderBuffer(base,options){Reporter.call(this,options);if(!Buffer.isBuffer(base)){this.error("Input not Buffer");return}this.base=base;this.offset=0;this.length=base.length}inherits(DecoderBuffer,Reporter);exports.DecoderBuffer=DecoderBuffer;DecoderBuffer.prototype.save=function save(){return{offset:this.offset,reporter:Reporter.prototype.save.call(this)}};DecoderBuffer.prototype.restore=function restore(save){var res=new DecoderBuffer(this.base);res.offset=save.offset;res.length=this.offset;this.offset=save.offset;Reporter.prototype.restore.call(this,save.reporter);return res};DecoderBuffer.prototype.isEmpty=function isEmpty(){return this.offset===this.length};DecoderBuffer.prototype.readUInt8=function readUInt8(fail){if(this.offset+1<=this.length)return this.base.readUInt8(this.offset++,true);else return this.error(fail||"DecoderBuffer overrun")};DecoderBuffer.prototype.skip=function skip(bytes,fail){if(!(this.offset+bytes<=this.length))return this.error(fail||"DecoderBuffer overrun");var res=new DecoderBuffer(this.base);res._reporterState=this._reporterState;res.offset=this.offset;res.length=this.offset+bytes;this.offset+=bytes;return res};DecoderBuffer.prototype.raw=function raw(save){return this.base.slice(save?save.offset:this.offset,this.length)};function EncoderBuffer(value,reporter){if(Array.isArray(value)){this.length=0;this.value=value.map(function(item){if(!(item instanceof EncoderBuffer))item=new EncoderBuffer(item,reporter);this.length+=item.length;return item},this)}else if(typeof value==="number"){if(!(0<=value&&value<=255))return reporter.error("non-byte EncoderBuffer value");this.value=value;this.length=1}else if(typeof value==="string"){this.value=value;this.length=Buffer.byteLength(value)}else if(Buffer.isBuffer(value)){this.value=value;this.length=value.length}else{return reporter.error("Unsupported type: "+typeof value)}}exports.EncoderBuffer=EncoderBuffer;EncoderBuffer.prototype.join=function join(out,offset){if(!out)out=new Buffer(this.length);if(!offset)offset=0;if(this.length===0)return out;if(Array.isArray(this.value)){this.value.forEach(function(item){item.join(out,offset);offset+=item.length})}else{if(typeof this.value==="number")out[offset]=this.value;else if(typeof this.value==="string")out.write(this.value,offset);else if(Buffer.isBuffer(this.value))this.value.copy(out,offset);offset+=this.length}return out}},{"../base":205,buffer:247,inherits:293}],205:[function(require,module,exports){var base=exports;base.Reporter=require("./reporter").Reporter;base.DecoderBuffer=require("./buffer").DecoderBuffer;base.EncoderBuffer=require("./buffer").EncoderBuffer;base.Node=require("./node")},{"./buffer":204,"./node":206,"./reporter":207}],206:[function(require,module,exports){var Reporter=require("../base").Reporter;var EncoderBuffer=require("../base").EncoderBuffer;var DecoderBuffer=require("../base").DecoderBuffer;var assert=require("minimalistic-assert");var tags=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"];var methods=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(tags);var overrided=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function Node(enc,parent){var state={};this._baseState=state;state.enc=enc;state.parent=parent||null;state.children=null;state.tag=null;state.args=null;state.reverseArgs=null;state.choice=null;state.optional=false;state.any=false;state.obj=false;state.use=null;state.useDecoder=null;state.key=null;state["default"]=null;state.explicit=null;state.implicit=null;state.contains=null;if(!state.parent){state.children=[];this._wrap()}}module.exports=Node;var stateProps=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];Node.prototype.clone=function clone(){var state=this._baseState;var cstate={};stateProps.forEach(function(prop){cstate[prop]=state[prop]});var res=new this.constructor(cstate.parent);res._baseState=cstate;return res};Node.prototype._wrap=function wrap(){var state=this._baseState;methods.forEach(function(method){this[method]=function _wrappedMethod(){var clone=new this.constructor(this);state.children.push(clone);return clone[method].apply(clone,arguments)}},this)};Node.prototype._init=function init(body){var state=this._baseState;assert(state.parent===null);body.call(this);state.children=state.children.filter(function(child){return child._baseState.parent===this},this);assert.equal(state.children.length,1,"Root node can have only one child")};Node.prototype._useArgs=function useArgs(args){var state=this._baseState;var children=args.filter(function(arg){return arg instanceof this.constructor},this);args=args.filter(function(arg){return!(arg instanceof this.constructor)},this);if(children.length!==0){assert(state.children===null);state.children=children;children.forEach(function(child){child._baseState.parent=this},this)}if(args.length!==0){assert(state.args===null);state.args=args;state.reverseArgs=args.map(function(arg){if(typeof arg!=="object"||arg.constructor!==Object)return arg;var res={};Object.keys(arg).forEach(function(key){if(key==(key|0))key|=0;var value=arg[key];res[value]=key});return res})}};overrided.forEach(function(method){Node.prototype[method]=function _overrided(){var state=this._baseState;throw new Error(method+" not implemented for encoding: "+state.enc)}});tags.forEach(function(tag){Node.prototype[tag]=function _tagMethod(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);assert(state.tag===null);state.tag=tag;this._useArgs(args);return this}});Node.prototype.use=function use(item){assert(item);var state=this._baseState;assert(state.use===null);state.use=item;return this};Node.prototype.optional=function optional(){var state=this._baseState;state.optional=true;return this};Node.prototype.def=function def(val){var state=this._baseState;assert(state["default"]===null);state["default"]=val;state.optional=true;return this};Node.prototype.explicit=function explicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.explicit=num;return this};Node.prototype.implicit=function implicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.implicit=num;return this};Node.prototype.obj=function obj(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);state.obj=true;if(args.length!==0)this._useArgs(args);return this};Node.prototype.key=function key(newKey){var state=this._baseState;assert(state.key===null);state.key=newKey;return this};Node.prototype.any=function any(){var state=this._baseState;state.any=true;return this};Node.prototype.choice=function choice(obj){var state=this._baseState;assert(state.choice===null);state.choice=obj;this._useArgs(Object.keys(obj).map(function(key){return obj[key]}));return this};Node.prototype.contains=function contains(item){var state=this._baseState;assert(state.use===null);state.contains=item;return this};Node.prototype._decode=function decode(input,options){var state=this._baseState;if(state.parent===null)return input.wrapResult(state.children[0]._decode(input,options));var result=state["default"];var present=true;var prevKey=null;if(state.key!==null)prevKey=input.enterKey(state.key);if(state.optional){var tag=null;if(state.explicit!==null)tag=state.explicit;else if(state.implicit!==null)tag=state.implicit;else if(state.tag!==null)tag=state.tag;if(tag===null&&!state.any){var save=input.save();try{if(state.choice===null)this._decodeGeneric(state.tag,input,options);else this._decodeChoice(input,options);present=true}catch(e){present=false}input.restore(save)}else{present=this._peekTag(input,tag,state.any);if(input.isError(present))return present}}var prevObj;if(state.obj&&present)prevObj=input.enterObject();if(present){if(state.explicit!==null){var explicit=this._decodeTag(input,state.explicit);if(input.isError(explicit))return explicit;input=explicit}var start=input.offset;if(state.use===null&&state.choice===null){if(state.any)var save=input.save();var body=this._decodeTag(input,state.implicit!==null?state.implicit:state.tag,state.any);if(input.isError(body))return body;if(state.any)result=input.raw(save);else input=body}if(options&&options.track&&state.tag!==null)options.track(input.path(),start,input.length,"tagged");if(options&&options.track&&state.tag!==null)options.track(input.path(),input.offset,input.length,"content");if(state.any)result=result;else if(state.choice===null)result=this._decodeGeneric(state.tag,input,options);else result=this._decodeChoice(input,options);if(input.isError(result))return result;if(!state.any&&state.choice===null&&state.children!==null){state.children.forEach(function decodeChildren(child){child._decode(input,options)})}if(state.contains&&(state.tag==="octstr"||state.tag==="bitstr")){var data=new DecoderBuffer(result);result=this._getUse(state.contains,input._reporterState.obj)._decode(data,options)}}if(state.obj&&present)result=input.leaveObject(prevObj);if(state.key!==null&&(result!==null||present===true))input.leaveKey(prevKey,state.key,result);else if(prevKey!==null)input.exitKey(prevKey);return result};Node.prototype._decodeGeneric=function decodeGeneric(tag,input,options){var state=this._baseState;if(tag==="seq"||tag==="set")return null;if(tag==="seqof"||tag==="setof")return this._decodeList(input,tag,state.args[0],options);else if(/str$/.test(tag))return this._decodeStr(input,tag,options);else if(tag==="objid"&&state.args)return this._decodeObjid(input,state.args[0],state.args[1],options);else if(tag==="objid")return this._decodeObjid(input,null,null,options);else if(tag==="gentime"||tag==="utctime")return this._decodeTime(input,tag,options);else if(tag==="null_")return this._decodeNull(input,options);else if(tag==="bool")return this._decodeBool(input,options);else if(tag==="objDesc")return this._decodeStr(input,tag,options);else if(tag==="int"||tag==="enum")return this._decodeInt(input,state.args&&state.args[0],options);if(state.use!==null){return this._getUse(state.use,input._reporterState.obj)._decode(input,options)}else{return input.error("unknown tag: "+tag)}};Node.prototype._getUse=function _getUse(entity,obj){var state=this._baseState;state.useDecoder=this._use(entity,obj);assert(state.useDecoder._baseState.parent===null);state.useDecoder=state.useDecoder._baseState.children[0];if(state.implicit!==state.useDecoder._baseState.implicit){state.useDecoder=state.useDecoder.clone();state.useDecoder._baseState.implicit=state.implicit}return state.useDecoder};Node.prototype._decodeChoice=function decodeChoice(input,options){var state=this._baseState;var result=null;var match=false;Object.keys(state.choice).some(function(key){var save=input.save();var node=state.choice[key];try{var value=node._decode(input,options);if(input.isError(value))return false;result={type:key,value:value};match=true}catch(e){input.restore(save);return false}return true},this);if(!match)return input.error("Choice not matched");return result};Node.prototype._createEncoderBuffer=function createEncoderBuffer(data){return new EncoderBuffer(data,this.reporter)};Node.prototype._encode=function encode(data,reporter,parent){var state=this._baseState;if(state["default"]!==null&&state["default"]===data)return;var result=this._encodeValue(data,reporter,parent);if(result===undefined)return;if(this._skipDefault(result,reporter,parent))return;return result};Node.prototype._encodeValue=function encode(data,reporter,parent){var state=this._baseState;if(state.parent===null)return state.children[0]._encode(data,reporter||new Reporter);var result=null;this.reporter=reporter;if(state.optional&&data===undefined){if(state["default"]!==null)data=state["default"];else return}var content=null;var primitive=false;if(state.any){result=this._createEncoderBuffer(data)}else if(state.choice){result=this._encodeChoice(data,reporter)}else if(state.contains){content=this._getUse(state.contains,parent)._encode(data,reporter);primitive=true}else if(state.children){content=state.children.map(function(child){if(child._baseState.tag==="null_")return child._encode(null,reporter,data);if(child._baseState.key===null)return reporter.error("Child should have a key");var prevKey=reporter.enterKey(child._baseState.key);if(typeof data!=="object")return reporter.error("Child expected, but input is not object");var res=child._encode(data[child._baseState.key],reporter,data);reporter.leaveKey(prevKey);return res},this).filter(function(child){return child});content=this._createEncoderBuffer(content)}else{if(state.tag==="seqof"||state.tag==="setof"){if(!(state.args&&state.args.length===1))return reporter.error("Too many args for : "+state.tag);if(!Array.isArray(data))return reporter.error("seqof/setof, but data is not Array");var child=this.clone();child._baseState.implicit=null;content=this._createEncoderBuffer(data.map(function(item){var state=this._baseState;return this._getUse(state.args[0],data)._encode(item,reporter)},child))}else if(state.use!==null){result=this._getUse(state.use,parent)._encode(data,reporter)}else{content=this._encodePrimitive(state.tag,data);primitive=true}}var result;if(!state.any&&state.choice===null){var tag=state.implicit!==null?state.implicit:state.tag;var cls=state.implicit===null?"universal":"context";if(tag===null){if(state.use===null)reporter.error("Tag could be ommited only for .use()")}else{if(state.use===null)result=this._encodeComposite(tag,primitive,cls,content)}}if(state.explicit!==null)result=this._encodeComposite(state.explicit,false,"context",result);return result};Node.prototype._encodeChoice=function encodeChoice(data,reporter){var state=this._baseState;var node=state.choice[data.type];if(!node){assert(false,data.type+" not found in "+JSON.stringify(Object.keys(state.choice)))}return node._encode(data.value,reporter)};Node.prototype._encodePrimitive=function encodePrimitive(tag,data){var state=this._baseState;if(/str$/.test(tag))return this._encodeStr(data,tag);else if(tag==="objid"&&state.args)return this._encodeObjid(data,state.reverseArgs[0],state.args[1]);else if(tag==="objid")return this._encodeObjid(data,null,null);else if(tag==="gentime"||tag==="utctime")return this._encodeTime(data,tag);else if(tag==="null_")return this._encodeNull();else if(tag==="int"||tag==="enum")return this._encodeInt(data,state.args&&state.reverseArgs[0]);else if(tag==="bool")return this._encodeBool(data);else if(tag==="objDesc")return this._encodeStr(data,tag);else throw new Error("Unsupported tag: "+tag)};Node.prototype._isNumstr=function isNumstr(str){return/^[0-9 ]*$/.test(str)};Node.prototype._isPrintstr=function isPrintstr(str){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(str)}},{"../base":205,"minimalistic-assert":297}],207:[function(require,module,exports){var inherits=require("inherits");function Reporter(options){this._reporterState={obj:null,path:[],options:options||{},errors:[]}}exports.Reporter=Reporter;Reporter.prototype.isError=function isError(obj){return obj instanceof ReporterError};Reporter.prototype.save=function save(){var state=this._reporterState;return{obj:state.obj,pathLen:state.path.length}};Reporter.prototype.restore=function restore(data){var state=this._reporterState;state.obj=data.obj;state.path=state.path.slice(0,data.pathLen)};Reporter.prototype.enterKey=function enterKey(key){return this._reporterState.path.push(key)};Reporter.prototype.exitKey=function exitKey(index){var state=this._reporterState;

state.path=state.path.slice(0,index-1)};Reporter.prototype.leaveKey=function leaveKey(index,key,value){var state=this._reporterState;this.exitKey(index);if(state.obj!==null)state.obj[key]=value};Reporter.prototype.path=function path(){return this._reporterState.path.join("/")};Reporter.prototype.enterObject=function enterObject(){var state=this._reporterState;var prev=state.obj;state.obj={};return prev};Reporter.prototype.leaveObject=function leaveObject(prev){var state=this._reporterState;var now=state.obj;state.obj=prev;return now};Reporter.prototype.error=function error(msg){var err;var state=this._reporterState;var inherited=msg instanceof ReporterError;if(inherited){err=msg}else{err=new ReporterError(state.path.map(function(elem){return"["+JSON.stringify(elem)+"]"}).join(""),msg.message||msg,msg.stack)}if(!state.options.partial)throw err;if(!inherited)state.errors.push(err);return err};Reporter.prototype.wrapResult=function wrapResult(result){var state=this._reporterState;if(!state.options.partial)return result;return{result:this.isError(result)?null:result,errors:state.errors}};function ReporterError(path,msg){this.path=path;this.rethrow(msg)}inherits(ReporterError,Error);ReporterError.prototype.rethrow=function rethrow(msg){this.message=msg+" at: "+(this.path||"(shallow)");if(Error.captureStackTrace)Error.captureStackTrace(this,ReporterError);if(!this.stack){try{throw new Error(this.message)}catch(e){this.stack=e.stack}}return this}},{inherits:293}],208:[function(require,module,exports){var constants=require("../constants");exports.tagClass={0:"universal",1:"application",2:"context",3:"private"};exports.tagClassByName=constants._reverse(exports.tagClass);exports.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"};exports.tagByName=constants._reverse(exports.tag)},{"../constants":209}],209:[function(require,module,exports){var constants=exports;constants._reverse=function reverse(map){var res={};Object.keys(map).forEach(function(key){if((key|0)==key)key=key|0;var value=map[key];res[value]=key});return res};constants.der=require("./der")},{"./der":208}],210:[function(require,module,exports){var inherits=require("inherits");var asn1=require("../../asn1");var base=asn1.base;var bignum=asn1.bignum;var der=asn1.constants.der;function DERDecoder(entity){this.enc="der";this.name=entity.name;this.entity=entity;this.tree=new DERNode;this.tree._init(entity.body)}module.exports=DERDecoder;DERDecoder.prototype.decode=function decode(data,options){if(!(data instanceof base.DecoderBuffer))data=new base.DecoderBuffer(data,options);return this.tree._decode(data,options)};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node);DERNode.prototype._peekTag=function peekTag(buffer,tag,any){if(buffer.isEmpty())return false;var state=buffer.save();var decodedTag=derDecodeTag(buffer,'Failed to peek tag: "'+tag+'"');if(buffer.isError(decodedTag))return decodedTag;buffer.restore(state);return decodedTag.tag===tag||decodedTag.tagStr===tag||decodedTag.tagStr+"of"===tag||any};DERNode.prototype._decodeTag=function decodeTag(buffer,tag,any){var decodedTag=derDecodeTag(buffer,'Failed to decode tag of "'+tag+'"');if(buffer.isError(decodedTag))return decodedTag;var len=derDecodeLen(buffer,decodedTag.primitive,'Failed to get length of "'+tag+'"');if(buffer.isError(len))return len;if(!any&&decodedTag.tag!==tag&&decodedTag.tagStr!==tag&&decodedTag.tagStr+"of"!==tag){return buffer.error('Failed to match tag: "'+tag+'"')}if(decodedTag.primitive||len!==null)return buffer.skip(len,'Failed to match body of: "'+tag+'"');var state=buffer.save();var res=this._skipUntilEnd(buffer,'Failed to skip indefinite length body: "'+this.tag+'"');if(buffer.isError(res))return res;len=buffer.offset-state.offset;buffer.restore(state);return buffer.skip(len,'Failed to match body of: "'+tag+'"')};DERNode.prototype._skipUntilEnd=function skipUntilEnd(buffer,fail){while(true){var tag=derDecodeTag(buffer,fail);if(buffer.isError(tag))return tag;var len=derDecodeLen(buffer,tag.primitive,fail);if(buffer.isError(len))return len;var res;if(tag.primitive||len!==null)res=buffer.skip(len);else res=this._skipUntilEnd(buffer,fail);if(buffer.isError(res))return res;if(tag.tagStr==="end")break}};DERNode.prototype._decodeList=function decodeList(buffer,tag,decoder,options){var result=[];while(!buffer.isEmpty()){var possibleEnd=this._peekTag(buffer,"end");if(buffer.isError(possibleEnd))return possibleEnd;var res=decoder.decode(buffer,"der",options);if(buffer.isError(res)&&possibleEnd)break;result.push(res)}return result};DERNode.prototype._decodeStr=function decodeStr(buffer,tag){if(tag==="bitstr"){var unused=buffer.readUInt8();if(buffer.isError(unused))return unused;return{unused:unused,data:buffer.raw()}}else if(tag==="bmpstr"){var raw=buffer.raw();if(raw.length%2===1)return buffer.error("Decoding of string type: bmpstr length mismatch");var str="";for(var i=0;i<raw.length/2;i++){str+=String.fromCharCode(raw.readUInt16BE(i*2))}return str}else if(tag==="numstr"){var numstr=buffer.raw().toString("ascii");if(!this._isNumstr(numstr)){return buffer.error("Decoding of string type: "+"numstr unsupported characters")}return numstr}else if(tag==="octstr"){return buffer.raw()}else if(tag==="objDesc"){return buffer.raw()}else if(tag==="printstr"){var printstr=buffer.raw().toString("ascii");if(!this._isPrintstr(printstr)){return buffer.error("Decoding of string type: "+"printstr unsupported characters")}return printstr}else if(/str$/.test(tag)){return buffer.raw().toString()}else{return buffer.error("Decoding of string type: "+tag+" unsupported")}};DERNode.prototype._decodeObjid=function decodeObjid(buffer,values,relative){var result;var identifiers=[];var ident=0;while(!buffer.isEmpty()){var subident=buffer.readUInt8();ident<<=7;ident|=subident&127;if((subident&128)===0){identifiers.push(ident);ident=0}}if(subident&128)identifiers.push(ident);var first=identifiers[0]/40|0;var second=identifiers[0]%40;if(relative)result=identifiers;else result=[first,second].concat(identifiers.slice(1));if(values){var tmp=values[result.join(" ")];if(tmp===undefined)tmp=values[result.join(".")];if(tmp!==undefined)result=tmp}return result};DERNode.prototype._decodeTime=function decodeTime(buffer,tag){var str=buffer.raw().toString();if(tag==="gentime"){var year=str.slice(0,4)|0;var mon=str.slice(4,6)|0;var day=str.slice(6,8)|0;var hour=str.slice(8,10)|0;var min=str.slice(10,12)|0;var sec=str.slice(12,14)|0}else if(tag==="utctime"){var year=str.slice(0,2)|0;var mon=str.slice(2,4)|0;var day=str.slice(4,6)|0;var hour=str.slice(6,8)|0;var min=str.slice(8,10)|0;var sec=str.slice(10,12)|0;if(year<70)year=2e3+year;else year=1900+year}else{return buffer.error("Decoding "+tag+" time is not supported yet")}return Date.UTC(year,mon-1,day,hour,min,sec,0)};DERNode.prototype._decodeNull=function decodeNull(buffer){return null};DERNode.prototype._decodeBool=function decodeBool(buffer){var res=buffer.readUInt8();if(buffer.isError(res))return res;else return res!==0};DERNode.prototype._decodeInt=function decodeInt(buffer,values){var raw=buffer.raw();var res=new bignum(raw);if(values)res=values[res.toString(10)]||res;return res};DERNode.prototype._use=function use(entity,obj){if(typeof entity==="function")entity=entity(obj);return entity._getDecoder("der").tree};function derDecodeTag(buf,fail){var tag=buf.readUInt8(fail);if(buf.isError(tag))return tag;var cls=der.tagClass[tag>>6];var primitive=(tag&32)===0;if((tag&31)===31){var oct=tag;tag=0;while((oct&128)===128){oct=buf.readUInt8(fail);if(buf.isError(oct))return oct;tag<<=7;tag|=oct&127}}else{tag&=31}var tagStr=der.tag[tag];return{cls:cls,primitive:primitive,tag:tag,tagStr:tagStr}}function derDecodeLen(buf,primitive,fail){var len=buf.readUInt8(fail);if(buf.isError(len))return len;if(!primitive&&len===128)return null;if((len&128)===0){return len}var num=len&127;if(num>=4)return buf.error("length octect is too long");len=0;for(var i=0;i<num;i++){len<<=8;var j=buf.readUInt8(fail);if(buf.isError(j))return j;len|=j}return len}},{"../../asn1":202,inherits:293}],211:[function(require,module,exports){var decoders=exports;decoders.der=require("./der");decoders.pem=require("./pem")},{"./der":210,"./pem":212}],212:[function(require,module,exports){var inherits=require("inherits");var Buffer=require("buffer").Buffer;var DERDecoder=require("./der");function PEMDecoder(entity){DERDecoder.call(this,entity);this.enc="pem"}inherits(PEMDecoder,DERDecoder);module.exports=PEMDecoder;PEMDecoder.prototype.decode=function decode(data,options){var lines=data.toString().split(/[\r\n]+/g);var label=options.label.toUpperCase();var re=/^-----(BEGIN|END) ([^-]+)-----$/;var start=-1;var end=-1;for(var i=0;i<lines.length;i++){var match=lines[i].match(re);if(match===null)continue;if(match[2]!==label)continue;if(start===-1){if(match[1]!=="BEGIN")break;start=i}else{if(match[1]!=="END")break;end=i;break}}if(start===-1||end===-1)throw new Error("PEM section not found for: "+label);var base64=lines.slice(start+1,end).join("");base64.replace(/[^a-z0-9\+\/=]+/gi,"");var input=new Buffer(base64,"base64");return DERDecoder.prototype.decode.call(this,input,options)}},{"./der":210,buffer:247,inherits:293}],213:[function(require,module,exports){var inherits=require("inherits");var Buffer=require("buffer").Buffer;var asn1=require("../../asn1");var base=asn1.base;var der=asn1.constants.der;function DEREncoder(entity){this.enc="der";this.name=entity.name;this.entity=entity;this.tree=new DERNode;this.tree._init(entity.body)}module.exports=DEREncoder;DEREncoder.prototype.encode=function encode(data,reporter){return this.tree._encode(data,reporter).join()};function DERNode(parent){base.Node.call(this,"der",parent)}inherits(DERNode,base.Node);DERNode.prototype._encodeComposite=function encodeComposite(tag,primitive,cls,content){var encodedTag=encodeTag(tag,primitive,cls,this.reporter);if(content.length<128){var header=new Buffer(2);header[0]=encodedTag;header[1]=content.length;return this._createEncoderBuffer([header,content])}var lenOctets=1;for(var i=content.length;i>=256;i>>=8)lenOctets++;var header=new Buffer(1+1+lenOctets);header[0]=encodedTag;header[1]=128|lenOctets;for(var i=1+lenOctets,j=content.length;j>0;i--,j>>=8)header[i]=j&255;return this._createEncoderBuffer([header,content])};DERNode.prototype._encodeStr=function encodeStr(str,tag){if(tag==="bitstr"){return this._createEncoderBuffer([str.unused|0,str.data])}else if(tag==="bmpstr"){var buf=new Buffer(str.length*2);for(var i=0;i<str.length;i++){buf.writeUInt16BE(str.charCodeAt(i),i*2)}return this._createEncoderBuffer(buf)}else if(tag==="numstr"){if(!this._isNumstr(str)){return this.reporter.error("Encoding of string type: numstr supports "+"only digits and space")}return this._createEncoderBuffer(str)}else if(tag==="printstr"){if(!this._isPrintstr(str)){return this.reporter.error("Encoding of string type: printstr supports "+"only latin upper and lower case letters, "+"digits, space, apostrophe, left and rigth "+"parenthesis, plus sign, comma, hyphen, "+"dot, slash, colon, equal sign, "+"question mark")}return this._createEncoderBuffer(str)}else if(/str$/.test(tag)){return this._createEncoderBuffer(str)}else if(tag==="objDesc"){return this._createEncoderBuffer(str)}else{return this.reporter.error("Encoding of string type: "+tag+" unsupported")}};DERNode.prototype._encodeObjid=function encodeObjid(id,values,relative){if(typeof id==="string"){if(!values)return this.reporter.error("string objid given, but no values map found");if(!values.hasOwnProperty(id))return this.reporter.error("objid not found in values map");id=values[id].split(/[\s\.]+/g);for(var i=0;i<id.length;i++)id[i]|=0}else if(Array.isArray(id)){id=id.slice();for(var i=0;i<id.length;i++)id[i]|=0}if(!Array.isArray(id)){return this.reporter.error("objid() should be either array or string, "+"got: "+JSON.stringify(id))}if(!relative){if(id[1]>=40)return this.reporter.error("Second objid identifier OOB");id.splice(0,2,id[0]*40+id[1])}var size=0;for(var i=0;i<id.length;i++){var ident=id[i];for(size++;ident>=128;ident>>=7)size++}var objid=new Buffer(size);var offset=objid.length-1;for(var i=id.length-1;i>=0;i--){var ident=id[i];objid[offset--]=ident&127;while((ident>>=7)>0)objid[offset--]=128|ident&127}return this._createEncoderBuffer(objid)};function two(num){if(num<10)return"0"+num;else return num}DERNode.prototype._encodeTime=function encodeTime(time,tag){var str;var date=new Date(time);if(tag==="gentime"){str=[two(date.getFullYear()),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join("")}else if(tag==="utctime"){str=[two(date.getFullYear()%100),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),"Z"].join("")}else{this.reporter.error("Encoding "+tag+" time is not supported yet")}return this._encodeStr(str,"octstr")};DERNode.prototype._encodeNull=function encodeNull(){return this._createEncoderBuffer("")};DERNode.prototype._encodeInt=function encodeInt(num,values){if(typeof num==="string"){if(!values)return this.reporter.error("String int or enum given, but no values map");if(!values.hasOwnProperty(num)){return this.reporter.error("Values map doesn't contain: "+JSON.stringify(num))}num=values[num]}if(typeof num!=="number"&&!Buffer.isBuffer(num)){var numArray=num.toArray();if(!num.sign&&numArray[0]&128){numArray.unshift(0)}num=new Buffer(numArray)}if(Buffer.isBuffer(num)){var size=num.length;if(num.length===0)size++;var out=new Buffer(size);num.copy(out);if(num.length===0)out[0]=0;return this._createEncoderBuffer(out)}if(num<128)return this._createEncoderBuffer(num);if(num<256)return this._createEncoderBuffer([0,num]);var size=1;for(var i=num;i>=256;i>>=8)size++;var out=new Array(size);for(var i=out.length-1;i>=0;i--){out[i]=num&255;num>>=8}if(out[0]&128){out.unshift(0)}return this._createEncoderBuffer(new Buffer(out))};DERNode.prototype._encodeBool=function encodeBool(value){return this._createEncoderBuffer(value?255:0)};DERNode.prototype._use=function use(entity,obj){if(typeof entity==="function")entity=entity(obj);return entity._getEncoder("der").tree};DERNode.prototype._skipDefault=function skipDefault(dataBuffer,reporter,parent){var state=this._baseState;var i;if(state["default"]===null)return false;var data=dataBuffer.join();if(state.defaultBuffer===undefined)state.defaultBuffer=this._encodeValue(state["default"],reporter,parent).join();if(data.length!==state.defaultBuffer.length)return false;for(i=0;i<data.length;i++)if(data[i]!==state.defaultBuffer[i])return false;return true};function encodeTag(tag,primitive,cls,reporter){var res;if(tag==="seqof")tag="seq";else if(tag==="setof")tag="set";if(der.tagByName.hasOwnProperty(tag))res=der.tagByName[tag];else if(typeof tag==="number"&&(tag|0)===tag)res=tag;else return reporter.error("Unknown tag: "+tag);if(res>=31)return reporter.error("Multi-octet tag encoding unsupported");if(!primitive)res|=32;res|=der.tagClassByName[cls||"universal"]<<6;return res}},{"../../asn1":202,buffer:247,inherits:293}],214:[function(require,module,exports){var encoders=exports;encoders.der=require("./der");encoders.pem=require("./pem")},{"./der":213,"./pem":215}],215:[function(require,module,exports){var inherits=require("inherits");var DEREncoder=require("./der");function PEMEncoder(entity){DEREncoder.call(this,entity);this.enc="pem"}inherits(PEMEncoder,DEREncoder);module.exports=PEMEncoder;PEMEncoder.prototype.encode=function encode(data,options){var buf=DEREncoder.prototype.encode.call(this,data);var p=buf.toString("base64");var out=["-----BEGIN "+options.label+"-----"];for(var i=0;i<p.length;i+=64)out.push(p.slice(i,i+64));out.push("-----END "+options.label+"-----");return out.join("\n")}},{"./der":213,inherits:293}],216:[function(require,module,exports){var util=require("util/");var pSlice=Array.prototype.slice;var hasOwn=Object.prototype.hasOwnProperty;var assert=module.exports=ok;assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=stackStartFunction.name;var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function replacer(key,value){if(util.isUndefined(value)){return""+value}if(util.isNumber(value)&&!isFinite(value)){return value.toString()}if(util.isFunction(value)||util.isRegExp(value)){return value.toString()}return value}function truncate(s,n){if(util.isString(s)){return s.length<n?s:s.slice(0,n)}else{return s}}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};function _deepEqual(actual,expected){if(actual===expected){return true}else if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return false;for(var i=0;i<actual.length;i++){if(actual[i]!==expected[i])return false}return true}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if(!util.isObject(actual)&&!util.isObject(expected)){return actual==expected}else{return objEquiv(actual,expected)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return false;if(a.prototype!==b.prototype)return false;if(util.isPrimitive(a)||util.isPrimitive(b)){return a===b}var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b)}var ka=objectKeys(a),kb=objectKeys(b),key,i;if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key]))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}else if(actual instanceof expected){return true}else if(expected.call({},actual)===true){return true}return false}function _throws(shouldThrow,block,expected,message){var actual;if(util.isString(expected)){message=expected;expected=null}try{block()}catch(e){actual=e}message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}if(!shouldThrow&&expectedException(actual,expected)){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws.apply(this,[true].concat(pSlice.call(arguments)))};assert.doesNotThrow=function(block,message){_throws.apply(this,[false].concat(pSlice.call(arguments)))};assert.ifError=function(err){if(err){throw err}};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}},{"util/":339}],217:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],218:[function(require,module,exports){(function(module,exports){"use strict";function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}function BN(number,base,endian){if(BN.isBN(number)){return number}this.negative=0;this.words=null;this.length=0;this.red=null;if(number!==null){if(base==="le"||base==="be"){endian=base;base=10}this._init(number||0,base||10,endian||"be")}}if(typeof module==="object"){module.exports=BN}else{exports.BN=BN}BN.BN=BN;BN.wordSize=26;var Buffer;try{Buffer=require("buf"+"fer").Buffer}catch(e){}BN.isBN=function isBN(num){if(num instanceof BN){return true}return num!==null&&typeof num==="object"&&num.constructor.wordSize===BN.wordSize&&Array.isArray(num.words)};BN.max=function max(left,right){if(left.cmp(right)>0)return left;return right};BN.min=function min(left,right){if(left.cmp(right)<0)return left;return right};BN.prototype._init=function init(number,base,endian){if(typeof number==="number"){return this._initNumber(number,base,endian)}if(typeof number==="object"){return this._initArray(number,base,endian)}if(base==="hex"){base=16}assert(base===(base|0)&&base>=2&&base<=36);number=number.toString().replace(/\s+/g,"");var start=0;if(number[0]==="-"){start++}if(base===16){this._parseHex(number,start)}else{this._parseBase(number,base,start)}if(number[0]==="-"){this.negative=1}this.strip();if(endian!=="le")return;this._initArray(this.toArray(),base,endian)};BN.prototype._initNumber=function _initNumber(number,base,endian){if(number<0){this.negative=1;number=-number}if(number<67108864){this.words=[number&67108863];this.length=1}else if(number<4503599627370496){this.words=[number&67108863,number/67108864&67108863];this.length=2}else{assert(number<9007199254740992);this.words=[number&67108863,number/67108864&67108863,1];this.length=3}if(endian!=="le")return;this._initArray(this.toArray(),base,endian)};BN.prototype._initArray=function _initArray(number,base,endian){assert(typeof number.length==="number");if(number.length<=0){this.words=[0];this.length=1;return this}this.length=Math.ceil(number.length/3);this.words=new Array(this.length);for(var i=0;i<this.length;i++){this.words[i]=0}var j,w;var off=0;if(endian==="be"){for(i=number.length-1,j=0;i>=0;i-=3){w=number[i]|number[i-1]<<8|number[i-2]<<16;this.words[j]|=w<<off&67108863;this.words[j+1]=w>>>26-off&67108863;off+=24;if(off>=26){off-=26;j++}}}else if(endian==="le"){for(i=0,j=0;i<number.length;i+=3){w=number[i]|number[i+1]<<8|number[i+2]<<16;this.words[j]|=w<<off&67108863;this.words[j+1]=w>>>26-off&67108863;off+=24;if(off>=26){off-=26;j++}}}return this.strip()};function parseHex(str,start,end){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r<<=4;if(c>=49&&c<=54){r|=c-49+10}else if(c>=17&&c<=22){r|=c-17+10}else{r|=c&15}}return r}BN.prototype._parseHex=function _parseHex(number,start){this.length=Math.ceil((number.length-start)/6);this.words=new Array(this.length);for(var i=0;i<this.length;i++){this.words[i]=0}var j,w;var off=0;for(i=number.length-6,j=0;i>=start;i-=6){w=parseHex(number,i,i+6);this.words[j]|=w<<off&67108863;this.words[j+1]|=w>>>26-off&4194303;off+=24;if(off>=26){off-=26;j++}}if(i+6!==start){w=parseHex(number,start,i+6);this.words[j]|=w<<off&67108863;this.words[j+1]|=w>>>26-off&4194303}this.strip()};function parseBase(str,start,end,mul){var r=0;var len=Math.min(str.length,end);for(var i=start;i<len;i++){var c=str.charCodeAt(i)-48;r*=mul;if(c>=49){r+=c-49+10}else if(c>=17){r+=c-17+10}else{r+=c}}return r}BN.prototype._parseBase=function _parseBase(number,base,start){this.words=[0];this.length=1;for(var limbLen=0,limbPow=1;limbPow<=67108863;limbPow*=base){limbLen++}limbLen--;limbPow=limbPow/base|0;var total=number.length-start;var mod=total%limbLen;var end=Math.min(total,total-mod)+start;var word=0;for(var i=start;i<end;i+=limbLen){word=parseBase(number,i,i+limbLen,base);this.imuln(limbPow);if(this.words[0]+word<67108864){this.words[0]+=word}else{this._iaddn(word)}}if(mod!==0){var pow=1;word=parseBase(number,i,number.length,base);for(i=0;i<mod;i++){pow*=base}this.imuln(pow);if(this.words[0]+word<67108864){this.words[0]+=word}else{this._iaddn(word)}}};BN.prototype.copy=function copy(dest){dest.words=new Array(this.length);for(var i=0;i<this.length;i++){dest.words[i]=this.words[i]}dest.length=this.length;dest.negative=this.negative;dest.red=this.red};BN.prototype.clone=function clone(){var r=new BN(null);this.copy(r);return r};BN.prototype._expand=function _expand(size){while(this.length<size){this.words[this.length++]=0}return this};BN.prototype.strip=function strip(){while(this.length>1&&this.words[this.length-1]===0){this.length--}return this._normSign()};BN.prototype._normSign=function _normSign(){if(this.length===1&&this.words[0]===0){this.negative=0}return this};BN.prototype.inspect=function inspect(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var zeros=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"];var groupSizes=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];var groupBases=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];BN.prototype.toString=function toString(base,padding){base=base||10;padding=padding|0||1;var out;if(base===16||base==="hex"){out="";var off=0;var carry=0;for(var i=0;i<this.length;i++){var w=this.words[i];var word=((w<<off|carry)&16777215).toString(16);carry=w>>>24-off&16777215;if(carry!==0||i!==this.length-1){out=zeros[6-word.length]+word+out}else{out=word+out}off+=2;if(off>=26){off-=26;i--}}if(carry!==0){out=carry.toString(16)+out}while(out.length%padding!==0){out="0"+out}if(this.negative!==0){out="-"+out}return out}if(base===(base|0)&&base>=2&&base<=36){var groupSize=groupSizes[base];var groupBase=groupBases[base];out="";var c=this.clone();c.negative=0;while(!c.isZero()){var r=c.modn(groupBase).toString(base);c=c.idivn(groupBase);if(!c.isZero()){out=zeros[groupSize-r.length]+r+out}else{out=r+out}}if(this.isZero()){out="0"+out}while(out.length%padding!==0){out="0"+out}if(this.negative!==0){out="-"+out}return out}assert(false,"Base should be between 2 and 36")};BN.prototype.toNumber=function toNumber(){var ret=this.words[0];if(this.length===2){ret+=this.words[1]*67108864}else if(this.length===3&&this.words[2]===1){ret+=4503599627370496+this.words[1]*67108864}else if(this.length>2){assert(false,"Number can only safely store up to 53 bits")}return this.negative!==0?-ret:ret};BN.prototype.toJSON=function toJSON(){return this.toString(16)};BN.prototype.toBuffer=function toBuffer(endian,length){assert(typeof Buffer!=="undefined");return this.toArrayLike(Buffer,endian,length)};BN.prototype.toArray=function toArray(endian,length){return this.toArrayLike(Array,endian,length)};BN.prototype.toArrayLike=function toArrayLike(ArrayType,endian,length){var byteLength=this.byteLength();var reqLength=length||Math.max(1,byteLength);assert(byteLength<=reqLength,"byte array longer than desired length");assert(reqLength>0,"Requested array length <= 0");this.strip();var littleEndian=endian==="le";var res=new ArrayType(reqLength);var b,i;var q=this.clone();if(!littleEndian){for(i=0;i<reqLength-byteLength;i++){res[i]=0}for(i=0;!q.isZero();i++){b=q.andln(255);q.iushrn(8);res[reqLength-i-1]=b}}else{for(i=0;!q.isZero();i++){b=q.andln(255);q.iushrn(8);res[i]=b}for(;i<reqLength;i++){res[i]=0}}return res};if(Math.clz32){BN.prototype._countBits=function _countBits(w){return 32-Math.clz32(w)}}else{BN.prototype._countBits=function _countBits(w){var t=w;var r=0;if(t>=4096){r+=13;t>>>=13}if(t>=64){r+=7;t>>>=7}if(t>=8){r+=4;t>>>=4}if(t>=2){r+=2;t>>>=2}return r+t}}BN.prototype._zeroBits=function _zeroBits(w){
if(w===0)return 26;var t=w;var r=0;if((t&8191)===0){r+=13;t>>>=13}if((t&127)===0){r+=7;t>>>=7}if((t&15)===0){r+=4;t>>>=4}if((t&3)===0){r+=2;t>>>=2}if((t&1)===0){r++}return r};BN.prototype.bitLength=function bitLength(){var w=this.words[this.length-1];var hi=this._countBits(w);return(this.length-1)*26+hi};function toBitArray(num){var w=new Array(num.bitLength());for(var bit=0;bit<w.length;bit++){var off=bit/26|0;var wbit=bit%26;w[bit]=(num.words[off]&1<<wbit)>>>wbit}return w}BN.prototype.zeroBits=function zeroBits(){if(this.isZero())return 0;var r=0;for(var i=0;i<this.length;i++){var b=this._zeroBits(this.words[i]);r+=b;if(b!==26)break}return r};BN.prototype.byteLength=function byteLength(){return Math.ceil(this.bitLength()/8)};BN.prototype.toTwos=function toTwos(width){if(this.negative!==0){return this.abs().inotn(width).iaddn(1)}return this.clone()};BN.prototype.fromTwos=function fromTwos(width){if(this.testn(width-1)){return this.notn(width).iaddn(1).ineg()}return this.clone()};BN.prototype.isNeg=function isNeg(){return this.negative!==0};BN.prototype.neg=function neg(){return this.clone().ineg()};BN.prototype.ineg=function ineg(){if(!this.isZero()){this.negative^=1}return this};BN.prototype.iuor=function iuor(num){while(this.length<num.length){this.words[this.length++]=0}for(var i=0;i<num.length;i++){this.words[i]=this.words[i]|num.words[i]}return this.strip()};BN.prototype.ior=function ior(num){assert((this.negative|num.negative)===0);return this.iuor(num)};BN.prototype.or=function or(num){if(this.length>num.length)return this.clone().ior(num);return num.clone().ior(this)};BN.prototype.uor=function uor(num){if(this.length>num.length)return this.clone().iuor(num);return num.clone().iuor(this)};BN.prototype.iuand=function iuand(num){var b;if(this.length>num.length){b=num}else{b=this}for(var i=0;i<b.length;i++){this.words[i]=this.words[i]&num.words[i]}this.length=b.length;return this.strip()};BN.prototype.iand=function iand(num){assert((this.negative|num.negative)===0);return this.iuand(num)};BN.prototype.and=function and(num){if(this.length>num.length)return this.clone().iand(num);return num.clone().iand(this)};BN.prototype.uand=function uand(num){if(this.length>num.length)return this.clone().iuand(num);return num.clone().iuand(this)};BN.prototype.iuxor=function iuxor(num){var a;var b;if(this.length>num.length){a=this;b=num}else{a=num;b=this}for(var i=0;i<b.length;i++){this.words[i]=a.words[i]^b.words[i]}if(this!==a){for(;i<a.length;i++){this.words[i]=a.words[i]}}this.length=a.length;return this.strip()};BN.prototype.ixor=function ixor(num){assert((this.negative|num.negative)===0);return this.iuxor(num)};BN.prototype.xor=function xor(num){if(this.length>num.length)return this.clone().ixor(num);return num.clone().ixor(this)};BN.prototype.uxor=function uxor(num){if(this.length>num.length)return this.clone().iuxor(num);return num.clone().iuxor(this)};BN.prototype.inotn=function inotn(width){assert(typeof width==="number"&&width>=0);var bytesNeeded=Math.ceil(width/26)|0;var bitsLeft=width%26;this._expand(bytesNeeded);if(bitsLeft>0){bytesNeeded--}for(var i=0;i<bytesNeeded;i++){this.words[i]=~this.words[i]&67108863}if(bitsLeft>0){this.words[i]=~this.words[i]&67108863>>26-bitsLeft}return this.strip()};BN.prototype.notn=function notn(width){return this.clone().inotn(width)};BN.prototype.setn=function setn(bit,val){assert(typeof bit==="number"&&bit>=0);var off=bit/26|0;var wbit=bit%26;this._expand(off+1);if(val){this.words[off]=this.words[off]|1<<wbit}else{this.words[off]=this.words[off]&~(1<<wbit)}return this.strip()};BN.prototype.iadd=function iadd(num){var r;if(this.negative!==0&&num.negative===0){this.negative=0;r=this.isub(num);this.negative^=1;return this._normSign()}else if(this.negative===0&&num.negative!==0){num.negative=0;r=this.isub(num);num.negative=1;return r._normSign()}var a,b;if(this.length>num.length){a=this;b=num}else{a=num;b=this}var carry=0;for(var i=0;i<b.length;i++){r=(a.words[i]|0)+(b.words[i]|0)+carry;this.words[i]=r&67108863;carry=r>>>26}for(;carry!==0&&i<a.length;i++){r=(a.words[i]|0)+carry;this.words[i]=r&67108863;carry=r>>>26}this.length=a.length;if(carry!==0){this.words[this.length]=carry;this.length++}else if(a!==this){for(;i<a.length;i++){this.words[i]=a.words[i]}}return this};BN.prototype.add=function add(num){var res;if(num.negative!==0&&this.negative===0){num.negative=0;res=this.sub(num);num.negative^=1;return res}else if(num.negative===0&&this.negative!==0){this.negative=0;res=num.sub(this);this.negative=1;return res}if(this.length>num.length)return this.clone().iadd(num);return num.clone().iadd(this)};BN.prototype.isub=function isub(num){if(num.negative!==0){num.negative=0;var r=this.iadd(num);num.negative=1;return r._normSign()}else if(this.negative!==0){this.negative=0;this.iadd(num);this.negative=1;return this._normSign()}var cmp=this.cmp(num);if(cmp===0){this.negative=0;this.length=1;this.words[0]=0;return this}var a,b;if(cmp>0){a=this;b=num}else{a=num;b=this}var carry=0;for(var i=0;i<b.length;i++){r=(a.words[i]|0)-(b.words[i]|0)+carry;carry=r>>26;this.words[i]=r&67108863}for(;carry!==0&&i<a.length;i++){r=(a.words[i]|0)+carry;carry=r>>26;this.words[i]=r&67108863}if(carry===0&&i<a.length&&a!==this){for(;i<a.length;i++){this.words[i]=a.words[i]}}this.length=Math.max(this.length,i);if(a!==this){this.negative=1}return this.strip()};BN.prototype.sub=function sub(num){return this.clone().isub(num)};function smallMulTo(self,num,out){out.negative=num.negative^self.negative;var len=self.length+num.length|0;out.length=len;len=len-1|0;var a=self.words[0]|0;var b=num.words[0]|0;var r=a*b;var lo=r&67108863;var carry=r/67108864|0;out.words[0]=lo;for(var k=1;k<len;k++){var ncarry=carry>>>26;var rword=carry&67108863;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j|0;a=self.words[i]|0;b=num.words[j]|0;r=a*b+rword;ncarry+=r/67108864|0;rword=r&67108863}out.words[k]=rword|0;carry=ncarry|0}if(carry!==0){out.words[k]=carry|0}else{out.length--}return out.strip()}var comb10MulTo=function comb10MulTo(self,num,out){var a=self.words;var b=num.words;var o=out.words;var c=0;var lo;var mid;var hi;var a0=a[0]|0;var al0=a0&8191;var ah0=a0>>>13;var a1=a[1]|0;var al1=a1&8191;var ah1=a1>>>13;var a2=a[2]|0;var al2=a2&8191;var ah2=a2>>>13;var a3=a[3]|0;var al3=a3&8191;var ah3=a3>>>13;var a4=a[4]|0;var al4=a4&8191;var ah4=a4>>>13;var a5=a[5]|0;var al5=a5&8191;var ah5=a5>>>13;var a6=a[6]|0;var al6=a6&8191;var ah6=a6>>>13;var a7=a[7]|0;var al7=a7&8191;var ah7=a7>>>13;var a8=a[8]|0;var al8=a8&8191;var ah8=a8>>>13;var a9=a[9]|0;var al9=a9&8191;var ah9=a9>>>13;var b0=b[0]|0;var bl0=b0&8191;var bh0=b0>>>13;var b1=b[1]|0;var bl1=b1&8191;var bh1=b1>>>13;var b2=b[2]|0;var bl2=b2&8191;var bh2=b2>>>13;var b3=b[3]|0;var bl3=b3&8191;var bh3=b3>>>13;var b4=b[4]|0;var bl4=b4&8191;var bh4=b4>>>13;var b5=b[5]|0;var bl5=b5&8191;var bh5=b5>>>13;var b6=b[6]|0;var bl6=b6&8191;var bh6=b6>>>13;var b7=b[7]|0;var bl7=b7&8191;var bh7=b7>>>13;var b8=b[8]|0;var bl8=b8&8191;var bh8=b8>>>13;var b9=b[9]|0;var bl9=b9&8191;var bh9=b9>>>13;out.negative=self.negative^num.negative;out.length=19;lo=Math.imul(al0,bl0);mid=Math.imul(al0,bh0);mid=mid+Math.imul(ah0,bl0)|0;hi=Math.imul(ah0,bh0);var w0=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w0>>>26)|0;w0&=67108863;lo=Math.imul(al1,bl0);mid=Math.imul(al1,bh0);mid=mid+Math.imul(ah1,bl0)|0;hi=Math.imul(ah1,bh0);lo=lo+Math.imul(al0,bl1)|0;mid=mid+Math.imul(al0,bh1)|0;mid=mid+Math.imul(ah0,bl1)|0;hi=hi+Math.imul(ah0,bh1)|0;var w1=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w1>>>26)|0;w1&=67108863;lo=Math.imul(al2,bl0);mid=Math.imul(al2,bh0);mid=mid+Math.imul(ah2,bl0)|0;hi=Math.imul(ah2,bh0);lo=lo+Math.imul(al1,bl1)|0;mid=mid+Math.imul(al1,bh1)|0;mid=mid+Math.imul(ah1,bl1)|0;hi=hi+Math.imul(ah1,bh1)|0;lo=lo+Math.imul(al0,bl2)|0;mid=mid+Math.imul(al0,bh2)|0;mid=mid+Math.imul(ah0,bl2)|0;hi=hi+Math.imul(ah0,bh2)|0;var w2=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w2>>>26)|0;w2&=67108863;lo=Math.imul(al3,bl0);mid=Math.imul(al3,bh0);mid=mid+Math.imul(ah3,bl0)|0;hi=Math.imul(ah3,bh0);lo=lo+Math.imul(al2,bl1)|0;mid=mid+Math.imul(al2,bh1)|0;mid=mid+Math.imul(ah2,bl1)|0;hi=hi+Math.imul(ah2,bh1)|0;lo=lo+Math.imul(al1,bl2)|0;mid=mid+Math.imul(al1,bh2)|0;mid=mid+Math.imul(ah1,bl2)|0;hi=hi+Math.imul(ah1,bh2)|0;lo=lo+Math.imul(al0,bl3)|0;mid=mid+Math.imul(al0,bh3)|0;mid=mid+Math.imul(ah0,bl3)|0;hi=hi+Math.imul(ah0,bh3)|0;var w3=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w3>>>26)|0;w3&=67108863;lo=Math.imul(al4,bl0);mid=Math.imul(al4,bh0);mid=mid+Math.imul(ah4,bl0)|0;hi=Math.imul(ah4,bh0);lo=lo+Math.imul(al3,bl1)|0;mid=mid+Math.imul(al3,bh1)|0;mid=mid+Math.imul(ah3,bl1)|0;hi=hi+Math.imul(ah3,bh1)|0;lo=lo+Math.imul(al2,bl2)|0;mid=mid+Math.imul(al2,bh2)|0;mid=mid+Math.imul(ah2,bl2)|0;hi=hi+Math.imul(ah2,bh2)|0;lo=lo+Math.imul(al1,bl3)|0;mid=mid+Math.imul(al1,bh3)|0;mid=mid+Math.imul(ah1,bl3)|0;hi=hi+Math.imul(ah1,bh3)|0;lo=lo+Math.imul(al0,bl4)|0;mid=mid+Math.imul(al0,bh4)|0;mid=mid+Math.imul(ah0,bl4)|0;hi=hi+Math.imul(ah0,bh4)|0;var w4=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w4>>>26)|0;w4&=67108863;lo=Math.imul(al5,bl0);mid=Math.imul(al5,bh0);mid=mid+Math.imul(ah5,bl0)|0;hi=Math.imul(ah5,bh0);lo=lo+Math.imul(al4,bl1)|0;mid=mid+Math.imul(al4,bh1)|0;mid=mid+Math.imul(ah4,bl1)|0;hi=hi+Math.imul(ah4,bh1)|0;lo=lo+Math.imul(al3,bl2)|0;mid=mid+Math.imul(al3,bh2)|0;mid=mid+Math.imul(ah3,bl2)|0;hi=hi+Math.imul(ah3,bh2)|0;lo=lo+Math.imul(al2,bl3)|0;mid=mid+Math.imul(al2,bh3)|0;mid=mid+Math.imul(ah2,bl3)|0;hi=hi+Math.imul(ah2,bh3)|0;lo=lo+Math.imul(al1,bl4)|0;mid=mid+Math.imul(al1,bh4)|0;mid=mid+Math.imul(ah1,bl4)|0;hi=hi+Math.imul(ah1,bh4)|0;lo=lo+Math.imul(al0,bl5)|0;mid=mid+Math.imul(al0,bh5)|0;mid=mid+Math.imul(ah0,bl5)|0;hi=hi+Math.imul(ah0,bh5)|0;var w5=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w5>>>26)|0;w5&=67108863;lo=Math.imul(al6,bl0);mid=Math.imul(al6,bh0);mid=mid+Math.imul(ah6,bl0)|0;hi=Math.imul(ah6,bh0);lo=lo+Math.imul(al5,bl1)|0;mid=mid+Math.imul(al5,bh1)|0;mid=mid+Math.imul(ah5,bl1)|0;hi=hi+Math.imul(ah5,bh1)|0;lo=lo+Math.imul(al4,bl2)|0;mid=mid+Math.imul(al4,bh2)|0;mid=mid+Math.imul(ah4,bl2)|0;hi=hi+Math.imul(ah4,bh2)|0;lo=lo+Math.imul(al3,bl3)|0;mid=mid+Math.imul(al3,bh3)|0;mid=mid+Math.imul(ah3,bl3)|0;hi=hi+Math.imul(ah3,bh3)|0;lo=lo+Math.imul(al2,bl4)|0;mid=mid+Math.imul(al2,bh4)|0;mid=mid+Math.imul(ah2,bl4)|0;hi=hi+Math.imul(ah2,bh4)|0;lo=lo+Math.imul(al1,bl5)|0;mid=mid+Math.imul(al1,bh5)|0;mid=mid+Math.imul(ah1,bl5)|0;hi=hi+Math.imul(ah1,bh5)|0;lo=lo+Math.imul(al0,bl6)|0;mid=mid+Math.imul(al0,bh6)|0;mid=mid+Math.imul(ah0,bl6)|0;hi=hi+Math.imul(ah0,bh6)|0;var w6=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w6>>>26)|0;w6&=67108863;lo=Math.imul(al7,bl0);mid=Math.imul(al7,bh0);mid=mid+Math.imul(ah7,bl0)|0;hi=Math.imul(ah7,bh0);lo=lo+Math.imul(al6,bl1)|0;mid=mid+Math.imul(al6,bh1)|0;mid=mid+Math.imul(ah6,bl1)|0;hi=hi+Math.imul(ah6,bh1)|0;lo=lo+Math.imul(al5,bl2)|0;mid=mid+Math.imul(al5,bh2)|0;mid=mid+Math.imul(ah5,bl2)|0;hi=hi+Math.imul(ah5,bh2)|0;lo=lo+Math.imul(al4,bl3)|0;mid=mid+Math.imul(al4,bh3)|0;mid=mid+Math.imul(ah4,bl3)|0;hi=hi+Math.imul(ah4,bh3)|0;lo=lo+Math.imul(al3,bl4)|0;mid=mid+Math.imul(al3,bh4)|0;mid=mid+Math.imul(ah3,bl4)|0;hi=hi+Math.imul(ah3,bh4)|0;lo=lo+Math.imul(al2,bl5)|0;mid=mid+Math.imul(al2,bh5)|0;mid=mid+Math.imul(ah2,bl5)|0;hi=hi+Math.imul(ah2,bh5)|0;lo=lo+Math.imul(al1,bl6)|0;mid=mid+Math.imul(al1,bh6)|0;mid=mid+Math.imul(ah1,bl6)|0;hi=hi+Math.imul(ah1,bh6)|0;lo=lo+Math.imul(al0,bl7)|0;mid=mid+Math.imul(al0,bh7)|0;mid=mid+Math.imul(ah0,bl7)|0;hi=hi+Math.imul(ah0,bh7)|0;var w7=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w7>>>26)|0;w7&=67108863;lo=Math.imul(al8,bl0);mid=Math.imul(al8,bh0);mid=mid+Math.imul(ah8,bl0)|0;hi=Math.imul(ah8,bh0);lo=lo+Math.imul(al7,bl1)|0;mid=mid+Math.imul(al7,bh1)|0;mid=mid+Math.imul(ah7,bl1)|0;hi=hi+Math.imul(ah7,bh1)|0;lo=lo+Math.imul(al6,bl2)|0;mid=mid+Math.imul(al6,bh2)|0;mid=mid+Math.imul(ah6,bl2)|0;hi=hi+Math.imul(ah6,bh2)|0;lo=lo+Math.imul(al5,bl3)|0;mid=mid+Math.imul(al5,bh3)|0;mid=mid+Math.imul(ah5,bl3)|0;hi=hi+Math.imul(ah5,bh3)|0;lo=lo+Math.imul(al4,bl4)|0;mid=mid+Math.imul(al4,bh4)|0;mid=mid+Math.imul(ah4,bl4)|0;hi=hi+Math.imul(ah4,bh4)|0;lo=lo+Math.imul(al3,bl5)|0;mid=mid+Math.imul(al3,bh5)|0;mid=mid+Math.imul(ah3,bl5)|0;hi=hi+Math.imul(ah3,bh5)|0;lo=lo+Math.imul(al2,bl6)|0;mid=mid+Math.imul(al2,bh6)|0;mid=mid+Math.imul(ah2,bl6)|0;hi=hi+Math.imul(ah2,bh6)|0;lo=lo+Math.imul(al1,bl7)|0;mid=mid+Math.imul(al1,bh7)|0;mid=mid+Math.imul(ah1,bl7)|0;hi=hi+Math.imul(ah1,bh7)|0;lo=lo+Math.imul(al0,bl8)|0;mid=mid+Math.imul(al0,bh8)|0;mid=mid+Math.imul(ah0,bl8)|0;hi=hi+Math.imul(ah0,bh8)|0;var w8=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w8>>>26)|0;w8&=67108863;lo=Math.imul(al9,bl0);mid=Math.imul(al9,bh0);mid=mid+Math.imul(ah9,bl0)|0;hi=Math.imul(ah9,bh0);lo=lo+Math.imul(al8,bl1)|0;mid=mid+Math.imul(al8,bh1)|0;mid=mid+Math.imul(ah8,bl1)|0;hi=hi+Math.imul(ah8,bh1)|0;lo=lo+Math.imul(al7,bl2)|0;mid=mid+Math.imul(al7,bh2)|0;mid=mid+Math.imul(ah7,bl2)|0;hi=hi+Math.imul(ah7,bh2)|0;lo=lo+Math.imul(al6,bl3)|0;mid=mid+Math.imul(al6,bh3)|0;mid=mid+Math.imul(ah6,bl3)|0;hi=hi+Math.imul(ah6,bh3)|0;lo=lo+Math.imul(al5,bl4)|0;mid=mid+Math.imul(al5,bh4)|0;mid=mid+Math.imul(ah5,bl4)|0;hi=hi+Math.imul(ah5,bh4)|0;lo=lo+Math.imul(al4,bl5)|0;mid=mid+Math.imul(al4,bh5)|0;mid=mid+Math.imul(ah4,bl5)|0;hi=hi+Math.imul(ah4,bh5)|0;lo=lo+Math.imul(al3,bl6)|0;mid=mid+Math.imul(al3,bh6)|0;mid=mid+Math.imul(ah3,bl6)|0;hi=hi+Math.imul(ah3,bh6)|0;lo=lo+Math.imul(al2,bl7)|0;mid=mid+Math.imul(al2,bh7)|0;mid=mid+Math.imul(ah2,bl7)|0;hi=hi+Math.imul(ah2,bh7)|0;lo=lo+Math.imul(al1,bl8)|0;mid=mid+Math.imul(al1,bh8)|0;mid=mid+Math.imul(ah1,bl8)|0;hi=hi+Math.imul(ah1,bh8)|0;lo=lo+Math.imul(al0,bl9)|0;mid=mid+Math.imul(al0,bh9)|0;mid=mid+Math.imul(ah0,bl9)|0;hi=hi+Math.imul(ah0,bh9)|0;var w9=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w9>>>26)|0;w9&=67108863;lo=Math.imul(al9,bl1);mid=Math.imul(al9,bh1);mid=mid+Math.imul(ah9,bl1)|0;hi=Math.imul(ah9,bh1);lo=lo+Math.imul(al8,bl2)|0;mid=mid+Math.imul(al8,bh2)|0;mid=mid+Math.imul(ah8,bl2)|0;hi=hi+Math.imul(ah8,bh2)|0;lo=lo+Math.imul(al7,bl3)|0;mid=mid+Math.imul(al7,bh3)|0;mid=mid+Math.imul(ah7,bl3)|0;hi=hi+Math.imul(ah7,bh3)|0;lo=lo+Math.imul(al6,bl4)|0;mid=mid+Math.imul(al6,bh4)|0;mid=mid+Math.imul(ah6,bl4)|0;hi=hi+Math.imul(ah6,bh4)|0;lo=lo+Math.imul(al5,bl5)|0;mid=mid+Math.imul(al5,bh5)|0;mid=mid+Math.imul(ah5,bl5)|0;hi=hi+Math.imul(ah5,bh5)|0;lo=lo+Math.imul(al4,bl6)|0;mid=mid+Math.imul(al4,bh6)|0;mid=mid+Math.imul(ah4,bl6)|0;hi=hi+Math.imul(ah4,bh6)|0;lo=lo+Math.imul(al3,bl7)|0;mid=mid+Math.imul(al3,bh7)|0;mid=mid+Math.imul(ah3,bl7)|0;hi=hi+Math.imul(ah3,bh7)|0;lo=lo+Math.imul(al2,bl8)|0;mid=mid+Math.imul(al2,bh8)|0;mid=mid+Math.imul(ah2,bl8)|0;hi=hi+Math.imul(ah2,bh8)|0;lo=lo+Math.imul(al1,bl9)|0;mid=mid+Math.imul(al1,bh9)|0;mid=mid+Math.imul(ah1,bl9)|0;hi=hi+Math.imul(ah1,bh9)|0;var w10=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w10>>>26)|0;w10&=67108863;lo=Math.imul(al9,bl2);mid=Math.imul(al9,bh2);mid=mid+Math.imul(ah9,bl2)|0;hi=Math.imul(ah9,bh2);lo=lo+Math.imul(al8,bl3)|0;mid=mid+Math.imul(al8,bh3)|0;mid=mid+Math.imul(ah8,bl3)|0;hi=hi+Math.imul(ah8,bh3)|0;lo=lo+Math.imul(al7,bl4)|0;mid=mid+Math.imul(al7,bh4)|0;mid=mid+Math.imul(ah7,bl4)|0;hi=hi+Math.imul(ah7,bh4)|0;lo=lo+Math.imul(al6,bl5)|0;mid=mid+Math.imul(al6,bh5)|0;mid=mid+Math.imul(ah6,bl5)|0;hi=hi+Math.imul(ah6,bh5)|0;lo=lo+Math.imul(al5,bl6)|0;mid=mid+Math.imul(al5,bh6)|0;mid=mid+Math.imul(ah5,bl6)|0;hi=hi+Math.imul(ah5,bh6)|0;lo=lo+Math.imul(al4,bl7)|0;mid=mid+Math.imul(al4,bh7)|0;mid=mid+Math.imul(ah4,bl7)|0;hi=hi+Math.imul(ah4,bh7)|0;lo=lo+Math.imul(al3,bl8)|0;mid=mid+Math.imul(al3,bh8)|0;mid=mid+Math.imul(ah3,bl8)|0;hi=hi+Math.imul(ah3,bh8)|0;lo=lo+Math.imul(al2,bl9)|0;mid=mid+Math.imul(al2,bh9)|0;mid=mid+Math.imul(ah2,bl9)|0;hi=hi+Math.imul(ah2,bh9)|0;var w11=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w11>>>26)|0;w11&=67108863;lo=Math.imul(al9,bl3);mid=Math.imul(al9,bh3);mid=mid+Math.imul(ah9,bl3)|0;hi=Math.imul(ah9,bh3);lo=lo+Math.imul(al8,bl4)|0;mid=mid+Math.imul(al8,bh4)|0;mid=mid+Math.imul(ah8,bl4)|0;hi=hi+Math.imul(ah8,bh4)|0;lo=lo+Math.imul(al7,bl5)|0;mid=mid+Math.imul(al7,bh5)|0;mid=mid+Math.imul(ah7,bl5)|0;hi=hi+Math.imul(ah7,bh5)|0;lo=lo+Math.imul(al6,bl6)|0;mid=mid+Math.imul(al6,bh6)|0;mid=mid+Math.imul(ah6,bl6)|0;hi=hi+Math.imul(ah6,bh6)|0;lo=lo+Math.imul(al5,bl7)|0;mid=mid+Math.imul(al5,bh7)|0;mid=mid+Math.imul(ah5,bl7)|0;hi=hi+Math.imul(ah5,bh7)|0;lo=lo+Math.imul(al4,bl8)|0;mid=mid+Math.imul(al4,bh8)|0;mid=mid+Math.imul(ah4,bl8)|0;hi=hi+Math.imul(ah4,bh8)|0;lo=lo+Math.imul(al3,bl9)|0;mid=mid+Math.imul(al3,bh9)|0;mid=mid+Math.imul(ah3,bl9)|0;hi=hi+Math.imul(ah3,bh9)|0;var w12=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w12>>>26)|0;w12&=67108863;lo=Math.imul(al9,bl4);mid=Math.imul(al9,bh4);mid=mid+Math.imul(ah9,bl4)|0;hi=Math.imul(ah9,bh4);lo=lo+Math.imul(al8,bl5)|0;mid=mid+Math.imul(al8,bh5)|0;mid=mid+Math.imul(ah8,bl5)|0;hi=hi+Math.imul(ah8,bh5)|0;lo=lo+Math.imul(al7,bl6)|0;mid=mid+Math.imul(al7,bh6)|0;mid=mid+Math.imul(ah7,bl6)|0;hi=hi+Math.imul(ah7,bh6)|0;lo=lo+Math.imul(al6,bl7)|0;mid=mid+Math.imul(al6,bh7)|0;mid=mid+Math.imul(ah6,bl7)|0;hi=hi+Math.imul(ah6,bh7)|0;lo=lo+Math.imul(al5,bl8)|0;mid=mid+Math.imul(al5,bh8)|0;mid=mid+Math.imul(ah5,bl8)|0;hi=hi+Math.imul(ah5,bh8)|0;lo=lo+Math.imul(al4,bl9)|0;mid=mid+Math.imul(al4,bh9)|0;mid=mid+Math.imul(ah4,bl9)|0;hi=hi+Math.imul(ah4,bh9)|0;var w13=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w13>>>26)|0;w13&=67108863;lo=Math.imul(al9,bl5);mid=Math.imul(al9,bh5);mid=mid+Math.imul(ah9,bl5)|0;hi=Math.imul(ah9,bh5);lo=lo+Math.imul(al8,bl6)|0;mid=mid+Math.imul(al8,bh6)|0;mid=mid+Math.imul(ah8,bl6)|0;hi=hi+Math.imul(ah8,bh6)|0;lo=lo+Math.imul(al7,bl7)|0;mid=mid+Math.imul(al7,bh7)|0;mid=mid+Math.imul(ah7,bl7)|0;hi=hi+Math.imul(ah7,bh7)|0;lo=lo+Math.imul(al6,bl8)|0;mid=mid+Math.imul(al6,bh8)|0;mid=mid+Math.imul(ah6,bl8)|0;hi=hi+Math.imul(ah6,bh8)|0;lo=lo+Math.imul(al5,bl9)|0;mid=mid+Math.imul(al5,bh9)|0;mid=mid+Math.imul(ah5,bl9)|0;hi=hi+Math.imul(ah5,bh9)|0;var w14=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w14>>>26)|0;w14&=67108863;lo=Math.imul(al9,bl6);mid=Math.imul(al9,bh6);mid=mid+Math.imul(ah9,bl6)|0;hi=Math.imul(ah9,bh6);lo=lo+Math.imul(al8,bl7)|0;mid=mid+Math.imul(al8,bh7)|0;mid=mid+Math.imul(ah8,bl7)|0;hi=hi+Math.imul(ah8,bh7)|0;lo=lo+Math.imul(al7,bl8)|0;mid=mid+Math.imul(al7,bh8)|0;mid=mid+Math.imul(ah7,bl8)|0;hi=hi+Math.imul(ah7,bh8)|0;lo=lo+Math.imul(al6,bl9)|0;mid=mid+Math.imul(al6,bh9)|0;mid=mid+Math.imul(ah6,bl9)|0;hi=hi+Math.imul(ah6,bh9)|0;var w15=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w15>>>26)|0;w15&=67108863;lo=Math.imul(al9,bl7);mid=Math.imul(al9,bh7);mid=mid+Math.imul(ah9,bl7)|0;hi=Math.imul(ah9,bh7);lo=lo+Math.imul(al8,bl8)|0;mid=mid+Math.imul(al8,bh8)|0;mid=mid+Math.imul(ah8,bl8)|0;hi=hi+Math.imul(ah8,bh8)|0;lo=lo+Math.imul(al7,bl9)|0;mid=mid+Math.imul(al7,bh9)|0;mid=mid+Math.imul(ah7,bl9)|0;hi=hi+Math.imul(ah7,bh9)|0;var w16=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w16>>>26)|0;w16&=67108863;lo=Math.imul(al9,bl8);mid=Math.imul(al9,bh8);mid=mid+Math.imul(ah9,bl8)|0;hi=Math.imul(ah9,bh8);lo=lo+Math.imul(al8,bl9)|0;mid=mid+Math.imul(al8,bh9)|0;mid=mid+Math.imul(ah8,bl9)|0;hi=hi+Math.imul(ah8,bh9)|0;var w17=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w17>>>26)|0;w17&=67108863;lo=Math.imul(al9,bl9);mid=Math.imul(al9,bh9);mid=mid+Math.imul(ah9,bl9)|0;hi=Math.imul(ah9,bh9);var w18=(c+lo|0)+((mid&8191)<<13)|0;c=(hi+(mid>>>13)|0)+(w18>>>26)|0;w18&=67108863;o[0]=w0;o[1]=w1;o[2]=w2;o[3]=w3;o[4]=w4;o[5]=w5;o[6]=w6;o[7]=w7;o[8]=w8;o[9]=w9;o[10]=w10;o[11]=w11;o[12]=w12;o[13]=w13;o[14]=w14;o[15]=w15;o[16]=w16;o[17]=w17;o[18]=w18;if(c!==0){o[19]=c;out.length++}return out};if(!Math.imul){comb10MulTo=smallMulTo}function bigMulTo(self,num,out){out.negative=num.negative^self.negative;out.length=self.length+num.length;var carry=0;var hncarry=0;for(var k=0;k<out.length-1;k++){var ncarry=hncarry;hncarry=0;var rword=carry&67108863;var maxJ=Math.min(k,num.length-1);for(var j=Math.max(0,k-self.length+1);j<=maxJ;j++){var i=k-j;var a=self.words[i]|0;var b=num.words[j]|0;var r=a*b;var lo=r&67108863;ncarry=ncarry+(r/67108864|0)|0;lo=lo+rword|0;rword=lo&67108863;ncarry=ncarry+(lo>>>26)|0;hncarry+=ncarry>>>26;ncarry&=67108863}out.words[k]=rword;carry=ncarry;ncarry=hncarry}if(carry!==0){out.words[k]=carry}else{out.length--}return out.strip()}function jumboMulTo(self,num,out){var fftm=new FFTM;return fftm.mulp(self,num,out)}BN.prototype.mulTo=function mulTo(num,out){var res;var len=this.length+num.length;if(this.length===10&&num.length===10){res=comb10MulTo(this,num,out)}else if(len<63){res=smallMulTo(this,num,out)}else if(len<1024){res=bigMulTo(this,num,out)}else{res=jumboMulTo(this,num,out)}return res};function FFTM(x,y){this.x=x;this.y=y}FFTM.prototype.makeRBT=function makeRBT(N){var t=new Array(N);var l=BN.prototype._countBits(N)-1;for(var i=0;i<N;i++){t[i]=this.revBin(i,l,N)}return t};FFTM.prototype.revBin=function revBin(x,l,N){if(x===0||x===N-1)return x;var rb=0;for(var i=0;i<l;i++){rb|=(x&1)<<l-i-1;x>>=1}return rb};FFTM.prototype.permute=function permute(rbt,rws,iws,rtws,itws,N){for(var i=0;i<N;i++){rtws[i]=rws[rbt[i]];itws[i]=iws[rbt[i]]}};FFTM.prototype.transform=function transform(rws,iws,rtws,itws,N,rbt){this.permute(rbt,rws,iws,rtws,itws,N);for(var s=1;s<N;s<<=1){var l=s<<1;var rtwdf=Math.cos(2*Math.PI/l);var itwdf=Math.sin(2*Math.PI/l);for(var p=0;p<N;p+=l){var rtwdf_=rtwdf;var itwdf_=itwdf;for(var j=0;j<s;j++){var re=rtws[p+j];var ie=itws[p+j];var ro=rtws[p+j+s];var io=itws[p+j+s];var rx=rtwdf_*ro-itwdf_*io;io=rtwdf_*io+itwdf_*ro;ro=rx;rtws[p+j]=re+ro;itws[p+j]=ie+io;rtws[p+j+s]=re-ro;itws[p+j+s]=ie-io;if(j!==l){rx=rtwdf*rtwdf_-itwdf*itwdf_;itwdf_=rtwdf*itwdf_+itwdf*rtwdf_;rtwdf_=rx}}}}};FFTM.prototype.guessLen13b=function guessLen13b(n,m){var N=Math.max(m,n)|1;var odd=N&1;var i=0;for(N=N/2|0;N;N=N>>>1){i++}return 1<<i+1+odd};FFTM.prototype.conjugate=function conjugate(rws,iws,N){if(N<=1)return;for(var i=0;i<N/2;i++){var t=rws[i];rws[i]=rws[N-i-1];rws[N-i-1]=t;t=iws[i];iws[i]=-iws[N-i-1];iws[N-i-1]=-t}};FFTM.prototype.normalize13b=function normalize13b(ws,N){var carry=0;for(var i=0;i<N/2;i++){var w=Math.round(ws[2*i+1]/N)*8192+Math.round(ws[2*i]/N)+carry;ws[i]=w&67108863;if(w<67108864){carry=0}else{carry=w/67108864|0}}return ws};FFTM.prototype.convert13b=function convert13b(ws,len,rws,N){var carry=0;for(var i=0;i<len;i++){carry=carry+(ws[i]|0);rws[2*i]=carry&8191;carry=carry>>>13;rws[2*i+1]=carry&8191;carry=carry>>>13}for(i=2*len;i<N;++i){rws[i]=0}assert(carry===0);assert((carry&~8191)===0)};FFTM.prototype.stub=function stub(N){var ph=new Array(N);for(var i=0;i<N;i++){ph[i]=0}return ph};FFTM.prototype.mulp=function mulp(x,y,out){var N=2*this.guessLen13b(x.length,y.length);var rbt=this.makeRBT(N);var _=this.stub(N);var rws=new Array(N);var rwst=new Array(N);var iwst=new Array(N);var nrws=new Array(N);var nrwst=new Array(N);var niwst=new Array(N);var rmws=out.words;rmws.length=N;this.convert13b(x.words,x.length,rws,N);this.convert13b(y.words,y.length,nrws,N);this.transform(rws,_,rwst,iwst,N,rbt);this.transform(nrws,_,nrwst,niwst,N,rbt);for(var i=0;i<N;i++){var rx=rwst[i]*nrwst[i]-iwst[i]*niwst[i];iwst[i]=rwst[i]*niwst[i]+iwst[i]*nrwst[i];rwst[i]=rx}this.conjugate(rwst,iwst,N);this.transform(rwst,iwst,rmws,_,N,rbt);this.conjugate(rmws,_,N);this.normalize13b(rmws,N);out.negative=x.negative^y.negative;out.length=x.length+y.length;return out.strip()};BN.prototype.mul=function mul(num){var out=new BN(null);out.words=new Array(this.length+num.length);return this.mulTo(num,out)};BN.prototype.mulf=function mulf(num){var out=new BN(null);out.words=new Array(this.length+num.length);return jumboMulTo(this,num,out)};BN.prototype.imul=function imul(num){return this.clone().mulTo(num,this)};BN.prototype.imuln=function imuln(num){assert(typeof num==="number");assert(num<67108864);var carry=0;for(var i=0;i<this.length;i++){var w=(this.words[i]|0)*num;var lo=(w&67108863)+(carry&67108863);carry>>=26;carry+=w/67108864|0;carry+=lo>>>26;this.words[i]=lo&67108863}if(carry!==0){this.words[i]=carry;this.length++}return this};BN.prototype.muln=function muln(num){return this.clone().imuln(num)};BN.prototype.sqr=function sqr(){return this.mul(this)};BN.prototype.isqr=function isqr(){return this.imul(this.clone())};BN.prototype.pow=function pow(num){var w=toBitArray(num);if(w.length===0)return new BN(1);var res=this;for(var i=0;i<w.length;i++,res=res.sqr()){if(w[i]!==0)break}if(++i<w.length){for(var q=res.sqr();i<w.length;i++,q=q.sqr()){if(w[i]===0)continue;res=res.mul(q)}}return res};BN.prototype.iushln=function iushln(bits){assert(typeof bits==="number"&&bits>=0);var r=bits%26;var s=(bits-r)/26;var carryMask=67108863>>>26-r<<26-r;var i;if(r!==0){var carry=0;for(i=0;i<this.length;i++){var newCarry=this.words[i]&carryMask;var c=(this.words[i]|0)-newCarry<<r;this.words[i]=c|carry;carry=newCarry>>>26-r}if(carry){this.words[i]=carry;this.length++}}if(s!==0){for(i=this.length-1;i>=0;i--){this.words[i+s]=this.words[i]}for(i=0;i<s;i++){this.words[i]=0}this.length+=s}return this.strip()};BN.prototype.ishln=function ishln(bits){assert(this.negative===0);return this.iushln(bits)};BN.prototype.iushrn=function iushrn(bits,hint,extended){assert(typeof bits==="number"&&bits>=0);var h;if(hint){h=(hint-hint%26)/26}else{h=0}var r=bits%26;var s=Math.min((bits-r)/26,this.length);var mask=67108863^67108863>>>r<<r;var maskedWords=extended;h-=s;h=Math.max(0,h);if(maskedWords){for(var i=0;i<s;i++){maskedWords.words[i]=this.words[i]}maskedWords.length=s}if(s===0){}else if(this.length>s){this.length-=s;for(i=0;i<this.length;i++){this.words[i]=this.words[i+s]}}else{this.words[0]=0;this.length=1}var carry=0;for(i=this.length-1;i>=0&&(carry!==0||i>=h);i--){var word=this.words[i]|0;this.words[i]=carry<<26-r|word>>>r;carry=word&mask}if(maskedWords&&carry!==0){maskedWords.words[maskedWords.length++]=carry}if(this.length===0){this.words[0]=0;this.length=1}return this.strip()};BN.prototype.ishrn=function ishrn(bits,hint,extended){assert(this.negative===0);return this.iushrn(bits,hint,extended)};BN.prototype.shln=function shln(bits){return this.clone().ishln(bits)};BN.prototype.ushln=function ushln(bits){return this.clone().iushln(bits)};BN.prototype.shrn=function shrn(bits){return this.clone().ishrn(bits)};BN.prototype.ushrn=function ushrn(bits){return this.clone().iushrn(bits)};BN.prototype.testn=function testn(bit){assert(typeof bit==="number"&&bit>=0);var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s)return false;var w=this.words[s];return!!(w&q)};BN.prototype.imaskn=function imaskn(bits){assert(typeof bits==="number"&&bits>=0);var r=bits%26;var s=(bits-r)/26;assert(this.negative===0,"imaskn works only with positive numbers");if(this.length<=s){return this}if(r!==0){s++}this.length=Math.min(s,this.length);if(r!==0){var mask=67108863^67108863>>>r<<r;this.words[this.length-1]&=mask}return this.strip()};BN.prototype.maskn=function maskn(bits){return this.clone().imaskn(bits)};BN.prototype.iaddn=function iaddn(num){assert(typeof num==="number");assert(num<67108864);if(num<0)return this.isubn(-num);if(this.negative!==0){if(this.length===1&&(this.words[0]|0)<num){this.words[0]=num-(this.words[0]|0);this.negative=0;return this}this.negative=0;this.isubn(num);this.negative=1;return this}return this._iaddn(num)};BN.prototype._iaddn=function _iaddn(num){this.words[0]+=num;for(var i=0;i<this.length&&this.words[i]>=67108864;i++){this.words[i]-=67108864;if(i===this.length-1){this.words[i+1]=1}else{this.words[i+1]++}}this.length=Math.max(this.length,i+1);return this};BN.prototype.isubn=function isubn(num){assert(typeof num==="number");assert(num<67108864);if(num<0)return this.iaddn(-num);if(this.negative!==0){this.negative=0;this.iaddn(num);this.negative=1;return this}this.words[0]-=num;if(this.length===1&&this.words[0]<0){this.words[0]=-this.words[0];this.negative=1}else{for(var i=0;i<this.length&&this.words[i]<0;i++){this.words[i]+=67108864;this.words[i+1]-=1}}return this.strip()};BN.prototype.addn=function addn(num){return this.clone().iaddn(num)};BN.prototype.subn=function subn(num){return this.clone().isubn(num)};BN.prototype.iabs=function iabs(){this.negative=0;return this};BN.prototype.abs=function abs(){return this.clone().iabs()};BN.prototype._ishlnsubmul=function _ishlnsubmul(num,mul,shift){var len=num.length+shift;var i;this._expand(len);var w;var carry=0;for(i=0;i<num.length;i++){w=(this.words[i+shift]|0)+carry;var right=(num.words[i]|0)*mul;w-=right&67108863;carry=(w>>26)-(right/67108864|0);this.words[i+shift]=w&67108863}for(;i<this.length-shift;i++){w=(this.words[i+shift]|0)+carry;carry=w>>26;this.words[i+shift]=w&67108863}if(carry===0)return this.strip();assert(carry===-1);carry=0;for(i=0;i<this.length;i++){w=-(this.words[i]|0)+carry;carry=w>>26;this.words[i]=w&67108863}this.negative=1;return this.strip()};BN.prototype._wordDiv=function _wordDiv(num,mode){var shift=this.length-num.length;var a=this.clone();var b=num;var bhi=b.words[b.length-1]|0;var bhiBits=this._countBits(bhi);shift=26-bhiBits;if(shift!==0){b=b.ushln(shift);a.iushln(shift);bhi=b.words[b.length-1]|0}var m=a.length-b.length;var q;if(mode!=="mod"){q=new BN(null);q.length=m+1;q.words=new Array(q.length);for(var i=0;i<q.length;i++){q.words[i]=0}}var diff=a.clone()._ishlnsubmul(b,1,m);if(diff.negative===0){a=diff;if(q){q.words[m]=1}}for(var j=m-1;j>=0;j--){var qj=(a.words[b.length+j]|0)*67108864+(a.words[b.length+j-1]|0);qj=Math.min(qj/bhi|0,67108863);a._ishlnsubmul(b,qj,j);while(a.negative!==0){qj--;a.negative=0;a._ishlnsubmul(b,1,j);if(!a.isZero()){a.negative^=1}}if(q){q.words[j]=qj}}if(q){q.strip()}a.strip();if(mode!=="div"&&shift!==0){a.iushrn(shift)}return{div:q||null,mod:a}};BN.prototype.divmod=function divmod(num,mode,positive){assert(!num.isZero());if(this.isZero()){return{div:new BN(0),mod:new BN(0)}}var div,mod,res;if(this.negative!==0&&num.negative===0){res=this.neg().divmod(num,mode);if(mode!=="mod"){div=res.div.neg()}if(mode!=="div"){mod=res.mod.neg();if(positive&&mod.negative!==0){mod.iadd(num)}}return{div:div,mod:mod}}if(this.negative===0&&num.negative!==0){res=this.divmod(num.neg(),mode);if(mode!=="mod"){div=res.div.neg()}return{div:div,mod:res.mod}}if((this.negative&num.negative)!==0){res=this.neg().divmod(num.neg(),mode);if(mode!=="div"){mod=res.mod.neg();if(positive&&mod.negative!==0){mod.isub(num)}}return{div:res.div,mod:mod}}if(num.length>this.length||this.cmp(num)<0){return{div:new BN(0),mod:this}}if(num.length===1){if(mode==="div"){return{div:this.divn(num.words[0]),mod:null}}if(mode==="mod"){return{div:null,mod:new BN(this.modn(num.words[0]))}}return{div:this.divn(num.words[0]),mod:new BN(this.modn(num.words[0]))}}return this._wordDiv(num,mode)};BN.prototype.div=function div(num){return this.divmod(num,"div",false).div};BN.prototype.mod=function mod(num){return this.divmod(num,"mod",false).mod};BN.prototype.umod=function umod(num){return this.divmod(num,"mod",true).mod};BN.prototype.divRound=function divRound(num){var dm=this.divmod(num);if(dm.mod.isZero())return dm.div;var mod=dm.div.negative!==0?dm.mod.isub(num):dm.mod;var half=num.ushrn(1);var r2=num.andln(1);var cmp=mod.cmp(half);if(cmp<0||r2===1&&cmp===0)return dm.div;return dm.div.negative!==0?dm.div.isubn(1):dm.div.iaddn(1)};BN.prototype.modn=function modn(num){assert(num<=67108863);var p=(1<<26)%num;var acc=0;for(var i=this.length-1;i>=0;i--){acc=(p*acc+(this.words[i]|0))%num}return acc};BN.prototype.idivn=function idivn(num){assert(num<=67108863);var carry=0;for(var i=this.length-1;i>=0;i--){var w=(this.words[i]|0)+carry*67108864;this.words[i]=w/num|0;carry=w%num}return this.strip()};BN.prototype.divn=function divn(num){return this.clone().idivn(num)};BN.prototype.egcd=function egcd(p){assert(p.negative===0);assert(!p.isZero());var x=this;var y=p.clone();if(x.negative!==0){x=x.umod(p)}else{x=x.clone()}var A=new BN(1);var B=new BN(0);var C=new BN(0);var D=new BN(1);

var g=0;while(x.isEven()&&y.isEven()){x.iushrn(1);y.iushrn(1);++g}var yp=y.clone();var xp=x.clone();while(!x.isZero()){for(var i=0,im=1;(x.words[0]&im)===0&&i<26;++i,im<<=1);if(i>0){x.iushrn(i);while(i-->0){if(A.isOdd()||B.isOdd()){A.iadd(yp);B.isub(xp)}A.iushrn(1);B.iushrn(1)}}for(var j=0,jm=1;(y.words[0]&jm)===0&&j<26;++j,jm<<=1);if(j>0){y.iushrn(j);while(j-->0){if(C.isOdd()||D.isOdd()){C.iadd(yp);D.isub(xp)}C.iushrn(1);D.iushrn(1)}}if(x.cmp(y)>=0){x.isub(y);A.isub(C);B.isub(D)}else{y.isub(x);C.isub(A);D.isub(B)}}return{a:C,b:D,gcd:y.iushln(g)}};BN.prototype._invmp=function _invmp(p){assert(p.negative===0);assert(!p.isZero());var a=this;var b=p.clone();if(a.negative!==0){a=a.umod(p)}else{a=a.clone()}var x1=new BN(1);var x2=new BN(0);var delta=b.clone();while(a.cmpn(1)>0&&b.cmpn(1)>0){for(var i=0,im=1;(a.words[0]&im)===0&&i<26;++i,im<<=1);if(i>0){a.iushrn(i);while(i-->0){if(x1.isOdd()){x1.iadd(delta)}x1.iushrn(1)}}for(var j=0,jm=1;(b.words[0]&jm)===0&&j<26;++j,jm<<=1);if(j>0){b.iushrn(j);while(j-->0){if(x2.isOdd()){x2.iadd(delta)}x2.iushrn(1)}}if(a.cmp(b)>=0){a.isub(b);x1.isub(x2)}else{b.isub(a);x2.isub(x1)}}var res;if(a.cmpn(1)===0){res=x1}else{res=x2}if(res.cmpn(0)<0){res.iadd(p)}return res};BN.prototype.gcd=function gcd(num){if(this.isZero())return num.abs();if(num.isZero())return this.abs();var a=this.clone();var b=num.clone();a.negative=0;b.negative=0;for(var shift=0;a.isEven()&&b.isEven();shift++){a.iushrn(1);b.iushrn(1)}do{while(a.isEven()){a.iushrn(1)}while(b.isEven()){b.iushrn(1)}var r=a.cmp(b);if(r<0){var t=a;a=b;b=t}else if(r===0||b.cmpn(1)===0){break}a.isub(b)}while(true);return b.iushln(shift)};BN.prototype.invm=function invm(num){return this.egcd(num).a.umod(num)};BN.prototype.isEven=function isEven(){return(this.words[0]&1)===0};BN.prototype.isOdd=function isOdd(){return(this.words[0]&1)===1};BN.prototype.andln=function andln(num){return this.words[0]&num};BN.prototype.bincn=function bincn(bit){assert(typeof bit==="number");var r=bit%26;var s=(bit-r)/26;var q=1<<r;if(this.length<=s){this._expand(s+1);this.words[s]|=q;return this}var carry=q;for(var i=s;carry!==0&&i<this.length;i++){var w=this.words[i]|0;w+=carry;carry=w>>>26;w&=67108863;this.words[i]=w}if(carry!==0){this.words[i]=carry;this.length++}return this};BN.prototype.isZero=function isZero(){return this.length===1&&this.words[0]===0};BN.prototype.cmpn=function cmpn(num){var negative=num<0;if(this.negative!==0&&!negative)return-1;if(this.negative===0&&negative)return 1;this.strip();var res;if(this.length>1){res=1}else{if(negative){num=-num}assert(num<=67108863,"Number is too big");var w=this.words[0]|0;res=w===num?0:w<num?-1:1}if(this.negative!==0)return-res|0;return res};BN.prototype.cmp=function cmp(num){if(this.negative!==0&&num.negative===0)return-1;if(this.negative===0&&num.negative!==0)return 1;var res=this.ucmp(num);if(this.negative!==0)return-res|0;return res};BN.prototype.ucmp=function ucmp(num){if(this.length>num.length)return 1;if(this.length<num.length)return-1;var res=0;for(var i=this.length-1;i>=0;i--){var a=this.words[i]|0;var b=num.words[i]|0;if(a===b)continue;if(a<b){res=-1}else if(a>b){res=1}break}return res};BN.prototype.gtn=function gtn(num){return this.cmpn(num)===1};BN.prototype.gt=function gt(num){return this.cmp(num)===1};BN.prototype.gten=function gten(num){return this.cmpn(num)>=0};BN.prototype.gte=function gte(num){return this.cmp(num)>=0};BN.prototype.ltn=function ltn(num){return this.cmpn(num)===-1};BN.prototype.lt=function lt(num){return this.cmp(num)===-1};BN.prototype.lten=function lten(num){return this.cmpn(num)<=0};BN.prototype.lte=function lte(num){return this.cmp(num)<=0};BN.prototype.eqn=function eqn(num){return this.cmpn(num)===0};BN.prototype.eq=function eq(num){return this.cmp(num)===0};BN.red=function red(num){return new Red(num)};BN.prototype.toRed=function toRed(ctx){assert(!this.red,"Already a number in reduction context");assert(this.negative===0,"red works only with positives");return ctx.convertTo(this)._forceRed(ctx)};BN.prototype.fromRed=function fromRed(){assert(this.red,"fromRed works only with numbers in reduction context");return this.red.convertFrom(this)};BN.prototype._forceRed=function _forceRed(ctx){this.red=ctx;return this};BN.prototype.forceRed=function forceRed(ctx){assert(!this.red,"Already a number in reduction context");return this._forceRed(ctx)};BN.prototype.redAdd=function redAdd(num){assert(this.red,"redAdd works only with red numbers");return this.red.add(this,num)};BN.prototype.redIAdd=function redIAdd(num){assert(this.red,"redIAdd works only with red numbers");return this.red.iadd(this,num)};BN.prototype.redSub=function redSub(num){assert(this.red,"redSub works only with red numbers");return this.red.sub(this,num)};BN.prototype.redISub=function redISub(num){assert(this.red,"redISub works only with red numbers");return this.red.isub(this,num)};BN.prototype.redShl=function redShl(num){assert(this.red,"redShl works only with red numbers");return this.red.shl(this,num)};BN.prototype.redMul=function redMul(num){assert(this.red,"redMul works only with red numbers");this.red._verify2(this,num);return this.red.mul(this,num)};BN.prototype.redIMul=function redIMul(num){assert(this.red,"redMul works only with red numbers");this.red._verify2(this,num);return this.red.imul(this,num)};BN.prototype.redSqr=function redSqr(){assert(this.red,"redSqr works only with red numbers");this.red._verify1(this);return this.red.sqr(this)};BN.prototype.redISqr=function redISqr(){assert(this.red,"redISqr works only with red numbers");this.red._verify1(this);return this.red.isqr(this)};BN.prototype.redSqrt=function redSqrt(){assert(this.red,"redSqrt works only with red numbers");this.red._verify1(this);return this.red.sqrt(this)};BN.prototype.redInvm=function redInvm(){assert(this.red,"redInvm works only with red numbers");this.red._verify1(this);return this.red.invm(this)};BN.prototype.redNeg=function redNeg(){assert(this.red,"redNeg works only with red numbers");this.red._verify1(this);return this.red.neg(this)};BN.prototype.redPow=function redPow(num){assert(this.red&&!num.red,"redPow(normalNum)");this.red._verify1(this);return this.red.pow(this,num)};var primes={k256:null,p224:null,p192:null,p25519:null};function MPrime(name,p){this.name=name;this.p=new BN(p,16);this.n=this.p.bitLength();this.k=new BN(1).iushln(this.n).isub(this.p);this.tmp=this._tmp()}MPrime.prototype._tmp=function _tmp(){var tmp=new BN(null);tmp.words=new Array(Math.ceil(this.n/13));return tmp};MPrime.prototype.ireduce=function ireduce(num){var r=num;var rlen;do{this.split(r,this.tmp);r=this.imulK(r);r=r.iadd(this.tmp);rlen=r.bitLength()}while(rlen>this.n);var cmp=rlen<this.n?-1:r.ucmp(this.p);if(cmp===0){r.words[0]=0;r.length=1}else if(cmp>0){r.isub(this.p)}else{r.strip()}return r};MPrime.prototype.split=function split(input,out){input.iushrn(this.n,0,out)};MPrime.prototype.imulK=function imulK(num){return num.imul(this.k)};function K256(){MPrime.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}inherits(K256,MPrime);K256.prototype.split=function split(input,output){var mask=4194303;var outLen=Math.min(input.length,9);for(var i=0;i<outLen;i++){output.words[i]=input.words[i]}output.length=outLen;if(input.length<=9){input.words[0]=0;input.length=1;return}var prev=input.words[9];output.words[output.length++]=prev&mask;for(i=10;i<input.length;i++){var next=input.words[i]|0;input.words[i-10]=(next&mask)<<4|prev>>>22;prev=next}prev>>>=22;input.words[i-10]=prev;if(prev===0&&input.length>10){input.length-=10}else{input.length-=9}};K256.prototype.imulK=function imulK(num){num.words[num.length]=0;num.words[num.length+1]=0;num.length+=2;var lo=0;for(var i=0;i<num.length;i++){var w=num.words[i]|0;lo+=w*977;num.words[i]=lo&67108863;lo=w*64+(lo/67108864|0)}if(num.words[num.length-1]===0){num.length--;if(num.words[num.length-1]===0){num.length--}}return num};function P224(){MPrime.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}inherits(P224,MPrime);function P192(){MPrime.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}inherits(P192,MPrime);function P25519(){MPrime.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}inherits(P25519,MPrime);P25519.prototype.imulK=function imulK(num){var carry=0;for(var i=0;i<num.length;i++){var hi=(num.words[i]|0)*19+carry;var lo=hi&67108863;hi>>>=26;num.words[i]=lo;carry=hi}if(carry!==0){num.words[num.length++]=carry}return num};BN._prime=function prime(name){if(primes[name])return primes[name];var prime;if(name==="k256"){prime=new K256}else if(name==="p224"){prime=new P224}else if(name==="p192"){prime=new P192}else if(name==="p25519"){prime=new P25519}else{throw new Error("Unknown prime "+name)}primes[name]=prime;return prime};function Red(m){if(typeof m==="string"){var prime=BN._prime(m);this.m=prime.p;this.prime=prime}else{assert(m.gtn(1),"modulus must be greater than 1");this.m=m;this.prime=null}}Red.prototype._verify1=function _verify1(a){assert(a.negative===0,"red works only with positives");assert(a.red,"red works only with red numbers")};Red.prototype._verify2=function _verify2(a,b){assert((a.negative|b.negative)===0,"red works only with positives");assert(a.red&&a.red===b.red,"red works only with red numbers")};Red.prototype.imod=function imod(a){if(this.prime)return this.prime.ireduce(a)._forceRed(this);return a.umod(this.m)._forceRed(this)};Red.prototype.neg=function neg(a){if(a.isZero()){return a.clone()}return this.m.sub(a)._forceRed(this)};Red.prototype.add=function add(a,b){this._verify2(a,b);var res=a.add(b);if(res.cmp(this.m)>=0){res.isub(this.m)}return res._forceRed(this)};Red.prototype.iadd=function iadd(a,b){this._verify2(a,b);var res=a.iadd(b);if(res.cmp(this.m)>=0){res.isub(this.m)}return res};Red.prototype.sub=function sub(a,b){this._verify2(a,b);var res=a.sub(b);if(res.cmpn(0)<0){res.iadd(this.m)}return res._forceRed(this)};Red.prototype.isub=function isub(a,b){this._verify2(a,b);var res=a.isub(b);if(res.cmpn(0)<0){res.iadd(this.m)}return res};Red.prototype.shl=function shl(a,num){this._verify1(a);return this.imod(a.ushln(num))};Red.prototype.imul=function imul(a,b){this._verify2(a,b);return this.imod(a.imul(b))};Red.prototype.mul=function mul(a,b){this._verify2(a,b);return this.imod(a.mul(b))};Red.prototype.isqr=function isqr(a){return this.imul(a,a.clone())};Red.prototype.sqr=function sqr(a){return this.mul(a,a)};Red.prototype.sqrt=function sqrt(a){if(a.isZero())return a.clone();var mod3=this.m.andln(3);assert(mod3%2===1);if(mod3===3){var pow=this.m.add(new BN(1)).iushrn(2);return this.pow(a,pow)}var q=this.m.subn(1);var s=0;while(!q.isZero()&&q.andln(1)===0){s++;q.iushrn(1)}assert(!q.isZero());var one=new BN(1).toRed(this);var nOne=one.redNeg();var lpow=this.m.subn(1).iushrn(1);var z=this.m.bitLength();z=new BN(2*z*z).toRed(this);while(this.pow(z,lpow).cmp(nOne)!==0){z.redIAdd(nOne)}var c=this.pow(z,q);var r=this.pow(a,q.addn(1).iushrn(1));var t=this.pow(a,q);var m=s;while(t.cmp(one)!==0){var tmp=t;for(var i=0;tmp.cmp(one)!==0;i++){tmp=tmp.redSqr()}assert(i<m);var b=this.pow(c,new BN(1).iushln(m-i-1));r=r.redMul(b);c=b.redSqr();t=t.redMul(c);m=i}return r};Red.prototype.invm=function invm(a){var inv=a._invmp(this.m);if(inv.negative!==0){inv.negative=0;return this.imod(inv).redNeg()}else{return this.imod(inv)}};Red.prototype.pow=function pow(a,num){if(num.isZero())return new BN(1);if(num.cmpn(1)===0)return a.clone();var windowSize=4;var wnd=new Array(1<<windowSize);wnd[0]=new BN(1).toRed(this);wnd[1]=a;for(var i=2;i<wnd.length;i++){wnd[i]=this.mul(wnd[i-1],a)}var res=wnd[0];var current=0;var currentLen=0;var start=num.bitLength()%26;if(start===0){start=26}for(i=num.length-1;i>=0;i--){var word=num.words[i];for(var j=start-1;j>=0;j--){var bit=word>>j&1;if(res!==wnd[0]){res=this.sqr(res)}if(bit===0&&current===0){currentLen=0;continue}current<<=1;current|=bit;currentLen++;if(currentLen!==windowSize&&(i!==0||j!==0))continue;res=this.mul(res,wnd[current]);currentLen=0;current=0}start=26}return res};Red.prototype.convertTo=function convertTo(num){var r=num.umod(this.m);return r===num?r.clone():r};Red.prototype.convertFrom=function convertFrom(num){var res=num.clone();res.red=null;return res};BN.mont=function mont(num){return new Mont(num)};function Mont(m){Red.call(this,m);this.shift=this.m.bitLength();if(this.shift%26!==0){this.shift+=26-this.shift%26}this.r=new BN(1).iushln(this.shift);this.r2=this.imod(this.r.sqr());this.rinv=this.r._invmp(this.m);this.minv=this.rinv.mul(this.r).isubn(1).div(this.m);this.minv=this.minv.umod(this.r);this.minv=this.r.sub(this.minv)}inherits(Mont,Red);Mont.prototype.convertTo=function convertTo(num){return this.imod(num.ushln(this.shift))};Mont.prototype.convertFrom=function convertFrom(num){var r=this.imod(num.mul(this.rinv));r.red=null;return r};Mont.prototype.imul=function imul(a,b){if(a.isZero()||b.isZero()){a.words[0]=0;a.length=1;return a}var t=a.imul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).iushrn(this.shift);var res=u;if(u.cmp(this.m)>=0){res=u.isub(this.m)}else if(u.cmpn(0)<0){res=u.iadd(this.m)}return res._forceRed(this)};Mont.prototype.mul=function mul(a,b){if(a.isZero()||b.isZero())return new BN(0)._forceRed(this);var t=a.mul(b);var c=t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);var u=t.isub(c).iushrn(this.shift);var res=u;if(u.cmp(this.m)>=0){res=u.isub(this.m)}else if(u.cmpn(0)<0){res=u.iadd(this.m)}return res._forceRed(this)};Mont.prototype.invm=function invm(a){var res=this.imod(a._invmp(this.m).mul(this.r2));return res._forceRed(this)}})(typeof module==="undefined"||module,this)},{}],219:[function(require,module,exports){var r;module.exports=function rand(len){if(!r)r=new Rand(null);return r.generate(len)};function Rand(rand){this.rand=rand}module.exports.Rand=Rand;Rand.prototype.generate=function generate(len){return this._rand(len)};if(typeof window==="object"){if(window.crypto&&window.crypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);window.crypto.getRandomValues(arr);return arr}}else if(window.msCrypto&&window.msCrypto.getRandomValues){Rand.prototype._rand=function _rand(n){var arr=new Uint8Array(n);window.msCrypto.getRandomValues(arr);return arr}}else{Rand.prototype._rand=function(){throw new Error("Not implemented yet")}}}else{try{var crypto=require("crypto");Rand.prototype._rand=function _rand(n){return crypto.randomBytes(n)}}catch(e){Rand.prototype._rand=function _rand(n){var res=new Uint8Array(n);for(var i=0;i<res.length;i++)res[i]=this.rand.getByte();return res}}}},{crypto:220}],220:[function(require,module,exports){},{}],221:[function(require,module,exports){(function(Buffer){var uint_max=Math.pow(2,32);function fixup_uint32(x){var ret,x_pos;ret=x>uint_max||x<0?(x_pos=Math.abs(x)%uint_max,x<0?uint_max-x_pos:x_pos):x;return ret}function scrub_vec(v){for(var i=0;i<v.length;v++){v[i]=0}return false}function Global(){this.SBOX=[];this.INV_SBOX=[];this.SUB_MIX=[[],[],[],[]];this.INV_SUB_MIX=[[],[],[],[]];this.init();this.RCON=[0,1,2,4,8,16,32,64,128,27,54]}Global.prototype.init=function(){var d,i,sx,t,x,x2,x4,x8,xi,_i;d=function(){var _i,_results;_results=[];for(i=_i=0;_i<256;i=++_i){if(i<128){_results.push(i<<1)}else{_results.push(i<<1^283)}}return _results}();x=0;xi=0;for(i=_i=0;_i<256;i=++_i){sx=xi^xi<<1^xi<<2^xi<<3^xi<<4;sx=sx>>>8^sx&255^99;this.SBOX[x]=sx;this.INV_SBOX[sx]=x;x2=d[x];x4=d[x2];x8=d[x4];t=d[sx]*257^sx*16843008;this.SUB_MIX[0][x]=t<<24|t>>>8;this.SUB_MIX[1][x]=t<<16|t>>>16;this.SUB_MIX[2][x]=t<<8|t>>>24;this.SUB_MIX[3][x]=t;t=x8*16843009^x4*65537^x2*257^x*16843008;this.INV_SUB_MIX[0][sx]=t<<24|t>>>8;this.INV_SUB_MIX[1][sx]=t<<16|t>>>16;this.INV_SUB_MIX[2][sx]=t<<8|t>>>24;this.INV_SUB_MIX[3][sx]=t;if(x===0){x=xi=1}else{x=x2^d[d[d[x8^x2]]];xi^=d[d[xi]]}}return true};var G=new Global;AES.blockSize=4*4;AES.prototype.blockSize=AES.blockSize;AES.keySize=256/8;AES.prototype.keySize=AES.keySize;function bufferToArray(buf){var len=buf.length/4;var out=new Array(len);var i=-1;while(++i<len){out[i]=buf.readUInt32BE(i*4)}return out}function AES(key){this._key=bufferToArray(key);this._doReset()}AES.prototype._doReset=function(){var invKsRow,keySize,keyWords,ksRow,ksRows,t;keyWords=this._key;keySize=keyWords.length;this._nRounds=keySize+6;ksRows=(this._nRounds+1)*4;this._keySchedule=[];for(ksRow=0;ksRow<ksRows;ksRow++){this._keySchedule[ksRow]=ksRow<keySize?keyWords[ksRow]:(t=this._keySchedule[ksRow-1],ksRow%keySize===0?(t=t<<8|t>>>24,t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[t&255],t^=G.RCON[ksRow/keySize|0]<<24):keySize>6&&ksRow%keySize===4?t=G.SBOX[t>>>24]<<24|G.SBOX[t>>>16&255]<<16|G.SBOX[t>>>8&255]<<8|G.SBOX[t&255]:void 0,this._keySchedule[ksRow-keySize]^t)}this._invKeySchedule=[];for(invKsRow=0;invKsRow<ksRows;invKsRow++){ksRow=ksRows-invKsRow;t=this._keySchedule[ksRow-(invKsRow%4?0:4)];this._invKeySchedule[invKsRow]=invKsRow<4||ksRow<=4?t:G.INV_SUB_MIX[0][G.SBOX[t>>>24]]^G.INV_SUB_MIX[1][G.SBOX[t>>>16&255]]^G.INV_SUB_MIX[2][G.SBOX[t>>>8&255]]^G.INV_SUB_MIX[3][G.SBOX[t&255]]}return true};AES.prototype.encryptBlock=function(M){M=bufferToArray(new Buffer(M));var out=this._doCryptBlock(M,this._keySchedule,G.SUB_MIX,G.SBOX);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[1],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[3],12);return buf};AES.prototype.decryptBlock=function(M){M=bufferToArray(new Buffer(M));var temp=[M[3],M[1]];M[1]=temp[0];M[3]=temp[1];var out=this._doCryptBlock(M,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[3],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[1],12);return buf};AES.prototype.scrub=function(){scrub_vec(this._keySchedule);scrub_vec(this._invKeySchedule);scrub_vec(this._key)};AES.prototype._doCryptBlock=function(M,keySchedule,SUB_MIX,SBOX){var ksRow,s0,s1,s2,s3,t0,t1,t2,t3;s0=M[0]^keySchedule[0];s1=M[1]^keySchedule[1];s2=M[2]^keySchedule[2];s3=M[3]^keySchedule[3];ksRow=4;for(var round=1;round<this._nRounds;round++){t0=SUB_MIX[0][s0>>>24]^SUB_MIX[1][s1>>>16&255]^SUB_MIX[2][s2>>>8&255]^SUB_MIX[3][s3&255]^keySchedule[ksRow++];t1=SUB_MIX[0][s1>>>24]^SUB_MIX[1][s2>>>16&255]^SUB_MIX[2][s3>>>8&255]^SUB_MIX[3][s0&255]^keySchedule[ksRow++];t2=SUB_MIX[0][s2>>>24]^SUB_MIX[1][s3>>>16&255]^SUB_MIX[2][s0>>>8&255]^SUB_MIX[3][s1&255]^keySchedule[ksRow++];t3=SUB_MIX[0][s3>>>24]^SUB_MIX[1][s0>>>16&255]^SUB_MIX[2][s1>>>8&255]^SUB_MIX[3][s2&255]^keySchedule[ksRow++];s0=t0;s1=t1;s2=t2;s3=t3}t0=(SBOX[s0>>>24]<<24|SBOX[s1>>>16&255]<<16|SBOX[s2>>>8&255]<<8|SBOX[s3&255])^keySchedule[ksRow++];t1=(SBOX[s1>>>24]<<24|SBOX[s2>>>16&255]<<16|SBOX[s3>>>8&255]<<8|SBOX[s0&255])^keySchedule[ksRow++];t2=(SBOX[s2>>>24]<<24|SBOX[s3>>>16&255]<<16|SBOX[s0>>>8&255]<<8|SBOX[s1&255])^keySchedule[ksRow++];t3=(SBOX[s3>>>24]<<24|SBOX[s0>>>16&255]<<16|SBOX[s1>>>8&255]<<8|SBOX[s2&255])^keySchedule[ksRow++];return[fixup_uint32(t0),fixup_uint32(t1),fixup_uint32(t2),fixup_uint32(t3)]};exports.AES=AES}).call(this,require("buffer").Buffer)},{buffer:247}],222:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("cipher-base");var inherits=require("inherits");var GHASH=require("./ghash");var xor=require("buffer-xor");inherits(StreamCipher,Transform);module.exports=StreamCipher;function StreamCipher(mode,key,iv,decrypt){if(!(this instanceof StreamCipher)){return new StreamCipher(mode,key,iv)}Transform.call(this);this._finID=Buffer.concat([iv,new Buffer([0,0,0,1])]);iv=Buffer.concat([iv,new Buffer([0,0,0,2])]);this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);this._cache=new Buffer("");this._secCache=new Buffer("");this._decrypt=decrypt;this._alen=0;this._len=0;iv.copy(this._prev);this._mode=mode;var h=new Buffer(4);h.fill(0);this._ghash=new GHASH(this._cipher.encryptBlock(h));this._authTag=null;this._called=false}StreamCipher.prototype._update=function(chunk){if(!this._called&&this._alen){var rump=16-this._alen%16;if(rump<16){rump=new Buffer(rump);rump.fill(0);this._ghash.update(rump)}}this._called=true;var out=this._mode.encrypt(this,chunk);if(this._decrypt){this._ghash.update(chunk)}else{this._ghash.update(out)}this._len+=chunk.length;return out};StreamCipher.prototype._final=function(){if(this._decrypt&&!this._authTag){throw new Error("Unsupported state or unable to authenticate data")}var tag=xor(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt){if(xorTest(tag,this._authTag)){throw new Error("Unsupported state or unable to authenticate data")}}else{this._authTag=tag}this._cipher.scrub()};StreamCipher.prototype.getAuthTag=function getAuthTag(){if(!this._decrypt&&Buffer.isBuffer(this._authTag)){return this._authTag}else{throw new Error("Attempting to get auth tag in unsupported state")}};StreamCipher.prototype.setAuthTag=function setAuthTag(tag){if(this._decrypt){this._authTag=tag}else{throw new Error("Attempting to set auth tag in unsupported state")}};StreamCipher.prototype.setAAD=function setAAD(buf){if(!this._called){this._ghash.update(buf);this._alen+=buf.length}else{throw new Error("Attempting to set AAD in unsupported state")}};function xorTest(a,b){var out=0;if(a.length!==b.length){out++}var len=Math.min(a.length,b.length);var i=-1;while(++i<len){out+=a[i]^b[i]}return out}}).call(this,require("buffer").Buffer)},{"./aes":221,"./ghash":226,buffer:247,"buffer-xor":246,"cipher-base":248,inherits:293}],223:[function(require,module,exports){var ciphers=require("./encrypter");exports.createCipher=exports.Cipher=ciphers.createCipher;exports.createCipheriv=exports.Cipheriv=ciphers.createCipheriv;var deciphers=require("./decrypter");exports.createDecipher=exports.Decipher=deciphers.createDecipher;exports.createDecipheriv=exports.Decipheriv=deciphers.createDecipheriv;var modes=require("./modes");function getCiphers(){return Object.keys(modes)}exports.listCiphers=exports.getCiphers=getCiphers},{"./decrypter":224,"./encrypter":225,"./modes":227}],224:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("cipher-base");var inherits=require("inherits");var modes=require("./modes");var StreamCipher=require("./streamCipher");var AuthCipher=require("./authCipher");var ebtk=require("evp_bytestokey");inherits(Decipher,Transform);function Decipher(mode,key,iv){if(!(this instanceof Decipher)){return new Decipher(mode,key,iv)}Transform.call(this);this._cache=new Splitter;this._last=void 0;this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);iv.copy(this._prev);this._mode=mode;this._autopadding=true}Decipher.prototype._update=function(data){this._cache.add(data);var chunk;var thing;var out=[];while(chunk=this._cache.get(this._autopadding)){thing=this._mode.decrypt(this,chunk);out.push(thing)}return Buffer.concat(out)};Decipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding){return unpad(this._mode.decrypt(this,chunk))}else if(chunk){throw new Error("data not multiple of block length")}};Decipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo;return this};function Splitter(){if(!(this instanceof Splitter)){return new Splitter}this.cache=new Buffer("")}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])};Splitter.prototype.get=function(autoPadding){var out;if(autoPadding){if(this.cache.length>16){out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}}else{if(this.cache.length>=16){out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}}return null};Splitter.prototype.flush=function(){if(this.cache.length){return this.cache}};function unpad(last){var padded=last[15];var i=-1;while(++i<padded){if(last[i+(16-padded)]!==padded){throw new Error("unable to decrypt data")}}if(padded===16){return}return last.slice(0,16-padded)}var modelist={ECB:require("./modes/ecb"),CBC:require("./modes/cbc"),CFB:require("./modes/cfb"),CFB8:require("./modes/cfb8"),CFB1:require("./modes/cfb1"),OFB:require("./modes/ofb"),CTR:require("./modes/ctr"),GCM:require("./modes/ctr")};function createDecipheriv(suite,password,iv){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}if(typeof iv==="string"){iv=new Buffer(iv)}if(typeof password==="string"){password=new Buffer(password)}if(password.length!==config.key/8){throw new TypeError("invalid key length "+password.length)}if(iv.length!==config.iv){throw new TypeError("invalid iv length "+iv.length)}if(config.type==="stream"){return new StreamCipher(modelist[config.mode],password,iv,true)}else if(config.type==="auth"){return new AuthCipher(modelist[config.mode],password,iv,true)}return new Decipher(modelist[config.mode],password,iv)}function createDecipher(suite,password){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}var keys=ebtk(password,false,config.key,config.iv);return createDecipheriv(suite,keys.key,keys.iv)}exports.createDecipher=createDecipher;exports.createDecipheriv=createDecipheriv}).call(this,require("buffer").Buffer)},{"./aes":221,"./authCipher":222,"./modes":227,"./modes/cbc":228,"./modes/cfb":229,"./modes/cfb1":230,"./modes/cfb8":231,"./modes/ctr":232,"./modes/ecb":233,"./modes/ofb":234,"./streamCipher":235,buffer:247,"cipher-base":248,evp_bytestokey:284,inherits:293}],225:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("cipher-base");var inherits=require("inherits");var modes=require("./modes");var ebtk=require("evp_bytestokey");var StreamCipher=require("./streamCipher");var AuthCipher=require("./authCipher");inherits(Cipher,Transform);function Cipher(mode,key,iv){if(!(this instanceof Cipher)){return new Cipher(mode,key,iv)}Transform.call(this);this._cache=new Splitter;this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);iv.copy(this._prev);this._mode=mode;this._autopadding=true}Cipher.prototype._update=function(data){this._cache.add(data);var chunk;var thing;var out=[];while(chunk=this._cache.get()){thing=this._mode.encrypt(this,chunk);out.push(thing)}return Buffer.concat(out)};Cipher.prototype._final=function(){var chunk=this._cache.flush();if(this._autopadding){chunk=this._mode.encrypt(this,chunk);this._cipher.scrub();return chunk}else if(chunk.toString("hex")!=="10101010101010101010101010101010"){this._cipher.scrub();throw new Error("data not multiple of block length")}};Cipher.prototype.setAutoPadding=function(setTo){this._autopadding=!!setTo;return this};function Splitter(){if(!(this instanceof Splitter)){return new Splitter}this.cache=new Buffer("")}Splitter.prototype.add=function(data){this.cache=Buffer.concat([this.cache,data])};Splitter.prototype.get=function(){if(this.cache.length>15){var out=this.cache.slice(0,16);this.cache=this.cache.slice(16);return out}return null};Splitter.prototype.flush=function(){var len=16-this.cache.length;var padBuff=new Buffer(len);var i=-1;while(++i<len){padBuff.writeUInt8(len,i)}var out=Buffer.concat([this.cache,padBuff]);return out};var modelist={ECB:require("./modes/ecb"),CBC:require("./modes/cbc"),CFB:require("./modes/cfb"),CFB8:require("./modes/cfb8"),CFB1:require("./modes/cfb1"),OFB:require("./modes/ofb"),CTR:require("./modes/ctr"),GCM:require("./modes/ctr")};function createCipheriv(suite,password,iv){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}if(typeof iv==="string"){iv=new Buffer(iv)}if(typeof password==="string"){password=new Buffer(password)}if(password.length!==config.key/8){throw new TypeError("invalid key length "+password.length)}if(iv.length!==config.iv){throw new TypeError("invalid iv length "+iv.length)}if(config.type==="stream"){return new StreamCipher(modelist[config.mode],password,iv)}else if(config.type==="auth"){return new AuthCipher(modelist[config.mode],password,iv)}return new Cipher(modelist[config.mode],password,iv)}function createCipher(suite,password){var config=modes[suite.toLowerCase()];if(!config){throw new TypeError("invalid suite type")}var keys=ebtk(password,false,config.key,config.iv);return createCipheriv(suite,keys.key,keys.iv)}exports.createCipheriv=createCipheriv;exports.createCipher=createCipher}).call(this,require("buffer").Buffer)},{"./aes":221,"./authCipher":222,"./modes":227,"./modes/cbc":228,"./modes/cfb":229,"./modes/cfb1":230,"./modes/cfb8":231,"./modes/ctr":232,"./modes/ecb":233,"./modes/ofb":234,"./streamCipher":235,buffer:247,"cipher-base":248,evp_bytestokey:284,inherits:293}],226:[function(require,module,exports){(function(Buffer){var zeros=new Buffer(16);zeros.fill(0);module.exports=GHASH;function GHASH(key){this.h=key;this.state=new Buffer(16);this.state.fill(0);this.cache=new Buffer("")}GHASH.prototype.ghash=function(block){var i=-1;while(++i<block.length){this.state[i]^=block[i]}this._multiply()};GHASH.prototype._multiply=function(){var Vi=toArray(this.h);var Zi=[0,0,0,0];var j,xi,lsb_Vi;var i=-1;while(++i<128){xi=(this.state[~~(i/8)]&1<<7-i%8)!==0;if(xi){Zi=xor(Zi,Vi)}lsb_Vi=(Vi[3]&1)!==0;for(j=3;j>0;j--){Vi[j]=Vi[j]>>>1|(Vi[j-1]&1)<<31}Vi[0]=Vi[0]>>>1;if(lsb_Vi){Vi[0]=Vi[0]^225<<24}}this.state=fromArray(Zi)};GHASH.prototype.update=function(buf){this.cache=Buffer.concat([this.cache,buf]);var chunk;while(this.cache.length>=16){chunk=this.cache.slice(0,16);this.cache=this.cache.slice(16);this.ghash(chunk)}};GHASH.prototype.final=function(abl,bl){if(this.cache.length){this.ghash(Buffer.concat([this.cache,zeros],16))}this.ghash(fromArray([0,abl,0,bl]));return this.state};function toArray(buf){return[buf.readUInt32BE(0),buf.readUInt32BE(4),buf.readUInt32BE(8),buf.readUInt32BE(12)]}function fromArray(out){out=out.map(fixup_uint32);var buf=new Buffer(16);buf.writeUInt32BE(out[0],0);buf.writeUInt32BE(out[1],4);buf.writeUInt32BE(out[2],8);buf.writeUInt32BE(out[3],12);return buf}var uint_max=Math.pow(2,32);function fixup_uint32(x){var ret,x_pos;ret=x>uint_max||x<0?(x_pos=Math.abs(x)%uint_max,x<0?uint_max-x_pos:x_pos):x;return ret}function xor(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}}).call(this,require("buffer").Buffer)},{buffer:247}],227:[function(require,module,exports){exports["aes-128-ecb"]={cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"};exports["aes-192-ecb"]={cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"};exports["aes-256-ecb"]={cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"};exports["aes-128-cbc"]={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"};exports["aes-192-cbc"]={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"};exports["aes-256-cbc"]={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"};exports["aes128"]=exports["aes-128-cbc"];exports["aes192"]=exports["aes-192-cbc"];exports["aes256"]=exports["aes-256-cbc"];exports["aes-128-cfb"]={cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"};exports["aes-192-cfb"]={cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"};exports["aes-256-cfb"]={cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"};exports["aes-128-cfb8"]={cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"};exports["aes-192-cfb8"]={cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"};exports["aes-256-cfb8"]={cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"};exports["aes-128-cfb1"]={cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"};exports["aes-192-cfb1"]={cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"};exports["aes-256-cfb1"]={cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"};exports["aes-128-ofb"]={cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"};exports["aes-192-ofb"]={cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"};exports["aes-256-ofb"]={cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"};exports["aes-128-ctr"]={cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"};exports["aes-192-ctr"]={cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"};exports["aes-256-ctr"]={cipher:"AES",key:256,iv:16,mode:"CTR",
type:"stream"};exports["aes-128-gcm"]={cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"};exports["aes-192-gcm"]={cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"};exports["aes-256-gcm"]={cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}},{}],228:[function(require,module,exports){var xor=require("buffer-xor");exports.encrypt=function(self,block){var data=xor(block,self._prev);self._prev=self._cipher.encryptBlock(data);return self._prev};exports.decrypt=function(self,block){var pad=self._prev;self._prev=block;var out=self._cipher.decryptBlock(block);return xor(out,pad)}},{"buffer-xor":246}],229:[function(require,module,exports){(function(Buffer){var xor=require("buffer-xor");exports.encrypt=function(self,data,decrypt){var out=new Buffer("");var len;while(data.length){if(self._cache.length===0){self._cache=self._cipher.encryptBlock(self._prev);self._prev=new Buffer("")}if(self._cache.length<=data.length){len=self._cache.length;out=Buffer.concat([out,encryptStart(self,data.slice(0,len),decrypt)]);data=data.slice(len)}else{out=Buffer.concat([out,encryptStart(self,data,decrypt)]);break}}return out};function encryptStart(self,data,decrypt){var len=data.length;var out=xor(data,self._cache);self._cache=self._cache.slice(len);self._prev=Buffer.concat([self._prev,decrypt?data:out]);return out}}).call(this,require("buffer").Buffer)},{buffer:247,"buffer-xor":246}],230:[function(require,module,exports){(function(Buffer){function encryptByte(self,byteParam,decrypt){var pad;var i=-1;var len=8;var out=0;var bit,value;while(++i<len){pad=self._cipher.encryptBlock(self._prev);bit=byteParam&1<<7-i?128:0;value=pad[0]^bit;out+=(value&128)>>i%8;self._prev=shiftIn(self._prev,decrypt?bit:value)}return out}exports.encrypt=function(self,chunk,decrypt){var len=chunk.length;var out=new Buffer(len);var i=-1;while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}return out};function shiftIn(buffer,value){var len=buffer.length;var i=-1;var out=new Buffer(buffer.length);buffer=Buffer.concat([buffer,new Buffer([value])]);while(++i<len){out[i]=buffer[i]<<1|buffer[i+1]>>7}return out}}).call(this,require("buffer").Buffer)},{buffer:247}],231:[function(require,module,exports){(function(Buffer){function encryptByte(self,byteParam,decrypt){var pad=self._cipher.encryptBlock(self._prev);var out=pad[0]^byteParam;self._prev=Buffer.concat([self._prev.slice(1),new Buffer([decrypt?byteParam:out])]);return out}exports.encrypt=function(self,chunk,decrypt){var len=chunk.length;var out=new Buffer(len);var i=-1;while(++i<len){out[i]=encryptByte(self,chunk[i],decrypt)}return out}}).call(this,require("buffer").Buffer)},{buffer:247}],232:[function(require,module,exports){(function(Buffer){var xor=require("buffer-xor");function incr32(iv){var len=iv.length;var item;while(len--){item=iv.readUInt8(len);if(item===255){iv.writeUInt8(0,len)}else{item++;iv.writeUInt8(item,len);break}}}function getBlock(self){var out=self._cipher.encryptBlock(self._prev);incr32(self._prev);return out}exports.encrypt=function(self,chunk){while(self._cache.length<chunk.length){self._cache=Buffer.concat([self._cache,getBlock(self)])}var pad=self._cache.slice(0,chunk.length);self._cache=self._cache.slice(chunk.length);return xor(chunk,pad)}}).call(this,require("buffer").Buffer)},{buffer:247,"buffer-xor":246}],233:[function(require,module,exports){exports.encrypt=function(self,block){return self._cipher.encryptBlock(block)};exports.decrypt=function(self,block){return self._cipher.decryptBlock(block)}},{}],234:[function(require,module,exports){(function(Buffer){var xor=require("buffer-xor");function getBlock(self){self._prev=self._cipher.encryptBlock(self._prev);return self._prev}exports.encrypt=function(self,chunk){while(self._cache.length<chunk.length){self._cache=Buffer.concat([self._cache,getBlock(self)])}var pad=self._cache.slice(0,chunk.length);self._cache=self._cache.slice(chunk.length);return xor(chunk,pad)}}).call(this,require("buffer").Buffer)},{buffer:247,"buffer-xor":246}],235:[function(require,module,exports){(function(Buffer){var aes=require("./aes");var Transform=require("cipher-base");var inherits=require("inherits");inherits(StreamCipher,Transform);module.exports=StreamCipher;function StreamCipher(mode,key,iv,decrypt){if(!(this instanceof StreamCipher)){return new StreamCipher(mode,key,iv)}Transform.call(this);this._cipher=new aes.AES(key);this._prev=new Buffer(iv.length);this._cache=new Buffer("");this._secCache=new Buffer("");this._decrypt=decrypt;iv.copy(this._prev);this._mode=mode}StreamCipher.prototype._update=function(chunk){return this._mode.encrypt(this,chunk,this._decrypt)};StreamCipher.prototype._final=function(){this._cipher.scrub()}}).call(this,require("buffer").Buffer)},{"./aes":221,buffer:247,"cipher-base":248,inherits:293}],236:[function(require,module,exports){var ebtk=require("evp_bytestokey");var aes=require("browserify-aes/browser");var DES=require("browserify-des");var desModes=require("browserify-des/modes");var aesModes=require("browserify-aes/modes");function createCipher(suite,password){var keyLen,ivLen;suite=suite.toLowerCase();if(aesModes[suite]){keyLen=aesModes[suite].key;ivLen=aesModes[suite].iv}else if(desModes[suite]){keyLen=desModes[suite].key*8;ivLen=desModes[suite].iv}else{throw new TypeError("invalid suite type")}var keys=ebtk(password,false,keyLen,ivLen);return createCipheriv(suite,keys.key,keys.iv)}function createDecipher(suite,password){var keyLen,ivLen;suite=suite.toLowerCase();if(aesModes[suite]){keyLen=aesModes[suite].key;ivLen=aesModes[suite].iv}else if(desModes[suite]){keyLen=desModes[suite].key*8;ivLen=desModes[suite].iv}else{throw new TypeError("invalid suite type")}var keys=ebtk(password,false,keyLen,ivLen);return createDecipheriv(suite,keys.key,keys.iv)}function createCipheriv(suite,key,iv){suite=suite.toLowerCase();if(aesModes[suite]){return aes.createCipheriv(suite,key,iv)}else if(desModes[suite]){return new DES({key:key,iv:iv,mode:suite})}else{throw new TypeError("invalid suite type")}}function createDecipheriv(suite,key,iv){suite=suite.toLowerCase();if(aesModes[suite]){return aes.createDecipheriv(suite,key,iv)}else if(desModes[suite]){return new DES({key:key,iv:iv,mode:suite,decrypt:true})}else{throw new TypeError("invalid suite type")}}exports.createCipher=exports.Cipher=createCipher;exports.createCipheriv=exports.Cipheriv=createCipheriv;exports.createDecipher=exports.Decipher=createDecipher;exports.createDecipheriv=exports.Decipheriv=createDecipheriv;function getCiphers(){return Object.keys(desModes).concat(aes.getCiphers())}exports.listCiphers=exports.getCiphers=getCiphers},{"browserify-aes/browser":223,"browserify-aes/modes":227,"browserify-des":237,"browserify-des/modes":238,evp_bytestokey:284}],237:[function(require,module,exports){(function(Buffer){var CipherBase=require("cipher-base");var des=require("des.js");var inherits=require("inherits");var modes={"des-ede3-cbc":des.CBC.instantiate(des.EDE),"des-ede3":des.EDE,"des-ede-cbc":des.CBC.instantiate(des.EDE),"des-ede":des.EDE,"des-cbc":des.CBC.instantiate(des.DES),"des-ecb":des.DES};modes.des=modes["des-cbc"];modes.des3=modes["des-ede3-cbc"];module.exports=DES;inherits(DES,CipherBase);function DES(opts){CipherBase.call(this);var modeName=opts.mode.toLowerCase();var mode=modes[modeName];var type;if(opts.decrypt){type="decrypt"}else{type="encrypt"}var key=opts.key;if(modeName==="des-ede"||modeName==="des-ede-cbc"){key=Buffer.concat([key,key.slice(0,8)])}var iv=opts.iv;this._des=mode.create({key:key,iv:iv,type:type})}DES.prototype._update=function(data){return new Buffer(this._des.update(data))};DES.prototype._final=function(){return new Buffer(this._des.final())}}).call(this,require("buffer").Buffer)},{buffer:247,"cipher-base":248,"des.js":256,inherits:293}],238:[function(require,module,exports){exports["des-ecb"]={key:8,iv:0};exports["des-cbc"]=exports.des={key:8,iv:8};exports["des-ede3-cbc"]=exports.des3={key:24,iv:8};exports["des-ede3"]={key:24,iv:0};exports["des-ede-cbc"]={key:16,iv:8};exports["des-ede"]={key:16,iv:0}},{}],239:[function(require,module,exports){(function(Buffer){var bn=require("bn.js");var randomBytes=require("randombytes");module.exports=crt;function blind(priv){var r=getr(priv);var blinder=r.toRed(bn.mont(priv.modulus)).redPow(new bn(priv.publicExponent)).fromRed();return{blinder:blinder,unblinder:r.invm(priv.modulus)}}function crt(msg,priv){var blinds=blind(priv);var len=priv.modulus.byteLength();var mod=bn.mont(priv.modulus);var blinded=new bn(msg).mul(blinds.blinder).umod(priv.modulus);var c1=blinded.toRed(bn.mont(priv.prime1));var c2=blinded.toRed(bn.mont(priv.prime2));var qinv=priv.coefficient;var p=priv.prime1;var q=priv.prime2;var m1=c1.redPow(priv.exponent1);var m2=c2.redPow(priv.exponent2);m1=m1.fromRed();m2=m2.fromRed();var h=m1.isub(m2).imul(qinv).umod(p);h.imul(q);m2.iadd(h);return new Buffer(m2.imul(blinds.unblinder).umod(priv.modulus).toArray(false,len))}crt.getr=getr;function getr(priv){var len=priv.modulus.byteLength();var r=new bn(randomBytes(len));while(r.cmp(priv.modulus)>=0||!r.umod(priv.prime1)||!r.umod(priv.prime2)){r=new bn(randomBytes(len))}return r}}).call(this,require("buffer").Buffer)},{"bn.js":218,buffer:247,randombytes:313}],240:[function(require,module,exports){(function(Buffer){"use strict";exports["RSA-SHA224"]=exports.sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:new Buffer("302d300d06096086480165030402040500041c","hex")};exports["RSA-SHA256"]=exports.sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:new Buffer("3031300d060960864801650304020105000420","hex")};exports["RSA-SHA384"]=exports.sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:new Buffer("3041300d060960864801650304020205000430","hex")};exports["RSA-SHA512"]=exports.sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:new Buffer("3051300d060960864801650304020305000440","hex")};exports["RSA-SHA1"]={sign:"rsa",hash:"sha1",id:new Buffer("3021300906052b0e03021a05000414","hex")};exports["ecdsa-with-SHA1"]={sign:"ecdsa",hash:"sha1",id:new Buffer("","hex")};exports.DSA=exports["DSA-SHA1"]=exports["DSA-SHA"]={sign:"dsa",hash:"sha1",id:new Buffer("","hex")};exports["DSA-SHA224"]=exports["DSA-WITH-SHA224"]={sign:"dsa",hash:"sha224",id:new Buffer("","hex")};exports["DSA-SHA256"]=exports["DSA-WITH-SHA256"]={sign:"dsa",hash:"sha256",id:new Buffer("","hex")};exports["DSA-SHA384"]=exports["DSA-WITH-SHA384"]={sign:"dsa",hash:"sha384",id:new Buffer("","hex")};exports["DSA-SHA512"]=exports["DSA-WITH-SHA512"]={sign:"dsa",hash:"sha512",id:new Buffer("","hex")};exports["DSA-RIPEMD160"]={sign:"dsa",hash:"rmd160",id:new Buffer("","hex")};exports["RSA-RIPEMD160"]=exports.ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:new Buffer("3021300906052b2403020105000414","hex")};exports["RSA-MD5"]=exports.md5WithRSAEncryption={sign:"rsa",hash:"md5",id:new Buffer("3020300c06082a864886f70d020505000410","hex")}}).call(this,require("buffer").Buffer)},{buffer:247}],241:[function(require,module,exports){(function(Buffer){var _algos=require("./algos");var createHash=require("create-hash");var inherits=require("inherits");var sign=require("./sign");var stream=require("stream");var verify=require("./verify");var algos={};Object.keys(_algos).forEach(function(key){algos[key]=algos[key.toLowerCase()]=_algos[key]});function Sign(algorithm){stream.Writable.call(this);var data=algos[algorithm];if(!data){throw new Error("Unknown message digest")}this._hashType=data.hash;this._hash=createHash(data.hash);this._tag=data.id;this._signType=data.sign}inherits(Sign,stream.Writable);Sign.prototype._write=function _write(data,_,done){this._hash.update(data);done()};Sign.prototype.update=function update(data,enc){if(typeof data==="string"){data=new Buffer(data,enc)}this._hash.update(data);return this};Sign.prototype.sign=function signMethod(key,enc){this.end();var hash=this._hash.digest();var sig=sign(Buffer.concat([this._tag,hash]),key,this._hashType,this._signType);return enc?sig.toString(enc):sig};function Verify(algorithm){stream.Writable.call(this);var data=algos[algorithm];if(!data){throw new Error("Unknown message digest")}this._hash=createHash(data.hash);this._tag=data.id;this._signType=data.sign}inherits(Verify,stream.Writable);Verify.prototype._write=function _write(data,_,done){this._hash.update(data);done()};Verify.prototype.update=function update(data,enc){if(typeof data==="string"){data=new Buffer(data,enc)}this._hash.update(data);return this};Verify.prototype.verify=function verifyMethod(key,sig,enc){if(typeof sig==="string"){sig=new Buffer(sig,enc)}this.end();var hash=this._hash.digest();return verify(sig,Buffer.concat([this._tag,hash]),key,this._signType)};function createSign(algorithm){return new Sign(algorithm)}function createVerify(algorithm){return new Verify(algorithm)}module.exports={Sign:createSign,Verify:createVerify,createSign:createSign,createVerify:createVerify}}).call(this,require("buffer").Buffer)},{"./algos":240,"./sign":243,"./verify":244,buffer:247,"create-hash":251,inherits:293,stream:334}],242:[function(require,module,exports){"use strict";exports["1.3.132.0.10"]="secp256k1";exports["1.3.132.0.33"]="p224";exports["1.2.840.10045.3.1.1"]="p192";exports["1.2.840.10045.3.1.7"]="p256";exports["1.3.132.0.34"]="p384";exports["1.3.132.0.35"]="p521"},{}],243:[function(require,module,exports){(function(Buffer){var createHmac=require("create-hmac");var crt=require("browserify-rsa");var curves=require("./curves");var elliptic=require("elliptic");var parseKeys=require("parse-asn1");var BN=require("bn.js");var EC=elliptic.ec;function sign(hash,key,hashType,signType){var priv=parseKeys(key);if(priv.curve){if(signType!=="ecdsa")throw new Error("wrong private key type");return ecSign(hash,priv)}else if(priv.type==="dsa"){if(signType!=="dsa"){throw new Error("wrong private key type")}return dsaSign(hash,priv,hashType)}else{if(signType!=="rsa")throw new Error("wrong private key type")}var len=priv.modulus.byteLength();var pad=[0,1];while(hash.length+pad.length+1<len){pad.push(255)}pad.push(0);var i=-1;while(++i<hash.length){pad.push(hash[i])}var out=crt(pad,priv);return out}function ecSign(hash,priv){var curveId=curves[priv.curve.join(".")];if(!curveId)throw new Error("unknown curve "+priv.curve.join("."));var curve=new EC(curveId);var key=curve.genKeyPair();key._importPrivate(priv.privateKey);var out=key.sign(hash);return new Buffer(out.toDER())}function dsaSign(hash,priv,algo){var x=priv.params.priv_key;var p=priv.params.p;var q=priv.params.q;var g=priv.params.g;var r=new BN(0);var k;var H=bits2int(hash,q).mod(q);var s=false;var kv=getKey(x,q,hash,algo);while(s===false){k=makeKey(q,kv,algo);r=makeR(g,k,p,q);s=k.invm(q).imul(H.add(x.mul(r))).mod(q);if(!s.cmpn(0)){s=false;r=new BN(0)}}return toDER(r,s)}function toDER(r,s){r=r.toArray();s=s.toArray();if(r[0]&128){r=[0].concat(r)}if(s[0]&128){s=[0].concat(s)}var total=r.length+s.length+4;var res=[48,total,2,r.length];res=res.concat(r,[2,s.length],s);return new Buffer(res)}function getKey(x,q,hash,algo){x=new Buffer(x.toArray());if(x.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-x.length);zeros.fill(0);x=Buffer.concat([zeros,x])}var hlen=hash.length;var hbits=bits2octets(hash,q);var v=new Buffer(hlen);v.fill(1);var k=new Buffer(hlen);k.fill(0);k=createHmac(algo,k).update(v).update(new Buffer([0])).update(x).update(hbits).digest();v=createHmac(algo,k).update(v).digest();k=createHmac(algo,k).update(v).update(new Buffer([1])).update(x).update(hbits).digest();v=createHmac(algo,k).update(v).digest();return{k:k,v:v}}function bits2int(obits,q){var bits=new BN(obits);var shift=(obits.length<<3)-q.bitLength();if(shift>0){bits.ishrn(shift)}return bits}function bits2octets(bits,q){bits=bits2int(bits,q);bits=bits.mod(q);var out=new Buffer(bits.toArray());if(out.length<q.byteLength()){var zeros=new Buffer(q.byteLength()-out.length);zeros.fill(0);out=Buffer.concat([zeros,out])}return out}function makeKey(q,kv,algo){var t,k;do{t=new Buffer("");while(t.length*8<q.bitLength()){kv.v=createHmac(algo,kv.k).update(kv.v).digest();t=Buffer.concat([t,kv.v])}k=bits2int(t,q);kv.k=createHmac(algo,kv.k).update(kv.v).update(new Buffer([0])).digest();kv.v=createHmac(algo,kv.k).update(kv.v).digest()}while(k.cmp(q)!==-1);return k}function makeR(g,k,p,q){return g.toRed(BN.mont(p)).redPow(k).fromRed().mod(q)}module.exports=sign;module.exports.getKey=getKey;module.exports.makeKey=makeKey}).call(this,require("buffer").Buffer)},{"./curves":242,"bn.js":218,"browserify-rsa":239,buffer:247,"create-hmac":254,elliptic:266,"parse-asn1":301}],244:[function(require,module,exports){(function(Buffer){var curves=require("./curves");var elliptic=require("elliptic");var parseKeys=require("parse-asn1");var BN=require("bn.js");var EC=elliptic.ec;function verify(sig,hash,key,signType){var pub=parseKeys(key);if(pub.type==="ec"){if(signType!=="ecdsa"){throw new Error("wrong public key type")}return ecVerify(sig,hash,pub)}else if(pub.type==="dsa"){if(signType!=="dsa"){throw new Error("wrong public key type")}return dsaVerify(sig,hash,pub)}else{if(signType!=="rsa"){throw new Error("wrong public key type")}}var len=pub.modulus.byteLength();var pad=[1];var padNum=0;while(hash.length+pad.length+2<len){pad.push(255);padNum++}pad.push(0);var i=-1;while(++i<hash.length){pad.push(hash[i])}pad=new Buffer(pad);var red=BN.mont(pub.modulus);sig=new BN(sig).toRed(red);sig=sig.redPow(new BN(pub.publicExponent));sig=new Buffer(sig.fromRed().toArray());var out=0;if(padNum<8){out=1}len=Math.min(sig.length,pad.length);if(sig.length!==pad.length){out=1}i=-1;while(++i<len){out|=sig[i]^pad[i]}return out===0}function ecVerify(sig,hash,pub){var curveId=curves[pub.data.algorithm.curve.join(".")];if(!curveId)throw new Error("unknown curve "+pub.data.algorithm.curve.join("."));var curve=new EC(curveId);var pubkey=pub.data.subjectPrivateKey.data;return curve.verify(hash,sig,pubkey)}function dsaVerify(sig,hash,pub){var p=pub.data.p;var q=pub.data.q;var g=pub.data.g;var y=pub.data.pub_key;var unpacked=parseKeys.signature.decode(sig,"der");var s=unpacked.s;var r=unpacked.r;checkValue(s,q);checkValue(r,q);var montp=BN.mont(p);var w=s.invm(q);var v=g.toRed(montp).redPow(new BN(hash).mul(w).mod(q)).fromRed().mul(y.toRed(montp).redPow(r.mul(w).mod(q)).fromRed()).mod(p).mod(q);return!v.cmp(r)}function checkValue(b,q){if(b.cmpn(0)<=0){throw new Error("invalid sig")}if(b.cmp(q)>=q){throw new Error("invalid sig")}}module.exports=verify}).call(this,require("buffer").Buffer)},{"./curves":242,"bn.js":218,buffer:247,elliptic:266,"parse-asn1":301}],245:[function(require,module,exports){(function(global){"use strict";var buffer=require("buffer");var Buffer=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports.alloc=function alloc(size,fill,encoding){if(typeof Buffer.alloc==="function"){return Buffer.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===undefined){enc=undefined;_fill=0}var buf=new Buffer(size);if(typeof _fill==="string"){var fillBuf=new Buffer(_fill,enc);var flen=fillBuf.length;var i=-1;while(++i<size){buf[i]=fillBuf[i%flen]}}else{buf.fill(_fill)}return buf};exports.allocUnsafe=function allocUnsafe(size){if(typeof Buffer.allocUnsafe==="function"){return Buffer.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer(size)};exports.from=function from(value,encodingOrOffset,length){if(typeof Buffer.from==="function"&&(!global.Uint8Array||Uint8Array.from!==Buffer.from)){return Buffer.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof value==="string"){return new Buffer(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("'offset' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("'length' is out of bounds")}return new Buffer(value.slice(offset,offset+len))}if(Buffer.isBuffer(value)){var out=new Buffer(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer(value.data)}}throw new TypeError("First argument must be a string, Buffer, "+"ArrayBuffer, Array, or array-like object.")};exports.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer.allocUnsafeSlow==="function"){return Buffer.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{buffer:247}],246:[function(require,module,exports){(function(Buffer){module.exports=function xor(a,b){var length=Math.min(a.length,b.length);var buffer=new Buffer(length);for(var i=0;i<length;++i){buffer[i]=a[i]^b[i]}return buffer}}).call(this,require("buffer").Buffer)},{buffer:247}],247:[function(require,module,exports){(function(global){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){
val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":217,ieee754:291,isarray:295}],248:[function(require,module,exports){(function(Buffer){var Transform=require("stream").Transform;var inherits=require("inherits");var StringDecoder=require("string_decoder").StringDecoder;module.exports=CipherBase;inherits(CipherBase,Transform);function CipherBase(hashMode){Transform.call(this);this.hashMode=typeof hashMode==="string";if(this.hashMode){this[hashMode]=this._finalOrDigest}else{this.final=this._finalOrDigest}this._decoder=null;this._encoding=null}CipherBase.prototype.update=function(data,inputEnc,outputEnc){if(typeof data==="string"){data=new Buffer(data,inputEnc)}var outData=this._update(data);if(this.hashMode){return this}if(outputEnc){outData=this._toString(outData,outputEnc)}return outData};CipherBase.prototype.setAutoPadding=function(){};CipherBase.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")};CipherBase.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")};CipherBase.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")};CipherBase.prototype._transform=function(data,_,next){var err;try{if(this.hashMode){this._update(data)}else{this.push(this._update(data))}}catch(e){err=e}finally{next(err)}};CipherBase.prototype._flush=function(done){var err;try{this.push(this._final())}catch(e){err=e}finally{done(err)}};CipherBase.prototype._finalOrDigest=function(outputEnc){var outData=this._final()||new Buffer("");if(outputEnc){outData=this._toString(outData,outputEnc,true)}return outData};CipherBase.prototype._toString=function(value,enc,fin){if(!this._decoder){this._decoder=new StringDecoder(enc);this._encoding=enc}if(this._encoding!==enc){throw new Error("can't switch encodings")}var out=this._decoder.write(value);if(fin){out+=this._decoder.end()}return out}}).call(this,require("buffer").Buffer)},{buffer:247,inherits:293,stream:334,string_decoder:335}],249:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":294}],250:[function(require,module,exports){(function(Buffer){var elliptic=require("elliptic");var BN=require("bn.js");module.exports=function createECDH(curve){return new ECDH(curve)};var aliases={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};aliases.p224=aliases.secp224r1;aliases.p256=aliases.secp256r1=aliases.prime256v1;aliases.p192=aliases.secp192r1=aliases.prime192v1;aliases.p384=aliases.secp384r1;aliases.p521=aliases.secp521r1;function ECDH(curve){this.curveType=aliases[curve];if(!this.curveType){this.curveType={name:curve}}this.curve=new elliptic.ec(this.curveType.name);this.keys=void 0}ECDH.prototype.generateKeys=function(enc,format){this.keys=this.curve.genKeyPair();return this.getPublicKey(enc,format)};ECDH.prototype.computeSecret=function(other,inenc,enc){inenc=inenc||"utf8";if(!Buffer.isBuffer(other)){other=new Buffer(other,inenc)}var otherPub=this.curve.keyFromPublic(other).getPublic();var out=otherPub.mul(this.keys.getPrivate()).getX();return formatReturnValue(out,enc,this.curveType.byteLength)};ECDH.prototype.getPublicKey=function(enc,format){var key=this.keys.getPublic(format==="compressed",true);if(format==="hybrid"){if(key[key.length-1]%2){key[0]=7}else{key[0]=6}}return formatReturnValue(key,enc)};ECDH.prototype.getPrivateKey=function(enc){return formatReturnValue(this.keys.getPrivate(),enc)};ECDH.prototype.setPublicKey=function(pub,enc){enc=enc||"utf8";if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}this.keys._importPublic(pub);return this};ECDH.prototype.setPrivateKey=function(priv,enc){enc=enc||"utf8";if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}var _priv=new BN(priv);_priv=_priv.toString(16);this.keys._importPrivate(_priv);return this};function formatReturnValue(bn,enc,len){if(!Array.isArray(bn)){bn=bn.toArray()}var buf=new Buffer(bn);if(len&&buf.length<len){var zeros=new Buffer(len-buf.length);zeros.fill(0);buf=Buffer.concat([zeros,buf])}if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"bn.js":218,buffer:247,elliptic:266}],251:[function(require,module,exports){(function(Buffer){"use strict";var inherits=require("inherits");var md5=require("./md5");var rmd160=require("ripemd160");var sha=require("sha.js");var Base=require("cipher-base");function HashNoConstructor(hash){Base.call(this,"digest");this._hash=hash;this.buffers=[]}inherits(HashNoConstructor,Base);HashNoConstructor.prototype._update=function(data){this.buffers.push(data)};HashNoConstructor.prototype._final=function(){var buf=Buffer.concat(this.buffers);var r=this._hash(buf);this.buffers=null;return r};function Hash(hash){Base.call(this,"digest");this._hash=hash}inherits(Hash,Base);Hash.prototype._update=function(data){this._hash.update(data)};Hash.prototype._final=function(){return this._hash.digest()};module.exports=function createHash(alg){alg=alg.toLowerCase();if("md5"===alg)return new HashNoConstructor(md5);if("rmd160"===alg||"ripemd160"===alg)return new HashNoConstructor(rmd160);return new Hash(sha(alg))}}).call(this,require("buffer").Buffer)},{"./md5":253,buffer:247,"cipher-base":248,inherits:293,ripemd160:325,"sha.js":327}],252:[function(require,module,exports){(function(Buffer){"use strict";var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}exports.hash=hash}).call(this,require("buffer").Buffer)},{buffer:247}],253:[function(require,module,exports){"use strict";var helpers=require("./helpers");function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);

b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":252}],254:[function(require,module,exports){(function(Buffer){"use strict";var createHash=require("create-hash/browser");var inherits=require("inherits");var Transform=require("stream").Transform;var ZEROS=new Buffer(128);ZEROS.fill(0);function Hmac(alg,key){Transform.call(this);alg=alg.toLowerCase();if(typeof key==="string"){key=new Buffer(key)}var blocksize=alg==="sha512"||alg==="sha384"?128:64;this._alg=alg;this._key=key;if(key.length>blocksize){key=createHash(alg).update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}var ipad=this._ipad=new Buffer(blocksize);var opad=this._opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}this._hash=createHash(alg).update(ipad)}inherits(Hmac,Transform);Hmac.prototype.update=function(data,enc){this._hash.update(data,enc);return this};Hmac.prototype._transform=function(data,_,next){this._hash.update(data);next()};Hmac.prototype._flush=function(next){this.push(this.digest());next()};Hmac.prototype.digest=function(enc){var h=this._hash.digest();return createHash(this._alg).update(this._opad).update(h).digest(enc)};module.exports=function createHmac(alg,key){return new Hmac(alg,key)}}).call(this,require("buffer").Buffer)},{buffer:247,"create-hash/browser":251,inherits:293,stream:334}],255:[function(require,module,exports){"use strict";exports.randomBytes=exports.rng=exports.pseudoRandomBytes=exports.prng=require("randombytes");exports.createHash=exports.Hash=require("create-hash");exports.createHmac=exports.Hmac=require("create-hmac");var hashes=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(Object.keys(require("browserify-sign/algos")));exports.getHashes=function(){return hashes};var p=require("pbkdf2");exports.pbkdf2=p.pbkdf2;exports.pbkdf2Sync=p.pbkdf2Sync;var aes=require("browserify-cipher");["Cipher","createCipher","Cipheriv","createCipheriv","Decipher","createDecipher","Decipheriv","createDecipheriv","getCiphers","listCiphers"].forEach(function(key){exports[key]=aes[key]});var dh=require("diffie-hellman");["DiffieHellmanGroup","createDiffieHellmanGroup","getDiffieHellman","createDiffieHellman","DiffieHellman"].forEach(function(key){exports[key]=dh[key]});var sign=require("browserify-sign");["createSign","Sign","createVerify","Verify"].forEach(function(key){exports[key]=sign[key]});exports.createECDH=require("create-ecdh");var publicEncrypt=require("public-encrypt");["publicEncrypt","privateEncrypt","publicDecrypt","privateDecrypt"].forEach(function(key){exports[key]=publicEncrypt[key]});["createCredentials"].forEach(function(name){exports[name]=function(){throw new Error(["sorry, "+name+" is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))}})},{"browserify-cipher":236,"browserify-sign":241,"browserify-sign/algos":240,"create-ecdh":250,"create-hash":251,"create-hmac":254,"diffie-hellman":262,pbkdf2:303,"public-encrypt":307,randombytes:313}],256:[function(require,module,exports){"use strict";exports.utils=require("./des/utils");exports.Cipher=require("./des/cipher");exports.DES=require("./des/des");exports.CBC=require("./des/cbc");exports.EDE=require("./des/ede")},{"./des/cbc":257,"./des/cipher":258,"./des/des":259,"./des/ede":260,"./des/utils":261}],257:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert");var inherits=require("inherits");var proto={};function CBCState(iv){assert.equal(iv.length,8,"Invalid IV length");this.iv=new Array(8);for(var i=0;i<this.iv.length;i++)this.iv[i]=iv[i]}function instantiate(Base){function CBC(options){Base.call(this,options);this._cbcInit()}inherits(CBC,Base);var keys=Object.keys(proto);for(var i=0;i<keys.length;i++){var key=keys[i];CBC.prototype[key]=proto[key]}CBC.create=function create(options){return new CBC(options)};return CBC}exports.instantiate=instantiate;proto._cbcInit=function _cbcInit(){var state=new CBCState(this.options.iv);this._cbcState=state};proto._update=function _update(inp,inOff,out,outOff){var state=this._cbcState;var superProto=this.constructor.super_.prototype;var iv=state.iv;if(this.type==="encrypt"){for(var i=0;i<this.blockSize;i++)iv[i]^=inp[inOff+i];superProto._update.call(this,iv,0,out,outOff);for(var i=0;i<this.blockSize;i++)iv[i]=out[outOff+i]}else{superProto._update.call(this,inp,inOff,out,outOff);for(var i=0;i<this.blockSize;i++)out[outOff+i]^=iv[i];for(var i=0;i<this.blockSize;i++)iv[i]=inp[inOff+i]}}},{inherits:293,"minimalistic-assert":297}],258:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert");function Cipher(options){this.options=options;this.type=this.options.type;this.blockSize=8;this._init();this.buffer=new Array(this.blockSize);this.bufferOff=0}module.exports=Cipher;Cipher.prototype._init=function _init(){};Cipher.prototype.update=function update(data){if(data.length===0)return[];if(this.type==="decrypt")return this._updateDecrypt(data);else return this._updateEncrypt(data)};Cipher.prototype._buffer=function _buffer(data,off){var min=Math.min(this.buffer.length-this.bufferOff,data.length-off);for(var i=0;i<min;i++)this.buffer[this.bufferOff+i]=data[off+i];this.bufferOff+=min;return min};Cipher.prototype._flushBuffer=function _flushBuffer(out,off){this._update(this.buffer,0,out,off);this.bufferOff=0;return this.blockSize};Cipher.prototype._updateEncrypt=function _updateEncrypt(data){var inputOff=0;var outputOff=0;var count=(this.bufferOff+data.length)/this.blockSize|0;var out=new Array(count*this.blockSize);if(this.bufferOff!==0){inputOff+=this._buffer(data,inputOff);if(this.bufferOff===this.buffer.length)outputOff+=this._flushBuffer(out,outputOff)}var max=data.length-(data.length-inputOff)%this.blockSize;for(;inputOff<max;inputOff+=this.blockSize){this._update(data,inputOff,out,outputOff);outputOff+=this.blockSize}for(;inputOff<data.length;inputOff++,this.bufferOff++)this.buffer[this.bufferOff]=data[inputOff];return out};Cipher.prototype._updateDecrypt=function _updateDecrypt(data){var inputOff=0;var outputOff=0;var count=Math.ceil((this.bufferOff+data.length)/this.blockSize)-1;var out=new Array(count*this.blockSize);for(;count>0;count--){inputOff+=this._buffer(data,inputOff);outputOff+=this._flushBuffer(out,outputOff)}inputOff+=this._buffer(data,inputOff);return out};Cipher.prototype.final=function final(buffer){var first;if(buffer)first=this.update(buffer);var last;if(this.type==="encrypt")last=this._finalEncrypt();else last=this._finalDecrypt();if(first)return first.concat(last);else return last};Cipher.prototype._pad=function _pad(buffer,off){if(off===0)return false;while(off<buffer.length)buffer[off++]=0;return true};Cipher.prototype._finalEncrypt=function _finalEncrypt(){if(!this._pad(this.buffer,this.bufferOff))return[];var out=new Array(this.blockSize);this._update(this.buffer,0,out,0);return out};Cipher.prototype._unpad=function _unpad(buffer){return buffer};Cipher.prototype._finalDecrypt=function _finalDecrypt(){assert.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var out=new Array(this.blockSize);this._flushBuffer(out,0);return this._unpad(out)}},{"minimalistic-assert":297}],259:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert");var inherits=require("inherits");var des=require("../des");var utils=des.utils;var Cipher=des.Cipher;function DESState(){this.tmp=new Array(2);this.keys=null}function DES(options){Cipher.call(this,options);var state=new DESState;this._desState=state;this.deriveKeys(state,options.key)}inherits(DES,Cipher);module.exports=DES;DES.create=function create(options){return new DES(options)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES.prototype.deriveKeys=function deriveKeys(state,key){state.keys=new Array(16*2);assert.equal(key.length,this.blockSize,"Invalid key length");var kL=utils.readUInt32BE(key,0);var kR=utils.readUInt32BE(key,4);utils.pc1(kL,kR,state.tmp,0);kL=state.tmp[0];kR=state.tmp[1];for(var i=0;i<state.keys.length;i+=2){var shift=shiftTable[i>>>1];kL=utils.r28shl(kL,shift);kR=utils.r28shl(kR,shift);utils.pc2(kL,kR,state.keys,i)}};DES.prototype._update=function _update(inp,inOff,out,outOff){var state=this._desState;var l=utils.readUInt32BE(inp,inOff);var r=utils.readUInt32BE(inp,inOff+4);utils.ip(l,r,state.tmp,0);l=state.tmp[0];r=state.tmp[1];if(this.type==="encrypt")this._encrypt(state,l,r,state.tmp,0);else this._decrypt(state,l,r,state.tmp,0);l=state.tmp[0];r=state.tmp[1];utils.writeUInt32BE(out,l,outOff);utils.writeUInt32BE(out,r,outOff+4)};DES.prototype._pad=function _pad(buffer,off){var value=buffer.length-off;for(var i=off;i<buffer.length;i++)buffer[i]=value;return true};DES.prototype._unpad=function _unpad(buffer){var pad=buffer[buffer.length-1];for(var i=buffer.length-pad;i<buffer.length;i++)assert.equal(buffer[i],pad);return buffer.slice(0,buffer.length-pad)};DES.prototype._encrypt=function _encrypt(state,lStart,rStart,out,off){var l=lStart;var r=rStart;for(var i=0;i<state.keys.length;i+=2){var keyL=state.keys[i];var keyR=state.keys[i+1];utils.expand(r,state.tmp,0);keyL^=state.tmp[0];keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR);var f=utils.permute(s);var t=r;r=(l^f)>>>0;l=t}utils.rip(r,l,out,off)};DES.prototype._decrypt=function _decrypt(state,lStart,rStart,out,off){var l=rStart;var r=lStart;for(var i=state.keys.length-2;i>=0;i-=2){var keyL=state.keys[i];var keyR=state.keys[i+1];utils.expand(l,state.tmp,0);keyL^=state.tmp[0];keyR^=state.tmp[1];var s=utils.substitute(keyL,keyR);var f=utils.permute(s);var t=l;l=(r^f)>>>0;r=t}utils.rip(l,r,out,off)}},{"../des":256,inherits:293,"minimalistic-assert":297}],260:[function(require,module,exports){"use strict";var assert=require("minimalistic-assert");var inherits=require("inherits");var des=require("../des");var Cipher=des.Cipher;var DES=des.DES;function EDEState(type,key){assert.equal(key.length,24,"Invalid key length");var k1=key.slice(0,8);var k2=key.slice(8,16);var k3=key.slice(16,24);if(type==="encrypt"){this.ciphers=[DES.create({type:"encrypt",key:k1}),DES.create({type:"decrypt",key:k2}),DES.create({type:"encrypt",key:k3})]}else{this.ciphers=[DES.create({type:"decrypt",key:k3}),DES.create({type:"encrypt",key:k2}),DES.create({type:"decrypt",key:k1})]}}function EDE(options){Cipher.call(this,options);var state=new EDEState(this.type,this.options.key);this._edeState=state}inherits(EDE,Cipher);module.exports=EDE;EDE.create=function create(options){return new EDE(options)};EDE.prototype._update=function _update(inp,inOff,out,outOff){var state=this._edeState;state.ciphers[0]._update(inp,inOff,out,outOff);state.ciphers[1]._update(out,outOff,out,outOff);state.ciphers[2]._update(out,outOff,out,outOff)};EDE.prototype._pad=DES.prototype._pad;EDE.prototype._unpad=DES.prototype._unpad},{"../des":256,inherits:293,"minimalistic-assert":297}],261:[function(require,module,exports){"use strict";exports.readUInt32BE=function readUInt32BE(bytes,off){var res=bytes[0+off]<<24|bytes[1+off]<<16|bytes[2+off]<<8|bytes[3+off];return res>>>0};exports.writeUInt32BE=function writeUInt32BE(bytes,value,off){bytes[0+off]=value>>>24;bytes[1+off]=value>>>16&255;bytes[2+off]=value>>>8&255;bytes[3+off]=value&255};exports.ip=function ip(inL,inR,out,off){var outL=0;var outR=0;for(var i=6;i>=0;i-=2){for(var j=0;j<=24;j+=8){outL<<=1;outL|=inR>>>j+i&1}for(var j=0;j<=24;j+=8){outL<<=1;outL|=inL>>>j+i&1}}for(var i=6;i>=0;i-=2){for(var j=1;j<=25;j+=8){outR<<=1;outR|=inR>>>j+i&1}for(var j=1;j<=25;j+=8){outR<<=1;outR|=inL>>>j+i&1}}out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.rip=function rip(inL,inR,out,off){var outL=0;var outR=0;for(var i=0;i<4;i++){for(var j=24;j>=0;j-=8){outL<<=1;outL|=inR>>>j+i&1;outL<<=1;outL|=inL>>>j+i&1}}for(var i=4;i<8;i++){for(var j=24;j>=0;j-=8){outR<<=1;outR|=inR>>>j+i&1;outR<<=1;outR|=inL>>>j+i&1}}out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.pc1=function pc1(inL,inR,out,off){var outL=0;var outR=0;for(var i=7;i>=5;i--){for(var j=0;j<=24;j+=8){outL<<=1;outL|=inR>>j+i&1}for(var j=0;j<=24;j+=8){outL<<=1;outL|=inL>>j+i&1}}for(var j=0;j<=24;j+=8){outL<<=1;outL|=inR>>j+i&1}for(var i=1;i<=3;i++){for(var j=0;j<=24;j+=8){outR<<=1;outR|=inR>>j+i&1}for(var j=0;j<=24;j+=8){outR<<=1;outR|=inL>>j+i&1}}for(var j=0;j<=24;j+=8){outR<<=1;outR|=inL>>j+i&1}out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.r28shl=function r28shl(num,shift){return num<<shift&268435455|num>>>28-shift};var pc2table=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];exports.pc2=function pc2(inL,inR,out,off){var outL=0;var outR=0;var len=pc2table.length>>>1;for(var i=0;i<len;i++){outL<<=1;outL|=inL>>>pc2table[i]&1}for(var i=len;i<pc2table.length;i++){outR<<=1;outR|=inR>>>pc2table[i]&1}out[off+0]=outL>>>0;out[off+1]=outR>>>0};exports.expand=function expand(r,out,off){var outL=0;var outR=0;outL=(r&1)<<5|r>>>27;for(var i=23;i>=15;i-=4){outL<<=6;outL|=r>>>i&63}for(var i=11;i>=3;i-=4){outR|=r>>>i&63;outR<<=6}outR|=(r&31)<<1|r>>>31;out[off+0]=outL>>>0;out[off+1]=outR>>>0};var sTable=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];exports.substitute=function substitute(inL,inR){var out=0;for(var i=0;i<4;i++){var b=inL>>>18-i*6&63;var sb=sTable[i*64+b];out<<=4;out|=sb}for(var i=0;i<4;i++){var b=inR>>>18-i*6&63;var sb=sTable[4*64+i*64+b];out<<=4;out|=sb}return out>>>0};var permuteTable=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];exports.permute=function permute(num){var out=0;for(var i=0;i<permuteTable.length;i++){out<<=1;out|=num>>>permuteTable[i]&1}return out>>>0};exports.padSplit=function padSplit(num,size,group){var str=num.toString(2);while(str.length<size)str="0"+str;var out=[];for(var i=0;i<size;i+=group)out.push(str.slice(i,i+group));return out.join(" ")}},{}],262:[function(require,module,exports){(function(Buffer){var generatePrime=require("./lib/generatePrime");var primes=require("./lib/primes.json");var DH=require("./lib/dh");function getDiffieHellman(mod){var prime=new Buffer(primes[mod].prime,"hex");var gen=new Buffer(primes[mod].gen,"hex");return new DH(prime,gen)}var ENCODINGS={binary:true,hex:true,base64:true};function createDiffieHellman(prime,enc,generator,genc){if(Buffer.isBuffer(enc)||ENCODINGS[enc]===undefined){return createDiffieHellman(prime,"binary",enc,generator)}enc=enc||"binary";genc=genc||"binary";generator=generator||new Buffer([2]);if(!Buffer.isBuffer(generator)){generator=new Buffer(generator,genc)}if(typeof prime==="number"){return new DH(generatePrime(prime,generator),generator,true)}if(!Buffer.isBuffer(prime)){prime=new Buffer(prime,enc)}return new DH(prime,generator,true)}exports.DiffieHellmanGroup=exports.createDiffieHellmanGroup=exports.getDiffieHellman=getDiffieHellman;exports.createDiffieHellman=exports.DiffieHellman=createDiffieHellman}).call(this,require("buffer").Buffer)},{"./lib/dh":263,"./lib/generatePrime":264,"./lib/primes.json":265,buffer:247}],263:[function(require,module,exports){(function(Buffer){var BN=require("bn.js");var MillerRabin=require("miller-rabin");var millerRabin=new MillerRabin;var TWENTYFOUR=new BN(24);var ELEVEN=new BN(11);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var primes=require("./generatePrime");var randomBytes=require("randombytes");module.exports=DH;function setPublicKey(pub,enc){enc=enc||"utf8";if(!Buffer.isBuffer(pub)){pub=new Buffer(pub,enc)}this._pub=new BN(pub);return this}function setPrivateKey(priv,enc){enc=enc||"utf8";if(!Buffer.isBuffer(priv)){priv=new Buffer(priv,enc)}this._priv=new BN(priv);return this}var primeCache={};function checkPrime(prime,generator){var gen=generator.toString("hex");var hex=[gen,prime.toString(16)].join("_");if(hex in primeCache){return primeCache[hex]}var error=0;if(prime.isEven()||!primes.simpleSieve||!primes.fermatTest(prime)||!millerRabin.test(prime)){error+=1;if(gen==="02"||gen==="05"){error+=8}else{error+=4}primeCache[hex]=error;return error}if(!millerRabin.test(prime.shrn(1))){error+=2}var rem;switch(gen){case"02":if(prime.mod(TWENTYFOUR).cmp(ELEVEN)){error+=8}break;case"05":rem=prime.mod(TEN);if(rem.cmp(THREE)&&rem.cmp(SEVEN)){error+=8}break;default:error+=4}primeCache[hex]=error;return error}function DH(prime,generator,malleable){this.setGenerator(generator);this.__prime=new BN(prime);this._prime=BN.mont(this.__prime);this._primeLen=prime.length;this._pub=undefined;this._priv=undefined;this._primeCode=undefined;if(malleable){this.setPublicKey=setPublicKey;this.setPrivateKey=setPrivateKey}else{this._primeCode=8}}Object.defineProperty(DH.prototype,"verifyError",{enumerable:true,get:function(){if(typeof this._primeCode!=="number"){this._primeCode=checkPrime(this.__prime,this.__gen)}return this._primeCode}});DH.prototype.generateKeys=function(){if(!this._priv){this._priv=new BN(randomBytes(this._primeLen))}this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed();return this.getPublicKey()};DH.prototype.computeSecret=function(other){other=new BN(other);other=other.toRed(this._prime);var secret=other.redPow(this._priv).fromRed();var out=new Buffer(secret.toArray());var prime=this.getPrime();if(out.length<prime.length){var front=new Buffer(prime.length-out.length);front.fill(0);out=Buffer.concat([front,out])}return out};DH.prototype.getPublicKey=function getPublicKey(enc){return formatReturnValue(this._pub,enc)};DH.prototype.getPrivateKey=function getPrivateKey(enc){return formatReturnValue(this._priv,enc)};DH.prototype.getPrime=function(enc){return formatReturnValue(this.__prime,enc)};DH.prototype.getGenerator=function(enc){return formatReturnValue(this._gen,enc)};DH.prototype.setGenerator=function(gen,enc){enc=enc||"utf8";if(!Buffer.isBuffer(gen)){gen=new Buffer(gen,enc)}this.__gen=gen;this._gen=new BN(gen);return this};function formatReturnValue(bn,enc){var buf=new Buffer(bn.toArray());if(!enc){return buf}else{return buf.toString(enc)}}}).call(this,require("buffer").Buffer)},{"./generatePrime":264,"bn.js":218,buffer:247,"miller-rabin":296,randombytes:313}],264:[function(require,module,exports){var randomBytes=require("randombytes");module.exports=findPrime;findPrime.simpleSieve=simpleSieve;findPrime.fermatTest=fermatTest;var BN=require("bn.js");var TWENTYFOUR=new BN(24);var MillerRabin=require("miller-rabin");var millerRabin=new MillerRabin;var ONE=new BN(1);var TWO=new BN(2);var FIVE=new BN(5);var SIXTEEN=new BN(16);var EIGHT=new BN(8);var TEN=new BN(10);var THREE=new BN(3);var SEVEN=new BN(7);var ELEVEN=new BN(11);var FOUR=new BN(4);var TWELVE=new BN(12);var primes=null;function _getPrimes(){if(primes!==null)return primes;var limit=1048576;var res=[];res[0]=2;for(var i=1,k=3;k<limit;k+=2){var sqrt=Math.ceil(Math.sqrt(k));for(var j=0;j<i&&res[j]<=sqrt;j++)if(k%res[j]===0)break;if(i!==j&&res[j]<=sqrt)continue;res[i++]=k}primes=res;return res}function simpleSieve(p){var primes=_getPrimes();for(var i=0;i<primes.length;i++)if(p.modn(primes[i])===0){if(p.cmpn(primes[i])===0){return true}else{return false}}return true}function fermatTest(p){var red=BN.mont(p);return TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1)===0}function findPrime(bits,gen){if(bits<16){if(gen===2||gen===5){return new BN([140,123])}else{return new BN([140,39])}}gen=new BN(gen);var num,n2;while(true){num=new BN(randomBytes(Math.ceil(bits/8)));while(num.bitLength()>bits){num.ishrn(1)}if(num.isEven()){num.iadd(ONE)}if(!num.testn(1)){num.iadd(TWO)}if(!gen.cmp(TWO)){while(num.mod(TWENTYFOUR).cmp(ELEVEN)){num.iadd(FOUR)}}else if(!gen.cmp(FIVE)){while(num.mod(TEN).cmp(THREE)){num.iadd(FOUR)}}n2=num.shrn(1);if(simpleSieve(n2)&&simpleSieve(num)&&fermatTest(n2)&&fermatTest(num)&&millerRabin.test(n2)&&millerRabin.test(num)){return num}}}},{"bn.js":218,"miller-rabin":296,randombytes:313}],265:[function(require,module,exports){module.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},{}],266:[function(require,module,exports){"use strict";var elliptic=exports;elliptic.version=require("../package.json").version;elliptic.utils=require("./elliptic/utils");elliptic.rand=require("brorand");elliptic.hmacDRBG=require("./elliptic/hmac-drbg");elliptic.curve=require("./elliptic/curve");elliptic.curves=require("./elliptic/curves");elliptic.ec=require("./elliptic/ec");elliptic.eddsa=require("./elliptic/eddsa")},{"../package.json":282,"./elliptic/curve":269,"./elliptic/curves":272,"./elliptic/ec":273,"./elliptic/eddsa":276,"./elliptic/hmac-drbg":279,"./elliptic/utils":281,brorand:219}],267:[function(require,module,exports){"use strict";var BN=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var getNAF=utils.getNAF;var getJSF=utils.getJSF;var assert=utils.assert;function BaseCurve(type,conf){this.type=type;this.p=new BN(conf.p,16);this.red=conf.prime?BN.red(conf.prime):BN.mont(this.p);this.zero=new BN(0).toRed(this.red);this.one=new BN(1).toRed(this.red);this.two=new BN(2).toRed(this.red);this.n=conf.n&&new BN(conf.n,16);this.g=conf.g&&this.pointFromJSON(conf.g,conf.gRed);this._wnafT1=new Array(4);this._wnafT2=new Array(4);this._wnafT3=new Array(4);this._wnafT4=new Array(4);var adjustCount=this.n&&this.p.div(this.n);if(!adjustCount||adjustCount.cmpn(100)>0){this.redN=null}else{this._maxwellTrick=true;this.redN=this.n.toRed(this.red)}}module.exports=BaseCurve;BaseCurve.prototype.point=function point(){throw new Error("Not implemented")};BaseCurve.prototype.validate=function validate(){throw new Error("Not implemented")};BaseCurve.prototype._fixedNafMul=function _fixedNafMul(p,k){assert(p.precomputed);var doubles=p._getDoubles();var naf=getNAF(k,1);var I=(1<<doubles.step+1)-(doubles.step%2===0?2:1);I/=3;var repr=[];for(var j=0;j<naf.length;j+=doubles.step){var nafW=0;for(var k=j+doubles.step-1;k>=j;k--)nafW=(nafW<<1)+naf[k];repr.push(nafW)}var a=this.jpoint(null,null,null);var b=this.jpoint(null,null,null);for(var i=I;i>0;i--){for(var j=0;j<repr.length;j++){var nafW=repr[j];if(nafW===i)b=b.mixedAdd(doubles.points[j]);else if(nafW===-i)b=b.mixedAdd(doubles.points[j].neg())}a=a.add(b)}return a.toP()};BaseCurve.prototype._wnafMul=function _wnafMul(p,k){var w=4;var nafPoints=p._getNAFPoints(w);w=nafPoints.wnd;var wnd=nafPoints.points;var naf=getNAF(k,w);var acc=this.jpoint(null,null,null);for(var i=naf.length-1;i>=0;i--){for(var k=0;i>=0&&naf[i]===0;i--)k++;if(i>=0)k++;acc=acc.dblp(k);if(i<0)break;var z=naf[i];assert(z!==0);if(p.type==="affine"){if(z>0)acc=acc.mixedAdd(wnd[z-1>>1]);else acc=acc.mixedAdd(wnd[-z-1>>1].neg())}else{if(z>0)acc=acc.add(wnd[z-1>>1]);else acc=acc.add(wnd[-z-1>>1].neg())}}return p.type==="affine"?acc.toP():acc};BaseCurve.prototype._wnafMulAdd=function _wnafMulAdd(defW,points,coeffs,len,jacobianResult){var wndWidth=this._wnafT1;var wnd=this._wnafT2;var naf=this._wnafT3;var max=0;for(var i=0;i<len;i++){var p=points[i];var nafPoints=p._getNAFPoints(defW);wndWidth[i]=nafPoints.wnd;wnd[i]=nafPoints.points}for(var i=len-1;i>=1;i-=2){var a=i-1;

var b=i;if(wndWidth[a]!==1||wndWidth[b]!==1){naf[a]=getNAF(coeffs[a],wndWidth[a]);naf[b]=getNAF(coeffs[b],wndWidth[b]);max=Math.max(naf[a].length,max);max=Math.max(naf[b].length,max);continue}var comb=[points[a],null,null,points[b]];if(points[a].y.cmp(points[b].y)===0){comb[1]=points[a].add(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}else if(points[a].y.cmp(points[b].y.redNeg())===0){comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].add(points[b].neg())}else{comb[1]=points[a].toJ().mixedAdd(points[b]);comb[2]=points[a].toJ().mixedAdd(points[b].neg())}var index=[-3,-1,-5,-7,0,7,5,1,3];var jsf=getJSF(coeffs[a],coeffs[b]);max=Math.max(jsf[0].length,max);naf[a]=new Array(max);naf[b]=new Array(max);for(var j=0;j<max;j++){var ja=jsf[0][j]|0;var jb=jsf[1][j]|0;naf[a][j]=index[(ja+1)*3+(jb+1)];naf[b][j]=0;wnd[a]=comb}}var acc=this.jpoint(null,null,null);var tmp=this._wnafT4;for(var i=max;i>=0;i--){var k=0;while(i>=0){var zero=true;for(var j=0;j<len;j++){tmp[j]=naf[j][i]|0;if(tmp[j]!==0)zero=false}if(!zero)break;k++;i--}if(i>=0)k++;acc=acc.dblp(k);if(i<0)break;for(var j=0;j<len;j++){var z=tmp[j];var p;if(z===0)continue;else if(z>0)p=wnd[j][z-1>>1];else if(z<0)p=wnd[j][-z-1>>1].neg();if(p.type==="affine")acc=acc.mixedAdd(p);else acc=acc.add(p)}}for(var i=0;i<len;i++)wnd[i]=null;if(jacobianResult)return acc;else return acc.toP()};function BasePoint(curve,type){this.curve=curve;this.type=type;this.precomputed=null}BaseCurve.BasePoint=BasePoint;BasePoint.prototype.eq=function eq(){throw new Error("Not implemented")};BasePoint.prototype.validate=function validate(){return this.curve.validate(this)};BaseCurve.prototype.decodePoint=function decodePoint(bytes,enc){bytes=utils.toArray(bytes,enc);var len=this.p.byteLength();if((bytes[0]===4||bytes[0]===6||bytes[0]===7)&&bytes.length-1===2*len){if(bytes[0]===6)assert(bytes[bytes.length-1]%2===0);else if(bytes[0]===7)assert(bytes[bytes.length-1]%2===1);var res=this.point(bytes.slice(1,1+len),bytes.slice(1+len,1+2*len));return res}else if((bytes[0]===2||bytes[0]===3)&&bytes.length-1===len){return this.pointFromX(bytes.slice(1,1+len),bytes[0]===3)}throw new Error("Unknown point format")};BasePoint.prototype.encodeCompressed=function encodeCompressed(enc){return this.encode(enc,true)};BasePoint.prototype._encode=function _encode(compact){var len=this.curve.p.byteLength();var x=this.getX().toArray("be",len);if(compact)return[this.getY().isEven()?2:3].concat(x);return[4].concat(x,this.getY().toArray("be",len))};BasePoint.prototype.encode=function encode(enc,compact){return utils.encode(this._encode(compact),enc)};BasePoint.prototype.precompute=function precompute(power){if(this.precomputed)return this;var precomputed={doubles:null,naf:null,beta:null};precomputed.naf=this._getNAFPoints(8);precomputed.doubles=this._getDoubles(4,power);precomputed.beta=this._getBeta();this.precomputed=precomputed;return this};BasePoint.prototype._hasDoubles=function _hasDoubles(k){if(!this.precomputed)return false;var doubles=this.precomputed.doubles;if(!doubles)return false;return doubles.points.length>=Math.ceil((k.bitLength()+1)/doubles.step)};BasePoint.prototype._getDoubles=function _getDoubles(step,power){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;var doubles=[this];var acc=this;for(var i=0;i<power;i+=step){for(var j=0;j<step;j++)acc=acc.dbl();doubles.push(acc)}return{step:step,points:doubles}};BasePoint.prototype._getNAFPoints=function _getNAFPoints(wnd){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;var res=[this];var max=(1<<wnd)-1;var dbl=max===1?null:this.dbl();for(var i=1;i<max;i++)res[i]=res[i-1].add(dbl);return{wnd:wnd,points:res}};BasePoint.prototype._getBeta=function _getBeta(){return null};BasePoint.prototype.dblp=function dblp(k){var r=this;for(var i=0;i<k;i++)r=r.dbl();return r}},{"../../elliptic":266,"bn.js":218}],268:[function(require,module,exports){"use strict";var curve=require("../curve");var elliptic=require("../../elliptic");var BN=require("bn.js");var inherits=require("inherits");var Base=curve.base;var assert=elliptic.utils.assert;function EdwardsCurve(conf){this.twisted=(conf.a|0)!==1;this.mOneA=this.twisted&&(conf.a|0)===-1;this.extended=this.mOneA;Base.call(this,"edwards",conf);this.a=new BN(conf.a,16).umod(this.red.m);this.a=this.a.toRed(this.red);this.c=new BN(conf.c,16).toRed(this.red);this.c2=this.c.redSqr();this.d=new BN(conf.d,16).toRed(this.red);this.dd=this.d.redAdd(this.d);assert(!this.twisted||this.c.fromRed().cmpn(1)===0);this.oneC=(conf.c|0)===1}inherits(EdwardsCurve,Base);module.exports=EdwardsCurve;EdwardsCurve.prototype._mulA=function _mulA(num){if(this.mOneA)return num.redNeg();else return this.a.redMul(num)};EdwardsCurve.prototype._mulC=function _mulC(num){if(this.oneC)return num;else return this.c.redMul(num)};EdwardsCurve.prototype.jpoint=function jpoint(x,y,z,t){return this.point(x,y,z,t)};EdwardsCurve.prototype.pointFromX=function pointFromX(x,odd){x=new BN(x,16);if(!x.red)x=x.toRed(this.red);var x2=x.redSqr();var rhs=this.c2.redSub(this.a.redMul(x2));var lhs=this.one.redSub(this.c2.redMul(this.d).redMul(x2));var y2=rhs.redMul(lhs.redInvm());var y=y2.redSqrt();if(y.redSqr().redSub(y2).cmp(this.zero)!==0)throw new Error("invalid point");var isOdd=y.fromRed().isOdd();if(odd&&!isOdd||!odd&&isOdd)y=y.redNeg();return this.point(x,y)};EdwardsCurve.prototype.pointFromY=function pointFromY(y,odd){y=new BN(y,16);if(!y.red)y=y.toRed(this.red);var y2=y.redSqr();var lhs=y2.redSub(this.one);var rhs=y2.redMul(this.d).redAdd(this.one);var x2=lhs.redMul(rhs.redInvm());if(x2.cmp(this.zero)===0){if(odd)throw new Error("invalid point");else return this.point(this.zero,y)}var x=x2.redSqrt();if(x.redSqr().redSub(x2).cmp(this.zero)!==0)throw new Error("invalid point");if(x.isOdd()!==odd)x=x.redNeg();return this.point(x,y)};EdwardsCurve.prototype.validate=function validate(point){if(point.isInfinity())return true;point.normalize();var x2=point.x.redSqr();var y2=point.y.redSqr();var lhs=x2.redMul(this.a).redAdd(y2);var rhs=this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));return lhs.cmp(rhs)===0};function Point(curve,x,y,z,t){Base.BasePoint.call(this,curve,"projective");if(x===null&&y===null&&z===null){this.x=this.curve.zero;this.y=this.curve.one;this.z=this.curve.one;this.t=this.curve.zero;this.zOne=true}else{this.x=new BN(x,16);this.y=new BN(y,16);this.z=z?new BN(z,16):this.curve.one;this.t=t&&new BN(t,16);if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red);if(this.t&&!this.t.red)this.t=this.t.toRed(this.curve.red);this.zOne=this.z===this.curve.one;if(this.curve.extended&&!this.t){this.t=this.x.redMul(this.y);if(!this.zOne)this.t=this.t.redMul(this.z.redInvm())}}}inherits(Point,Base.BasePoint);EdwardsCurve.prototype.pointFromJSON=function pointFromJSON(obj){return Point.fromJSON(this,obj)};EdwardsCurve.prototype.point=function point(x,y,z,t){return new Point(this,x,y,z,t)};Point.fromJSON=function fromJSON(curve,obj){return new Point(curve,obj[0],obj[1],obj[2])};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.x.cmpn(0)===0&&this.y.cmp(this.z)===0};Point.prototype._extDbl=function _extDbl(){var a=this.x.redSqr();var b=this.y.redSqr();var c=this.z.redSqr();c=c.redIAdd(c);var d=this.curve._mulA(a);var e=this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);var g=d.redAdd(b);var f=g.redSub(c);var h=d.redSub(b);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)};Point.prototype._projDbl=function _projDbl(){var b=this.x.redAdd(this.y).redSqr();var c=this.x.redSqr();var d=this.y.redSqr();var nx;var ny;var nz;if(this.curve.twisted){var e=this.curve._mulA(c);var f=e.redAdd(d);if(this.zOne){nx=b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));ny=f.redMul(e.redSub(d));nz=f.redSqr().redSub(f).redSub(f)}else{var h=this.z.redSqr();var j=f.redSub(h).redISub(h);nx=b.redSub(c).redISub(d).redMul(j);ny=f.redMul(e.redSub(d));nz=f.redMul(j)}}else{var e=c.redAdd(d);var h=this.curve._mulC(this.c.redMul(this.z)).redSqr();var j=e.redSub(h).redSub(h);nx=this.curve._mulC(b.redISub(e)).redMul(j);ny=this.curve._mulC(e).redMul(c.redISub(d));nz=e.redMul(j)}return this.curve.point(nx,ny,nz)};Point.prototype.dbl=function dbl(){if(this.isInfinity())return this;if(this.curve.extended)return this._extDbl();else return this._projDbl()};Point.prototype._extAdd=function _extAdd(p){var a=this.y.redSub(this.x).redMul(p.y.redSub(p.x));var b=this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));var c=this.t.redMul(this.curve.dd).redMul(p.t);var d=this.z.redMul(p.z.redAdd(p.z));var e=b.redSub(a);var f=d.redSub(c);var g=d.redAdd(c);var h=b.redAdd(a);var nx=e.redMul(f);var ny=g.redMul(h);var nt=e.redMul(h);var nz=f.redMul(g);return this.curve.point(nx,ny,nz,nt)};Point.prototype._projAdd=function _projAdd(p){var a=this.z.redMul(p.z);var b=a.redSqr();var c=this.x.redMul(p.x);var d=this.y.redMul(p.y);var e=this.curve.d.redMul(c).redMul(d);var f=b.redSub(e);var g=b.redAdd(e);var tmp=this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);var nx=a.redMul(f).redMul(tmp);var ny;var nz;if(this.curve.twisted){ny=a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));nz=f.redMul(g)}else{ny=a.redMul(g).redMul(d.redSub(c));nz=this.curve._mulC(f).redMul(g)}return this.curve.point(nx,ny,nz)};Point.prototype.add=function add(p){if(this.isInfinity())return p;if(p.isInfinity())return this;if(this.curve.extended)return this._extAdd(p);else return this._projAdd(p)};Point.prototype.mul=function mul(k){if(this._hasDoubles(k))return this.curve._fixedNafMul(this,k);else return this.curve._wnafMul(this,k)};Point.prototype.mulAdd=function mulAdd(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,false)};Point.prototype.jmulAdd=function jmulAdd(k1,p,k2){return this.curve._wnafMulAdd(1,[this,p],[k1,k2],2,true)};Point.prototype.normalize=function normalize(){if(this.zOne)return this;var zi=this.z.redInvm();this.x=this.x.redMul(zi);this.y=this.y.redMul(zi);if(this.t)this.t=this.t.redMul(zi);this.z=this.curve.one;this.zOne=true;return this};Point.prototype.neg=function neg(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};Point.prototype.getX=function getX(){this.normalize();return this.x.fromRed()};Point.prototype.getY=function getY(){this.normalize();return this.y.fromRed()};Point.prototype.eq=function eq(other){return this===other||this.getX().cmp(other.getX())===0&&this.getY().cmp(other.getY())===0};Point.prototype.eqXToP=function eqXToP(x){var rx=x.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(rx)===0)return true;var xc=x.clone();var t=this.curve.redN.redMul(this.z);for(;;){xc.iadd(this.curve.n);if(xc.cmp(this.curve.p)>=0)return false;rx.redIAdd(t);if(this.x.cmp(rx)===0)return true}return false};Point.prototype.toP=Point.prototype.normalize;Point.prototype.mixedAdd=Point.prototype.add},{"../../elliptic":266,"../curve":269,"bn.js":218,inherits:293}],269:[function(require,module,exports){"use strict";var curve=exports;curve.base=require("./base");curve.short=require("./short");curve.mont=require("./mont");curve.edwards=require("./edwards")},{"./base":267,"./edwards":268,"./mont":270,"./short":271}],270:[function(require,module,exports){"use strict";var curve=require("../curve");var BN=require("bn.js");var inherits=require("inherits");var Base=curve.base;var elliptic=require("../../elliptic");var utils=elliptic.utils;function MontCurve(conf){Base.call(this,"mont",conf);this.a=new BN(conf.a,16).toRed(this.red);this.b=new BN(conf.b,16).toRed(this.red);this.i4=new BN(4).toRed(this.red).redInvm();this.two=new BN(2).toRed(this.red);this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits(MontCurve,Base);module.exports=MontCurve;MontCurve.prototype.validate=function validate(point){var x=point.normalize().x;var x2=x.redSqr();var rhs=x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);var y=rhs.redSqrt();return y.redSqr().cmp(rhs)===0};function Point(curve,x,z){Base.BasePoint.call(this,curve,"projective");if(x===null&&z===null){this.x=this.curve.one;this.z=this.curve.zero}else{this.x=new BN(x,16);this.z=new BN(z,16);if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red)}}inherits(Point,Base.BasePoint);MontCurve.prototype.decodePoint=function decodePoint(bytes,enc){return this.point(utils.toArray(bytes,enc),1)};MontCurve.prototype.point=function point(x,z){return new Point(this,x,z)};MontCurve.prototype.pointFromJSON=function pointFromJSON(obj){return Point.fromJSON(this,obj)};Point.prototype.precompute=function precompute(){};Point.prototype._encode=function _encode(){return this.getX().toArray("be",this.curve.p.byteLength())};Point.fromJSON=function fromJSON(curve,obj){return new Point(curve,obj[0],obj[1]||curve.one)};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.z.cmpn(0)===0};Point.prototype.dbl=function dbl(){var a=this.x.redAdd(this.z);var aa=a.redSqr();var b=this.x.redSub(this.z);var bb=b.redSqr();var c=aa.redSub(bb);var nx=aa.redMul(bb);var nz=c.redMul(bb.redAdd(this.curve.a24.redMul(c)));return this.curve.point(nx,nz)};Point.prototype.add=function add(){throw new Error("Not supported on Montgomery curve")};Point.prototype.diffAdd=function diffAdd(p,diff){var a=this.x.redAdd(this.z);var b=this.x.redSub(this.z);var c=p.x.redAdd(p.z);var d=p.x.redSub(p.z);var da=d.redMul(a);var cb=c.redMul(b);var nx=diff.z.redMul(da.redAdd(cb).redSqr());var nz=diff.x.redMul(da.redISub(cb).redSqr());return this.curve.point(nx,nz)};Point.prototype.mul=function mul(k){var t=k.clone();var a=this;var b=this.curve.point(null,null);var c=this;for(var bits=[];t.cmpn(0)!==0;t.iushrn(1))bits.push(t.andln(1));for(var i=bits.length-1;i>=0;i--){if(bits[i]===0){a=a.diffAdd(b,c);b=b.dbl()}else{b=a.diffAdd(b,c);a=a.dbl()}}return b};Point.prototype.mulAdd=function mulAdd(){throw new Error("Not supported on Montgomery curve")};Point.prototype.jumlAdd=function jumlAdd(){throw new Error("Not supported on Montgomery curve")};Point.prototype.eq=function eq(other){return this.getX().cmp(other.getX())===0};Point.prototype.normalize=function normalize(){this.x=this.x.redMul(this.z.redInvm());this.z=this.curve.one;return this};Point.prototype.getX=function getX(){this.normalize();return this.x.fromRed()}},{"../../elliptic":266,"../curve":269,"bn.js":218,inherits:293}],271:[function(require,module,exports){"use strict";var curve=require("../curve");var elliptic=require("../../elliptic");var BN=require("bn.js");var inherits=require("inherits");var Base=curve.base;var assert=elliptic.utils.assert;function ShortCurve(conf){Base.call(this,"short",conf);this.a=new BN(conf.a,16).toRed(this.red);this.b=new BN(conf.b,16).toRed(this.red);this.tinv=this.two.redInvm();this.zeroA=this.a.fromRed().cmpn(0)===0;this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0;this.endo=this._getEndomorphism(conf);this._endoWnafT1=new Array(4);this._endoWnafT2=new Array(4)}inherits(ShortCurve,Base);module.exports=ShortCurve;ShortCurve.prototype._getEndomorphism=function _getEndomorphism(conf){if(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)return;var beta;var lambda;if(conf.beta){beta=new BN(conf.beta,16).toRed(this.red)}else{var betas=this._getEndoRoots(this.p);beta=betas[0].cmp(betas[1])<0?betas[0]:betas[1];beta=beta.toRed(this.red)}if(conf.lambda){lambda=new BN(conf.lambda,16)}else{var lambdas=this._getEndoRoots(this.n);if(this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta))===0){lambda=lambdas[0]}else{lambda=lambdas[1];assert(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta))===0)}}var basis;if(conf.basis){basis=conf.basis.map(function(vec){return{a:new BN(vec.a,16),b:new BN(vec.b,16)}})}else{basis=this._getEndoBasis(lambda)}return{beta:beta,lambda:lambda,basis:basis}};ShortCurve.prototype._getEndoRoots=function _getEndoRoots(num){var red=num===this.p?this.red:BN.mont(num);var tinv=new BN(2).toRed(red).redInvm();var ntinv=tinv.redNeg();var s=new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);var l1=ntinv.redAdd(s).fromRed();var l2=ntinv.redSub(s).fromRed();return[l1,l2]};ShortCurve.prototype._getEndoBasis=function _getEndoBasis(lambda){var aprxSqrt=this.n.ushrn(Math.floor(this.n.bitLength()/2));var u=lambda;var v=this.n.clone();var x1=new BN(1);var y1=new BN(0);var x2=new BN(0);var y2=new BN(1);var a0;var b0;var a1;var b1;var a2;var b2;var prevR;var i=0;var r;var x;while(u.cmpn(0)!==0){var q=v.div(u);r=v.sub(q.mul(u));x=x2.sub(q.mul(x1));var y=y2.sub(q.mul(y1));if(!a1&&r.cmp(aprxSqrt)<0){a0=prevR.neg();b0=x1;a1=r.neg();b1=x}else if(a1&&++i===2){break}prevR=r;v=u;u=r;x2=x1;x1=x;y2=y1;y1=y}a2=r.neg();b2=x;var len1=a1.sqr().add(b1.sqr());var len2=a2.sqr().add(b2.sqr());if(len2.cmp(len1)>=0){a2=a0;b2=b0}if(a1.negative){a1=a1.neg();b1=b1.neg()}if(a2.negative){a2=a2.neg();b2=b2.neg()}return[{a:a1,b:b1},{a:a2,b:b2}]};ShortCurve.prototype._endoSplit=function _endoSplit(k){var basis=this.endo.basis;var v1=basis[0];var v2=basis[1];var c1=v2.b.mul(k).divRound(this.n);var c2=v1.b.neg().mul(k).divRound(this.n);var p1=c1.mul(v1.a);var p2=c2.mul(v2.a);var q1=c1.mul(v1.b);var q2=c2.mul(v2.b);var k1=k.sub(p1).sub(p2);var k2=q1.add(q2).neg();return{k1:k1,k2:k2}};ShortCurve.prototype.pointFromX=function pointFromX(x,odd){x=new BN(x,16);if(!x.red)x=x.toRed(this.red);var y2=x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);var y=y2.redSqrt();if(y.redSqr().redSub(y2).cmp(this.zero)!==0)throw new Error("invalid point");var isOdd=y.fromRed().isOdd();if(odd&&!isOdd||!odd&&isOdd)y=y.redNeg();return this.point(x,y)};ShortCurve.prototype.validate=function validate(point){if(point.inf)return true;var x=point.x;var y=point.y;var ax=this.a.redMul(x);var rhs=x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);return y.redSqr().redISub(rhs).cmpn(0)===0};ShortCurve.prototype._endoWnafMulAdd=function _endoWnafMulAdd(points,coeffs,jacobianResult){var npoints=this._endoWnafT1;var ncoeffs=this._endoWnafT2;for(var i=0;i<points.length;i++){var split=this._endoSplit(coeffs[i]);var p=points[i];var beta=p._getBeta();if(split.k1.negative){split.k1.ineg();p=p.neg(true)}if(split.k2.negative){split.k2.ineg();beta=beta.neg(true)}npoints[i*2]=p;npoints[i*2+1]=beta;ncoeffs[i*2]=split.k1;ncoeffs[i*2+1]=split.k2}var res=this._wnafMulAdd(1,npoints,ncoeffs,i*2,jacobianResult);for(var j=0;j<i*2;j++){npoints[j]=null;ncoeffs[j]=null}return res};function Point(curve,x,y,isRed){Base.BasePoint.call(this,curve,"affine");if(x===null&&y===null){this.x=null;this.y=null;this.inf=true}else{this.x=new BN(x,16);this.y=new BN(y,16);if(isRed){this.x.forceRed(this.curve.red);this.y.forceRed(this.curve.red)}if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);this.inf=false}}inherits(Point,Base.BasePoint);ShortCurve.prototype.point=function point(x,y,isRed){return new Point(this,x,y,isRed)};ShortCurve.prototype.pointFromJSON=function pointFromJSON(obj,red){return Point.fromJSON(this,obj,red)};Point.prototype._getBeta=function _getBeta(){if(!this.curve.endo)return;var pre=this.precomputed;if(pre&&pre.beta)return pre.beta;var beta=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(pre){var curve=this.curve;var endoMul=function(p){return curve.point(p.x.redMul(curve.endo.beta),p.y)};pre.beta=beta;beta.precomputed={beta:null,naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(endoMul)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(endoMul)}}}return beta};Point.prototype.toJSON=function toJSON(){if(!this.precomputed)return[this.x,this.y];return[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]};Point.fromJSON=function fromJSON(curve,obj,red){if(typeof obj==="string")obj=JSON.parse(obj);var res=curve.point(obj[0],obj[1],red);if(!obj[2])return res;function obj2point(obj){return curve.point(obj[0],obj[1],red)}var pre=obj[2];res.precomputed={beta:null,doubles:pre.doubles&&{step:pre.doubles.step,points:[res].concat(pre.doubles.points.map(obj2point))},naf:pre.naf&&{wnd:pre.naf.wnd,points:[res].concat(pre.naf.points.map(obj2point))}};return res};Point.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC Point Infinity>";return"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function isInfinity(){return this.inf};Point.prototype.add=function add(p){if(this.inf)return p;if(p.inf)return this;if(this.eq(p))return this.dbl();if(this.neg().eq(p))return this.curve.point(null,null);if(this.x.cmp(p.x)===0)return this.curve.point(null,null);var c=this.y.redSub(p.y);if(c.cmpn(0)!==0)c=c.redMul(this.x.redSub(p.x).redInvm());var nx=c.redSqr().redISub(this.x).redISub(p.x);var ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)};Point.prototype.dbl=function dbl(){if(this.inf)return this;var ys1=this.y.redAdd(this.y);if(ys1.cmpn(0)===0)return this.curve.point(null,null);var a=this.curve.a;var x2=this.x.redSqr();var dyinv=ys1.redInvm();var c=x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);var nx=c.redSqr().redISub(this.x.redAdd(this.x));var ny=c.redMul(this.x.redSub(nx)).redISub(this.y);return this.curve.point(nx,ny)};Point.prototype.getX=function getX(){return this.x.fromRed()};Point.prototype.getY=function getY(){return this.y.fromRed()};Point.prototype.mul=function mul(k){k=new BN(k,16);if(this._hasDoubles(k))return this.curve._fixedNafMul(this,k);else if(this.curve.endo)return this.curve._endoWnafMulAdd([this],[k]);else return this.curve._wnafMul(this,k)};Point.prototype.mulAdd=function mulAdd(k1,p2,k2){var points=[this,p2];var coeffs=[k1,k2];if(this.curve.endo)return this.curve._endoWnafMulAdd(points,coeffs);else return this.curve._wnafMulAdd(1,points,coeffs,2)};Point.prototype.jmulAdd=function jmulAdd(k1,p2,k2){var points=[this,p2];var coeffs=[k1,k2];if(this.curve.endo)return this.curve._endoWnafMulAdd(points,coeffs,true);else return this.curve._wnafMulAdd(1,points,coeffs,2,true)};Point.prototype.eq=function eq(p){return this===p||this.inf===p.inf&&(this.inf||this.x.cmp(p.x)===0&&this.y.cmp(p.y)===0)};Point.prototype.neg=function neg(_precompute){if(this.inf)return this;var res=this.curve.point(this.x,this.y.redNeg());if(_precompute&&this.precomputed){var pre=this.precomputed;var negate=function(p){return p.neg()};res.precomputed={naf:pre.naf&&{wnd:pre.naf.wnd,points:pre.naf.points.map(negate)},doubles:pre.doubles&&{step:pre.doubles.step,points:pre.doubles.points.map(negate)}}}return res};Point.prototype.toJ=function toJ(){if(this.inf)return this.curve.jpoint(null,null,null);var res=this.curve.jpoint(this.x,this.y,this.curve.one);return res};function JPoint(curve,x,y,z){Base.BasePoint.call(this,curve,"jacobian");if(x===null&&y===null&&z===null){this.x=this.curve.one;this.y=this.curve.one;this.z=new BN(0)}else{this.x=new BN(x,16);this.y=new BN(y,16);this.z=new BN(z,16)}if(!this.x.red)this.x=this.x.toRed(this.curve.red);if(!this.y.red)this.y=this.y.toRed(this.curve.red);if(!this.z.red)this.z=this.z.toRed(this.curve.red);this.zOne=this.z===this.curve.one}inherits(JPoint,Base.BasePoint);ShortCurve.prototype.jpoint=function jpoint(x,y,z){return new JPoint(this,x,y,z)};JPoint.prototype.toP=function toP(){if(this.isInfinity())return this.curve.point(null,null);var zinv=this.z.redInvm();var zinv2=zinv.redSqr();var ax=this.x.redMul(zinv2);var ay=this.y.redMul(zinv2).redMul(zinv);return this.curve.point(ax,ay)};JPoint.prototype.neg=function neg(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};JPoint.prototype.add=function add(p){if(this.isInfinity())return p;if(p.isInfinity())return this;var pz2=p.z.redSqr();var z2=this.z.redSqr();var u1=this.x.redMul(pz2);var u2=p.x.redMul(z2);var s1=this.y.redMul(pz2.redMul(p.z));var s2=p.y.redMul(z2.redMul(this.z));var h=u1.redSub(u2);var r=s1.redSub(s2);if(h.cmpn(0)===0){if(r.cmpn(0)!==0)return this.curve.jpoint(null,null,null);else return this.dbl()}var h2=h.redSqr();var h3=h2.redMul(h);var v=u1.redMul(h2);var nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);var ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));var nz=this.z.redMul(p.z).redMul(h);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.mixedAdd=function mixedAdd(p){if(this.isInfinity())return p.toJ();if(p.isInfinity())return this;var z2=this.z.redSqr();var u1=this.x;var u2=p.x.redMul(z2);var s1=this.y;var s2=p.y.redMul(z2).redMul(this.z);var h=u1.redSub(u2);var r=s1.redSub(s2);if(h.cmpn(0)===0){if(r.cmpn(0)!==0)return this.curve.jpoint(null,null,null);else return this.dbl()}var h2=h.redSqr();var h3=h2.redMul(h);var v=u1.redMul(h2);var nx=r.redSqr().redIAdd(h3).redISub(v).redISub(v);var ny=r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));var nz=this.z.redMul(h);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.dblp=function dblp(pow){if(pow===0)return this;if(this.isInfinity())return this;if(!pow)return this.dbl();if(this.curve.zeroA||this.curve.threeA){var r=this;for(var i=0;i<pow;i++)r=r.dbl();return r}var a=this.curve.a;var tinv=this.curve.tinv;var jx=this.x;var jy=this.y;var jz=this.z;var jz4=jz.redSqr().redSqr();var jyd=jy.redAdd(jy);for(var i=0;i<pow;i++){var jx2=jx.redSqr();var jyd2=jyd.redSqr();var jyd4=jyd2.redSqr();var c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));var t1=jx.redMul(jyd2);var nx=c.redSqr().redISub(t1.redAdd(t1));var t2=t1.redISub(nx);var dny=c.redMul(t2);dny=dny.redIAdd(dny).redISub(jyd4);var nz=jyd.redMul(jz);if(i+1<pow)jz4=jz4.redMul(jyd4);jx=nx;jz=nz;jyd=dny}return this.curve.jpoint(jx,jyd.redMul(tinv),jz)};JPoint.prototype.dbl=function dbl(){if(this.isInfinity())return this;if(this.curve.zeroA)return this._zeroDbl();else if(this.curve.threeA)return this._threeDbl();else return this._dbl()};JPoint.prototype._zeroDbl=function _zeroDbl(){var nx;var ny;var nz;if(this.zOne){var xx=this.x.redSqr();var yy=this.y.redSqr();var yyyy=yy.redSqr();var s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx);var t=m.redSqr().redISub(s).redISub(s);var yyyy8=yyyy.redIAdd(yyyy);yyyy8=yyyy8.redIAdd(yyyy8);yyyy8=yyyy8.redIAdd(yyyy8);nx=t;ny=m.redMul(s.redISub(t)).redISub(yyyy8);nz=this.y.redAdd(this.y)}else{var a=this.x.redSqr();var b=this.y.redSqr();var c=b.redSqr();var d=this.x.redAdd(b).redSqr().redISub(a).redISub(c);d=d.redIAdd(d);var e=a.redAdd(a).redIAdd(a);var f=e.redSqr();var c8=c.redIAdd(c);c8=c8.redIAdd(c8);c8=c8.redIAdd(c8);nx=f.redISub(d).redISub(d);ny=e.redMul(d.redISub(nx)).redISub(c8);nz=this.y.redMul(this.z);nz=nz.redIAdd(nz)}return this.curve.jpoint(nx,ny,nz)};JPoint.prototype._threeDbl=function _threeDbl(){var nx;var ny;var nz;if(this.zOne){var xx=this.x.redSqr();var yy=this.y.redSqr();var yyyy=yy.redSqr();var s=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);s=s.redIAdd(s);var m=xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);var t=m.redSqr().redISub(s).redISub(s);nx=t;var yyyy8=yyyy.redIAdd(yyyy);yyyy8=yyyy8.redIAdd(yyyy8);yyyy8=yyyy8.redIAdd(yyyy8);ny=m.redMul(s.redISub(t)).redISub(yyyy8);nz=this.y.redAdd(this.y)}else{var delta=this.z.redSqr();var gamma=this.y.redSqr();var beta=this.x.redMul(gamma);var alpha=this.x.redSub(delta).redMul(this.x.redAdd(delta));alpha=alpha.redAdd(alpha).redIAdd(alpha);var beta4=beta.redIAdd(beta);beta4=beta4.redIAdd(beta4);var beta8=beta4.redAdd(beta4);nx=alpha.redSqr().redISub(beta8);nz=this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);var ggamma8=gamma.redSqr();ggamma8=ggamma8.redIAdd(ggamma8);ggamma8=ggamma8.redIAdd(ggamma8);ggamma8=ggamma8.redIAdd(ggamma8);ny=alpha.redMul(beta4.redISub(nx)).redISub(ggamma8)}return this.curve.jpoint(nx,ny,nz)};JPoint.prototype._dbl=function _dbl(){var a=this.curve.a;var jx=this.x;var jy=this.y;var jz=this.z;var jz4=jz.redSqr().redSqr();var jx2=jx.redSqr();var jy2=jy.redSqr();var c=jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));var jxd4=jx.redAdd(jx);jxd4=jxd4.redIAdd(jxd4);var t1=jxd4.redMul(jy2);var nx=c.redSqr().redISub(t1.redAdd(t1));var t2=t1.redISub(nx);var jyd8=jy2.redSqr();jyd8=jyd8.redIAdd(jyd8);jyd8=jyd8.redIAdd(jyd8);jyd8=jyd8.redIAdd(jyd8);var ny=c.redMul(t2).redISub(jyd8);var nz=jy.redAdd(jy).redMul(jz);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.trpl=function trpl(){if(!this.curve.zeroA)return this.dbl().add(this);var xx=this.x.redSqr();var yy=this.y.redSqr();var zz=this.z.redSqr();var yyyy=yy.redSqr();var m=xx.redAdd(xx).redIAdd(xx);var mm=m.redSqr();var e=this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);e=e.redIAdd(e);e=e.redAdd(e).redIAdd(e);e=e.redISub(mm);var ee=e.redSqr();var t=yyyy.redIAdd(yyyy);t=t.redIAdd(t);t=t.redIAdd(t);t=t.redIAdd(t);var u=m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);var yyu4=yy.redMul(u);yyu4=yyu4.redIAdd(yyu4);yyu4=yyu4.redIAdd(yyu4);var nx=this.x.redMul(ee).redISub(yyu4);nx=nx.redIAdd(nx);nx=nx.redIAdd(nx);var ny=this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));ny=ny.redIAdd(ny);ny=ny.redIAdd(ny);ny=ny.redIAdd(ny);var nz=this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);return this.curve.jpoint(nx,ny,nz)};JPoint.prototype.mul=function mul(k,kbase){k=new BN(k,kbase);return this.curve._wnafMul(this,k)};JPoint.prototype.eq=function eq(p){if(p.type==="affine")return this.eq(p.toJ());if(this===p)return true;var z2=this.z.redSqr();var pz2=p.z.redSqr();if(this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0)!==0)return false;var z3=z2.redMul(this.z);var pz3=pz2.redMul(p.z);return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0)===0};JPoint.prototype.eqXToP=function eqXToP(x){var zs=this.z.redSqr();var rx=x.toRed(this.curve.red).redMul(zs);if(this.x.cmp(rx)===0)return true;var xc=x.clone();var t=this.curve.redN.redMul(zs);for(;;){xc.iadd(this.curve.n);if(xc.cmp(this.curve.p)>=0)return false;rx.redIAdd(t);if(this.x.cmp(rx)===0)return true}return false};JPoint.prototype.inspect=function inspect(){if(this.isInfinity())return"<EC JPoint Infinity>";return"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};JPoint.prototype.isInfinity=function isInfinity(){return this.z.cmpn(0)===0}},{"../../elliptic":266,"../curve":269,"bn.js":218,inherits:293}],272:[function(require,module,exports){"use strict";var curves=exports;var hash=require("hash.js");var elliptic=require("../elliptic");var assert=elliptic.utils.assert;function PresetCurve(options){if(options.type==="short")this.curve=new elliptic.curve.short(options);else if(options.type==="edwards")this.curve=new elliptic.curve.edwards(options);else this.curve=new elliptic.curve.mont(options);this.g=this.curve.g;this.n=this.curve.n;this.hash=options.hash;assert(this.g.validate(),"Invalid curve");assert(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}curves.PresetCurve=PresetCurve;function defineCurve(name,options){Object.defineProperty(curves,name,{configurable:true,enumerable:true,get:function(){var curve=new PresetCurve(options);Object.defineProperty(curves,name,{configurable:true,enumerable:true,value:curve});return curve}})}defineCurve("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:hash.sha256,gRed:false,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]
});defineCurve("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:hash.sha256,gRed:false,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]});defineCurve("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:hash.sha256,gRed:false,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]});defineCurve("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff "+"fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff "+"fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f "+"5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 "+"f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:hash.sha384,gRed:false,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 "+"5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 "+"0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]});defineCurve("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff "+"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff "+"ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff "+"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff "+"ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b "+"99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd "+"3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff "+"ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 "+"f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:hash.sha512,gRed:false,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 "+"053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 "+"a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 "+"579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 "+"3fad0761 353c7086 a272c240 88be9476 9fd16650"]});defineCurve("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"0",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:false,g:["9"]});defineCurve("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:hash.sha256,gRed:false,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var pre;try{pre=require("./precomputed/secp256k1")}catch(e){pre=undefined}defineCurve("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:hash.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:false,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",pre]})},{"../elliptic":266,"./precomputed/secp256k1":280,"hash.js":285}],273:[function(require,module,exports){"use strict";var BN=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;var KeyPair=require("./key");var Signature=require("./signature");function EC(options){if(!(this instanceof EC))return new EC(options);if(typeof options==="string"){assert(elliptic.curves.hasOwnProperty(options),"Unknown curve "+options);options=elliptic.curves[options]}if(options instanceof elliptic.curves.PresetCurve)options={curve:options};this.curve=options.curve.curve;this.n=this.curve.n;this.nh=this.n.ushrn(1);this.g=this.curve.g;this.g=options.curve.g;this.g.precompute(options.curve.n.bitLength()+1);this.hash=options.hash||options.curve.hash}module.exports=EC;EC.prototype.keyPair=function keyPair(options){return new KeyPair(this,options)};EC.prototype.keyFromPrivate=function keyFromPrivate(priv,enc){return KeyPair.fromPrivate(this,priv,enc)};EC.prototype.keyFromPublic=function keyFromPublic(pub,enc){return KeyPair.fromPublic(this,pub,enc)};EC.prototype.genKeyPair=function genKeyPair(options){if(!options)options={};var drbg=new elliptic.hmacDRBG({hash:this.hash,pers:options.pers,entropy:options.entropy||elliptic.rand(this.hash.hmacStrength),nonce:this.n.toArray()});var bytes=this.n.byteLength();var ns2=this.n.sub(new BN(2));do{var priv=new BN(drbg.generate(bytes));if(priv.cmp(ns2)>0)continue;priv.iaddn(1);return this.keyFromPrivate(priv)}while(true)};EC.prototype._truncateToN=function truncateToN(msg,truncOnly){var delta=msg.byteLength()*8-this.n.bitLength();if(delta>0)msg=msg.ushrn(delta);if(!truncOnly&&msg.cmp(this.n)>=0)return msg.sub(this.n);else return msg};EC.prototype.sign=function sign(msg,key,enc,options){if(typeof enc==="object"){options=enc;enc=null}if(!options)options={};key=this.keyFromPrivate(key,enc);msg=this._truncateToN(new BN(msg,16));var bytes=this.n.byteLength();var bkey=key.getPrivate().toArray("be",bytes);var nonce=msg.toArray("be",bytes);var drbg=new elliptic.hmacDRBG({hash:this.hash,entropy:bkey,nonce:nonce,pers:options.pers,persEnc:options.persEnc});var ns1=this.n.sub(new BN(1));for(var iter=0;true;iter++){var k=options.k?options.k(iter):new BN(drbg.generate(this.n.byteLength()));k=this._truncateToN(k,true);if(k.cmpn(1)<=0||k.cmp(ns1)>=0)continue;var kp=this.g.mul(k);if(kp.isInfinity())continue;var kpX=kp.getX();var r=kpX.umod(this.n);if(r.cmpn(0)===0)continue;var s=k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));s=s.umod(this.n);if(s.cmpn(0)===0)continue;var recoveryParam=(kp.getY().isOdd()?1:0)|(kpX.cmp(r)!==0?2:0);if(options.canonical&&s.cmp(this.nh)>0){s=this.n.sub(s);recoveryParam^=1}return new Signature({r:r,s:s,recoveryParam:recoveryParam})}};EC.prototype.verify=function verify(msg,signature,key,enc){msg=this._truncateToN(new BN(msg,16));key=this.keyFromPublic(key,enc);signature=new Signature(signature,"hex");var r=signature.r;var s=signature.s;if(r.cmpn(1)<0||r.cmp(this.n)>=0)return false;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return false;var sinv=s.invm(this.n);var u1=sinv.mul(msg).umod(this.n);var u2=sinv.mul(r).umod(this.n);if(!this.curve._maxwellTrick){var p=this.g.mulAdd(u1,key.getPublic(),u2);if(p.isInfinity())return false;return p.getX().umod(this.n).cmp(r)===0}var p=this.g.jmulAdd(u1,key.getPublic(),u2);if(p.isInfinity())return false;return p.eqXToP(r)};EC.prototype.recoverPubKey=function(msg,signature,j,enc){assert((3&j)===j,"The recovery param is more than two bits");signature=new Signature(signature,enc);var n=this.n;var e=new BN(msg);var r=signature.r;var s=signature.s;var isYOdd=j&1;var isSecondKey=j>>1;if(r.cmp(this.curve.p.umod(this.curve.n))>=0&&isSecondKey)throw new Error("Unable to find sencond key candinate");if(isSecondKey)r=this.curve.pointFromX(r.add(this.curve.n),isYOdd);else r=this.curve.pointFromX(r,isYOdd);var rInv=signature.r.invm(n);var s1=n.sub(e).mul(rInv).umod(n);var s2=s.mul(rInv).umod(n);return this.g.mulAdd(s1,r,s2)};EC.prototype.getKeyRecoveryParam=function(e,signature,Q,enc){signature=new Signature(signature,enc);if(signature.recoveryParam!==null)return signature.recoveryParam;for(var i=0;i<4;i++){var Qprime;try{Qprime=this.recoverPubKey(e,signature,i)}catch(e){continue}if(Qprime.eq(Q))return i}throw new Error("Unable to find valid recovery factor")}},{"../../elliptic":266,"./key":274,"./signature":275,"bn.js":218}],274:[function(require,module,exports){"use strict";var BN=require("bn.js");function KeyPair(ec,options){this.ec=ec;this.priv=null;this.pub=null;if(options.priv)this._importPrivate(options.priv,options.privEnc);if(options.pub)this._importPublic(options.pub,options.pubEnc)}module.exports=KeyPair;KeyPair.fromPublic=function fromPublic(ec,pub,enc){if(pub instanceof KeyPair)return pub;return new KeyPair(ec,{pub:pub,pubEnc:enc})};KeyPair.fromPrivate=function fromPrivate(ec,priv,enc){if(priv instanceof KeyPair)return priv;return new KeyPair(ec,{priv:priv,privEnc:enc})};KeyPair.prototype.validate=function validate(){var pub=this.getPublic();if(pub.isInfinity())return{result:false,reason:"Invalid public key"};if(!pub.validate())return{result:false,reason:"Public key is not a point"};if(!pub.mul(this.ec.curve.n).isInfinity())return{result:false,reason:"Public key * N != O"};return{result:true,reason:null}};KeyPair.prototype.getPublic=function getPublic(compact,enc){if(typeof compact==="string"){enc=compact;compact=null}if(!this.pub)this.pub=this.ec.g.mul(this.priv);if(!enc)return this.pub;return this.pub.encode(enc,compact)};KeyPair.prototype.getPrivate=function getPrivate(enc){if(enc==="hex")return this.priv.toString(16,2);else return this.priv};KeyPair.prototype._importPrivate=function _importPrivate(key,enc){this.priv=new BN(key,enc||16);this.priv=this.priv.umod(this.ec.curve.n)};KeyPair.prototype._importPublic=function _importPublic(key,enc){if(key.x||key.y){this.pub=this.ec.curve.point(key.x,key.y);return}this.pub=this.ec.curve.decodePoint(key,enc)};KeyPair.prototype.derive=function derive(pub){return pub.mul(this.priv).getX()};KeyPair.prototype.sign=function sign(msg,enc,options){return this.ec.sign(msg,this,enc,options)};KeyPair.prototype.verify=function verify(msg,signature){return this.ec.verify(msg,signature,this)};KeyPair.prototype.inspect=function inspect(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},{"bn.js":218}],275:[function(require,module,exports){"use strict";var BN=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;function Signature(options,enc){if(options instanceof Signature)return options;if(this._importDER(options,enc))return;assert(options.r&&options.s,"Signature without r or s");this.r=new BN(options.r,16);this.s=new BN(options.s,16);if(options.recoveryParam===undefined)this.recoveryParam=null;else this.recoveryParam=options.recoveryParam}module.exports=Signature;function Position(){this.place=0}function getLength(buf,p){var initial=buf[p.place++];if(!(initial&128)){return initial}var octetLen=initial&15;var val=0;for(var i=0,off=p.place;i<octetLen;i++,off++){val<<=8;val|=buf[off]}p.place=off;return val}function rmPadding(buf){var i=0;var len=buf.length-1;while(!buf[i]&&!(buf[i+1]&128)&&i<len){i++}if(i===0){return buf}return buf.slice(i)}Signature.prototype._importDER=function _importDER(data,enc){data=utils.toArray(data,enc);var p=new Position;if(data[p.place++]!==48){return false}var len=getLength(data,p);if(len+p.place!==data.length){return false}if(data[p.place++]!==2){return false}var rlen=getLength(data,p);var r=data.slice(p.place,rlen+p.place);p.place+=rlen;if(data[p.place++]!==2){return false}var slen=getLength(data,p);if(data.length!==slen+p.place){return false}var s=data.slice(p.place,slen+p.place);if(r[0]===0&&r[1]&128){r=r.slice(1)}if(s[0]===0&&s[1]&128){s=s.slice(1)}this.r=new BN(r);this.s=new BN(s);this.recoveryParam=null;return true};function constructLength(arr,len){if(len<128){arr.push(len);return}var octets=1+(Math.log(len)/Math.LN2>>>3);arr.push(octets|128);while(--octets){arr.push(len>>>(octets<<3)&255)}arr.push(len)}Signature.prototype.toDER=function toDER(enc){var r=this.r.toArray();var s=this.s.toArray();if(r[0]&128)r=[0].concat(r);if(s[0]&128)s=[0].concat(s);r=rmPadding(r);s=rmPadding(s);while(!s[0]&&!(s[1]&128)){s=s.slice(1)}var arr=[2];constructLength(arr,r.length);arr=arr.concat(r);arr.push(2);constructLength(arr,s.length);var backHalf=arr.concat(s);var res=[48];constructLength(res,backHalf.length);res=res.concat(backHalf);return utils.encode(res,enc)}},{"../../elliptic":266,"bn.js":218}],276:[function(require,module,exports){"use strict";var hash=require("hash.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;var parseBytes=utils.parseBytes;var KeyPair=require("./key");var Signature=require("./signature");function EDDSA(curve){assert(curve==="ed25519","only tested with ed25519 so far");if(!(this instanceof EDDSA))return new EDDSA(curve);var curve=elliptic.curves[curve].curve;this.curve=curve;this.g=curve.g;this.g.precompute(curve.n.bitLength()+1);this.pointClass=curve.point().constructor;this.encodingLength=Math.ceil(curve.n.bitLength()/8);this.hash=hash.sha512}module.exports=EDDSA;EDDSA.prototype.sign=function sign(message,secret){message=parseBytes(message);var key=this.keyFromSecret(secret);var r=this.hashInt(key.messagePrefix(),message);var R=this.g.mul(r);var Rencoded=this.encodePoint(R);var s_=this.hashInt(Rencoded,key.pubBytes(),message).mul(key.priv());var S=r.add(s_).umod(this.curve.n);return this.makeSignature({R:R,S:S,Rencoded:Rencoded})};EDDSA.prototype.verify=function verify(message,sig,pub){message=parseBytes(message);sig=this.makeSignature(sig);var key=this.keyFromPublic(pub);var h=this.hashInt(sig.Rencoded(),key.pubBytes(),message);var SG=this.g.mul(sig.S());var RplusAh=sig.R().add(key.pub().mul(h));return RplusAh.eq(SG)};EDDSA.prototype.hashInt=function hashInt(){var hash=this.hash();for(var i=0;i<arguments.length;i++)hash.update(arguments[i]);return utils.intFromLE(hash.digest()).umod(this.curve.n)};EDDSA.prototype.keyFromPublic=function keyFromPublic(pub){return KeyPair.fromPublic(this,pub)};EDDSA.prototype.keyFromSecret=function keyFromSecret(secret){return KeyPair.fromSecret(this,secret)};EDDSA.prototype.makeSignature=function makeSignature(sig){if(sig instanceof Signature)return sig;return new Signature(this,sig)};EDDSA.prototype.encodePoint=function encodePoint(point){var enc=point.getY().toArray("le",this.encodingLength);enc[this.encodingLength-1]|=point.getX().isOdd()?128:0;return enc};EDDSA.prototype.decodePoint=function decodePoint(bytes){bytes=utils.parseBytes(bytes);var lastIx=bytes.length-1;var normed=bytes.slice(0,lastIx).concat(bytes[lastIx]&~128);var xIsOdd=(bytes[lastIx]&128)!==0;var y=utils.intFromLE(normed);return this.curve.pointFromY(y,xIsOdd)};EDDSA.prototype.encodeInt=function encodeInt(num){return num.toArray("le",this.encodingLength)};EDDSA.prototype.decodeInt=function decodeInt(bytes){return utils.intFromLE(bytes)};EDDSA.prototype.isPoint=function isPoint(val){return val instanceof this.pointClass}},{"../../elliptic":266,"./key":277,"./signature":278,"hash.js":285}],277:[function(require,module,exports){"use strict";var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;var parseBytes=utils.parseBytes;var cachedProperty=utils.cachedProperty;function KeyPair(eddsa,params){this.eddsa=eddsa;this._secret=parseBytes(params.secret);if(eddsa.isPoint(params.pub))this._pub=params.pub;else this._pubBytes=parseBytes(params.pub)}KeyPair.fromPublic=function fromPublic(eddsa,pub){if(pub instanceof KeyPair)return pub;return new KeyPair(eddsa,{pub:pub})};KeyPair.fromSecret=function fromSecret(eddsa,secret){if(secret instanceof KeyPair)return secret;return new KeyPair(eddsa,{secret:secret})};KeyPair.prototype.secret=function secret(){return this._secret};cachedProperty(KeyPair,"pubBytes",function pubBytes(){return this.eddsa.encodePoint(this.pub())});cachedProperty(KeyPair,"pub",function pub(){if(this._pubBytes)return this.eddsa.decodePoint(this._pubBytes);return this.eddsa.g.mul(this.priv())});cachedProperty(KeyPair,"privBytes",function privBytes(){var eddsa=this.eddsa;var hash=this.hash();var lastIx=eddsa.encodingLength-1;var a=hash.slice(0,eddsa.encodingLength);a[0]&=248;a[lastIx]&=127;a[lastIx]|=64;return a});cachedProperty(KeyPair,"priv",function priv(){return this.eddsa.decodeInt(this.privBytes())});cachedProperty(KeyPair,"hash",function hash(){return this.eddsa.hash().update(this.secret()).digest()});cachedProperty(KeyPair,"messagePrefix",function messagePrefix(){return this.hash().slice(this.eddsa.encodingLength)});KeyPair.prototype.sign=function sign(message){assert(this._secret,"KeyPair can only verify");return this.eddsa.sign(message,this)};KeyPair.prototype.verify=function verify(message,sig){return this.eddsa.verify(message,sig,this)};KeyPair.prototype.getSecret=function getSecret(enc){assert(this._secret,"KeyPair is public only");return utils.encode(this.secret(),enc)};KeyPair.prototype.getPublic=function getPublic(enc){return utils.encode(this.pubBytes(),enc)};module.exports=KeyPair},{"../../elliptic":266}],278:[function(require,module,exports){"use strict";var BN=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;var cachedProperty=utils.cachedProperty;var parseBytes=utils.parseBytes;function Signature(eddsa,sig){this.eddsa=eddsa;if(typeof sig!=="object")sig=parseBytes(sig);if(Array.isArray(sig)){sig={R:sig.slice(0,eddsa.encodingLength),S:sig.slice(eddsa.encodingLength)}}assert(sig.R&&sig.S,"Signature without R or S");if(eddsa.isPoint(sig.R))this._R=sig.R;if(sig.S instanceof BN)this._S=sig.S;this._Rencoded=Array.isArray(sig.R)?sig.R:sig.Rencoded;this._Sencoded=Array.isArray(sig.S)?sig.S:sig.Sencoded}cachedProperty(Signature,"S",function S(){return this.eddsa.decodeInt(this.Sencoded())});cachedProperty(Signature,"R",function R(){return this.eddsa.decodePoint(this.Rencoded())});cachedProperty(Signature,"Rencoded",function Rencoded(){return this.eddsa.encodePoint(this.R())});cachedProperty(Signature,"Sencoded",function Sencoded(){return this.eddsa.encodeInt(this.S())});Signature.prototype.toBytes=function toBytes(){return this.Rencoded().concat(this.Sencoded())};Signature.prototype.toHex=function toHex(){return utils.encode(this.toBytes(),"hex").toUpperCase()};module.exports=Signature},{"../../elliptic":266,"bn.js":218}],279:[function(require,module,exports){"use strict";var hash=require("hash.js");var elliptic=require("../elliptic");var utils=elliptic.utils;var assert=utils.assert;function HmacDRBG(options){if(!(this instanceof HmacDRBG))return new HmacDRBG(options);this.hash=options.hash;this.predResist=!!options.predResist;this.outLen=this.hash.outSize;this.minEntropy=options.minEntropy||this.hash.hmacStrength;this.reseed=null;this.reseedInterval=null;this.K=null;this.V=null;var entropy=utils.toArray(options.entropy,options.entropyEnc);var nonce=utils.toArray(options.nonce,options.nonceEnc);var pers=utils.toArray(options.pers,options.persEnc);assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits");this._init(entropy,nonce,pers)}module.exports=HmacDRBG;HmacDRBG.prototype._init=function init(entropy,nonce,pers){var seed=entropy.concat(nonce).concat(pers);this.K=new Array(this.outLen/8);this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++){this.K[i]=0;this.V[i]=1}this._update(seed);this.reseed=1;this.reseedInterval=281474976710656};HmacDRBG.prototype._hmac=function hmac(){return new hash.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function update(seed){var kmac=this._hmac().update(this.V).update([0]);if(seed)kmac=kmac.update(seed);this.K=kmac.digest();this.V=this._hmac().update(this.V).digest();if(!seed)return;this.K=this._hmac().update(this.V).update([1]).update(seed).digest();this.V=this._hmac().update(this.V).digest()};HmacDRBG.prototype.reseed=function reseed(entropy,entropyEnc,add,addEnc){if(typeof entropyEnc!=="string"){addEnc=add;add=entropyEnc;entropyEnc=null}entropy=utils.toBuffer(entropy,entropyEnc);add=utils.toBuffer(add,addEnc);assert(entropy.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits");this._update(entropy.concat(add||[]));this.reseed=1};HmacDRBG.prototype.generate=function generate(len,enc,add,addEnc){if(this.reseed>this.reseedInterval)throw new Error("Reseed is required");if(typeof enc!=="string"){addEnc=add;add=enc;enc=null}if(add){add=utils.toArray(add,addEnc);this._update(add)}var temp=[];while(temp.length<len){this.V=this._hmac().update(this.V).digest();temp=temp.concat(this.V)}var res=temp.slice(0,len);this._update(add);this.reseed++;return utils.encode(res,enc)}},{"../elliptic":266,"hash.js":285}],280:[function(require,module,exports){module.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]
}}},{}],281:[function(require,module,exports){"use strict";var utils=exports;var BN=require("bn.js");utils.assert=function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")};function toArray(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if(typeof msg!=="string"){for(var i=0;i<msg.length;i++)res[i]=msg[i]|0;return res}if(!enc){for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);var hi=c>>8;var lo=c&255;if(hi)res.push(hi,lo);else res.push(lo)}}else if(enc==="hex"){msg=msg.replace(/[^a-z0-9]+/gi,"");if(msg.length%2!==0)msg="0"+msg;for(var i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}return res}utils.toArray=toArray;function zero2(word){if(word.length===1)return"0"+word;else return word}utils.zero2=zero2;function toHex(msg){var res="";for(var i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}utils.toHex=toHex;utils.encode=function encode(arr,enc){if(enc==="hex")return toHex(arr);else return arr};function getNAF(num,w){var naf=[];var ws=1<<w+1;var k=num.clone();while(k.cmpn(1)>=0){var z;if(k.isOdd()){var mod=k.andln(ws-1);if(mod>(ws>>1)-1)z=(ws>>1)-mod;else z=mod;k.isubn(z)}else{z=0}naf.push(z);var shift=k.cmpn(0)!==0&&k.andln(ws-1)===0?w+1:1;for(var i=1;i<shift;i++)naf.push(0);k.iushrn(shift)}return naf}utils.getNAF=getNAF;function getJSF(k1,k2){var jsf=[[],[]];k1=k1.clone();k2=k2.clone();var d1=0;var d2=0;while(k1.cmpn(-d1)>0||k2.cmpn(-d2)>0){var m14=k1.andln(3)+d1&3;var m24=k2.andln(3)+d2&3;if(m14===3)m14=-1;if(m24===3)m24=-1;var u1;if((m14&1)===0){u1=0}else{var m8=k1.andln(7)+d1&7;if((m8===3||m8===5)&&m24===2)u1=-m14;else u1=m14}jsf[0].push(u1);var u2;if((m24&1)===0){u2=0}else{var m8=k2.andln(7)+d2&7;if((m8===3||m8===5)&&m14===2)u2=-m24;else u2=m24}jsf[1].push(u2);if(2*d1===u1+1)d1=1-d1;if(2*d2===u2+1)d2=1-d2;k1.iushrn(1);k2.iushrn(1)}return jsf}utils.getJSF=getJSF;function cachedProperty(obj,name,computer){var key="_"+name;obj.prototype[name]=function cachedProperty(){return this[key]!==undefined?this[key]:this[key]=computer.call(this)}}utils.cachedProperty=cachedProperty;function parseBytes(bytes){return typeof bytes==="string"?utils.toArray(bytes,"hex"):bytes}utils.parseBytes=parseBytes;function intFromLE(bytes){return new BN(bytes,"hex","le")}utils.intFromLE=intFromLE},{"bn.js":218}],282:[function(require,module,exports){module.exports={_args:[[{raw:"elliptic@^6.0.0",scope:null,escapedName:"elliptic",name:"elliptic",rawSpec:"^6.0.0",spec:">=6.0.0 <7.0.0",type:"range"},"/home/node/.nvm/versions/node/v7.2.0/lib/node_modules/browserify/node_modules/browserify-sign"]],_from:"elliptic@>=6.0.0 <7.0.0",_id:"elliptic@6.3.2",_inCache:true,_location:"/browserify/elliptic",_nodeVersion:"6.3.0",_npmOperationalInternal:{host:"packages-16-east.internal.npmjs.com",tmp:"tmp/elliptic-6.3.2.tgz_1473938837205_0.3108903462998569"},_npmUser:{name:"indutny",email:"fedor@indutny.com"},_npmVersion:"3.10.3",_phantomChildren:{},_requested:{raw:"elliptic@^6.0.0",scope:null,escapedName:"elliptic",name:"elliptic",rawSpec:"^6.0.0",spec:">=6.0.0 <7.0.0",type:"range"},_requiredBy:["/browserify/browserify-sign","/browserify/create-ecdh"],_resolved:"https://registry.npmjs.org/elliptic/-/elliptic-6.3.2.tgz",_shasum:"e4c81e0829cf0a65ab70e998b8232723b5c1bc48",_shrinkwrap:null,_spec:"elliptic@^6.0.0",_where:"/home/node/.nvm/versions/node/v7.2.0/lib/node_modules/browserify/node_modules/browserify-sign",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0",inherits:"^2.0.1"},description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^2.11.3",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2",istanbul:"^0.4.2",jscs:"^2.9.0",jshint:"^2.6.0",mocha:"^2.1.0"},directories:{},dist:{shasum:"e4c81e0829cf0a65ab70e998b8232723b5c1bc48",tarball:"https://registry.npmjs.org/elliptic/-/elliptic-6.3.2.tgz"},files:["lib"],gitHead:"cbace4683a4a548dc0306ef36756151a20299cd5",homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",maintainers:[{name:"indutny",email:"fedor@indutny.com"}],name:"elliptic",optionalDependencies:{},readme:"ERROR: No README data found!",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.3.2"}},{}],283:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],284:[function(require,module,exports){(function(Buffer){var md5=require("create-hash/md5");module.exports=EVP_BytesToKey;function EVP_BytesToKey(password,salt,keyLen,ivLen){if(!Buffer.isBuffer(password)){password=new Buffer(password,"binary")}if(salt&&!Buffer.isBuffer(salt)){salt=new Buffer(salt,"binary")}keyLen=keyLen/8;ivLen=ivLen||0;var ki=0;var ii=0;var key=new Buffer(keyLen);var iv=new Buffer(ivLen);var addmd=0;var md_buf;var i;var bufs=[];while(true){if(addmd++>0){bufs.push(md_buf)}bufs.push(password);if(salt){bufs.push(salt)}md_buf=md5(Buffer.concat(bufs));bufs=[];i=0;if(keyLen>0){while(true){if(keyLen===0){break}if(i===md_buf.length){break}key[ki++]=md_buf[i];keyLen--;i++}}if(ivLen>0&&i!==md_buf.length){while(true){if(ivLen===0){break}if(i===md_buf.length){break}iv[ii++]=md_buf[i];ivLen--;i++}}if(keyLen===0&&ivLen===0){break}}for(i=0;i<md_buf.length;i++){md_buf[i]=0}return{key:key,iv:iv}}}).call(this,require("buffer").Buffer)},{buffer:247,"create-hash/md5":253}],285:[function(require,module,exports){var hash=exports;hash.utils=require("./hash/utils");hash.common=require("./hash/common");hash.sha=require("./hash/sha");hash.ripemd=require("./hash/ripemd");hash.hmac=require("./hash/hmac");hash.sha1=hash.sha.sha1;hash.sha256=hash.sha.sha256;hash.sha224=hash.sha.sha224;hash.sha384=hash.sha.sha384;hash.sha512=hash.sha.sha512;hash.ripemd160=hash.ripemd.ripemd160},{"./hash/common":286,"./hash/hmac":287,"./hash/ripemd":288,"./hash/sha":289,"./hash/utils":290}],286:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;function BlockHash(){this.pending=null;this.pendingTotal=0;this.blockSize=this.constructor.blockSize;this.outSize=this.constructor.outSize;this.hmacStrength=this.constructor.hmacStrength;this.padLength=this.constructor.padLength/8;this.endian="big";this._delta8=this.blockSize/8;this._delta32=this.blockSize/32}exports.BlockHash=BlockHash;BlockHash.prototype.update=function update(msg,enc){msg=utils.toArray(msg,enc);if(!this.pending)this.pending=msg;else this.pending=this.pending.concat(msg);this.pendingTotal+=msg.length;if(this.pending.length>=this._delta8){msg=this.pending;var r=msg.length%this._delta8;this.pending=msg.slice(msg.length-r,msg.length);if(this.pending.length===0)this.pending=null;msg=utils.join32(msg,0,msg.length-r,this.endian);for(var i=0;i<msg.length;i+=this._delta32)this._update(msg,i,i+this._delta32)}return this};BlockHash.prototype.digest=function digest(enc){this.update(this._pad());assert(this.pending===null);return this._digest(enc)};BlockHash.prototype._pad=function pad(){var len=this.pendingTotal;var bytes=this._delta8;var k=bytes-(len+this.padLength)%bytes;var res=new Array(k+this.padLength);res[0]=128;for(var i=1;i<k;i++)res[i]=0;len<<=3;if(this.endian==="big"){for(var t=8;t<this.padLength;t++)res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=len>>>24&255;res[i++]=len>>>16&255;res[i++]=len>>>8&255;res[i++]=len&255}else{res[i++]=len&255;res[i++]=len>>>8&255;res[i++]=len>>>16&255;res[i++]=len>>>24&255;res[i++]=0;res[i++]=0;res[i++]=0;res[i++]=0;for(var t=8;t<this.padLength;t++)res[i++]=0}return res}},{"../hash":285}],287:[function(require,module,exports){var hmac=exports;var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;function Hmac(hash,key,enc){if(!(this instanceof Hmac))return new Hmac(hash,key,enc);this.Hash=hash;this.blockSize=hash.blockSize/8;this.outSize=hash.outSize/8;this.inner=null;this.outer=null;this._init(utils.toArray(key,enc))}module.exports=Hmac;Hmac.prototype._init=function init(key){if(key.length>this.blockSize)key=(new this.Hash).update(key).digest();assert(key.length<=this.blockSize);for(var i=key.length;i<this.blockSize;i++)key.push(0);for(var i=0;i<key.length;i++)key[i]^=54;this.inner=(new this.Hash).update(key);for(var i=0;i<key.length;i++)key[i]^=106;this.outer=(new this.Hash).update(key)};Hmac.prototype.update=function update(msg,enc){this.inner.update(msg,enc);return this};Hmac.prototype.digest=function digest(enc){this.outer.update(this.inner.digest());return this.outer.digest(enc)}},{"../hash":285}],288:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_3=utils.sum32_3;var sum32_4=utils.sum32_4;var BlockHash=hash.common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this);this.h=[1732584193,4023233417,2562383102,271733878,3285377520];this.endian="little"}utils.inherits(RIPEMD160,BlockHash);exports.ripemd160=RIPEMD160;RIPEMD160.blockSize=512;RIPEMD160.outSize=160;RIPEMD160.hmacStrength=192;RIPEMD160.padLength=64;RIPEMD160.prototype._update=function update(msg,start){var A=this.h[0];var B=this.h[1];var C=this.h[2];var D=this.h[3];var E=this.h[4];var Ah=A;var Bh=B;var Ch=C;var Dh=D;var Eh=E;for(var j=0;j<80;j++){var T=sum32(rotl32(sum32_4(A,f(j,B,C,D),msg[r[j]+start],K(j)),s[j]),E);A=E;E=D;D=rotl32(C,10);C=B;B=T;T=sum32(rotl32(sum32_4(Ah,f(79-j,Bh,Ch,Dh),msg[rh[j]+start],Kh(j)),sh[j]),Eh);Ah=Eh;Eh=Dh;Dh=rotl32(Ch,10);Ch=Bh;Bh=T}T=sum32_3(this.h[1],C,Dh);this.h[1]=sum32_3(this.h[2],D,Eh);this.h[2]=sum32_3(this.h[3],E,Ah);this.h[3]=sum32_3(this.h[4],A,Bh);this.h[4]=sum32_3(this.h[0],B,Ch);this.h[0]=T};RIPEMD160.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"little");else return utils.split32(this.h,"little")};function f(j,x,y,z){if(j<=15)return x^y^z;else if(j<=31)return x&y|~x&z;else if(j<=47)return(x|~y)^z;else if(j<=63)return x&z|y&~z;else return x^(y|~z)}function K(j){if(j<=15)return 0;else if(j<=31)return 1518500249;else if(j<=47)return 1859775393;else if(j<=63)return 2400959708;else return 2840853838}function Kh(j){if(j<=15)return 1352829926;else if(j<=31)return 1548603684;else if(j<=47)return 1836072691;else if(j<=63)return 2053994217;else return 0}var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"../hash":285}],289:[function(require,module,exports){var hash=require("../hash");var utils=hash.utils;var assert=utils.assert;var rotr32=utils.rotr32;var rotl32=utils.rotl32;var sum32=utils.sum32;var sum32_4=utils.sum32_4;var sum32_5=utils.sum32_5;var rotr64_hi=utils.rotr64_hi;var rotr64_lo=utils.rotr64_lo;var shr64_hi=utils.shr64_hi;var shr64_lo=utils.shr64_lo;var sum64=utils.sum64;var sum64_hi=utils.sum64_hi;var sum64_lo=utils.sum64_lo;var sum64_4_hi=utils.sum64_4_hi;var sum64_4_lo=utils.sum64_4_lo;var sum64_5_hi=utils.sum64_5_hi;var sum64_5_lo=utils.sum64_5_lo;var BlockHash=hash.common.BlockHash;var sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA256(){if(!(this instanceof SHA256))return new SHA256;BlockHash.call(this);this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];this.k=sha256_K;this.W=new Array(64)}utils.inherits(SHA256,BlockHash);exports.sha256=SHA256;SHA256.blockSize=512;SHA256.outSize=256;SHA256.hmacStrength=192;SHA256.padLength=64;SHA256.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=sum32_4(g1_256(W[i-2]),W[i-7],g0_256(W[i-15]),W[i-16]);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];var f=this.h[5];var g=this.h[6];var h=this.h[7];assert(this.k.length===W.length);for(var i=0;i<W.length;i++){var T1=sum32_5(h,s1_256(e),ch32(e,f,g),this.k[i],W[i]);var T2=sum32(s0_256(a),maj32(a,b,c));h=g;g=f;f=e;e=sum32(d,T1);d=c;c=b;b=a;a=sum32(T1,T2)}this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e);this.h[5]=sum32(this.h[5],f);this.h[6]=sum32(this.h[6],g);this.h[7]=sum32(this.h[7],h)};SHA256.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256.call(this);this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils.inherits(SHA224,SHA256);exports.sha224=SHA224;SHA224.blockSize=512;SHA224.outSize=224;SHA224.hmacStrength=192;SHA224.padLength=64;SHA224.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h.slice(0,7),"big");else return utils.split32(this.h.slice(0,7),"big")};function SHA512(){if(!(this instanceof SHA512))return new SHA512;BlockHash.call(this);this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209];this.k=sha512_K;this.W=new Array(160)}utils.inherits(SHA512,BlockHash);exports.sha512=SHA512;SHA512.blockSize=1024;SHA512.outSize=512;SHA512.hmacStrength=192;SHA512.padLength=128;SHA512.prototype._prepareBlock=function _prepareBlock(msg,start){var W=this.W;for(var i=0;i<32;i++)W[i]=msg[start+i];for(;i<W.length;i+=2){var c0_hi=g1_512_hi(W[i-4],W[i-3]);var c0_lo=g1_512_lo(W[i-4],W[i-3]);var c1_hi=W[i-14];var c1_lo=W[i-13];var c2_hi=g0_512_hi(W[i-30],W[i-29]);var c2_lo=g0_512_lo(W[i-30],W[i-29]);var c3_hi=W[i-32];var c3_lo=W[i-31];W[i]=sum64_4_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo);W[i+1]=sum64_4_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo)}};SHA512.prototype._update=function _update(msg,start){this._prepareBlock(msg,start);var W=this.W;var ah=this.h[0];var al=this.h[1];var bh=this.h[2];var bl=this.h[3];var ch=this.h[4];var cl=this.h[5];var dh=this.h[6];var dl=this.h[7];var eh=this.h[8];var el=this.h[9];var fh=this.h[10];var fl=this.h[11];var gh=this.h[12];var gl=this.h[13];var hh=this.h[14];var hl=this.h[15];assert(this.k.length===W.length);for(var i=0;i<W.length;i+=2){var c0_hi=hh;var c0_lo=hl;var c1_hi=s1_512_hi(eh,el);var c1_lo=s1_512_lo(eh,el);var c2_hi=ch64_hi(eh,el,fh,fl,gh,gl);var c2_lo=ch64_lo(eh,el,fh,fl,gh,gl);var c3_hi=this.k[i];var c3_lo=this.k[i+1];var c4_hi=W[i];var c4_lo=W[i+1];var T1_hi=sum64_5_hi(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);var T1_lo=sum64_5_lo(c0_hi,c0_lo,c1_hi,c1_lo,c2_hi,c2_lo,c3_hi,c3_lo,c4_hi,c4_lo);var c0_hi=s0_512_hi(ah,al);var c0_lo=s0_512_lo(ah,al);var c1_hi=maj64_hi(ah,al,bh,bl,ch,cl);var c1_lo=maj64_lo(ah,al,bh,bl,ch,cl);var T2_hi=sum64_hi(c0_hi,c0_lo,c1_hi,c1_lo);var T2_lo=sum64_lo(c0_hi,c0_lo,c1_hi,c1_lo);hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;eh=sum64_hi(dh,dl,T1_hi,T1_lo);el=sum64_lo(dl,dl,T1_hi,T1_lo);dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;ah=sum64_hi(T1_hi,T1_lo,T2_hi,T2_lo);al=sum64_lo(T1_hi,T1_lo,T2_hi,T2_lo)}sum64(this.h,0,ah,al);sum64(this.h,2,bh,bl);sum64(this.h,4,ch,cl);sum64(this.h,6,dh,dl);sum64(this.h,8,eh,el);sum64(this.h,10,fh,fl);sum64(this.h,12,gh,gl);sum64(this.h,14,hh,hl)};SHA512.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function SHA384(){if(!(this instanceof SHA384))return new SHA384;SHA512.call(this);this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils.inherits(SHA384,SHA512);exports.sha384=SHA384;SHA384.blockSize=1024;SHA384.outSize=384;SHA384.hmacStrength=192;SHA384.padLength=128;SHA384.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h.slice(0,12),"big");else return utils.split32(this.h.slice(0,12),"big")};function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash.call(this);this.h=[1732584193,4023233417,2562383102,271733878,3285377520];this.W=new Array(80)}utils.inherits(SHA1,BlockHash);exports.sha1=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function _update(msg,start){var W=this.W;for(var i=0;i<16;i++)W[i]=msg[start+i];for(;i<W.length;i++)W[i]=rotl32(W[i-3]^W[i-8]^W[i-14]^W[i-16],1);var a=this.h[0];var b=this.h[1];var c=this.h[2];var d=this.h[3];var e=this.h[4];for(var i=0;i<W.length;i++){var s=~~(i/20);var t=sum32_5(rotl32(a,5),ft_1(s,b,c,d),e,W[i],sha1_K[s]);e=d;d=c;c=rotl32(b,30);b=a;a=t}this.h[0]=sum32(this.h[0],a);this.h[1]=sum32(this.h[1],b);this.h[2]=sum32(this.h[2],c);this.h[3]=sum32(this.h[3],d);this.h[4]=sum32(this.h[4],e)};SHA1.prototype._digest=function digest(enc){if(enc==="hex")return utils.toHex32(this.h,"big");else return utils.split32(this.h,"big")};function ch32(x,y,z){return x&y^~x&z}function maj32(x,y,z){return x&y^x&z^y&z}function p32(x,y,z){return x^y^z}function s0_256(x){return rotr32(x,2)^rotr32(x,13)^rotr32(x,22)}function s1_256(x){return rotr32(x,6)^rotr32(x,11)^rotr32(x,25)}function g0_256(x){return rotr32(x,7)^rotr32(x,18)^x>>>3}function g1_256(x){return rotr32(x,17)^rotr32(x,19)^x>>>10}function ft_1(s,x,y,z){if(s===0)return ch32(x,y,z);if(s===1||s===3)return p32(x,y,z);if(s===2)return maj32(x,y,z)}function ch64_hi(xh,xl,yh,yl,zh,zl){var r=xh&yh^~xh&zh;if(r<0)r+=4294967296;return r}function ch64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^~xl&zl;if(r<0)r+=4294967296;return r}function maj64_hi(xh,xl,yh,yl,zh,zl){var r=xh&yh^xh&zh^yh&zh;if(r<0)r+=4294967296;return r}function maj64_lo(xh,xl,yh,yl,zh,zl){var r=xl&yl^xl&zl^yl&zl;if(r<0)r+=4294967296;return r}function s0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,28);var c1_hi=rotr64_hi(xl,xh,2);var c2_hi=rotr64_hi(xl,xh,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function s0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,28);var c1_lo=rotr64_lo(xl,xh,2);var c2_lo=rotr64_lo(xl,xh,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function s1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,14);var c1_hi=rotr64_hi(xh,xl,18);var c2_hi=rotr64_hi(xl,xh,9);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function s1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,14);var c1_lo=rotr64_lo(xh,xl,18);var c2_lo=rotr64_lo(xl,xh,9);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function g0_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,1);var c1_hi=rotr64_hi(xh,xl,8);var c2_hi=shr64_hi(xh,xl,7);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function g0_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,1);var c1_lo=rotr64_lo(xh,xl,8);var c2_lo=shr64_lo(xh,xl,7);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}function g1_512_hi(xh,xl){var c0_hi=rotr64_hi(xh,xl,19);var c1_hi=rotr64_hi(xl,xh,29);var c2_hi=shr64_hi(xh,xl,6);var r=c0_hi^c1_hi^c2_hi;if(r<0)r+=4294967296;return r}function g1_512_lo(xh,xl){var c0_lo=rotr64_lo(xh,xl,19);var c1_lo=rotr64_lo(xl,xh,29);var c2_lo=shr64_lo(xh,xl,6);var r=c0_lo^c1_lo^c2_lo;if(r<0)r+=4294967296;return r}},{"../hash":285}],290:[function(require,module,exports){var utils=exports;var inherits=require("inherits");function toArray(msg,enc){if(Array.isArray(msg))return msg.slice();if(!msg)return[];var res=[];if(typeof msg==="string"){if(!enc){for(var i=0;i<msg.length;i++){var c=msg.charCodeAt(i);var hi=c>>8;var lo=c&255;if(hi)res.push(hi,lo);else res.push(lo)}}else if(enc==="hex"){msg=msg.replace(/[^a-z0-9]+/gi,"");if(msg.length%2!==0)msg="0"+msg;for(var i=0;i<msg.length;i+=2)res.push(parseInt(msg[i]+msg[i+1],16))}}else{for(var i=0;i<msg.length;i++)res[i]=msg[i]|0}return res}utils.toArray=toArray;function toHex(msg){var res="";for(var i=0;i<msg.length;i++)res+=zero2(msg[i].toString(16));return res}utils.toHex=toHex;function htonl(w){var res=w>>>24|w>>>8&65280|w<<8&16711680|(w&255)<<24;return res>>>0}utils.htonl=htonl;function toHex32(msg,endian){var res="";for(var i=0;i<msg.length;i++){var w=msg[i];if(endian==="little")w=htonl(w);res+=zero8(w.toString(16))}return res}utils.toHex32=toHex32;function zero2(word){if(word.length===1)return"0"+word;else return word}utils.zero2=zero2;function zero8(word){if(word.length===7)return"0"+word;else if(word.length===6)return"00"+word;else if(word.length===5)return"000"+word;else if(word.length===4)return"0000"+word;else if(word.length===3)return"00000"+word;else if(word.length===2)return"000000"+word;else if(word.length===1)return"0000000"+word;else return word}utils.zero8=zero8;function join32(msg,start,end,endian){var len=end-start;assert(len%4===0);var res=new Array(len/4);for(var i=0,k=start;i<res.length;i++,k+=4){var w;if(endian==="big")w=msg[k]<<24|msg[k+1]<<16|msg[k+2]<<8|msg[k+3];else w=msg[k+3]<<24|msg[k+2]<<16|msg[k+1]<<8|msg[k];res[i]=w>>>0}return res}utils.join32=join32;function split32(msg,endian){var res=new Array(msg.length*4);for(var i=0,k=0;i<msg.length;i++,k+=4){var m=msg[i];if(endian==="big"){res[k]=m>>>24;res[k+1]=m>>>16&255;res[k+2]=m>>>8&255;res[k+3]=m&255}else{res[k+3]=m>>>24;res[k+2]=m>>>16&255;res[k+1]=m>>>8&255;res[k]=m&255}}return res}utils.split32=split32;function rotr32(w,b){return w>>>b|w<<32-b}utils.rotr32=rotr32;function rotl32(w,b){return w<<b|w>>>32-b}utils.rotl32=rotl32;function sum32(a,b){return a+b>>>0}utils.sum32=sum32;function sum32_3(a,b,c){return a+b+c>>>0}utils.sum32_3=sum32_3;function sum32_4(a,b,c,d){return a+b+c+d>>>0}utils.sum32_4=sum32_4;function sum32_5(a,b,c,d,e){return a+b+c+d+e>>>0}utils.sum32_5=sum32_5;function assert(cond,msg){if(!cond)throw new Error(msg||"Assertion failed")}utils.assert=assert;utils.inherits=inherits;function sum64(buf,pos,ah,al){var bh=buf[pos];var bl=buf[pos+1];var lo=al+bl>>>0;var hi=(lo<al?1:0)+ah+bh;buf[pos]=hi>>>0;buf[pos+1]=lo}exports.sum64=sum64;function sum64_hi(ah,al,bh,bl){var lo=al+bl>>>0;var hi=(lo<al?1:0)+ah+bh;return hi>>>0}exports.sum64_hi=sum64_hi;function sum64_lo(ah,al,bh,bl){var lo=al+bl;return lo>>>0}exports.sum64_lo=sum64_lo;function sum64_4_hi(ah,al,bh,bl,ch,cl,dh,dl){var carry=0;var lo=al;lo=lo+bl>>>0;carry+=lo<al?1:0;lo=lo+cl>>>0;carry+=lo<cl?1:0;lo=lo+dl>>>0;carry+=lo<dl?1:0;var hi=ah+bh+ch+dh+carry;return hi>>>0}exports.sum64_4_hi=sum64_4_hi;function sum64_4_lo(ah,al,bh,bl,ch,cl,dh,dl){var lo=al+bl+cl+dl;return lo>>>0}exports.sum64_4_lo=sum64_4_lo;function sum64_5_hi(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var carry=0;var lo=al;lo=lo+bl>>>0;carry+=lo<al?1:0;lo=lo+cl>>>0;carry+=lo<cl?1:0;lo=lo+dl>>>0;carry+=lo<dl?1:0;lo=lo+el>>>0;carry+=lo<el?1:0;var hi=ah+bh+ch+dh+eh+carry;return hi>>>0}exports.sum64_5_hi=sum64_5_hi;function sum64_5_lo(ah,al,bh,bl,ch,cl,dh,dl,eh,el){var lo=al+bl+cl+dl+el;return lo>>>0}exports.sum64_5_lo=sum64_5_lo;function rotr64_hi(ah,al,num){var r=al<<32-num|ah>>>num;return r>>>0}exports.rotr64_hi=rotr64_hi;function rotr64_lo(ah,al,num){var r=ah<<32-num|al>>>num;return r>>>0}exports.rotr64_lo=rotr64_lo;function shr64_hi(ah,al,num){return ah>>>num}exports.shr64_hi=shr64_hi;function shr64_lo(ah,al,num){var r=ah<<32-num|al>>>num;return r>>>0}exports.shr64_lo=shr64_lo},{inherits:293}],291:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;

var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],292:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],293:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],294:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],295:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],296:[function(require,module,exports){var bn=require("bn.js");var brorand=require("brorand");function MillerRabin(rand){this.rand=rand||new brorand.Rand}module.exports=MillerRabin;MillerRabin.create=function create(rand){return new MillerRabin(rand)};MillerRabin.prototype._rand=function _rand(n){var len=n.bitLength();var buf=this.rand.generate(Math.ceil(len/8));buf[0]|=3;var mask=len&7;if(mask!==0)buf[buf.length-1]>>=7-mask;return new bn(buf)};MillerRabin.prototype.test=function test(n,k,cb){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);var n2=n1.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);var prime=true;for(;k>0;k--){var a=this._rand(n2);if(cb)cb(a);var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return false;if(x.cmp(rn1)===0)break}if(i===s)return false}return prime};MillerRabin.prototype.getDivisor=function getDivisor(n,k){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);var n2=n1.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);for(;k>0;k--){var a=this._rand(n2);var g=n.gcd(a);if(g.cmpn(1)!==0)return g;var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return x.fromRed().subn(1).gcd(n);if(x.cmp(rn1)===0)break}if(i===s){x=x.redSqr();return x.fromRed().subn(1).gcd(n)}}return false}},{"bn.js":218,brorand:219}],297:[function(require,module,exports){module.exports=assert;function assert(val,msg){if(!val)throw new Error(msg||"Assertion failed")}assert.equal=function assertEqual(l,r,msg){if(l!=r)throw new Error(msg||"Assertion failed: "+l+" != "+r)}},{}],298:[function(require,module,exports){module.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],299:[function(require,module,exports){var asn1=require("asn1.js");var RSAPrivateKey=asn1.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});exports.RSAPrivateKey=RSAPrivateKey;var RSAPublicKey=asn1.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});exports.RSAPublicKey=RSAPublicKey;var PublicKey=asn1.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())});exports.PublicKey=PublicKey;var AlgorithmIdentifier=asn1.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())});var PrivateKeyInfo=asn1.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPrivateKey").octstr())});exports.PrivateKey=PrivateKeyInfo;var EncryptedPrivateKeyInfo=asn1.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});exports.EncryptedPrivateKey=EncryptedPrivateKeyInfo;var DSAPrivateKey=asn1.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});exports.DSAPrivateKey=DSAPrivateKey;exports.DSAparam=asn1.define("DSAparam",function(){this.int()});var ECPrivateKey=asn1.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(ECParameters),this.key("publicKey").optional().explicit(1).bitstr())});exports.ECPrivateKey=ECPrivateKey;var ECParameters=asn1.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});exports.signature=asn1.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},{"asn1.js":202}],300:[function(require,module,exports){(function(Buffer){var findProc=/Proc-Type: 4,ENCRYPTED\r?\nDEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)\r?\n\r?\n([0-9A-z\n\r\+\/\=]+)\r?\n/m;var startRegex=/^-----BEGIN (.*) KEY-----\r?\n/m;var fullRegex=/^-----BEGIN (.*) KEY-----\r?\n([0-9A-z\n\r\+\/\=]+)\r?\n-----END \1 KEY-----$/m;var evp=require("evp_bytestokey");var ciphers=require("browserify-aes");module.exports=function(okey,password){var key=okey.toString();var match=key.match(findProc);var decrypted;if(!match){var match2=key.match(fullRegex);decrypted=new Buffer(match2[2].replace(/\r?\n/g,""),"base64")}else{var suite="aes"+match[1];var iv=new Buffer(match[2],"hex");var cipherText=new Buffer(match[3].replace(/\r?\n/g,""),"base64");var cipherKey=evp(password,iv.slice(0,8),parseInt(match[1],10)).key;var out=[];var cipher=ciphers.createDecipheriv(suite,cipherKey,iv);out.push(cipher.update(cipherText));out.push(cipher.final());decrypted=Buffer.concat(out)}var tag=key.match(startRegex)[1]+" KEY";return{tag:tag,data:decrypted}}}).call(this,require("buffer").Buffer)},{"browserify-aes":223,buffer:247,evp_bytestokey:284}],301:[function(require,module,exports){(function(Buffer){var asn1=require("./asn1");var aesid=require("./aesid.json");var fixProc=require("./fixProc");var ciphers=require("browserify-aes");var compat=require("pbkdf2");module.exports=parseKeys;function parseKeys(buffer){var password;if(typeof buffer==="object"&&!Buffer.isBuffer(buffer)){password=buffer.passphrase;buffer=buffer.key}if(typeof buffer==="string"){buffer=new Buffer(buffer)}var stripped=fixProc(buffer,password);var type=stripped.tag;var data=stripped.data;var subtype,ndata;switch(type){case"PUBLIC KEY":ndata=asn1.PublicKey.decode(data,"der");subtype=ndata.algorithm.algorithm.join(".");switch(subtype){case"1.2.840.113549.1.1.1":return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":ndata.subjectPrivateKey=ndata.subjectPublicKey;return{type:"ec",data:ndata};case"1.2.840.10040.4.1":ndata.algorithm.params.pub_key=asn1.DSAparam.decode(ndata.subjectPublicKey.data,"der");return{type:"dsa",data:ndata.algorithm.params};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"ENCRYPTED PRIVATE KEY":data=asn1.EncryptedPrivateKey.decode(data,"der");data=decrypt(data,password);case"PRIVATE KEY":ndata=asn1.PrivateKey.decode(data,"der");subtype=ndata.algorithm.algorithm.join(".");switch(subtype){case"1.2.840.113549.1.1.1":return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:ndata.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(ndata.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":ndata.algorithm.params.priv_key=asn1.DSAparam.decode(ndata.subjectPrivateKey,"der");return{type:"dsa",params:ndata.algorithm.params};default:throw new Error("unknown key id "+subtype)}throw new Error("unknown key type "+type);case"RSA PUBLIC KEY":return asn1.RSAPublicKey.decode(data,"der");case"RSA PRIVATE KEY":return asn1.RSAPrivateKey.decode(data,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:asn1.DSAPrivateKey.decode(data,"der")};case"EC PRIVATE KEY":data=asn1.ECPrivateKey.decode(data,"der");return{curve:data.parameters.value,privateKey:data.privateKey};default:throw new Error("unknown key type "+type)}}parseKeys.signature=asn1.signature;function decrypt(data,password){var salt=data.algorithm.decrypt.kde.kdeparams.salt;var iters=parseInt(data.algorithm.decrypt.kde.kdeparams.iters.toString(),10);var algo=aesid[data.algorithm.decrypt.cipher.algo.join(".")];var iv=data.algorithm.decrypt.cipher.iv;var cipherText=data.subjectPrivateKey;var keylen=parseInt(algo.split("-")[1],10)/8;var key=compat.pbkdf2Sync(password,salt,iters,keylen);var cipher=ciphers.createDecipheriv(algo,key,iv);var out=[];out.push(cipher.update(cipherText));out.push(cipher.final());return Buffer.concat(out)}}).call(this,require("buffer").Buffer)},{"./aesid.json":298,"./asn1":299,"./fixProc":300,"browserify-aes":223,buffer:247,pbkdf2:303}],302:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:306}],303:[function(require,module,exports){(function(process,Buffer){var createHmac=require("create-hmac");var checkParameters=require("./precondition");exports.pbkdf2=function(password,salt,iterations,keylen,digest,callback){if(typeof digest==="function"){callback=digest;digest=undefined}checkParameters(iterations,keylen);if(typeof callback!=="function")throw new Error("No callback provided to pbkdf2");setTimeout(function(){callback(null,exports.pbkdf2Sync(password,salt,iterations,keylen,digest))})};var defaultEncoding;if(process.browser){defaultEncoding="utf-8"}else{var pVersionMajor=parseInt(process.version.split(".")[0].slice(1),10);defaultEncoding=pVersionMajor>=6?"utf-8":"binary"}exports.pbkdf2Sync=function(password,salt,iterations,keylen,digest){if(!Buffer.isBuffer(password))password=new Buffer(password,defaultEncoding);if(!Buffer.isBuffer(salt))salt=new Buffer(salt,defaultEncoding);checkParameters(iterations,keylen);digest=digest||"sha1";var hLen;var l=1;var DK=new Buffer(keylen);var block1=new Buffer(salt.length+4);salt.copy(block1,0,0,salt.length);var r;var T;for(var i=1;i<=l;i++){block1.writeUInt32BE(i,salt.length);var U=createHmac(digest,password).update(block1).digest();if(!hLen){hLen=U.length;T=new Buffer(hLen);l=Math.ceil(keylen/hLen);r=keylen-(l-1)*hLen}U.copy(T,0,0,hLen);for(var j=1;j<iterations;j++){U=createHmac(digest,password).update(U).digest();for(var k=0;k<hLen;k++)T[k]^=U[k]}var destPos=(i-1)*hLen;var len=i===l?r:hLen;T.copy(DK,destPos,0,len)}return DK}}).call(this,require("_process"),require("buffer").Buffer)},{"./precondition":304,_process:306,buffer:247,"create-hmac":254}],304:[function(require,module,exports){var MAX_ALLOC=Math.pow(2,30)-1;module.exports=function(iterations,keylen){if(typeof iterations!=="number"){throw new TypeError("Iterations not a number")}if(iterations<0){throw new TypeError("Bad iterations")}if(typeof keylen!=="number"){throw new TypeError("Key length not a number")}if(keylen<0||keylen>MAX_ALLOC||keylen!==keylen){throw new TypeError("Bad key length")}}},{}],305:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports=nextTick}else{module.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:306}],306:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],307:[function(require,module,exports){exports.publicEncrypt=require("./publicEncrypt");exports.privateDecrypt=require("./privateDecrypt");exports.privateEncrypt=function privateEncrypt(key,buf){return exports.publicEncrypt(key,buf,true)};exports.publicDecrypt=function publicDecrypt(key,buf){return exports.privateDecrypt(key,buf,true)}},{"./privateDecrypt":309,"./publicEncrypt":310}],308:[function(require,module,exports){(function(Buffer){var createHash=require("create-hash");module.exports=function(seed,len){var t=new Buffer("");var i=0,c;while(t.length<len){c=i2ops(i++);t=Buffer.concat([t,createHash("sha1").update(seed).update(c).digest()])}return t.slice(0,len)};function i2ops(c){var out=new Buffer(4);out.writeUInt32BE(c,0);return out}}).call(this,require("buffer").Buffer)},{buffer:247,"create-hash":251}],309:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var crt=require("browserify-rsa");var createHash=require("create-hash");var withPublic=require("./withPublic");module.exports=function privateDecrypt(private_key,enc,reverse){var padding;if(private_key.padding){padding=private_key.padding}else if(reverse){padding=1}else{padding=4}var key=parseKeys(private_key);var k=key.modulus.byteLength();if(enc.length>k||new bn(enc).cmp(key.modulus)>=0){throw new Error("decryption error")}var msg;if(reverse){msg=withPublic(new bn(enc),key)}else{msg=crt(enc,key)}var zBuffer=new Buffer(k-msg.length);zBuffer.fill(0);msg=Buffer.concat([zBuffer,msg],k);if(padding===4){return oaep(key,msg)}else if(padding===1){return pkcs1(key,msg,reverse)}else if(padding===3){return msg}else{throw new Error("unknown padding")}};function oaep(key,msg){var n=key.modulus;var k=key.modulus.byteLength();var mLen=msg.length;var iHash=createHash("sha1").update(new Buffer("")).digest();var hLen=iHash.length;var hLen2=2*hLen;if(msg[0]!==0){throw new Error("decryption error")}var maskedSeed=msg.slice(1,hLen+1);var maskedDb=msg.slice(hLen+1);var seed=xor(maskedSeed,mgf(maskedDb,hLen));var db=xor(maskedDb,mgf(seed,k-hLen-1));if(compare(iHash,db.slice(0,hLen))){throw new Error("decryption error")}var i=hLen;while(db[i]===0){i++}if(db[i++]!==1){throw new Error("decryption error")}return db.slice(i)}function pkcs1(key,msg,reverse){var p1=msg.slice(0,2);var i=2;var status=0;while(msg[i++]!==0){if(i>=msg.length){status++;break}}var ps=msg.slice(2,i-1);var p2=msg.slice(i-1,i);if(p1.toString("hex")!=="0002"&&!reverse||p1.toString("hex")!=="0001"&&reverse){status++}if(ps.length<8){status++}if(status){throw new Error("decryption error")}return msg.slice(i)}function compare(a,b){a=new Buffer(a);b=new Buffer(b);var dif=0;var len=a.length;if(a.length!==b.length){dif++;len=Math.min(a.length,b.length)}var i=-1;while(++i<len){dif+=a[i]^b[i]}return dif}}).call(this,require("buffer").Buffer)},{"./mgf":308,"./withPublic":311,"./xor":312,"bn.js":218,"browserify-rsa":239,buffer:247,"create-hash":251,"parse-asn1":301}],310:[function(require,module,exports){(function(Buffer){var parseKeys=require("parse-asn1");var randomBytes=require("randombytes");var createHash=require("create-hash");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var withPublic=require("./withPublic");var crt=require("browserify-rsa");var constants={RSA_PKCS1_OAEP_PADDING:4,RSA_PKCS1_PADDIN:1,RSA_NO_PADDING:3};module.exports=function publicEncrypt(public_key,msg,reverse){var padding;if(public_key.padding){padding=public_key.padding}else if(reverse){padding=1}else{padding=4}var key=parseKeys(public_key);var paddedMsg;if(padding===4){paddedMsg=oaep(key,msg)}else if(padding===1){paddedMsg=pkcs1(key,msg,reverse)}else if(padding===3){paddedMsg=new bn(msg);if(paddedMsg.cmp(key.modulus)>=0){throw new Error("data too long for modulus")}}else{throw new Error("unknown padding")}if(reverse){return crt(paddedMsg,key)}else{return withPublic(paddedMsg,key)}};function oaep(key,msg){var k=key.modulus.byteLength();var mLen=msg.length;var iHash=createHash("sha1").update(new Buffer("")).digest();var hLen=iHash.length;var hLen2=2*hLen;if(mLen>k-hLen2-2){throw new Error("message too long")}var ps=new Buffer(k-mLen-hLen2-2);ps.fill(0);var dblen=k-hLen-1;var seed=randomBytes(hLen);var maskedDb=xor(Buffer.concat([iHash,ps,new Buffer([1]),msg],dblen),mgf(seed,dblen));var maskedSeed=xor(seed,mgf(maskedDb,hLen));return new bn(Buffer.concat([new Buffer([0]),maskedSeed,maskedDb],k))}function pkcs1(key,msg,reverse){var mLen=msg.length;var k=key.modulus.byteLength();if(mLen>k-11){throw new Error("message too long")}var ps;if(reverse){ps=new Buffer(k-mLen-3);ps.fill(255)}else{ps=nonZero(k-mLen-3)}return new bn(Buffer.concat([new Buffer([0,reverse?1:2]),ps,new Buffer([0]),msg],k))}function nonZero(len,crypto){var out=new Buffer(len);var i=0;var cache=randomBytes(len*2);var cur=0;var num;while(i<len){if(cur===cache.length){cache=randomBytes(len*2);cur=0}num=cache[cur++];if(num){out[i++]=num}}return out}}).call(this,require("buffer").Buffer)},{"./mgf":308,"./withPublic":311,"./xor":312,"bn.js":218,"browserify-rsa":239,buffer:247,"create-hash":251,"parse-asn1":301,randombytes:313}],311:[function(require,module,exports){(function(Buffer){var bn=require("bn.js");function withPublic(paddedMsg,key){return new Buffer(paddedMsg.toRed(bn.mont(key.modulus)).redPow(new bn(key.publicExponent)).fromRed().toArray())}module.exports=withPublic}).call(this,require("buffer").Buffer)},{"bn.js":218,buffer:247}],312:[function(require,module,exports){module.exports=function xor(a,b){var len=a.length;var i=-1;while(++i<len){a[i]^=b[i]}return a}},{}],313:[function(require,module,exports){(function(process,global,Buffer){"use strict";function oldBrowser(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){module.exports=randomBytes}else{module.exports=oldBrowser}function randomBytes(size,cb){if(size>65536)throw new Error("requested too many random bytes");var rawBytes=new global.Uint8Array(size);if(size>0){crypto.getRandomValues(rawBytes)}var bytes=new Buffer(rawBytes.buffer);if(typeof cb==="function"){return process.nextTick(function(){cb(null,bytes)})}return bytes}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{_process:306,buffer:247}],314:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":315}],315:[function(require,module,exports){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var processNextTick=require("process-nextick-args");var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self){self.end()}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}},{"./_stream_readable":317,"./_stream_writable":319,"core-util-is":249,inherits:293,"process-nextick-args":305}],316:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":318,"core-util-is":249,inherits:293}],317:[function(require,module,exports){(function(process){"use strict";module.exports=Readable;var processNextTick=require("process-nextick-args");var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var StringDecoder;util.inherits(Readable,Stream);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(!state.objectMode&&typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state.reading=false;onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state.decoder&&!addToFront&&!encoding){chunk=state.decoder.write(chunk);skipAdd=!state.objectMode&&chunk.length===0}if(!addToFront)state.reading=false;if(!skipAdd){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;

if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;processNextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){processNextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;processNextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=bufferShim.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;processNextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":315,"./internal/streams/BufferList":320,_process:306,buffer:247,"buffer-shims":245,"core-util-is":249,events:283,inherits:293,isarray:295,"process-nextick-args":305,"string_decoder/":335,util:220}],318:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==undefined)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":315,"core-util-is":249,inherits:293}],319:[function(require,module,exports){(function(process){"use strict";module.exports=Writable;var processNextTick=require("process-nextick-args");var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream;(function(){try{Stream=require("st"+"ream")}catch(_){}finally{if(!Stream)Stream=require("events").EventEmitter}})();var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(!Buffer.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequestCount=0;state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else{prefinish(stream,state)}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)processNextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=_this}else{state.corkedRequestsFree=_this}}}}).call(this,require("_process"))},{"./_stream_duplex":315,_process:306,buffer:247,"buffer-shims":245,"core-util-is":249,events:283,inherits:293,"process-nextick-args":305,"util-deprecate":336}],320:[function(require,module,exports){"use strict";var Buffer=require("buffer").Buffer;var bufferShim=require("buffer-shims");module.exports=BufferList;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return bufferShim.alloc(0);if(this.length===1)return this.head.data;var ret=bufferShim.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){p.data.copy(ret,i);i+=p.data.length;p=p.next}return ret}},{buffer:247,"buffer-shims":245}],321:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":316}],322:[function(require,module,exports){(function(process){var Stream=function(){try{return require("st"+"ream")}catch(_){}}();exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream||exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js");if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module.exports=Stream}}).call(this,require("_process"))},{"./lib/_stream_duplex.js":315,"./lib/_stream_passthrough.js":316,"./lib/_stream_readable.js":317,"./lib/_stream_transform.js":318,"./lib/_stream_writable.js":319,_process:306}],323:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":318}],324:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":319}],325:[function(require,module,exports){(function(Buffer){var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];var hl=[0,1518500249,1859775393,2400959708,2840853838];var hr=[1352829926,1548603684,1836072691,2053994217,0];function bytesToWords(bytes){var words=[];for(var i=0,b=0;i<bytes.length;i++,b+=8){words[b>>>5]|=bytes[i]<<24-b%32}return words}function wordsToBytes(words){var bytes=[];for(var b=0;b<words.length*32;b+=8){bytes.push(words[b>>>5]>>>24-b%32&255)}return bytes}function processBlock(H,M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var al,bl,cl,dl,el;var ar,br,cr,dr,er;ar=al=H[0];br=bl=H[1];cr=cl=H[2];dr=dl=H[3];er=el=H[4];var t;for(i=0;i<80;i+=1){t=al+M[offset+zl[i]]|0;if(i<16){t+=f1(bl,cl,dl)+hl[0]}else if(i<32){t+=f2(bl,cl,dl)+hl[1]}else if(i<48){t+=f3(bl,cl,dl)+hl[2]}else if(i<64){t+=f4(bl,cl,dl)+hl[3]}else{t+=f5(bl,cl,dl)+hl[4]}t=t|0;t=rotl(t,sl[i]);t=t+el|0;al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=t;t=ar+M[offset+zr[i]]|0;if(i<16){t+=f5(br,cr,dr)+hr[0]}else if(i<32){t+=f4(br,cr,dr)+hr[1]}else if(i<48){t+=f3(br,cr,dr)+hr[2]}else if(i<64){t+=f2(br,cr,dr)+hr[3]}else{t+=f1(br,cr,dr)+hr[4]}t=t|0;t=rotl(t,sr[i]);t=t+er|0;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=t}t=H[1]+cl+dr|0;H[1]=H[2]+dl+er|0;H[2]=H[3]+el+ar|0;H[3]=H[4]+al+br|0;H[4]=H[0]+bl+cr|0;H[0]=t}function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}function ripemd160(message){var H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof message==="string"){message=new Buffer(message,"utf8")}var m=bytesToWords(message);var nBitsLeft=message.length*8;var nBitsTotal=message.length*8;m[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;m[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotal<<8|nBitsTotal>>>24)&16711935|(nBitsTotal<<24|nBitsTotal>>>8)&4278255360;for(var i=0;i<m.length;i+=16){processBlock(H,m,i)}for(i=0;i<5;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}var digestbytes=wordsToBytes(H);return new Buffer(digestbytes)}module.exports=ripemd160}).call(this,require("buffer").Buffer)},{buffer:247}],326:[function(require,module,exports){(function(Buffer){function Hash(blockSize,finalSize){this._block=new Buffer(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0;this._s=0}Hash.prototype.update=function(data,enc){if(typeof data==="string"){enc=enc||"utf8";data=new Buffer(data,enc)}var l=this._len+=data.length;var s=this._s||0;var f=0;var buffer=this._block;while(s<l){var t=Math.min(data.length,f+this._blockSize-s%this._blockSize);var ch=t-f;for(var i=0;i<ch;i++){buffer[s%this._blockSize+i]=data[i+f]}s+=ch;f+=ch;if(s%this._blockSize===0){this._update(buffer)}}this._s=s;return this};Hash.prototype.digest=function(enc){var l=this._len*8;this._block[this._len%this._blockSize]=128;this._block.fill(0,this._len%this._blockSize+1);if(l%(this._blockSize*8)>=this._finalSize*8){this._update(this._block);this._block.fill(0)}this._block.writeInt32BE(l,this._blockSize-4);var hash=this._update(this._block)||this._hash();return enc?hash.toString(enc):hash};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};module.exports=Hash}).call(this,require("buffer").Buffer)},{buffer:247}],327:[function(require,module,exports){var exports=module.exports=function SHA(algorithm){algorithm=algorithm.toLowerCase();var Algorithm=exports[algorithm];if(!Algorithm)throw new Error(algorithm+" is not supported (we accept pull requests)");return new Algorithm};exports.sha=require("./sha");exports.sha1=require("./sha1");exports.sha224=require("./sha224");exports.sha256=require("./sha256");exports.sha384=require("./sha384");exports.sha512=require("./sha512")},{"./sha":328,"./sha1":329,"./sha224":330,"./sha256":331,"./sha384":332,"./sha512":333}],328:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha,Hash);Sha.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;if(s===2)return b&c|b&d|c&d;return b^c^d}Sha.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=W[i-3]^W[i-8]^W[i-14]^W[i-16];for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha}).call(this,require("buffer").Buffer)},{"./hash":326,buffer:247,inherits:293}],329:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha1(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha1,Hash);Sha1.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl1(num){return num<<1|num>>>31}function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;

if(s===2)return b&c|b&d|c&d;return b^c^d}Sha1.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=rotl1(W[i-3]^W[i-8]^W[i-14]^W[i-16]);for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha1.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha1}).call(this,require("buffer").Buffer)},{"./hash":326,buffer:247,inherits:293}],330:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Sha256=require("./sha256");var Hash=require("./hash");var W=new Array(64);function Sha224(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha224,Sha256);Sha224.prototype.init=function(){this._a=3238371032;this._b=914150663;this._c=812702999;this._d=4144912697;this._e=4290775857;this._f=1750603025;this._g=1694076839;this._h=3204075428;return this};Sha224.prototype._hash=function(){var H=new Buffer(28);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);return H};module.exports=Sha224}).call(this,require("buffer").Buffer)},{"./hash":326,"./sha256":331,buffer:247,inherits:293}],331:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var W=new Array(64);function Sha256(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha256,Hash);Sha256.prototype.init=function(){this._a=1779033703;this._b=3144134277;this._c=1013904242;this._d=2773480762;this._e=1359893119;this._f=2600822924;this._g=528734635;this._h=1541459225;return this};function ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function gamma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}function gamma1(x){return(x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10}Sha256.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<64;++i)W[i]=gamma1(W[i-2])+W[i-7]+gamma0(W[i-15])+W[i-16]|0;for(var j=0;j<64;++j){var T1=h+sigma1(e)+ch(e,f,g)+K[j]+W[j]|0;var T2=sigma0(a)+maj(a,b,c)|0;h=g;g=f;f=e;e=d+T1|0;d=c;c=b;b=a;a=T1+T2|0}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){var H=new Buffer(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};module.exports=Sha256}).call(this,require("buffer").Buffer)},{"./hash":326,buffer:247,inherits:293}],332:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var SHA512=require("./sha512");var Hash=require("./hash");var W=new Array(160);function Sha384(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){this._ah=3418070365;this._bh=1654270250;this._ch=2438529370;this._dh=355462360;this._eh=1731405415;this._fh=2394180231;this._gh=3675008525;this._hh=1203062813;this._al=3238371032;this._bl=914150663;this._cl=812702999;this._dl=4144912697;this._el=4290775857;this._fl=1750603025;this._gl=1694076839;this._hl=3204075428;return this};Sha384.prototype._hash=function(){var H=new Buffer(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);return H};module.exports=Sha384}).call(this,require("buffer").Buffer)},{"./hash":326,"./sha512":333,buffer:247,inherits:293}],333:[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var W=new Array(160);function Sha512(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha512,Hash);Sha512.prototype.init=function(){this._ah=1779033703;this._bh=3144134277;this._ch=1013904242;this._dh=2773480762;this._eh=1359893119;this._fh=2600822924;this._gh=528734635;this._hh=1541459225;this._al=4089235720;this._bl=2227873595;this._cl=4271175723;this._dl=1595750129;this._el=2917565137;this._fl=725511199;this._gl=4215389547;this._hl=327033209;return this};function Ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x,xl){return(x>>>28|xl<<4)^(xl>>>2|x<<30)^(xl>>>7|x<<25)}function sigma1(x,xl){return(x>>>14|xl<<18)^(x>>>18|xl<<14)^(xl>>>9|x<<23)}function Gamma0(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^x>>>7}function Gamma0l(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7|xl<<25)}function Gamma1(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^x>>>6}function Gamma1l(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6|xl<<26)}function getCarry(a,b){return a>>>0<b>>>0?1:0}Sha512.prototype._update=function(M){var W=this._w;var ah=this._ah|0;var bh=this._bh|0;var ch=this._ch|0;var dh=this._dh|0;var eh=this._eh|0;var fh=this._fh|0;var gh=this._gh|0;var hh=this._hh|0;var al=this._al|0;var bl=this._bl|0;var cl=this._cl|0;var dl=this._dl|0;var el=this._el|0;var fl=this._fl|0;var gl=this._gl|0;var hl=this._hl|0;for(var i=0;i<32;i+=2){W[i]=M.readInt32BE(i*4);W[i+1]=M.readInt32BE(i*4+4)}for(;i<160;i+=2){var xh=W[i-15*2];var xl=W[i-15*2+1];var gamma0=Gamma0(xh,xl);var gamma0l=Gamma0l(xl,xh);xh=W[i-2*2];xl=W[i-2*2+1];var gamma1=Gamma1(xh,xl);var gamma1l=Gamma1l(xl,xh);var Wi7h=W[i-7*2];var Wi7l=W[i-7*2+1];var Wi16h=W[i-16*2];var Wi16l=W[i-16*2+1];var Wil=gamma0l+Wi7l|0;var Wih=gamma0+Wi7h+getCarry(Wil,gamma0l)|0;Wil=Wil+gamma1l|0;Wih=Wih+gamma1+getCarry(Wil,gamma1l)|0;Wil=Wil+Wi16l|0;Wih=Wih+Wi16h+getCarry(Wil,Wi16l)|0;W[i]=Wih;W[i+1]=Wil}for(var j=0;j<160;j+=2){Wih=W[j];Wil=W[j+1];var majh=maj(ah,bh,ch);var majl=maj(al,bl,cl);var sigma0h=sigma0(ah,al);var sigma0l=sigma0(al,ah);var sigma1h=sigma1(eh,el);var sigma1l=sigma1(el,eh);var Kih=K[j];var Kil=K[j+1];var chh=Ch(eh,fh,gh);var chl=Ch(el,fl,gl);var t1l=hl+sigma1l|0;var t1h=hh+sigma1h+getCarry(t1l,hl)|0;t1l=t1l+chl|0;t1h=t1h+chh+getCarry(t1l,chl)|0;t1l=t1l+Kil|0;t1h=t1h+Kih+getCarry(t1l,Kil)|0;t1l=t1l+Wil|0;t1h=t1h+Wih+getCarry(t1l,Wil)|0;var t2l=sigma0l+majl|0;var t2h=sigma0h+majh+getCarry(t2l,sigma0l)|0;hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;el=dl+t1l|0;eh=dh+t1h+getCarry(el,dl)|0;dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;al=t1l+t2l|0;ah=t1h+t2h+getCarry(al,t1l)|0}this._al=this._al+al|0;this._bl=this._bl+bl|0;this._cl=this._cl+cl|0;this._dl=this._dl+dl|0;this._el=this._el+el|0;this._fl=this._fl+fl|0;this._gl=this._gl+gl|0;this._hl=this._hl+hl|0;this._ah=this._ah+ah+getCarry(this._al,al)|0;this._bh=this._bh+bh+getCarry(this._bl,bl)|0;this._ch=this._ch+ch+getCarry(this._cl,cl)|0;this._dh=this._dh+dh+getCarry(this._dl,dl)|0;this._eh=this._eh+eh+getCarry(this._el,el)|0;this._fh=this._fh+fh+getCarry(this._fl,fl)|0;this._gh=this._gh+gh+getCarry(this._gl,gl)|0;this._hh=this._hh+hh+getCarry(this._hl,hl)|0};Sha512.prototype._hash=function(){var H=new Buffer(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);writeInt64BE(this._gh,this._gl,48);writeInt64BE(this._hh,this._hl,56);return H};module.exports=Sha512}).call(this,require("buffer").Buffer)},{"./hash":326,buffer:247,inherits:293}],334:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:283,inherits:293,"readable-stream/duplex.js":314,"readable-stream/passthrough.js":321,"readable-stream/readable.js":322,"readable-stream/transform.js":323,"readable-stream/writable.js":324}],335:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:247}],336:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],337:[function(require,module,exports){arguments[4][293][0].apply(exports,arguments)},{dup:293}],338:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],339:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":338,_process:306,inherits:337}],340:[function(require,module,exports){var indexOf=require("indexof");var Object_keys=function(obj){if(Object.keys)return Object.keys(obj);else{var res=[];for(var key in obj)res.push(key);return res}};var forEach=function(xs,fn){if(xs.forEach)return xs.forEach(fn);else for(var i=0;i<xs.length;i++){fn(xs[i],i,xs)}};var defineProp=function(){try{Object.defineProperty({},"_",{});return function(obj,name,value){Object.defineProperty(obj,name,{writable:true,enumerable:false,configurable:true,value:value})}}catch(e){return function(obj,name,value){obj[name]=value}}}();var globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function NodeScript(code){if(!(this instanceof Script))return new Script(code);this.code=code};Script.prototype.runInContext=function(context){if(!(context instanceof Context)){throw new TypeError("needs a 'context' argument.")}var iframe=document.createElement("iframe");if(!iframe.style)iframe.style={};iframe.style.display="none";document.body.appendChild(iframe);var win=iframe.contentWindow;var wEval=win.eval,wExecScript=win.execScript;if(!wEval&&wExecScript){wExecScript.call(win,"null");wEval=win.eval}forEach(Object_keys(context),function(key){win[key]=context[key]});forEach(globals,function(key){if(context[key]){win[key]=context[key]}});var winKeys=Object_keys(win);var res=wEval.call(win,this.code);forEach(Object_keys(win),function(key){if(key in context||indexOf(winKeys,key)===-1){context[key]=win[key]}});forEach(globals,function(key){if(!(key in context)){defineProp(context,key,win[key])}});document.body.removeChild(iframe);return res};Script.prototype.runInThisContext=function(){return eval(this.code)};Script.prototype.runInNewContext=function(context){var ctx=Script.createContext(context);var res=this.runInContext(ctx);forEach(Object_keys(ctx),function(key){context[key]=ctx[key]});return res};forEach(Object_keys(Script.prototype),function(name){exports[name]=Script[name]=function(code){var s=Script(code);return s[name].apply(s,[].slice.call(arguments,1))}});exports.createScript=function(code){return exports.Script(code)};exports.createContext=Script.createContext=function(context){var copy=new Context;if(typeof context==="object"){forEach(Object_keys(context),function(key){copy[key]=context[key]})}return copy}},{indexof:292}]},{},[153]);